<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.1f9bc03c.js" as="script"><link rel="preload" href="/assets/js/3.be9e7e99.js" as="script"><link rel="preload" href="/assets/js/2.c36d0987.js" as="script"><link rel="preload" href="/assets/js/10.57dc9feb.js" as="script"><link rel="prefetch" href="/assets/js/1.0094a9f8.js"><link rel="prefetch" href="/assets/js/100.549e8107.js"><link rel="prefetch" href="/assets/js/101.cdc9900a.js"><link rel="prefetch" href="/assets/js/102.559eb4e1.js"><link rel="prefetch" href="/assets/js/103.e93e873a.js"><link rel="prefetch" href="/assets/js/104.f72a97fa.js"><link rel="prefetch" href="/assets/js/105.8a88aff1.js"><link rel="prefetch" href="/assets/js/106.a6928366.js"><link rel="prefetch" href="/assets/js/107.88f8c8a9.js"><link rel="prefetch" href="/assets/js/108.221fcd72.js"><link rel="prefetch" href="/assets/js/109.83b01a4c.js"><link rel="prefetch" href="/assets/js/11.95ba941a.js"><link rel="prefetch" href="/assets/js/110.3a8bfc21.js"><link rel="prefetch" href="/assets/js/111.e09a67c7.js"><link rel="prefetch" href="/assets/js/112.8f29c828.js"><link rel="prefetch" href="/assets/js/113.a3ec218a.js"><link rel="prefetch" href="/assets/js/114.46baaf9a.js"><link rel="prefetch" href="/assets/js/115.dca2a47e.js"><link rel="prefetch" href="/assets/js/116.95b35ab7.js"><link rel="prefetch" href="/assets/js/117.748a7942.js"><link rel="prefetch" href="/assets/js/118.9baa4784.js"><link rel="prefetch" href="/assets/js/119.c98d396a.js"><link rel="prefetch" href="/assets/js/12.3e375fac.js"><link rel="prefetch" href="/assets/js/120.c56ebb20.js"><link rel="prefetch" href="/assets/js/121.0046ecb9.js"><link rel="prefetch" href="/assets/js/122.9266562d.js"><link rel="prefetch" href="/assets/js/123.607dd163.js"><link rel="prefetch" href="/assets/js/124.f902b1cd.js"><link rel="prefetch" href="/assets/js/125.a1fc58d3.js"><link rel="prefetch" href="/assets/js/126.0f7e19b0.js"><link rel="prefetch" href="/assets/js/127.0849390a.js"><link rel="prefetch" href="/assets/js/128.948551ba.js"><link rel="prefetch" href="/assets/js/129.d9ca416a.js"><link rel="prefetch" href="/assets/js/13.e15907e1.js"><link rel="prefetch" href="/assets/js/130.24c7e3fb.js"><link rel="prefetch" href="/assets/js/131.1b011ee5.js"><link rel="prefetch" href="/assets/js/132.8751add7.js"><link rel="prefetch" href="/assets/js/133.715ef8cf.js"><link rel="prefetch" href="/assets/js/14.8bc7a04e.js"><link rel="prefetch" href="/assets/js/15.45052e8a.js"><link rel="prefetch" href="/assets/js/16.9c02512f.js"><link rel="prefetch" href="/assets/js/17.48a859d1.js"><link rel="prefetch" href="/assets/js/18.5c00cde2.js"><link rel="prefetch" href="/assets/js/19.a40de13b.js"><link rel="prefetch" href="/assets/js/20.df43b03f.js"><link rel="prefetch" href="/assets/js/21.ceeba2d0.js"><link rel="prefetch" href="/assets/js/22.1bba0f00.js"><link rel="prefetch" href="/assets/js/23.76e4c23a.js"><link rel="prefetch" href="/assets/js/24.f9c3a106.js"><link rel="prefetch" href="/assets/js/25.d3ac7e27.js"><link rel="prefetch" href="/assets/js/26.2dccc980.js"><link rel="prefetch" href="/assets/js/27.470222d7.js"><link rel="prefetch" href="/assets/js/28.0083644b.js"><link rel="prefetch" href="/assets/js/29.c51b5005.js"><link rel="prefetch" href="/assets/js/30.e4d96a02.js"><link rel="prefetch" href="/assets/js/31.a6e5f592.js"><link rel="prefetch" href="/assets/js/32.f513417c.js"><link rel="prefetch" href="/assets/js/33.a02e512f.js"><link rel="prefetch" href="/assets/js/34.828ac0a3.js"><link rel="prefetch" href="/assets/js/35.6a8d3b2a.js"><link rel="prefetch" href="/assets/js/36.a17d9cce.js"><link rel="prefetch" href="/assets/js/37.b28188f4.js"><link rel="prefetch" href="/assets/js/38.6c0bad74.js"><link rel="prefetch" href="/assets/js/39.4ac705c3.js"><link rel="prefetch" href="/assets/js/4.80fad3d6.js"><link rel="prefetch" href="/assets/js/40.e1295e6b.js"><link rel="prefetch" href="/assets/js/41.ab0dc1d3.js"><link rel="prefetch" href="/assets/js/42.abf81f78.js"><link rel="prefetch" href="/assets/js/43.c6055770.js"><link rel="prefetch" href="/assets/js/44.2adf0a62.js"><link rel="prefetch" href="/assets/js/45.dfeaf4aa.js"><link rel="prefetch" href="/assets/js/46.4b7c2b21.js"><link rel="prefetch" href="/assets/js/47.d4a6831e.js"><link rel="prefetch" href="/assets/js/48.e1366a45.js"><link rel="prefetch" href="/assets/js/49.1bebc46f.js"><link rel="prefetch" href="/assets/js/5.1478cf6c.js"><link rel="prefetch" href="/assets/js/50.668f9cb0.js"><link rel="prefetch" href="/assets/js/51.dea0d5d9.js"><link rel="prefetch" href="/assets/js/52.3000ebc8.js"><link rel="prefetch" href="/assets/js/53.66f5ad34.js"><link rel="prefetch" href="/assets/js/54.319b0662.js"><link rel="prefetch" href="/assets/js/55.ffc0758d.js"><link rel="prefetch" href="/assets/js/56.b67a2b8d.js"><link rel="prefetch" href="/assets/js/57.70e2950c.js"><link rel="prefetch" href="/assets/js/58.a0a2420f.js"><link rel="prefetch" href="/assets/js/59.01790419.js"><link rel="prefetch" href="/assets/js/6.3409ab2f.js"><link rel="prefetch" href="/assets/js/60.43219c1e.js"><link rel="prefetch" href="/assets/js/61.ed48312b.js"><link rel="prefetch" href="/assets/js/62.62ea2fef.js"><link rel="prefetch" href="/assets/js/63.d1527c65.js"><link rel="prefetch" href="/assets/js/64.b10abcac.js"><link rel="prefetch" href="/assets/js/65.2206c2d8.js"><link rel="prefetch" href="/assets/js/66.bd612805.js"><link rel="prefetch" href="/assets/js/67.ad9c475a.js"><link rel="prefetch" href="/assets/js/68.7f975389.js"><link rel="prefetch" href="/assets/js/69.36725aff.js"><link rel="prefetch" href="/assets/js/70.b3cfc9e1.js"><link rel="prefetch" href="/assets/js/71.ef2c6abc.js"><link rel="prefetch" href="/assets/js/72.77bf484b.js"><link rel="prefetch" href="/assets/js/73.ca8e0259.js"><link rel="prefetch" href="/assets/js/74.9aa20efa.js"><link rel="prefetch" href="/assets/js/75.9de36ec8.js"><link rel="prefetch" href="/assets/js/76.79e8f077.js"><link rel="prefetch" href="/assets/js/77.a71d38fe.js"><link rel="prefetch" href="/assets/js/78.2168cfa5.js"><link rel="prefetch" href="/assets/js/79.d830dc29.js"><link rel="prefetch" href="/assets/js/80.ed07f097.js"><link rel="prefetch" href="/assets/js/81.036542c0.js"><link rel="prefetch" href="/assets/js/82.ccd57590.js"><link rel="prefetch" href="/assets/js/83.08279d07.js"><link rel="prefetch" href="/assets/js/84.fb82a36b.js"><link rel="prefetch" href="/assets/js/85.cc257bf7.js"><link rel="prefetch" href="/assets/js/86.9b4a4d60.js"><link rel="prefetch" href="/assets/js/87.be2fbadd.js"><link rel="prefetch" href="/assets/js/88.5dbe3bf4.js"><link rel="prefetch" href="/assets/js/89.baa4fea0.js"><link rel="prefetch" href="/assets/js/9.9ffa17fb.js"><link rel="prefetch" href="/assets/js/90.0b8138d9.js"><link rel="prefetch" href="/assets/js/91.6c5e4907.js"><link rel="prefetch" href="/assets/js/92.d4a76597.js"><link rel="prefetch" href="/assets/js/93.8a94df70.js"><link rel="prefetch" href="/assets/js/94.ed88a857.js"><link rel="prefetch" href="/assets/js/95.2f75b854.js"><link rel="prefetch" href="/assets/js/96.6946c831.js"><link rel="prefetch" href="/assets/js/97.b26e97d9.js"><link rel="prefetch" href="/assets/js/98.07ba851b.js"><link rel="prefetch" href="/assets/js/99.347e0865.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.cc39ba74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li><li class="dropdown-subitem"><a href="/java-basic/java-web/" class="nav-link">JavaWeb 技术</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title router-link-active">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" aria-current="page" class="nav-link router-link-exact-active router-link-active">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li><li class="dropdown-subitem"><a href="/java-basic/java-web/" class="nav-link">JavaWeb 技术</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title router-link-active">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" aria-current="page" class="nav-link router-link-exact-active router-link-active">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/micro-service-core/SpringCloud/" aria-current="page" class="active sidebar-link">Spring Cloud</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#微服务零基础理论知识入门" class="sidebar-link">微服务零基础理论知识入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#什么是微服务架构" class="sidebar-link">什么是微服务架构</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#springcloud" class="sidebar-link">SpringCloud</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#springcloud-组件" class="sidebar-link">SpringCloud 组件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#微服务架构编码-base-工程模块构建" class="sidebar-link">微服务架构编码 Base 工程模块构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#版本选择" class="sidebar-link">版本选择</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#订单-支付业务需求说明" class="sidebar-link">订单-支付业务需求说明</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#idea-新建-project-和-maven-父工程" class="sidebar-link">IDEA 新建 Project 和 Maven 父工程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#微服务-cloud-整体聚合-maven-父工程-project" class="sidebar-link">微服务 Cloud 整体聚合 Maven 父工程 Project</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#父工程-pom-文件内容" class="sidebar-link">父工程 POM 文件内容</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#小细节复习" class="sidebar-link">小细节复习</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#mysql-驱动说明" class="sidebar-link">Mysql 驱动说明</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#mysql-5-7" class="sidebar-link">MySQL 5.7</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#mysql-8-x" class="sidebar-link">MySQL 8.x</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#mapper4-之一键生成" class="sidebar-link">Mapper4 之一键生成</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#mybatis-genetator" class="sidebar-link">mybatis-genetator</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#mybatis-通用-mapper4" class="sidebar-link">MyBatis 通用 Mapper4</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#一键生成步骤" class="sidebar-link">一键生成步骤</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#rest-通用-base-工程构建" class="sidebar-link">Rest 通用 Base 工程构建</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#工程-v1-cloud-provider-payment8001-微服务提供者支付-module-模块" class="sidebar-link">工程 V1 cloud-provider-payment8001 微服务提供者支付 Module 模块</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#微服务小口诀" class="sidebar-link">微服务小口诀</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#步骤" class="sidebar-link">步骤</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#建-module-cloud-provider-payment8001" class="sidebar-link">建 module cloud-provider-payment8001</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#改-pom" class="sidebar-link">改 POM</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#写-yml-application-yml" class="sidebar-link">写 YML application.yml</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#主启动-修改-main-类名为-main8001" class="sidebar-link">主启动（修改 Main 类名为 Main8001）</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#业务类" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#postman" class="sidebar-link">PostMan</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#swagger3" class="sidebar-link">Swagger3</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#上述模块还有那些问题" class="sidebar-link">上述模块还有那些问题</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#工程-v2-cloud-provider-payment8001-微服务提供者支付-module-模块-v2-改进版" class="sidebar-link">工程 V2 cloud-provider-payment8001 微服务提供者支付 Module 模块 V2 改进版++</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#解决-时间格式问题" class="sidebar-link">解决：时间格式问题</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#解决-统一返回值" class="sidebar-link">解决：统一返回值</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#http-请求返回的状态码" class="sidebar-link">HTTP 请求返回的状态码</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#思路" class="sidebar-link">思路</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#步骤-2" class="sidebar-link">步骤</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#修改-paycontroller" class="sidebar-link">修改 PayController</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#测试-2" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#结论" class="sidebar-link">结论</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#如果某个方法有-bug" class="sidebar-link">如果某个方法有 bug</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#解决-全局异常接入返回的标准格式" class="sidebar-link">解决：全局异常接入返回的标准格式</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#为什么需要全局异常处理器" class="sidebar-link">为什么需要全局异常处理器</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#新建全局异常类-globalexceptionhandler" class="sidebar-link">新建全局异常类 GlobalExceptionHandler</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#修改-controller" class="sidebar-link">修改 Controller</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#目前工程目录结构" class="sidebar-link">目前工程目录结构</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#引入微服务理念-从这里开始" class="sidebar-link">引入微服务理念，从这里开始</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#cloud-consumer-order80-微服务调用者订单-module-模块" class="sidebar-link">cloud-consumer-order80 微服务调用者订单 Module 模块</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#建-cloud-consumer-order80" class="sidebar-link">建 cloud-consumer-order80</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#改-pom-2" class="sidebar-link">改 POM</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#写-yml-application-yml-2" class="sidebar-link">写 YML application.yml</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#主启动-修改-main-类名为-main80" class="sidebar-link">主启动（修改 Main 类名为 Main80）</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#业务类-2" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#entities" class="sidebar-link">entities</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#resultdata-统一返回值也从-8001-拷贝进来" class="sidebar-link">ResultData 统一返回值也从 8001 拷贝进来</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#resttemplete" class="sidebar-link">RestTemplete</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#config-配置类" class="sidebar-link">config 配置类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#controller" class="sidebar-link">controller</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#postman-测试" class="sidebar-link">PostMan 测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#工程重构" class="sidebar-link">工程重构</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#存在问题" class="sidebar-link">存在问题</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#新建-module" class="sidebar-link">新建 Module</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#改-pom-3" class="sidebar-link">改 POM</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#entities、全局异常类" class="sidebar-link">entities、全局异常类</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#maven-命令-clean-install" class="sidebar-link">maven 命令 clean install</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#订单-80-和支付-8001-分别改造" class="sidebar-link">订单 80 和支付 8001 分别改造</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#postman-测试-2" class="sidebar-link">postman 测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#目前工程样图" class="sidebar-link">目前工程样图</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#为什么要引入微服务" class="sidebar-link">为什么要引入微服务</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#consul-服务注册与发现" class="sidebar-link">Consul 服务注册与发现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#为什么要引入服务注册中心" class="sidebar-link">为什么要引入服务注册中心</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#为什么不再使用传统老牌的-eureka" class="sidebar-link">为什么不再使用传统老牌的 Eureka</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#consul-简介" class="sidebar-link">consul 简介</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#是什么" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#能干啥" class="sidebar-link">能干啥</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#去哪下" class="sidebar-link">去哪下</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#怎么玩" class="sidebar-link">怎么玩</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#安装并运行-consul" class="sidebar-link">安装并运行 consul</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#下载安装" class="sidebar-link">下载安装</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#使用开发模式启动" class="sidebar-link">使用开发模式启动</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#服务注册与发现" class="sidebar-link">服务注册与发现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#支付服务-provider8001-注册进-consul" class="sidebar-link">支付服务 provider8001 注册进 consul</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#消费者服务-consumer-order80-注册进-consul" class="sidebar-link">消费者服务 consumer-order80 注册进 consul</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#三个注册中心异同点" class="sidebar-link">三个注册中心异同点</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#cap" class="sidebar-link">CAP</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#经典-cap-图" class="sidebar-link">经典 CAP 图</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#ap-eureka" class="sidebar-link">AP(Eureka)</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#cp-zookeeper-consul" class="sidebar-link">CP(Zookeeper/Consul)</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#服务配置与刷新" class="sidebar-link">服务配置与刷新</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#分布式系统面临的配置问题" class="sidebar-link">分布式系统面临的配置问题</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#服务配置案例步骤" class="sidebar-link">服务配置案例步骤</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#需求" class="sidebar-link">需求</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#修改-cloud-provider-payment8001" class="sidebar-link">修改 cloud-provider-payment8001</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#pom-中新增依赖" class="sidebar-link">POM 中新增依赖</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#yml" class="sidebar-link">YML</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#配置规则说明" class="sidebar-link">配置规则说明</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#新增配置文件-bootstrap-yml" class="sidebar-link">新增配置文件 bootstrap.yml</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#修改-application-yml-配置" class="sidebar-link">修改 application.yml 配置</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#consul-服务器-key-value-配置填写" class="sidebar-link">consul 服务器 key/value 配置填写</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#修改-controller-2" class="sidebar-link">修改 controller</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#测试-3" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#动态刷新案例步骤" class="sidebar-link">动态刷新案例步骤</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#步骤-3" class="sidebar-link">步骤</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#思考" class="sidebar-link">思考</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#loadbalancer-负载均衡服务调用" class="sidebar-link">LoadBalancer 负载均衡服务调用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#ribbon-目前也进入维护模式" class="sidebar-link">Ribbon 目前也进入维护模式</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#是什么-2" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#维护模式不再介绍-了解即可" class="sidebar-link">维护模式不再介绍，了解即可</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#ribbon-未来替换方案-spring-cloud-loadbalancer" class="sidebar-link">Ribbon 未来替换方案：spring-cloud-loadbalancer</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#spring-cloud-loadbalancer-概述" class="sidebar-link">spring-cloud-loadbalancer 概述</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#是什么-3" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#面试题" class="sidebar-link">面试题</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#spring-cloud-loadbalancer-负载均衡解析" class="sidebar-link">spring-cloud-loadbalancer 负载均衡解析</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#负载均衡演示案例-理论" class="sidebar-link">负载均衡演示案例-理论</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#负载均衡演示案例-实操" class="sidebar-link">负载均衡演示案例-实操</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#官网参考如何正确使用" class="sidebar-link">官网参考如何正确使用？</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#新建-8002-微服务" class="sidebar-link">新建 8002 微服务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#启动-consul-注册微服务" class="sidebar-link">启动 Consul，注册微服务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#订单-80-模块修改-pom-并注册进-consul-新增-loadbalancer-组件" class="sidebar-link">订单 80 模块修改 POM 并注册进 consul，新增 LoadBalancer 组件</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#修改订单-80-模块-controller-并启动" class="sidebar-link">修改订单 80 模块 Controller 并启动</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#目前-consul-上的服务" class="sidebar-link">目前 consul 上的服务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#测试-4" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#负载均衡演示案例-小总结" class="sidebar-link">负载均衡演示案例-小总结</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#编码使用-discoveryclient-动态获取所有上线的服务列表" class="sidebar-link">编码使用 DiscoveryClient 动态获取所有上线的服务列表</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#代码解释-修改-80-微服务的-controller" class="sidebar-link">代码解释，修改 80 微服务的 Controller</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#结合前面实操-负载均衡原理小总结" class="sidebar-link">结合前面实操，负载均衡原理小总结</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#负载均衡算法原理" class="sidebar-link">负载均衡算法原理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#默认算法是什么-有几种" class="sidebar-link">默认算法是什么？有几种？</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#算法切换" class="sidebar-link">算法切换</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#测试-5" class="sidebar-link">测试</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#openfeign-服务接口调用" class="sidebar-link">OpenFeign 服务接口调用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#openfeign-是什么" class="sidebar-link">OpenFeign 是什么</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#能干啥-2" class="sidebar-link">能干啥</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#openfeign-通用步骤" class="sidebar-link">OpenFeign 通用步骤</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#接口-注解" class="sidebar-link">接口+注解</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#流程步骤" class="sidebar-link">流程步骤</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#建-module" class="sidebar-link">建 Module</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#改-pom-文件" class="sidebar-link">改 POM 文件</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#写-application-yml" class="sidebar-link">写 application.yml</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#主启动-修改类名为-mainopenfeign80" class="sidebar-link">主启动（修改类名为 MainOpenFeign80）</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#业务类-3" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#修改-cloud-api-commons-通用模块" class="sidebar-link">修改 cloud-api-commons 通用模块</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#创建-controller-层-ordercontroller" class="sidebar-link">创建 Controller 层 OrderController</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#测试-6" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#小总结" class="sidebar-link">小总结</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#openfeign-高级特性" class="sidebar-link">OpenFeign 高级特性</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#openfeign-超时控制" class="sidebar-link">OpenFeign 超时控制</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#问题描述" class="sidebar-link">问题描述</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#模拟请求超时" class="sidebar-link">模拟请求超时</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#超时时间配置" class="sidebar-link">超时时间配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#openfeign-重试机制" class="sidebar-link">OpenFeign 重试机制</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#openfeign-默认-httpclient-修改" class="sidebar-link">OpenFeign 默认 HttpClient 修改</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#是什么-4" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#为什么替换为-apache-httpclient-5" class="sidebar-link">为什么替换为 Apache HttpClient 5</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#修改微服务-cloud-consumer-openfeign-order80" class="sidebar-link">修改微服务 cloud-consumer-openfeign-order80</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#openfeign-请求-响应压缩" class="sidebar-link">OpenFeign 请求/响应压缩</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#官网说明" class="sidebar-link">官网说明</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#是什么-5" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#yml-2" class="sidebar-link">yml</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#openfeign-日志打印功能" class="sidebar-link">OpenFeign 日志打印功能</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#日志打印功能是什么" class="sidebar-link">日志打印功能是什么</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#日志级别" class="sidebar-link">日志级别</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#配置日志-bean-feignloggerlevel" class="sidebar-link">配置日志 bean feignLoggerLevel</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#yml-文件里需要开启日志的-feign-客户端" class="sidebar-link">YML 文件里需要开启日志的 Feign 客户端</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#后台日志查看" class="sidebar-link">后台日志查看</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#补充实验-重试机制" class="sidebar-link">补充实验，重试机制</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#openfeign-和-sentinel-集成实现-fallback-服务降级" class="sidebar-link">OpenFeign 和 Sentinel 集成实现 fallback 服务降级</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#circuit-breaker-断路器" class="sidebar-link">Circuit Breaker 断路器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#hystrix-目前也进入维护模式" class="sidebar-link">Hystrix 目前也进入维护模式</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#是什么-6" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#hystrix-官宣-停更进维" class="sidebar-link">Hystrix 官宣，停更进维</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#hystrix-未来替换方案-resilience4j" class="sidebar-link">Hystrix 未来替换方案：Resilience4j</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#circuit-breaker-概述" class="sidebar-link">Circuit Breaker 概述</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#_2023-年影响极大的真实生产故障" class="sidebar-link">2023 年影响极大的真实生产故障</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#分布式系统面临的问题" class="sidebar-link">分布式系统面临的问题</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#诉求" class="sidebar-link">诉求</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#如何避免系统大面积故障" class="sidebar-link">如何避免系统大面积故障</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#crcuit-breaker-是什么" class="sidebar-link">Crcuit Breaker 是什么</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#resilience4j" class="sidebar-link">Resilience4J</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#是什么-7" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#能干啥-3" class="sidebar-link">能干啥</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#怎么玩-2" class="sidebar-link">怎么玩</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#案例实战" class="sidebar-link">案例实战</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#熔断-circuitbreaker-服务熔断-服务降级" class="sidebar-link">熔断(CircuitBreaker)（服务熔断+服务降级）</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#断路器-3-大状态" class="sidebar-link">断路器 3 大状态</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#断路器-3-大状态之间的转换" class="sidebar-link">断路器 3 大状态之间的转换</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#断路器所有配置参数参考" class="sidebar-link">断路器所有配置参数参考</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#熔断-降级案例需求说明" class="sidebar-link">熔断+降级案例需求说明</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#基于计数的滑动窗口-count-based" class="sidebar-link">基于计数的滑动窗口 COUNT_BASED</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#基于时间的滑动窗口-time-based" class="sidebar-link">基于时间的滑动窗口 TIME_BASED</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#小总结-2" class="sidebar-link">小总结</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#隔离-bulkhead" class="sidebar-link">隔离(BulkHead)</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#是什么-8" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#能干啥-4" class="sidebar-link">能干啥</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#两种隔离实现方式" class="sidebar-link">两种隔离实现方式</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#实现-semaphorebulkhead-信号量舱壁" class="sidebar-link">实现 SemaphoreBulkhead（信号量舱壁）</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#实战" class="sidebar-link">实战</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#实现-fixedthreadpoolbulkhead-固定线程池舱壁" class="sidebar-link">实现 FixedThreadPoolBulkhead（固定线程池舱壁）</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#概述-2" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#实战-2" class="sidebar-link">实战</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#限流-ratelimiter" class="sidebar-link">限流(RateLimiter)</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#是什么-9" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#常见限流算法" class="sidebar-link">常见限流算法</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#漏斗算法-leaky-bucket" class="sidebar-link">漏斗算法(Leaky Bucket)</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#令牌桶算法-token-bucket" class="sidebar-link">令牌桶算法(Token Bucket)</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#滚动时间窗口-tumbling-time-window" class="sidebar-link">滚动时间窗口(tumbling time window)</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#滑动时间窗口-sliding-time-window" class="sidebar-link">滑动时间窗口(sliding time window)</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#实战-3" class="sidebar-link">实战</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#sleuth-micrometer-zipkin-分布式链路追踪" class="sidebar-link">Sleuth(Micrometer)+ZipKin 分布式链路追踪</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#sleuth-目前也进入维护模式" class="sidebar-link">Sleuth 目前也进入维护模式</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#分布式链路追踪概述" class="sidebar-link">分布式链路追踪概述</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#新一代-spring-cloud-sleuth-micrometer" class="sidebar-link">新一代 Spring Cloud Sleuth：Micrometer</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#官网重要提示" class="sidebar-link">官网重要提示</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#zipkin" class="sidebar-link">zipkin？</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#小总结-3" class="sidebar-link">小总结</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#行业内比较成熟的其它分布式链路追踪技术解决方案" class="sidebar-link">行业内比较成熟的其它分布式链路追踪技术解决方案</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#分布式链路追踪原理" class="sidebar-link">分布式链路追踪原理</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#zipkin-2" class="sidebar-link">Zipkin</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#是什么-10" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#zipkin-为什么出现-单有-sleuth-micrometer-行不行" class="sidebar-link">Zipkin 为什么出现？单有 Sleuth(Micrometer)行不行？</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#zipkin-下载-安装-运行" class="sidebar-link">Zipkin 下载+安装+运行</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#micrometer-zipkin-搭建链路监控案例步骤" class="sidebar-link">Micrometer+ZipKin 搭建链路监控案例步骤</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#micrometer-zipkin-两者各自的分工" class="sidebar-link">Micrometer+ZipKin 两者各自的分工</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#步骤-4" class="sidebar-link">步骤</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#测试-7" class="sidebar-link">测试</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#gateway-新一代网关" class="sidebar-link">Gateway 新一代网关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#概述-3" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#是什么-11" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#微服务架构中网关在哪里" class="sidebar-link">微服务架构中网关在哪里</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#能干嘛" class="sidebar-link">能干嘛</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#gateway-三大核心" class="sidebar-link">Gateway 三大核心</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#gateway-工作流程" class="sidebar-link">Gateway 工作流程</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#入门配置" class="sidebar-link">入门配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#建-module-2" class="sidebar-link">建 Module</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#改-pom-4" class="sidebar-link">改 POM</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#写-yml" class="sidebar-link">写 YML</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#主启动" class="sidebar-link">主启动</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#业务类-4" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#测试-8" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#_9527-网关如何做路由映射" class="sidebar-link">9527 网关如何做路由映射</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#_9527-网关如何做路由映射-2" class="sidebar-link">9527 网关如何做路由映射</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#_9527-网关-yml-新增配置" class="sidebar-link">9527 网关 YML 新增配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#测试-1" class="sidebar-link">测试 1</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#测试-2-2" class="sidebar-link">测试 2</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#启动订单微服务测试-看看是否通过网关" class="sidebar-link">启动订单微服务测试，看看是否通过网关？</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#正确配置" class="sidebar-link">正确配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#存在问题-2" class="sidebar-link">存在问题</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#gateway-高级特性" class="sidebar-link">GateWay 高级特性</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#route-以微服务名-动态获取服务-uri" class="sidebar-link">Route 以微服务名-动态获取服务 URI</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#痛点" class="sidebar-link">痛点</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#是什么-12" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#解决-uri-地址写死问题" class="sidebar-link">解决 uri 地址写死问题</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#测试-1-2" class="sidebar-link">测试 1</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#测试-2-3" class="sidebar-link">测试 2</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#predicate-断言-谓词" class="sidebar-link">Predicate 断言（谓词）</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#是什么-13" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#整体架构概述" class="sidebar-link">整体架构概述</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#常用的内置-route-predicate" class="sidebar-link">常用的内置 Route Predicate</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#配置语法总体概述" class="sidebar-link">配置语法总体概述</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#常用断言-api" class="sidebar-link">常用断言 api</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#上述配置小总结" class="sidebar-link">上述配置小总结</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#自定义断言-xxxroutepredicatefactory-规则" class="sidebar-link">自定义断言，XXXRoutePredicateFactory 规则</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#痛点-2" class="sidebar-link">痛点</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#自定义路由断言规则步骤套路" class="sidebar-link">自定义路由断言规则步骤套路</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#bug-分析" class="sidebar-link">bug 分析</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#测试-9" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud/#filter-过滤" class="sidebar-link">Filter 过滤</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#概述-4" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#是什么-14" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#能干嘛-2" class="sidebar-link">能干嘛</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#类型" class="sidebar-link">类型</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#gateway-常见的内置过滤器" class="sidebar-link">Gateway 常见的内置过滤器</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#请求头-requestheader-相关组" class="sidebar-link">请求头(RequestHeader)相关组</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#请求参数-requestparameter-相关组" class="sidebar-link">请求参数(RequestParameter)相关组</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#响应头-responseheader-相关组" class="sidebar-link">响应头(ResponseHeader)相关组</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#前缀和路径相关组" class="sidebar-link">前缀和路径相关组</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#default-filters" class="sidebar-link">Default Filters</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud/#gateway-自定义过滤器" class="sidebar-link">Gateway 自定义过滤器</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#自定义全局-filter" class="sidebar-link">自定义全局 Filter</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud/#自定义条件-filter" class="sidebar-link">自定义条件 Filter</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud/#gateway-整合阿里巴巴-sentinel-实现容错" class="sidebar-link">Gateway 整合阿里巴巴 Sentinel 实现容错</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud/#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li><a href="/micro-service-core/SpringCloud-Alibaba/" class="sidebar-link">Spring Cloud Alibaba</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>持久层框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>相关知识</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/micro-service-core/#微服务核心" data-v-06225672>微服务核心</a></li><li data-v-06225672><a href="/micro-service-core/#SpringCloud" data-v-06225672>SpringCloud</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-05-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Spring Cloud<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="微服务零基础理论知识入门"><a href="#微服务零基础理论知识入门" class="header-anchor">#</a> 微服务零基础理论知识入门</h2> <h3 id="什么是微服务架构"><a href="#什么是微服务架构" class="header-anchor">#</a> 什么是微服务架构</h3> <p>微服务架构是一种架构模式，它提倡将单一应用程序划分为一组小的服务，服务之间互相协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务与服务间采用轻量级的通信机制互相协作（通常是基于 HTTP 协议的 RESTful API）。每个服务都围绕着具体业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应当尽量避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建。</p> <p><img src="/assets/img/image-20240428223313675.5a044995.webp" alt="image-20240428223313675"></p> <h3 id="springcloud"><a href="#springcloud" class="header-anchor">#</a> SpringCloud</h3> <p>SpringCloud = 分布式微服务架构的一站式解决方案，是多种微服务架构落地技术的集合体，俗称微服务全家桶。</p> <h3 id="springcloud-组件"><a href="#springcloud-组件" class="header-anchor">#</a> SpringCloud 组件</h3> <p><img src="/assets/img/image-20240428224041123.a4d5e7d7.webp" alt="image-20240428224041123"></p> <ul><li>SpringCloud 2018 年组件</li></ul> <p><img src="/assets/img/springcloud2018.5cc7136a.webp" alt="springcloud2018"></p> <ul><li>SpringCloud 移除了 Netflix OOS 体系</li></ul> <p><img src="/assets/img/netflixremove.32d46e64.webp" alt="netflixremove"></p> <ul><li>SpringCloud 2024 年组件</li></ul> <p><img src="/assets/img/springcloud2024.3829171f.webp" alt="springcloud2024"></p> <ul><li>SpringCloud 组件 Upgrade</li></ul> <p><img src="/assets/img/SpringCloudUpgrade.77a1530c.webp" alt="SpringCloudUpgrade"></p> <h2 id="微服务架构编码-base-工程模块构建"><a href="#微服务架构编码-base-工程模块构建" class="header-anchor">#</a> 微服务架构编码 Base 工程模块构建</h2> <h3 id="版本选择"><a href="#版本选择" class="header-anchor">#</a> 版本选择</h3> <ul><li><p>Java：Java17+</p></li> <li><p>cloud：2023.0.0</p></li> <li><p>boot：3.2.0</p></li> <li><p>cloud alibaba：2022.0.0.0-RC2</p></li> <li><p>Maven：3.9+</p></li> <li><p>Mysql：8.0+</p> <p><a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes" target="_blank" rel="noopener noreferrer">SpringBoot3.0 版本依赖关系<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://spring.io/projects/spring-cloud#overview" target="_blank" rel="noopener noreferrer">Spring Cloud Overview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba 版本说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/2022/zh-cn/2022.0.0.0-RC2.html" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba 参考文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="订单-支付业务需求说明"><a href="#订单-支付业务需求说明" class="header-anchor">#</a> 订单-支付业务需求说明</h3> <p><img src="/assets/img/OrderAndPayable.5728e026.webp" alt="OrderAndPayable"></p> <h3 id="idea-新建-project-和-maven-父工程"><a href="#idea-新建-project-和-maven-父工程" class="header-anchor">#</a> IDEA 新建 Project 和 Maven 父工程</h3> <h4 id="微服务-cloud-整体聚合-maven-父工程-project"><a href="#微服务-cloud-整体聚合-maven-父工程-project" class="header-anchor">#</a> 微服务 Cloud 整体聚合 Maven 父工程 Project</h4> <ol><li><p>New Project</p> <p><img src="/assets/img/NewProject.a8ae524f.webp" alt="NewProject"></p></li> <li><p>字符编码设置为 UTF-8</p> <p><img src="/assets/img/FileEncodings.284d469e.webp" alt="FileEncodings"></p></li> <li><p>注解生效激活</p> <p><img src="/assets/img/AnnotationProcessor.20c1e4d2.webp" alt="AnnotationProcessor"></p></li> <li><p>Java 编译版本选 17</p> <p><img src="/assets/img/JDKVersion.74efe046.webp" alt="JDKVersion"></p></li></ol> <h4 id="父工程-pom-文件内容"><a href="#父工程-pom-文件内容" class="header-anchor">#</a> 父工程 POM 文件内容</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hutool.version</span><span class="token punctuation">&gt;</span></span>5.8.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hutool.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lombok.version</span><span class="token punctuation">&gt;</span></span>1.18.26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lombok.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>druid.version</span><span class="token punctuation">&gt;</span></span>1.1.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>druid.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis.springboot.version</span><span class="token punctuation">&gt;</span></span>3.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis.springboot.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">&gt;</span></span>8.0.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swagger3.version</span><span class="token punctuation">&gt;</span></span>2.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swagger3.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper.version</span><span class="token punctuation">&gt;</span></span>4.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fastjson2.version</span><span class="token punctuation">&gt;</span></span>2.0.40<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fastjson2.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence-api.version</span><span class="token punctuation">&gt;</span></span>1.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence-api.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.test.version</span><span class="token punctuation">&gt;</span></span>3.1.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.test.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>2023.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>2022.0.0.0-RC2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--springboot 3.2.0--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.boot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--springcloud 2023.0.0--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--springcloud alibaba 2022.0.0.0-RC2--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.cloud.alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--SpringBoot集成mybatis--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mybatis.springboot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--Mysql数据库驱动8 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mysql.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--SpringBoot集成druid连接池--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${druid.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--通用Mapper4之tk.mybatis--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mapper.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--persistence--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${persistence-api.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- fastjson2 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${fastjson2.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger3.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--hutool--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${hutool.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--lombok--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${lombok.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- spring-boot-starter-test --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.boot.test.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br></div></div><h5 id="小细节复习"><a href="#小细节复习" class="header-anchor">#</a> 小细节复习</h5> <ol><li><p>Maven 中的 DependencyManagement 和 Dependencies</p> <ul><li><p>Maven 使用 dependencyManagement 元素来提供了一种管理依赖版本号的方式。</p></li> <li><p><strong>通常会在一个组织或者项目的最顶层的父 POM 中看到 dependencyManagement 元素</strong>。</p></li> <li><p>使用 pom.xml 中的 dependencyManagement 元素能让所有在子项目中引用一个依赖而不用显式的列出版本号。</p></li> <li><p>Maven 会沿着父子层次向上走，直到找到一个拥有 dependencyManagement 元素的项目，然后它就会使用这个 dependencyManagement 元素中指定的版本号。</p></li> <li><p>好处：如果有多个子项目都引用同一样依赖，则可以避免在每个使用的子项目里都声明一个版本号</p> <ul><li>当想升级或切换到另一个版本时，只需要在顶层父容器里更新，而不需要一个一个子项目的修改 ；</li> <li>另外如果某个子项目需要另外的一个版本，只需要声明 version 就可。</li></ul></li> <li><p><strong>dependencyManagement 里只是声明依赖，并不实现引入，因此子项目需要显示的声明需要用的依赖</strong>。</p></li> <li><p>如果不在子项目中声明依赖，是不会从父项目中继承下来的，只有在子项目中写了该依赖项并且没有指定具体版本，才会从父项目中继承该项 ，且 version 和 scope 都读取自父 pom。</p></li> <li><p>如果子项目中指定了版本号，那么会使用子项目中指定的 jar 版本。</p></li></ul></li> <li><p>Maven 中跳过单元测试</p> <ul><li><p>通过配置</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- maven中跳过单元测试 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>IDEA 工具支持（推荐）</p> <p><img src="/assets/img/SkipMavenTest.40ddc0cf.webp" alt="SkipMavenTest"></p></li></ul></li></ol> <h4 id="mysql-驱动说明"><a href="#mysql-驱动说明" class="header-anchor">#</a> Mysql 驱动说明</h4> <h5 id="mysql-5-7"><a href="#mysql-5-7" class="header-anchor">#</a> MySQL 5.7</h5> <ol><li>application.properties</li></ol> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># mysql5.7---JDBC四件套</span>
<span class="token key attr-name">jdbc.driverClass</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span> <span class="token value attr-value">jdbc:mysql://localhost:3306/db2024?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span>
<span class="token key attr-name">jdbc.user</span> <span class="token punctuation">=</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">jdbc.password</span> <span class="token punctuation">=</span><span class="token value attr-value">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>Maven 的 POM.xml</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- Maven的POM文件处理 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="mysql-8-x"><a href="#mysql-8-x" class="header-anchor">#</a> MySQL 8.x</h5> <ol><li>application.properties</li></ol> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># mysql8.0---JDBC四件套</span>
<span class="token key attr-name">jdbc.driverClass</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span> <span class="token value attr-value">jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
<span class="token key attr-name">jdbc.user</span> <span class="token punctuation">=</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">jdbc.password</span> <span class="token punctuation">=</span><span class="token value attr-value">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>Maven 的 POM.xml</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="mapper4-之一键生成"><a href="#mapper4-之一键生成" class="header-anchor">#</a> Mapper4 之一键生成</h3> <h4 id="mybatis-genetator"><a href="#mybatis-genetator" class="header-anchor">#</a> <a href="https://mybatis.org/generator/" target="_blank" rel="noopener noreferrer">mybatis-genetator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>Mybatis Generator(MBG)是 Mybatis 官方提供的一个代码生成工具，它可以根据数据库表自动生成对应的 Java Model、Mapper 和 XML 文件，甚至还可以生成一些高级查询功能，使用 Mybatis-Generator 可以大大降低开发者的工作量，提高开发效率！</p> <p>常见的代码生成工具对比见 <a href="https://coderofmutou.github.io/pages/20b7dd/" target="_blank" rel="noopener noreferrer">Mybatis 代码生成工具比较<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或 <a href="https://github.com/coderofmutou/notes/blob/main/02.%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A0%B8%E5%BF%83/%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/Mybatis%20%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E6%AF%94%E8%BE%83.md" target="_blank" rel="noopener noreferrer">Mybatis 代码生成工具比较<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="mybatis-通用-mapper4"><a href="#mybatis-通用-mapper4" class="header-anchor">#</a> <a href="https://github.com/abel533/Mapper" target="_blank" rel="noopener noreferrer">MyBatis 通用 Mapper4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>通用 Mapper4 是一个可以实现任意 MyBatis 通用方法的框架，项目提供了常规的增删改查操作以及 Example 相关的单表操作。通用 Mapper 是为了解决 MyBatis 使用中 90% 的基本操作，使用它可以很方便的进行开发，可以节省开发人员大量的时间。</p> <h4 id="一键生成步骤"><a href="#一键生成步骤" class="header-anchor">#</a> 一键生成步骤</h4> <ol><li>新建数据库 db2024 和表 t_pay</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db2024<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db2024<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>t_pay<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t_pay<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>pay_no<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'支付流水号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>order_no<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单流水号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'1'</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户账号ID'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>amount<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'9.9'</span> <span class="token keyword">COMMENT</span> <span class="token string">'交易金额'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>deleted<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'删除标志，默认0不删除，1删除'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'支付交易表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_pay<span class="token punctuation">(</span>pay_no<span class="token punctuation">,</span>order_no<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'pay17203699'</span><span class="token punctuation">,</span><span class="token string">'6544bafb424a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_pay<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol start="2"><li>新建 Module mybatis_generator2024</li></ol> <p><img src="/assets/img/mybatis_generator2024.4659c4f6.webp" alt="mybatis_generator2024"></p> <ol start="3"><li>POM.xml</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--我自己独一份，只是一个普通Maven工程，与boot和cloud无关--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis_generator2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Mybatis 通用mapper tk单独使用，自己独有+自带版本号--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Mybatis Generator 自己独有+自带版本号--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-generator-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--通用Mapper--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mysql8.0--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--persistence--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>${basedir}/src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>${basedir}/src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-generator-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configurationFile</span><span class="token punctuation">&gt;</span></span>${basedir}/src/main/resources/generatorConfig.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configurationFile</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>overwrite</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>overwrite</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>verbose</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>verbose</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><ol start="4"><li>配置</li></ol> <p>src\main\resources 路径下新建配置文件</p> <ul><li><p>config.properties</p> <ul><li><p>MySQL 5.7</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#User表包名</span>
<span class="token key attr-name">package.name</span><span class="token punctuation">=</span><span class="token value attr-value">com.atguigu.cloud</span>
<span class="token comment"># mysql5.7</span>
<span class="token key attr-name">jdbc.driverClass</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span> <span class="token value attr-value">jdbc:mysql://localhost:3306/db2024?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span>
<span class="token key attr-name">jdbc.user</span> <span class="token punctuation">=</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">jdbc.password</span> <span class="token punctuation">=</span><span class="token value attr-value">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>MySQL 8.x</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#t_pay表包名</span>
<span class="token key attr-name">package.name</span><span class="token punctuation">=</span><span class="token value attr-value">com.atguigu.cloud</span>

<span class="token comment"># mysql8.0</span>
<span class="token key attr-name">jdbc.driverClass</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span> <span class="token value attr-value">jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
<span class="token key attr-name">jdbc.user</span> <span class="token punctuation">=</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">jdbc.password</span> <span class="token punctuation">=</span><span class="token value attr-value">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li> <li><p>generatorConfig.xml</p></li></ul> <div class="language-XML line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">generatorConfiguration</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatorConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>config.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetRuntime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MyBatis3Simple<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultModelType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beginningDelimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>`<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>endingDelimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>`<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tk.mybatis.mapper.generator.MapperPlugin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mappers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tk.mybatis.mapper.common.Mapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>caseSensitive<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbcConnection</span> <span class="token attr-name">driverClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.driverClass}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">connectionURL</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">userId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.user}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbcConnection</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaModelGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.entities<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlMapGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.mapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaClientGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.mapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>XMLMAPPER<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>t_pay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">domainObjectName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Pay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatedKey</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlStatement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatorConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ol start="5"><li>一键生成</li></ol> <p>双击插件 mybatis-generator:gererate，一键生成 entity + mapper 接口 + xml 实现 SQL</p> <p><img src="/assets/img/mybatisOneClickGeneration.f7861153.webp" alt="mybatisOneClickGeneration"></p> <h3 id="rest-通用-base-工程构建"><a href="#rest-通用-base-工程构建" class="header-anchor">#</a> Rest 通用 Base 工程构建</h3> <h4 id="工程-v1-cloud-provider-payment8001-微服务提供者支付-module-模块"><a href="#工程-v1-cloud-provider-payment8001-微服务提供者支付-module-模块" class="header-anchor">#</a> 工程 V1 cloud-provider-payment8001 微服务提供者支付 Module 模块</h4> <h5 id="微服务小口诀"><a href="#微服务小口诀" class="header-anchor">#</a> 微服务小口诀</h5> <ol><li>建 module</li> <li>改 POM</li> <li>写 YML</li> <li>主启动</li> <li>业务类</li></ol> <h5 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h5> <h6 id="建-module-cloud-provider-payment8001"><a href="#建-module-cloud-provider-payment8001" class="header-anchor">#</a> 建 module cloud-provider-payment8001</h6> <p><img src="/assets/img/cloud-provider-payment8001.fa87d795.webp" alt="cloud-provider-payment8001"></p> <h6 id="改-pom"><a href="#改-pom" class="header-anchor">#</a> 改 POM</h6> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-provider-payment8001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot通用依赖模块--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot集成druid连接池--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mybatis和springboot整合--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Mysql数据库驱动8 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--persistence--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--通用Mapper4--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- fastjson2 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--test--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><h6 id="写-yml-application-yml"><a href="#写-yml-application-yml" class="header-anchor">#</a> 写 YML application.yml</h6> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span>

<span class="token comment"># ==========applicationName + druid-mysql8 driver===================</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service

  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/db2024<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>

<span class="token comment"># ========================mybatis===================</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.cloud.entities
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h6 id="主启动-修改-main-类名为-main8001"><a href="#主启动-修改-main-类名为-main8001" class="header-anchor">#</a> 主启动（修改 Main 类名为 Main8001）</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.cloud.mapper&quot;</span><span class="token punctuation">)</span> <span class="token comment">//import tk.mybatis.spring.annotation.MapperScan;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main8001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main8001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h6 id="业务类"><a href="#业务类" class="header-anchor">#</a> 业务类</h6> <ol><li><p>将之前一键生成的代码直接拷贝进 8001 模块</p> <p><img src="/assets/img/CopymybatisOneClickGeneration.c39542b8.webp" alt="CopymybatisOneClickGeneration"></p></li> <li><p>entities</p> <ul><li><p>Pay.java（粘贴一键生成的代码）</p></li> <li><p>PayDTO.java</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>entities</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token comment">//支付流水号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> payNo<span class="token punctuation">;</span>
    <span class="token comment">//订单流水号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token comment">//用户账号ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
    <span class="token comment">//交易金额</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>mapper</p> <ul><li>Mapper 接口 PayMapper（粘贴一键生成的代码）</li> <li>映射文件 PayMapper.xml（粘贴一键生成的代码到 src\main\resources\mapper 文件夹）</li></ul></li> <li><p>service</p> <ul><li><p>服务接口 PayService</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayService</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Pay</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>实现类 PayServiceImpl</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PayService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayMapper</span> payMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">insertSelective</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">deleteByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Pay</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li></ul></li> <li><p>controller</p> <ul><li><p>PayController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayService</span> payService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">addPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Pay</span> pay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>pay<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;成功插入记录，返回值：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/del/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">deletePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/update&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">updatePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pay</span> pay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>payDTO<span class="token punctuation">,</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;成功修改记录，返回值：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Pay</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/getAll&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li></ul></li></ol> <p><img src="/assets/img/businessStructure.e679bc45.webp" alt="businessStructure"></p> <h5 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h5> <h6 id="postman"><a href="#postman" class="header-anchor">#</a> PostMan</h6> <ul><li><p>add</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> POST <span class="token string">'http://localhost:8001/pay/add'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
--data-raw <span class="token string">'{
    &quot;payNo&quot;: &quot;17204076&quot;,
    &quot;orderNo&quot;: &quot;6544de1c424a&quot;,
    &quot;userId&quot;: &quot;2&quot;,
    &quot;amount&quot;: &quot;19.90&quot;
}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>delete</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> DELETE <span class="token string">'http://localhost:8001/pay/del/3'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>update</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> PUT <span class="token string">'http://localhost:8001/pay/update'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
--data-raw <span class="token string">'{
    &quot;id&quot;: 2,
    &quot;payNo&quot;: &quot;17204076update&quot;,
    &quot;orderNo&quot;: &quot;6544de1c424aupdate&quot;,
    &quot;userId&quot;: 2,
    &quot;amount&quot;: 199.90
}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>select</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'http://localhost:8001/pay/get/2'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>select all</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'http://localhost:8001/pay/getAll'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h6 id="swagger3"><a href="#swagger3" class="header-anchor">#</a> Swagger3</h6> <ol><li><p>常用注解</p> <ul><li>注解列表</li></ul> <p><img src="data:image/webp;base64,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" alt="Swagger3Annotations"></p> <ul><li><p>Controller</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Tag</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;支付微服务模块&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;支付CRUD&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayService</span> payService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;新增&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;新增支付流水方法,json串做参数&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">addPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Pay</span> pay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>pay<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;成功插入记录，返回值：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/del/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;删除&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;删除支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">deletePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/update&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;修改&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;修改支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">updatePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pay</span> pay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>payDTO<span class="token punctuation">,</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;成功修改记录，返回值：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;按照ID查流水&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;查询支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Pay</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/getAll&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;查所有流水&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;查询所有支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div></li> <li><p>entity 或者 DTO</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>entities</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 表名：t_pay
 * 表注释：支付交易表
 */</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;t_pay&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;支付交易表Entity&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pay</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;JDBC&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;主键&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 支付流水号
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;pay_no&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;支付流水号&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> payNo<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 订单流水号
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;order_no&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;订单流水号&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 用户账号ID
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;用户账号ID&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 交易金额
     */</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;交易金额&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 删除标志，默认0不删除，1删除
     */</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;删除标志&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Byte</span> deleted<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建时间
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;create_time&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新时间
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;update_time&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;更新时间&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div></li></ul></li> <li><p>含分组迭代的 Config 配置类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Swagger3Config</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">GroupedOpenApi</span> <span class="token class-name">PayApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">GroupedOpenApi</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;支付微服务模块&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pathsToMatch</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">GroupedOpenApi</span> <span class="token class-name">OtherApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">GroupedOpenApi</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;其它微服务模块&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pathsToMatch</span><span class="token punctuation">(</span><span class="token string">&quot;/other/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/others&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*@Bean
    public GroupedOpenApi CustomerApi() {
        return GroupedOpenApi.builder().group(&quot;客户微服务模块&quot;).pathsToMatch(&quot;/customer/**&quot;, &quot;/customers&quot;).build();
    }*/</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">OpenAPI</span> <span class="token function">docsOpenApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OpenAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">&quot;cloud2024&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;通用设计rest&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">&quot;v1.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">externalDocs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExternalDocumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;www.atguigu.com&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;https://yiyan.baidu.com/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li> <li><p>调用方式</p> <p>http://localhost:8001/swagger-ui/index.html</p> <p><img src="/assets/img/swaggerui.480a4bd7.webp" alt="swaggerui"></p></li></ol> <h4 id="上述模块还有那些问题"><a href="#上述模块还有那些问题" class="header-anchor">#</a> 上述模块还有那些问题</h4> <ol><li>时间格式问题：时间日志格式的统一和定制情况</li> <li>Java 如何设计 API 接口实现统一格式返回？影响前端/小程序/app 等交互体验和开发</li> <li>全局异常接入返回的标准格式：全局异常接入返回的标准格式</li> <li>...</li></ol> <h4 id="工程-v2-cloud-provider-payment8001-微服务提供者支付-module-模块-v2-改进版"><a href="#工程-v2-cloud-provider-payment8001-微服务提供者支付-module-模块-v2-改进版" class="header-anchor">#</a> 工程 V2 cloud-provider-payment8001 微服务提供者支付 Module 模块 V2 改进版++</h4> <h5 id="解决-时间格式问题"><a href="#解决-时间格式问题" class="header-anchor">#</a> 解决：时间格式问题</h5> <p>方式一：可以在相应的类的属性上使用 @JsonFormat 注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* 创建时间
*/</span>
<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;create_time&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">,</span> timezone <span class="token operator">=</span> <span class="token string">&quot;GMT+8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>

<span class="token comment">/**
* 更新时间
*/</span>
<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;update_time&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Schema</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;更新时间&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">,</span> timezone <span class="token operator">=</span> <span class="token string">&quot;GMT+8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>方式二：如果是 Spring Boot 项目，也可以在 application.yml 文件中指定</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jackson</span><span class="token punctuation">:</span>
    <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss
    <span class="token key atrule">time-zone</span><span class="token punctuation">:</span> GMT+8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="解决-统一返回值"><a href="#解决-统一返回值" class="header-anchor">#</a> 解决：统一返回值</h5> <h6 id="http-请求返回的状态码"><a href="#http-请求返回的状态码" class="header-anchor">#</a> HTTP 请求返回的状态码</h6> <table><thead><tr><th style="text-align:left;">分类</th> <th>类别</th> <th style="text-align:left;">分类描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1XX</td> <td>Informational（信息性状态码）</td> <td style="text-align:left;">信息，服务器收到请求，需要请求者继续执行操作</td></tr> <tr><td style="text-align:left;">2XX</td> <td>Success（成功状态码）</td> <td style="text-align:left;">成功，操作被成功接收并处理</td></tr> <tr><td style="text-align:left;">3XX</td> <td>Redirection（重定向）</td> <td style="text-align:left;">重定向，需要进一步的操作以完成请求</td></tr> <tr><td style="text-align:left;">4XX</td> <td>Client Error（客户端错误状态码）</td> <td style="text-align:left;">客户端错误，请求包含语法错误或无法完成请求</td></tr> <tr><td style="text-align:left;">5XX</td> <td>Server Error（服务器错误状态码）</td> <td style="text-align:left;">服务器错误，服务器在处理请求的过程中发生了错误</td></tr></tbody></table> <p><a href="https://cloud.tencent.com/developer/article/1688459" target="_blank" rel="noopener noreferrer">一文牢记 HTTP 状态码（图解 HTTP 状态码）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener noreferrer">HTTP 状态码 | 菜鸟教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h6 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h6> <ol><li>定义返回标准格式，3 大标配
<ul><li><strong>code 状态值</strong>：由后端统一定义各种返回结果的状态码</li> <li><strong>message 描述</strong>：本次接口调用的结果描述</li> <li><strong>data 数据</strong>：本次返回的数据</li></ul></li> <li>扩展
<ul><li>接口调用时间之类
<ul><li><strong>timestamp</strong>: 接口调用时间</li></ul></li></ul></li></ol> <h6 id="步骤-2"><a href="#步骤-2" class="header-anchor">#</a> 步骤</h6> <ol><li><p>新建枚举类 <strong>ReturnCodeEnum</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>resp</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ReturnCodeEnum</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 举值</span>
    <span class="token comment">/**操作失败**/</span>
    <span class="token function">RC999</span><span class="token punctuation">(</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;操作XXX失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**操作成功**/</span>
    <span class="token function">RC200</span><span class="token punctuation">(</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**服务降级**/</span>
    <span class="token function">RC201</span><span class="token punctuation">(</span><span class="token string">&quot;201&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;服务开启降级保护,请稍后再试!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**热点参数限流**/</span>
    <span class="token function">RC202</span><span class="token punctuation">(</span><span class="token string">&quot;202&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;热点参数限流,请稍后再试!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**系统规则不满足**/</span>
    <span class="token function">RC203</span><span class="token punctuation">(</span><span class="token string">&quot;203&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;系统规则不满足要求,请稍后再试!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**授权规则不通过**/</span>
    <span class="token function">RC204</span><span class="token punctuation">(</span><span class="token string">&quot;204&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;授权规则不通过,请稍后再试!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**access_denied**/</span>
    <span class="token function">RC403</span><span class="token punctuation">(</span><span class="token string">&quot;403&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;无访问权限,请联系管理员授予权限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**access_denied**/</span>
    <span class="token function">RC401</span><span class="token punctuation">(</span><span class="token string">&quot;401&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;匿名用户访问无权限资源时的异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">RC404</span><span class="token punctuation">(</span><span class="token string">&quot;404&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;404页面找不到的异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/**服务异常**/</span>
    <span class="token function">RC500</span><span class="token punctuation">(</span><span class="token string">&quot;500&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;系统异常，请稍后重试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">RC375</span><span class="token punctuation">(</span><span class="token string">&quot;375&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;数学运算异常，请稍后重试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">INVALID_TOKEN</span><span class="token punctuation">(</span><span class="token string">&quot;2001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;访问令牌不合法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ACCESS_DENIED</span><span class="token punctuation">(</span><span class="token string">&quot;2003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;没有权限访问该资源&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">CLIENT_AUTHENTICATION_FAILED</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;客户端认证失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">USERNAME_OR_PASSWORD_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;用户名或密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">BUSINESS_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;1004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;业务逻辑异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">UNSUPPORTED_GRANT_TYPE</span><span class="token punctuation">(</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;不支持的认证模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如何定义一个通用的枚举类：举值-构造-遍历</span>
    <span class="token comment">// 2. 构造</span>
    <span class="token comment">/**自定义状态码**/</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
    <span class="token comment">/**自定义描述**/</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3. 遍历</span>
    <span class="token comment">// 3.1 传统版</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ReturnCodeEnum</span> <span class="token function">getReturnCodeEnumV1</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span> element <span class="token operator">:</span> <span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> element<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3.2 Stream流式计算版</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ReturnCodeEnum</span> <span class="token function">getReturnCodeEnumV2</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getReturnCodeEnumV1</span><span class="token punctuation">(</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getReturnCodeEnumV1</span><span class="token punctuation">(</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getReturnCodeEnumV1</span><span class="token punctuation">(</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getReturnCodeEnumV2</span><span class="token punctuation">(</span><span class="token string">&quot;404&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getReturnCodeEnumV2</span><span class="token punctuation">(</span><span class="token string">&quot;404&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getReturnCodeEnumV2</span><span class="token punctuation">(</span><span class="token string">&quot;404&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div></li> <li><p>新建统一定义返回对象 <strong>ResultData</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>resp</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 不写默认为false，当该值为 true 时，对应字段的 setter 方法调用后，会返回当前对象。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 结果状态 ,具体状态码参见枚举类ReturnCodeEnum.java
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> timestamp<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> resultData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC200</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC200</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> resultData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li></ol> <h6 id="修改-paycontroller"><a href="#修改-paycontroller" class="header-anchor">#</a> 修改 PayController</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Tag</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;支付微服务模块&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;支付CRUD&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayService</span> payService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;新增&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;新增支付流水方法,json串做参数&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">addPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Pay</span> pay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>pay<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;成功插入记录，返回值：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/del/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;删除&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;删除支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">deletePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span>  payService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/update&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;修改&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;修改支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">updatePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pay</span> pay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>payDTO<span class="token punctuation">,</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;成功修改记录，返回值：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;按照ID查流水&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;查询支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pay</span> pay <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/getAll&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;查所有流水&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;查询所有支付流水方法&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> payList <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>payList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h6 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试</h6> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> POST <span class="token string">'http://localhost:8001/pay/add'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
--data-raw <span class="token string">'{
    &quot;payNo&quot;: &quot;paystringret&quot;,
    &quot;orderNo&quot;: &quot;6544de1c424aret&quot;,
    &quot;userId&quot;: &quot;1&quot;,
    &quot;amount&quot;: &quot;119.90&quot;
}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h6 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h6> <p>通过 ResultData.success() 对返回结果进行包装后返回给前端</p> <h6 id="如果某个方法有-bug"><a href="#如果某个方法有-bug" class="header-anchor">#</a> 如果某个方法有 bug</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;按照ID查流水&quot;</span><span class="token punctuation">,</span>description <span class="token operator">=</span> <span class="token string">&quot;查询支付流水方法&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;id不能为负数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Pay</span> pay <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/image-20240503140119982.98856d16.webp" alt="image-20240503140119982"></p> <p><img src="/assets/img/image-20240503140143674.5e1d1a90.webp" alt="image-20240503140143674"></p> <h5 id="解决-全局异常接入返回的标准格式"><a href="#解决-全局异常接入返回的标准格式" class="header-anchor">#</a> 解决：全局异常接入返回的标准格式</h5> <h6 id="为什么需要全局异常处理器"><a href="#为什么需要全局异常处理器" class="header-anchor">#</a> 为什么需要全局异常处理器</h6> <ul><li>不用再手写 try。。。catch。</li> <li>当然，如果非要 trycf 也是可以的。</li></ul> <h6 id="新建全局异常类-globalexceptionhandler"><a href="#新建全局异常类-globalexceptionhandler" class="header-anchor">#</a> 新建全局异常类 GlobalExceptionHandler</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>exp</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">exception</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;####come in GlobalExceptionHandler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;全局异常信息:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC500</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>@RestControllerAdvice</code> 注解：</p> <ul><li><p>是什么</p> <ul><li><p><code>@RestControllerAdvice</code> 是一个组合注解，由 <code>@ControllerAdvice</code>、<code>@ResponseBody</code> 组成；</p></li> <li><p>而 <code>@ControllerAdvice</code> 继承了 <code>@Component</code>，因此<code>@RestControllerAdvice</code> 本质上是个 Component，用于定义 <code>@ExceptionHandler</code>，<code>@InitBinder</code> 和 <code>@ModelAttribute</code> 方法，适用于所有使用 <code>@RequestMapping</code> 方法。</p></li></ul></li> <li><p>特点</p> <ul><li>通过 <code>@ControllerAdvice</code> 注解可以将对于控制器的全局配置放在同一个位置。</li> <li>注解了 <code>@RestControllerAdvice</code> 的类的方法可以使用 <code>@ExceptionHandler</code>、<code>@InitBinder</code>、<code>@ModelAttribute</code> 注解到方法上。
<ul><li><code>@ExceptionHandler</code>：用于指定异常处理方法。当与 <code>@RestControllerAdvice</code> 配合使用时，用于全局处理控制器里的异常。</li> <li><code>@InitBinder</code>：用来设置 WebDataBinder，用于自动绑定前台请求参数到 Model 中。</li> <li><code>@ModelAttribute</code>：本来作用是绑定键值对到 Model 中，当与 <code>@ControllerAdvice</code> 配合使用时，可以让全局的 <code>@RequestMapping</code> 都能获得在此处设置的键值对。</li></ul></li> <li><code>@RestControllerAdvice</code> 注解将作用在所有注解了 <code>@RequestMapping</code> 的控制器的方法上。</li></ul></li></ul> <h6 id="修改-controller"><a href="#修改-controller" class="header-anchor">#</a> 修改 Controller</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/error&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> integer <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;come in payerror test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC500</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="data:image/webp;base64,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" alt="image-20240503144019687"></p> <h4 id="目前工程目录结构"><a href="#目前工程目录结构" class="header-anchor">#</a> 目前工程目录结构</h4> <p><img src="/assets/img/cloud-provider-payment8001-Structure.106b92f9.webp" alt="cloud-provider-payment8001-Structure"></p> <h3 id="引入微服务理念-从这里开始"><a href="#引入微服务理念-从这里开始" class="header-anchor">#</a> 引入微服务理念，从这里开始</h3> <h4 id="cloud-consumer-order80-微服务调用者订单-module-模块"><a href="#cloud-consumer-order80-微服务调用者订单-module-模块" class="header-anchor">#</a> cloud-consumer-order80 微服务调用者订单 Module 模块</h4> <h5 id="建-cloud-consumer-order80"><a href="#建-cloud-consumer-order80" class="header-anchor">#</a> 建 cloud-consumer-order80</h5> <h5 id="改-pom-2"><a href="#改-pom-2" class="header-anchor">#</a> 改 POM</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-consumer-order80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool-all--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--fastjson2--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h5 id="写-yml-application-yml-2"><a href="#写-yml-application-yml-2" class="header-anchor">#</a> 写 YML application.yml</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="主启动-修改-main-类名为-main80"><a href="#主启动-修改-main-类名为-main80" class="header-anchor">#</a> 主启动（修改 Main 类名为 Main80）</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main80</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="业务类-2"><a href="#业务类-2" class="header-anchor">#</a> 业务类</h5> <h6 id="entities"><a href="#entities" class="header-anchor">#</a> entities</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>entities</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 一般而言，调用者不应该获悉服务提供者的 entity 资源并知道表结构关系，所以服务提供方给出的
 * 接口文档都都应成为 DTO
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token comment">// 支付流水号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> payNo<span class="token punctuation">;</span>
    <span class="token comment">// 订单流水号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token comment">// 用户账号 ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
    <span class="token comment">// 交易金额</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h6 id="resultdata-统一返回值也从-8001-拷贝进来"><a href="#resultdata-统一返回值也从-8001-拷贝进来" class="header-anchor">#</a> ResultData 统一返回值也从 8001 拷贝进来</h6> <p>resp 目录下的 ResultData 和 ReturnCodeEnum</p> <h6 id="resttemplete"><a href="#resttemplete" class="header-anchor">#</a> <a href="https://docs.spring.io/spring-framework/docs/6.0.11/javadoc-api/org/springframework/web/client/RestTemplate.html" target="_blank" rel="noopener noreferrer">RestTemplete<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h6> <p><strong>是什么？</strong></p> <ul><li>RestTemplate 提供了多种便捷访问远程 HTTP 服务的方法;</li> <li>是一种简单便捷的访问 restful 服务模板类;</li> <li>是 Spring 提供的用于访问 Rest 服务的客户端模板工具集。</li></ul> <p><strong>常用 API 使用说明</strong></p> <ol><li><p>使用说明</p> <ul><li><p>使用 restTemplate 访问 restful 接口非常的简单粗暴无脑。</p></li> <li><p>(url, requestMap, ResponseBean.class)这三个参数分别代表 REST 请求地址、请求参数、HTTP 响应转换被转换成的对象类型。</p> <p><img src="/assets/img/image-20240503150524394.1dbde44b.webp" alt="image-20240503150524394"></p></li></ul></li> <li><p>getForObject 方法/getForEntity 方法</p> <ul><li>getForObject 方法：返回对象为响应体中数据转化成的对象，基本上可以理解为 Json。</li> <li>getForEntity 方法：返回对象为 ResponseEntity 对象，包含了响应中的一些重要信息，比如响应头、响应状态码、响应体等。</li></ul></li> <li><p>GET 请求方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token class-name">URI</span> url<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token class-name">URI</span> var1<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>POST 请求方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">postForObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> request<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">postForObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> request<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">postForObject</span><span class="token punctuation">(</span><span class="token class-name">URI</span> url<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> request<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> request<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> request<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> uriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token class-name">URI</span> url<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> request<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> responseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h6 id="config-配置类"><a href="#config-配置类" class="header-anchor">#</a> config 配置类</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestTemplateConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h6 id="controller"><a href="#controller" class="header-anchor">#</a> controller</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYMENTSRV_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8001&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 先写死，硬编码</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 一般情况下，通过浏览器的地址栏输入url，发送的只能是get请求
     * 我们底层调用的是post方法，模拟消费者发送get请求，客户端消费者
     * 参数可以不添加@RequestBody
     * @param payDTO
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForObject</span><span class="token punctuation">(</span><span class="token constant">PAYMENTSRV_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">,</span> payDTO<span class="token punctuation">,</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token constant">PAYMENTSRV_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/get/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">,</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/pay/update&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">updateOrder</span><span class="token punctuation">(</span><span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span><span class="token punctuation">{</span>
        restTemplate<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">PAYMENTSRV_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/update&quot;</span><span class="token punctuation">,</span> payDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;成功修改记录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/pay/del/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">delOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        restTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token constant">PAYMENTSRV_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/del/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;成功删除记录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h5 id="postman-测试"><a href="#postman-测试" class="header-anchor">#</a> PostMan 测试</h5> <ol><li><p>查找</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'http://localhost/consumer/pay/get/1'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20240503162118361.851d8e1e.webp" alt="image-20240503162118361"></p></li> <li><p>增加</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'http://localhost/consumer/pay/add?payNo=1213&amp;orderNo=1213&amp;userId=2&amp;amount=3.33'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20240503162250423.c398b97f.webp" alt="image-20240503162250423"></p></li> <li><p>修改</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'http://localhost/consumer/pay/update?id=5&amp;payNo=1213update&amp;orderNo=1213update&amp;userId=2&amp;amount=33.3'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20240503162909655.326ba0de.webp" alt="image-20240503162909655"></p></li> <li><p>删除</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'http://localhost/consumer/pay/del/5'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20240503163015842.c22fb06f.webp" alt="image-20240503163015842"></p></li></ol> <h4 id="工程重构"><a href="#工程重构" class="header-anchor">#</a> 工程重构</h4> <h5 id="存在问题"><a href="#存在问题" class="header-anchor">#</a> 存在问题</h5> <p>系统中有重复部分，重构</p> <p><img src="/assets/img/commonPart.95be15c1.webp" alt="commonPart"></p> <h5 id="新建-module"><a href="#新建-module" class="header-anchor">#</a> 新建 Module</h5> <ol><li>cloud-api-commons</li> <li>对外暴露通用的组件/api/接口/工具类等</li></ol> <h5 id="改-pom-3"><a href="#改-pom-3" class="header-anchor">#</a> 改 POM</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot通用依赖模块--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h5 id="entities、全局异常类"><a href="#entities、全局异常类" class="header-anchor">#</a> entities、全局异常类</h5> <p>拷贝通用部分</p> <p><img src="data:image/webp;base64,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" alt="image-20240503165347122"></p> <h5 id="maven-命令-clean-install"><a href="#maven-命令-clean-install" class="header-anchor">#</a> maven 命令 clean install</h5> <p><img src="/assets/img/image-20240503165626856.1b9ffe74.webp" alt="image-20240503165626856"></p> <h5 id="订单-80-和支付-8001-分别改造"><a href="#订单-80-和支付-8001-分别改造" class="header-anchor">#</a> 订单 80 和支付 8001 分别改造</h5> <ol><li><p>删除各自的原先有过的 entities 和统一返回体等内容</p></li> <li><p>各自粘贴 POM 内容</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h5 id="postman-测试-2"><a href="#postman-测试-2" class="header-anchor">#</a> postman 测试</h5> <p>同上</p> <h4 id="目前工程样图"><a href="#目前工程样图" class="header-anchor">#</a> 目前工程样图</h4> <p><img src="/assets/img/image-20240503171027535.ff89c69e.webp" alt="image-20240503171027535"></p> <h4 id="为什么要引入微服务"><a href="#为什么要引入微服务" class="header-anchor">#</a> 为什么要引入微服务</h4> <p>上一步 controller 存在的问题：<strong>硬编码写死问题</strong>。</p> <h2 id="consul-服务注册与发现"><a href="#consul-服务注册与发现" class="header-anchor">#</a> Consul 服务注册与发现</h2> <h3 id="为什么要引入服务注册中心"><a href="#为什么要引入服务注册中心" class="header-anchor">#</a> 为什么要引入服务注册中心</h3> <p>微服务所在的 IP 地址和端口号<strong>硬编码</strong>到订单微服务中，会存在非常多的问题：</p> <ol><li>如果订单微服务和支付微服务的 IP 地址或者端口号发生了变化，则支付微服务将变得不可用，需要同步修改订单微服务中调用支付微服务的 IP 地址和端口号。</li> <li>如果系统中提供了多个订单微服务和支付微服务，则无法实现微服务的负载均衡功能。</li> <li>如果系统需要支持更高的并发，需要部署更多的订单微服务和支付微服务，硬编码订单微服务则后续的维护会变得异常复杂。</li> <li>所以，在微服务开发的过程中，<strong>需要引入服务治理功能，实现微服务之间的动态注册与发现</strong>，从此刻开始我们正式进入 SpringCloud 实战。</li></ol> <h3 id="为什么不再使用传统老牌的-eureka"><a href="#为什么不再使用传统老牌的-eureka" class="header-anchor">#</a> 为什么不再使用传统老牌的 Eureka</h3> <ol><li><p>Eureka 停更</p> <ul><li><p><a href="https://github.com/Netflix/eureka/wiki" target="_blank" rel="noopener noreferrer">eureka<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/image-20240503173925440.088a91c7.webp" alt="image-20240503173925440"></p></li></ul></li> <li><p>Eureka 对初学者不友好</p></li> <li><p>注册中心独立且和微服务功能解耦</p> <ul><li>目前主流服务中心，希望单独隔离出来而不是作为一个独立微服务嵌入到系统中。</li> <li>按照 Netflix 的之前的思路，注册中心 Eureka 也是作为一个微服务且需要程序员自己开发部署。</li> <li>实际情况，希望微服务和注册中心分离解耦，注册中心和业务无关的，不要混为一谈。</li> <li>提供类似 tomcat 一样独立的组件，微服务注册上去使用，是个成品。</li></ul></li> <li><p>阿里巴巴 Nacos 的崛起(Service discovery and configuration management)</p></li></ol> <h3 id="consul-简介"><a href="#consul-简介" class="header-anchor">#</a> consul 简介</h3> <h4 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么</h4> <ol><li><p><a href="https://www.consul.io/" target="_blank" rel="noopener noreferrer">Consul 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.hashicorp.com/consul/docs/intro" target="_blank" rel="noopener noreferrer">What is Consul？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>Consul 是一套开源的<strong>分布式服务发现和配置管理系统</strong>，由 HashiCorp 公司用 Go 语言开发。</p></li> <li><p>提供了微服务系统中的服务治理、配置中心、控制总线等功能。这些功能中的每一个都可以根据需要单独使用，也可以一起使用以构建全方位的服务网格，总之 Consul 提供了一种完整的服务网格解决方案。</p></li> <li><p>它具有很多优点。包括： 基于 raft 协议，比较简洁； 支持健康检查, 同时支持 HTTP 和 DNS 协议，支持跨数据中心的 WAN 集群，提供图形界面，跨平台，支持 Linux、Mac、Windows。</p></li></ul></li> <li><p>禁止使用问题：</p> <ul><li>HashiCorp 是一家非常知名的基础软件提供商，很多人可能没听过它的名字，但是其旗下的 6 款主流软件，Terraform、Consul、Vagrant、Nomad、Vault，Packer 相信不少程序员都听说或使用过，尤其是 Consul 使用者不尽其数。</li> <li>截止目前为止，从 HashiCorp 官网上的声明来看，开源项目其实还是“安全”的，被禁用的只是<strong>Vault 企业版</strong>（并且原因是 Vault 产品目前使用的加密算法在中国不符合法规，另一方面是美国出口管制法在涉及加密相关软件上也有相应规定。因此这两项原因使得 HashiCorp 不得不在声明中说明风险）而非其他所有开源产品（Terraform、Consul 等）。因此，大家可以暂时放下心来，放心使用！</li></ul></li></ol> <h4 id="能干啥"><a href="#能干啥" class="header-anchor">#</a> 能干啥</h4> <p><img src="/assets/img/ConsulUsage.3f26c6a8.webp" alt="ConsulUsage"></p> <ol><li>服务发现
<ul><li>提供 HTTP 和 DNS 两种发现方式</li></ul></li> <li>健康监测
<ul><li>支持多种方式，HTTP、TCP、Docker、Shell 脚本定制化监控</li></ul></li> <li>KV 存储
<ul><li>Key、Value 的存储方式</li></ul></li> <li>多数据中心
<ul><li>Consul 支持多数据中心</li></ul></li> <li>可视化 Web 界面</li></ol> <h4 id="去哪下"><a href="#去哪下" class="header-anchor">#</a> 去哪下</h4> <p><a href="https://developer.hashicorp.com/consul/install" target="_blank" rel="noopener noreferrer">Install | Consul | HashiCorp Developer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="怎么玩"><a href="#怎么玩" class="header-anchor">#</a> 怎么玩</h4> <p><strong>分布式服务发现和配置管理系统</strong></p> <p><a href="https://docs.spring.io/spring-cloud-consul/docs/current/reference/html/" target="_blank" rel="noopener noreferrer">Spring Cloud Consul<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="安装并运行-consul"><a href="#安装并运行-consul" class="header-anchor">#</a> 安装并运行 consul</h3> <h4 id="下载安装"><a href="#下载安装" class="header-anchor">#</a> 下载安装</h4> <p>下载完成后只有一个 consul.exe 文件，对应全路径下查看版本号信息</p> <p><img src="/assets/img/image-20240503180945229.89ae0be9.webp" alt="image-20240503180945229"></p> <h4 id="使用开发模式启动"><a href="#使用开发模式启动" class="header-anchor">#</a> 使用开发模式启动</h4> <ol><li><p><code>consul agent -dev</code></p></li> <li><p>通过以下地址可以访问 Consul 的首页：<code>http://localhost:8500</code></p> <p><img src="/assets/img/image-20240503181129956.37ae0f7e.webp" alt="image-20240503181129956"></p></li></ol> <h3 id="服务注册与发现"><a href="#服务注册与发现" class="header-anchor">#</a> 服务注册与发现</h3> <h4 id="支付服务-provider8001-注册进-consul"><a href="#支付服务-provider8001-注册进-consul" class="header-anchor">#</a> 支付服务 provider8001 注册进 consul</h4> <ol><li><p>POM 中新增依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--SpringCloud consul discovery --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>YML 中新增 consul 配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service

  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>主启动类新增注解 <code>@EnableDiscoveryClient</code>，开启服务发现</p></li> <li><p>启动 8001 服务并查看 consul 控制台</p> <p><img src="data:image/webp;base64,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" alt="image-20240503182559384"></p></li></ol> <h4 id="消费者服务-consumer-order80-注册进-consul"><a href="#消费者服务-consumer-order80-注册进-consul" class="header-anchor">#</a> 消费者服务 consumer-order80 注册进 consul</h4> <ol><li><p>POM 中新增依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--SpringCloud consul discovery --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>YML 中新增 consul 配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>order
  <span class="token comment">####Spring Cloud Consul for Service Discovery</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#优先使用服务ip进行注册</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>主启动类新增注解 <code>@EnableDiscoveryClient</code>，开启服务发现</p></li> <li><p>修改 Controller 中的地址硬编码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//    public static final String PAYMENTSRV_URL = &quot;http://localhost:8001&quot;; // 先写死，硬编码</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYMENTSRV_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://cloud-payment-service&quot;</span><span class="token punctuation">;</span><span class="token comment">//服务注册中心上的微服务名称</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>启动 80 服务并查看 consul 控制台</p> <p><img src="data:image/webp;base64,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" alt="image-20240503183602726"></p></li> <li><p>访问测试地址，<strong>出现报错</strong></p> <p><font color="red" size="5"> java.net.UnknownHostException: cloud-payment-service</font></p></li></ol> <p><img src="/assets/img/image-20240503231620810.f8e92692.webp" alt="image-20240503231620810"></p> <p><strong>异常概述：</strong></p> <p>​	在 Java 编程中，<code>java.net.UnknownHostException</code> 是一个常见的异常，它通常表示在进行网络操作时，无法通过主机名找到对应的 IP 地址。这个异常是 <code>java.net</code> 包中的一部分，具体地说，它是 <code>java.net.UnknownHostException</code> 类的一个实例。</p> <p><strong>异常原因：</strong></p> <p>主机名无法解析成有效的 IP 地址，可能由以下原因引起：</p> <ul><li><strong>DNS 解析问题：</strong> 当使用主机名连接到网络资源时，Java 会依赖 DNS(Domain Name System)来将主机名解析为 IP 地址。如果 DNS 服务器无法解析主机名，就会抛出 <code>UnknownHostException</code>。</li> <li><strong>网络连接问题：</strong> 如果计算机无法连接到网络，或者网络不稳定，可能导致无法解析主机名。</li> <li><strong>主机名拼写错误：</strong> 可能在代码中输入的主机名有误，或者主机名在 DNS 服务器上不存在。</li></ul> <p><strong>异常处理：</strong></p> <p>解决 <code>UnknownHostException</code> 的方法通常包括以下几个步骤：</p> <ul><li><strong>检查主机名：</strong> 确保在代码中使用的主机名是正确的，没有拼写错误，并且确保该主机名在 DNS 服务器上存在。</li> <li><strong>检查网络连接：</strong> 确保计算机能够连接到网络，并且网络连接是稳定的。网络问题可能导致主机名无法解析。</li> <li><strong>检查 DNS 配置：</strong> 如果是 DNS 解析问题，可以检查计算机的 DNS 配置，确保它能够正确地解析主机名。</li> <li><strong>使用 IP 地址：</strong> 一种绕过 <code>UnknownHostException</code> 的方法是直接使用 IP 地址而不是主机名。但这通常不是长期解决方案，因为 IP 地址可能会更改。</li></ul> <ol start="7"><li><p>修改 RestTemplateConfig 配置</p> <p><img src="/assets/img/image-20240503232604350.f2a4ce43.webp" alt="image-20240503232604350"></p> <p><img src="/assets/img/image-20240503232752295.a33338dc.webp" alt="image-20240503232752295"></p></li></ol> <h4 id="三个注册中心异同点"><a href="#三个注册中心异同点" class="header-anchor">#</a> 三个注册中心异同点</h4> <p><img src="/assets/img/image-20240503232801111.fef91d57.webp" alt="image-20240503232801111"></p> <h5 id="cap"><a href="#cap" class="header-anchor">#</a> CAP</h5> <ul><li><strong>C:Consistency（强一致性）</strong></li> <li><strong>A:Availability（可用性）</strong></li> <li><strong>P:Partition tolerance（分区容错性）</strong></li></ul> <h5 id="经典-cap-图"><a href="#经典-cap-图" class="header-anchor">#</a> 经典 CAP 图</h5> <ul><li><p>最多只能同时较好的满足两个。</p></li> <li><p>CAP 理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类：</p> <ul><li>CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。</li> <li>CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。</li> <li>AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。</li></ul></li></ul> <p><img src="/assets/img/CAPTheorem.78ea430a.webp" alt="CAPTheorem"></p> <h6 id="ap-eureka"><a href="#ap-eureka" class="header-anchor">#</a> AP(Eureka)</h6> <ul><li>当网络分区出现后，为了保证可用性，系统 B 可以返回旧值，保证系统的<strong>可用性</strong>。</li> <li>当数据出现不一致时，虽然 A, B 上的注册信息不完全相同，但每个 Eureka 节点依然能够正常对外提供服务，这会出现查询服务信息时如果请求 A 查不到，但请求 B 就能查到。如此保证了可用性但牺牲了一致性。</li> <li><strong>结论：违背了一致性 C 的要求，只满足可用性和分区容错，即 AP</strong>。</li></ul> <p><img src="/assets/img/AP-Architecture.b2d70c76.webp" alt="AP-Architecture"></p> <h6 id="cp-zookeeper-consul"><a href="#cp-zookeeper-consul" class="header-anchor">#</a> CP(Zookeeper/Consul)</h6> <ul><li>当网络分区出现后，为了保证一致性，<strong>就必须拒接请求</strong>，否则无法保证一致性。</li> <li>Consul 遵循 CAP 原理中的 CP 原则，保证了强一致性和分区容错性，且使用的是 Raft 算法，比 zookeeper 使用的 Paxos 算法更加简单。</li> <li>虽然保证了强一致性，但是可用性就相应下降了，例如服务注册的时间会稍长一些，因为 Consul 的 raft 协议要求必须过半数的节点都写入成功才认为注册成功 ；在 leader 挂掉了之后，重新选举出 leader 之前会导致 Consul 服务不可用。</li> <li><strong>结论：违背了可用性 A 的要求，只满足一致性和分区容错，即 CP</strong>。</li></ul> <p><img src="/assets/img/CP-Architecture.9654d76b.webp" alt="CP-Architecture"></p> <h3 id="服务配置与刷新"><a href="#服务配置与刷新" class="header-anchor">#</a> 服务配置与刷新</h3> <h4 id="分布式系统面临的配置问题"><a href="#分布式系统面临的配置问题" class="header-anchor">#</a> 分布式系统面临的配置问题</h4> <ul><li>微服务意味着要将单体应用中的业务拆分成一个个子服务，每个服务的粒度相对较小，因此系统中会出现大量的服务。</li> <li>由于每个服务都需要必要的配置信息才能运行，所以<strong>一套集中式的、动态的配置管理设施是必不可少的</strong>。</li> <li>比如某些配置文件中的内容大部分都是相同的，只有个别的配置项不同。就拿数据库配置来说吧，如果每个微服务使用的技术栈都是相同的，则每个微服务中关于数据库的配置几乎都是相同的，有时候主机迁移了，我希望一次修改，处处生效。</li> <li>当下我们每一个微服务自己带着一个 application.yml，上百个配置文件的管理......</li></ul> <h4 id="服务配置案例步骤"><a href="#服务配置案例步骤" class="header-anchor">#</a> 服务配置案例步骤</h4> <h5 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h5> <ol><li>通用全局配置信息，直接注册进 Consul 服务器，从 Consul 获取</li> <li>既然从 Consul 获取自然要遵守 Consul 的配置规则要求</li></ol> <h5 id="修改-cloud-provider-payment8001"><a href="#修改-cloud-provider-payment8001" class="header-anchor">#</a> 修改 cloud-provider-payment8001</h5> <h5 id="pom-中新增依赖"><a href="#pom-中新增依赖" class="header-anchor">#</a> POM 中新增依赖</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--SpringCloud consul config--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="yml"><a href="#yml" class="header-anchor">#</a> YML</h5> <h6 id="配置规则说明"><a href="#配置规则说明" class="header-anchor">#</a> 配置规则说明</h6> <p><img src="/assets/img/image-20240504000925411.abd9dbb3.webp" alt="image-20240504000925411"></p> <h6 id="新增配置文件-bootstrap-yml"><a href="#新增配置文件-bootstrap-yml" class="header-anchor">#</a> 新增配置文件 bootstrap.yml</h6> <ul><li>applicaiton.yml 是<strong>用户级</strong>的资源配置项</li> <li>bootstrap.yml 是<strong>系统级</strong>的，优先级更加高</li> <li>Spring Cloud 会创建一个<code>Bootstrap Context</code>，作为 Spring 应用的<code>Application Context</code>的<strong>父上下文</strong>。初始化的时候，<code>Bootstrap Context</code>负责从<strong>外部源</strong>加载配置属性并解析配置。这两个上下文共享一个从外部获取的<code>Environment</code>。</li> <li><code>Bootstrap</code>属性有<strong>高优先级，默认情况下，它们不会被本地配置覆盖</strong>。 <code>Bootstrap context</code>和<code>Application Context</code>有着不同的约定，所以新增了一个<code>bootstrap.yml</code>文件，保证<code>Bootstrap Context</code>和<code>Application Context</code>配置的分离。</li> <li><strong>application.yml 文件改为 bootstrap.yml，这是很关键的或者两者共存</strong></li> <li>因为 bootstrap.yml 是比 application.yml 先加载的。bootstrap.yml 优先级高于 application.yml</li></ul> <p><strong>bootstrap.yml：</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
  <span class="token comment">####Spring Cloud Consul for Service Discovery</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">profile-separator</span><span class="token punctuation">:</span> <span class="token string">'-'</span> <span class="token comment"># default value is &quot;,&quot;，we update '-'</span>
        <span class="token key atrule">format</span><span class="token punctuation">:</span> yaml

<span class="token comment"># config/cloud-payment-service/data</span>
<span class="token comment">#       /cloud-payment-service-dev/data</span>
<span class="token comment">#       /cloud-payment-service-prod/data</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h6 id="修改-application-yml-配置"><a href="#修改-application-yml-配置" class="header-anchor">#</a> 修改 application.yml 配置</h6> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span>

<span class="token comment"># ==========druid-mysql8 driver===================</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/db2024<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
   <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 多环境配置加载内容dev/prod,不写就是默认default配置</span>

<span class="token comment"># ========================mybatis===================</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.cloud.entities
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="consul-服务器-key-value-配置填写"><a href="#consul-服务器-key-value-配置填写" class="header-anchor">#</a> consul 服务器 key/value 配置填写</h5> <ol><li><p>参考规则</p> <p><img src="data:image/webp;base64,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" alt="image-20240504001744856"></p></li> <li><p>创建 config 文件夹，以 <code>/</code> 结尾</p> <p><img src="/assets/img/image-20240504002213519.3ba85471.webp" alt="image-20240504002213519"></p></li> <li><p>config 文件夹下分别创建其它 3 个文件夹，以 <code>/</code> 结尾</p> <ul><li>cloud-payment-service</li> <li>cloud-payment-service-dev</li> <li>cloud-payment-service-prod</li> <li><img src="/assets/img/image-20240504002401953.f1990a53.webp" alt="image-20240504002401953"><img src="/assets/img/image-20240504002403690.f1990a53.webp" alt="image-20240504002403690"></li></ul></li> <li><p>上述 3 个文件夹下分别创建 data 内容，data 不再是文件夹</p> <p><img src="/assets/img/image-20240504002752008.f6fae6ee.webp" alt="image-20240504002752008"></p></li></ol> <h5 id="修改-controller-2"><a href="#修改-controller-2" class="header-anchor">#</a> 修改 controller</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/get/info&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getInfoByConsul</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${atguigu.info}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> atguiguInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;atguiguInfo: &quot;</span> <span class="token operator">+</span> atguiguInfo <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;port: &quot;</span> <span class="token operator">+</span> port<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="测试-3"><a href="#测试-3" class="header-anchor">#</a> 测试</h5> <p><a href="http://localhost:8001/pay/get/info" target="_blank" rel="noopener noreferrer">localhost:8001/pay/get/info<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev<span class="token punctuation">|</span>prod<span class="token punctuation">|</span>  <span class="token comment"># 多环境配置加载内容 dev|prod|默认</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通过修改 application.yml 里面的激活配置部分，进行内容的验证</p> <p><img src="data:image/webp;base64,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" alt="image-20240504003720394"></p> <h4 id="动态刷新案例步骤"><a href="#动态刷新案例步骤" class="header-anchor">#</a> 动态刷新案例步骤</h4> <h5 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h5> <p>接上一步，我们在 consul 的 dev 配置分支修改了 YML 配置内容后马上访问请求，会发现还是原来的内容，<strong>没有做到及时响应和动态刷新</strong>。</p> <h5 id="步骤-3"><a href="#步骤-3" class="header-anchor">#</a> 步骤</h5> <ol><li><p>主启动类新增注解 <code>@RefreshScope</code>，用于<strong>动态刷新</strong>。</p> <p><img src="/assets/img/image-20240504004834718.db1588bc.webp" alt="image-20240504004834718"></p></li> <li><p>bootstrap.yml 修改下(<strong>只为教学，实际别改</strong>) spring.cloud.consul.config.watch.wait-time</p> <p><img src="/assets/img/image-20240504004922243.635263c0.webp" alt="image-20240504004922243"></p></li></ol> <h4 id="思考"><a href="#思考" class="header-anchor">#</a> 思考</h4> <p>问：截止到这，服务配置和动态刷新全部通过，假设我重启 Consul，之前的配置还在吗？</p> <p>答：之前配置的 config 信息全部丢失。</p> <p><img src="/assets/img/image-20240504005033996.881fde69.webp" alt="image-20240504005033996"></p> <p>引出问题：<font color="red" size="5"><strong>Consul 配置持久化.....</strong>.</font></p> <h2 id="loadbalancer-负载均衡服务调用"><a href="#loadbalancer-负载均衡服务调用" class="header-anchor">#</a> LoadBalancer 负载均衡服务调用</h2> <h3 id="ribbon-目前也进入维护模式"><a href="#ribbon-目前也进入维护模式" class="header-anchor">#</a> Ribbon 目前也进入维护模式</h3> <h4 id="是什么-2"><a href="#是什么-2" class="header-anchor">#</a> 是什么</h4> <ul><li>Spring Cloud Ribbon 是基于 Netflix Ribbon 实现的一套 <strong>客户端负载均衡的工具</strong>。</li> <li>简单的说，Ribbon 是 Netflix 发布的开源项目，主要功能是<strong>提供客户端的软件负载均衡算法和服务调用</strong>。</li> <li>Ribbon 客户端组件提供一系列完善的配置项如连接超时，重试等。</li> <li>简单的说，就是在配置文件中列出 Load Balancer（简称 LB）后面所有的机器，Ribbon 会自动的帮助你基于某种规则（如简单轮询，随机连接等）去连接这些机器。</li> <li>我们很容易使用 Ribbon 实现自定义的负载均衡算法。</li> <li><a href="https://github.com/Netflix/ribbon" target="_blank" rel="noopener noreferrer">Netflix/Ribbon(github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="维护模式不再介绍-了解即可"><a href="#维护模式不再介绍-了解即可" class="header-anchor">#</a> 维护模式不再介绍，了解即可</h4> <p><img src="/assets/img/image-20240504005502876.53df6d32.webp" alt="image-20240504005502876"></p> <h4 id="ribbon-未来替换方案-spring-cloud-loadbalancer"><a href="#ribbon-未来替换方案-spring-cloud-loadbalancer" class="header-anchor">#</a> Ribbon 未来替换方案：spring-cloud-loadbalancer</h4> <p><img src="/assets/img/image-20240504005911550.6189b9a2.webp" alt="image-20240504005911550"></p> <h3 id="spring-cloud-loadbalancer-概述"><a href="#spring-cloud-loadbalancer-概述" class="header-anchor">#</a> <a href="https://spring.io/projects/spring-cloud-commons#learn" target="_blank" rel="noopener noreferrer">spring-cloud-loadbalancer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 概述</h3> <h4 id="是什么-3"><a href="#是什么-3" class="header-anchor">#</a> 是什么</h4> <p><a href="https://docs.spring.io/spring-cloud-commons/reference/spring-cloud-commons/loadbalancer.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>LB 负载均衡(Load Balance)是什么</strong></p> <ul><li>简单的说就是将用户的请求平摊的分配到多个服务上，从而达到系统的 HA（高可用），常见的负载均衡有软件 Nginx，LVS，硬件 F5 等。</li></ul> <p><strong>spring-cloud-starter-loadbalancer 组件是什么</strong></p> <ul><li><p>Spring Cloud LoadBalancer 是由 SpringCloud 官方提供的一个开源的、简单易用的<strong>客户端负载均衡器</strong>，它包含在 SpringCloud-commons 中，用它来替换了以前的 Ribbon 组件。</p></li> <li><p>相比较于 Ribbon，SpringCloud LoadBalancer 不仅能够支持 RestTemplate，还支持 WebClient（WebClient 是 Spring Web Flux 中提供的功能，可以实现响应式异步请求）。</p> <p><img src="/assets/img/image-20240504011323974.1cde95ef.webp" alt="image-20240504011323974"></p></li></ul> <h4 id="面试题"><a href="#面试题" class="header-anchor">#</a> 面试题</h4> <p><strong>loadbalancer 本地负载均衡客户端 VS Nginx 服务端负载均衡区别？</strong></p> <ul><li>Nginx 是 <strong>服务器负载均衡</strong>，客户端所有请求都会交给 nginx，然后由 nginx 实现转发请求，即负载均衡是由服务端实现的。</li> <li>loadbalancer <strong>本地负载均衡</strong>，在调用微服务接口时候，会在注册中心上获取注册信息服务列表之后缓存到 JVM 本地，从而在本地实现 RPC 远程服务调用技术。</li></ul> <h3 id="spring-cloud-loadbalancer-负载均衡解析"><a href="#spring-cloud-loadbalancer-负载均衡解析" class="header-anchor">#</a> spring-cloud-loadbalancer 负载均衡解析</h3> <h4 id="负载均衡演示案例-理论"><a href="#负载均衡演示案例-理论" class="header-anchor">#</a> 负载均衡演示案例-理论</h4> <p><strong>架构说明：80 通过轮询负载访问 8001/8002/8003</strong></p> <p><img src="/assets/img/LB-Architecture.1f409814.webp" alt="LB-Architecture"></p> <p>LoadBalancer 在工作时分成两步：</p> <p><strong>第一步</strong>：先选择 Consul Server 从服务端查询并拉取服务列表，知道了它有多个服务（上图 3 个服务），这 3 个实现是完全一样的，默认轮询调用谁都可以正常执行。类似生活中求医挂号，某个科室今日出诊的全部医生，客户端你自己选一个。</p> <p><strong>第二步</strong>：按照指定的负载均衡策略从 server 取到的服务注册列表中由客户端自己选择一个地址，所以 LoadBalancer 是一个<strong>客户端的</strong>负载均衡器。</p> <h4 id="负载均衡演示案例-实操"><a href="#负载均衡演示案例-实操" class="header-anchor">#</a> 负载均衡演示案例-实操</h4> <h5 id="官网参考如何正确使用"><a href="#官网参考如何正确使用" class="header-anchor">#</a> 官网参考如何正确使用？</h5> <p><a href="https://docs.spring.io/spring-cloud-commons/reference/spring-cloud-commons/loadbalancer.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/image-20240504102227636.3d59fe0c.webp" alt="image-20240504102227636"></p> <p><img src="/assets/img/spring-RestTemplate-LoadBalancer.247595ea.webp" alt="spring-RestTemplate-LoadBalancer"></p> <h5 id="新建-8002-微服务"><a href="#新建-8002-微服务" class="header-anchor">#</a> 新建 8002 微服务</h5> <p>按照 8001 拷贝进 8002 微服务</p> <h5 id="启动-consul-注册微服务"><a href="#启动-consul-注册微服务" class="header-anchor">#</a> 启动 Consul，注册微服务</h5> <ol><li><p><code>consul agent -dev</code></p></li> <li><p>将 8001/8002 启动后注册进微服务</p></li> <li><p>测试出现 BUG</p> <p><img src="/assets/img/image-20240504104713645.dd801a6c.webp" alt="image-20240504104713645"></p> <ul><li>原因：重启 Consul 后，之前的配置丢失了，没有持久化保存。</li></ul></li> <li><p>解决方法：<strong>Consul 数据持久化配置并且注册为 Windows 服务</strong></p> <ol><li><p>在 <code>consul.exe</code> 所在目录新建空文件夹  <code>mydata</code></p></li> <li><p>在 <code>consul.exe</code> 所在目录新建文件  <code>consul_start.bat</code></p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>@<span class="token function">echo</span><span class="token punctuation">.</span>服务启动<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
@<span class="token function">echo</span> off  
@<span class="token function">sc</span> create Consul binpath= <span class="token string">&quot;C:\Softwares\DevTools\devtools\consul_1.18.1_windows_amd64\consul.exe agent -server -ui -bind=127.0.0.1 -client=0.0.0.0 -bootstrap-expect  1  -data-dir C:\Softwares\DevTools\devtools\consul_1.18.1_windows_amd64\mydata&quot;</span>
@net <span class="token function">start</span> Consul
@<span class="token function">sc</span> config Consul <span class="token function">start</span>= AUTO  
@<span class="token function">echo</span><span class="token punctuation">.</span>Consul <span class="token function">start</span> is OK<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>success
@pause
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>以管理员身份运行  <code>consul_start.bat</code></p></li> <li><p>启动结果</p> <p><img src="/assets/img/image-20240504110217640.b3b39178.webp" alt="image-20240504110217640"></p> <p><img src="/assets/img/image-20240504110758770.bc0fe27e.webp" alt="image-20240504110758770"></p></li> <li><p>后续 consul 的配置数据会保存进 mydata 文件夹，重启还会存在</p></li></ol></li> <li><p>后台自启动 Consul 测试地址：http://localhost:8001/pay/get/info</p></li></ol> <h5 id="订单-80-模块修改-pom-并注册进-consul-新增-loadbalancer-组件"><a href="#订单-80-模块修改-pom-并注册进-consul-新增-loadbalancer-组件" class="header-anchor">#</a> 订单 80 模块修改 POM 并注册进 consul，新增 LoadBalancer 组件</h5> <p><img src="/assets/img/image-20240505224550154.f8031def.webp" alt="image-20240505224550154"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--loadbalancer--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="修改订单-80-模块-controller-并启动"><a href="#修改订单-80-模块-controller-并启动" class="header-anchor">#</a> 修改订单 80 模块 Controller 并启动</h5> <p>订单 80 模块修改 <code>OrderController</code> 并启动</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/consumer/pay/get/info&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getInfoByConsul</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token constant">PAYMENTSRV_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/get/info&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="目前-consul-上的服务"><a href="#目前-consul-上的服务" class="header-anchor">#</a> 目前 consul 上的服务</h5> <p><img src="/assets/img/image-20240505225303684.1ea0e5fe.webp" alt="image-20240505225303684"></p> <h5 id="测试-4"><a href="#测试-4" class="header-anchor">#</a> 测试</h5> <p>测试地址</p> <ul><li><a href="http://localhost/consumer/pay/get/info" target="_blank" rel="noopener noreferrer">http://localhost/consumer/pay/get/info<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>通过上述地址，交替访问到了 8001/8002。</li></ul> <h4 id="负载均衡演示案例-小总结"><a href="#负载均衡演示案例-小总结" class="header-anchor">#</a> 负载均衡演示案例-小总结</h4> <h5 id="编码使用-discoveryclient-动态获取所有上线的服务列表"><a href="#编码使用-discoveryclient-动态获取所有上线的服务列表" class="header-anchor">#</a> 编码使用 DiscoveryClient 动态获取所有上线的服务列表</h5> <p><img src="/assets/img/image-20240505225834032.348752bd.webp" alt="image-20240505225834032"></p> <h5 id="代码解释-修改-80-微服务的-controller"><a href="#代码解释-修改-80-微服务的-controller" class="header-anchor">#</a> 代码解释，修改 80 微服务的 Controller</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/discovery&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">discovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> services <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ServiceInstance</span> element <span class="token operator">:</span> instances<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span>element<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span>element<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span>element<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="/assets/img/image-20240505230519130.c3b8dc3b.webp" alt="image-20240505230519130"></p> <h5 id="结合前面实操-负载均衡原理小总结"><a href="#结合前面实操-负载均衡原理小总结" class="header-anchor">#</a> 结合前面实操，负载均衡原理小总结</h5> <p><strong>负载均衡算法：rest 接口第几次请求数 % 服务器集群总数量 = 实际调用服务器位置下标 ，每次服务重启动后 rest 接口计数从 1 开始。</strong></p> <p><code>List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&quot;cloud-payment-service&quot;);</code></p> <p>如：</p> <p>List [0] instances = 127.0.0.1:8002</p> <p>List [1] instances = 127.0.0.1:8001</p> <p>8001+ 8002 组合成为集群，它们共计 2 台机器，集群总数为 2， 按照轮询算法原理：</p> <ol><li>当总请求数为 1 时： 1 % 2 =1 对应下标位置为 1 ，则获得服务地址为 127.0.0.1:8001</li> <li>当总请求数位 2 时： 2 % 2 =0 对应下标位置为 0 ，则获得服务地址为 127.0.0.1:8002</li> <li>当总请求数位 3 时： 3 % 2 =1 对应下标位置为 1 ，则获得服务地址为 127.0.0.1:8001</li> <li>当总请求数位 4 时： 4 % 2 =0 对应下标位置为 0 ，则获得服务地址为 127.0.0.1:8002</li> <li>如此类推......</li></ol> <h3 id="负载均衡算法原理"><a href="#负载均衡算法原理" class="header-anchor">#</a> 负载均衡算法原理</h3> <h4 id="默认算法是什么-有几种"><a href="#默认算法是什么-有几种" class="header-anchor">#</a> 默认算法是什么？有几种？</h4> <p><img src="/assets/img/image-20240505231526580.23f1812c.webp" alt="image-20240505231526580"></p> <ul><li><p>轮询</p> <p><code>public class RoundRobinLoadBalancer implements ReactorServiceInstanceLoadBalancer</code></p></li> <li><p>随机</p> <p><code>public class RandomLoadBalancer implements ReactorServiceInstanceLoadBalancer</code></p></li></ul> <h4 id="算法切换"><a href="#算法切换" class="header-anchor">#</a> 算法切换</h4> <p>从默认的轮询，切换为随机算法，修改 <code>RestTemplateConfig</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@LoadBalancerClient</span><span class="token punctuation">(</span>
<span class="token comment">//下面的value值大小写一定要和consul里面的名字一样，必须一样</span>
value <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">RestTemplateConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestTemplateConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment">// 标注此注解后，RestTemplate就具有了客户端负载均衡能力</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ReactorLoadBalancer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> <span class="token function">randomLoadBalancer</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">,</span>
                                                            <span class="token class-name">LoadBalancerClientFactory</span> loadBalancerClientFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">LoadBalancerClientFactory</span><span class="token punctuation">.</span><span class="token constant">PROPERTY_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomLoadBalancer</span><span class="token punctuation">(</span>loadBalancerClientFactory
                <span class="token punctuation">.</span><span class="token function">getLazyProvider</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token class-name">ServiceInstanceListSupplier</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="/assets/img/image-20240505232205250.ee26d408.webp" alt="image-20240505232205250"></p> <h4 id="测试-5"><a href="#测试-5" class="header-anchor">#</a> 测试</h4> <ul><li><a href="http://localhost/consumer/pay/get/info" target="_blank" rel="noopener noreferrer">http://localhost/consumer/pay/get/info<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="openfeign-服务接口调用"><a href="#openfeign-服务接口调用" class="header-anchor">#</a> OpenFeign 服务接口调用</h2> <h3 id="openfeign-是什么"><a href="#openfeign-是什么" class="header-anchor">#</a> OpenFeign 是什么</h3> <p><a href="https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/#spring-cloud-feign" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/spring-cloud/spring-cloud-openfeign" target="_blank" rel="noopener noreferrer">spring-cloud/spring-cloud-openfeign: Support for using OpenFeign in Spring Cloud apps (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>Feign 是一个 <strong>声明性 web 服务客户端</strong>。它使编写 web 服务客户端变得更容易。使用 Feign 创建一个接口并对其进行注释。它具有可插入的注释支持，包括 Feign 注释和 JAX-RS 注释。Feign 还支持可插拔编码器和解码器。Spring Cloud 添加了对 Spring MVC 注释的支持，以及对使用 Spring Web 中默认使用的 HttpMessageConverter 的支持。Spring Cloud 集成了 Eureka、Spring Cloud CircuitBreaker 以及 Spring Cloud LoadBalancer，以便在使用 Feign 时提供负载平衡的 http 客户端。</li> <li>一句话总结：openfeign 是一个声明式的 Web 服务客户端，<strong>只需创建一个 Rest 接口并在该接口上添加注解 <code>@FeignClient</code> 即可</strong>。</li> <li>OpenFeign 基本上就是当前微服务之间调用的事实标准。</li></ul> <p><img src="/assets/img/image-20240505233453294.fac5c993.webp" alt="image-20240505233453294"></p> <p><img src="/assets/img/image-20240505233527052.00b7cd5a.webp" alt="image-20240505233527052"></p> <h3 id="能干啥-2"><a href="#能干啥-2" class="header-anchor">#</a> 能干啥</h3> <p><strong>OpenFeign 能干什么：</strong></p> <ul><li><p>前面在使用 <strong>SpringCloud LoadBalancer</strong> + RestTemplate 时，利用 RestTemplate 对 http 请求的封装处理形成了一套模版化的调用方法。</p></li> <li><p><strong>但是在实际开发中，</strong> 由于对服务依赖的调用可能不止一处，<strong>往往一个接口会被多处调用，所以通常都会针对每个微服务自行封装一些客户端类来包装这些依赖服务的调用</strong>。</p></li> <li><p>所以，OpenFeign 在此基础上做了进一步封装，由它来帮助我们定义和实现依赖服务接口。</p></li> <li><p>在 OpenFeign 的实现下，我们<strong>只需创建一个接口并使用注解的方式来配置它（在一个微服务接口上面标注一个 <code>@FeignClien</code> 注解即可）</strong>，即可完成对服务提供方的接口绑定，统一对外暴露可以被调用的接口方法，大大简化和降低了调用客户端的开发量，也即由服务提供者给出调用接口清单，消费者直接通过 OpenFeign 调用即可，O(∩_∩)O。</p></li> <li><p><strong>OpenFeign 同时还集成 SpringCloud LoadBalancer。</strong></p></li> <li><p>可以在使用 OpenFeign 时提供 Http 客户端的负载均衡，也可以集成阿里巴巴 Sentinel 来提供熔断、降级等功能。</p></li> <li><p>而与 SpringCloud LoadBalancer 不同的是，通过 OpenFeign 只需要定义服务绑定接口且以声明式的方法，优雅而简单的实现了服务调用。</p></li></ul> <p><strong>特性：</strong></p> <ol><li>可插拔的注解支持，包括 Feign 注解和 JAX-RS 注解</li> <li>支持可插拔的 HTTP 编码器和解码器</li> <li>支持 Sentinel 和它的 Fallback</li> <li>支持 SpringCloud LoadBalancer 的负载均衡</li> <li>支持 HTTP 请求和响应的压缩</li></ol> <h3 id="openfeign-通用步骤"><a href="#openfeign-通用步骤" class="header-anchor">#</a> OpenFeign 通用步骤</h3> <h4 id="接口-注解"><a href="#接口-注解" class="header-anchor">#</a> 接口+注解</h4> <ol><li><p>微服务 Api 接口 + <code>@FeignClient</code> 注解标签</p> <p><img src="/assets/img/image-20240505234348304.3adc341d.webp" alt="架构说明图"></p></li></ol> <h4 id="流程步骤"><a href="#流程步骤" class="header-anchor">#</a> 流程步骤</h4> <h5 id="建-module"><a href="#建-module" class="header-anchor">#</a> 建 Module</h5> <p>cloud-consumer-feign-order80</p> <p><img src="/assets/img/image-20240508215217961.afb8d740.webp" alt="image-20240508215217961"></p> <h5 id="改-pom-文件"><a href="#改-pom-文件" class="header-anchor">#</a> 改 POM 文件</h5> <p>引入 openfeign 依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--openfeign--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>完整 pom 文件</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-consumer-order80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--loadbalancer--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud consul discovery --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool-all--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--fastjson2--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><h5 id="写-application-yml"><a href="#写-application-yml" class="header-anchor">#</a> 写 application.yml</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>openfeign<span class="token punctuation">-</span>order
  <span class="token comment">####Spring Cloud Consul for Service Discovery</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#优先使用服务ip进行注册</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="主启动-修改类名为-mainopenfeign80"><a href="#主启动-修改类名为-mainopenfeign80" class="header-anchor">#</a> 主启动（修改类名为 MainOpenFeign80）</h5> <p>主启动类上面配置 <code>@EnableFeignClients</code> 表示开启 OpenFeign 功能并激活文件里需要开启日志</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">//该注解用于向使用consul为注册中心时注册服务</span>
<span class="token annotation punctuation">@EnableFeignClients</span><span class="token comment">//启用feign客户端,定义服务+绑定接口，以声明式的方法优雅而简单的实现服务调用</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainOpenFeign80</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MainOpenFeign80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="业务类-3"><a href="#业务类-3" class="header-anchor">#</a> 业务类</h5> <h6 id="修改-cloud-api-commons-通用模块"><a href="#修改-cloud-api-commons-通用模块" class="header-anchor">#</a> 修改 cloud-api-commons 通用模块</h6> <p>订单模块要去调用支付模块，订单和支付两个微服务，需要通过 Api 接口解耦，一般不要在订单模块写非订单相关的业务，自己的业务自己做+其它模块走 FeignApi 接口调用。</p> <ol><li><p>引入 openfeign 依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--openfeign--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>参考微服务 8001 的 Controller 层，新建服务接口 PayFeignApi ，头上配置 <code>@FeignClient</code> 注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>apis</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayFeignApi</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 新增一条支付相关流水记录
     * @param payDTO
     * @return
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResultData</span> <span class="token function">addPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 按照主键记录查询支付流水信息
     * @param id
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//    ResultData getPayInfo(@PathVariable String id);</span>
    <span class="token class-name">ResultData</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * openfeign 天然支持负载均衡演示
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/get/info&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">myLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li> <li><p>bug 提醒一下（当使用 IDEA 快速推荐时，引入的就是括号里没有参数的形式）</p> <p><img src="/assets/img/image-20240508221417156.09871beb.webp" alt="image-20240508221417156"></p></li></ol> <h6 id="创建-controller-层-ordercontroller"><a href="#创建-controller-层-ordercontroller" class="header-anchor">#</a> 创建 Controller 层 OrderController</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayFeignApi</span> payFeignApi<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/feign/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第一步：模拟本地addOrder新增订单成功(省略sql操作)，第二步：再开启addPay支付微服务远程调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">addPay</span><span class="token punctuation">(</span>payDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/feign/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------支付微服务远程调用，按照id查询订单支付流水信息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultData</span> resultData <span class="token operator">=</span> payFeignApi<span class="token punctuation">.</span><span class="token function">getPayInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * openfeign天然支持负载均衡演示
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/mylb&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">mylb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="测试-6"><a href="#测试-6" class="header-anchor">#</a> 测试</h4> <ol><li><p>先启动 Consul 服务器 <a href="http://localhost:8500/ui/dc1/services" target="_blank" rel="noopener noreferrer">Services - Consul<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>再启动微服务 8001</p></li> <li><p>再启动 cloud-consumer-feign-order80</p></li> <li><p>PostMan 测试</p> <ul><li><p>新增：<a href="http://localhost/feign/pay/add" target="_blank" rel="noopener noreferrer">http://localhost/feign/pay/add<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/image-20240508223753569.20d058bd.webp" alt="image-20240508223753569"></p></li> <li><p>查询：<a href="http://localhost/feign/pay/get/1" target="_blank" rel="noopener noreferrer">http://localhost/feign/pay/get/1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/image-20240508223908238.19c84a32.webp" alt="image-20240508223908238"></p></li></ul></li> <li><p>再启动微服务 8002，测试</p> <ul><li><p><a href="http://localhost/feign/pay/mylb" target="_blank" rel="noopener noreferrer">http://localhost/feign/pay/mylb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><strong>OpenFeign 默认集成了 LoadBalancer</strong></p> <p><img src="/assets/img/image-20240505234758632.3c0cb8ec.webp" alt="image-20240505234758632"></p></li></ul></li></ol> <h4 id="小总结"><a href="#小总结" class="header-anchor">#</a> 小总结</h4> <p><img src="/assets/img/image-20240505234833880.3b8b1ab1.webp" alt="image-20240505234833880"></p> <h3 id="openfeign-高级特性"><a href="#openfeign-高级特性" class="header-anchor">#</a> OpenFeign 高级特性</h3> <h4 id="openfeign-超时控制"><a href="#openfeign-超时控制" class="header-anchor">#</a> OpenFeign 超时控制</h4> <h5 id="问题描述"><a href="#问题描述" class="header-anchor">#</a> 问题描述</h5> <p>在 Spring Cloud 微服务架构中，大部分公司都是利用 OpenFeign 进行服务间的调用，而比较简单的业务使用默认配置是不会有多大问题的，但是如果是业务比较复杂，服务要进行比较繁杂的业务计算，那后台很有可能会出现 Read Timeout 这个异常，因此定制化配置超时时间就有必要了。</p> <p><img src="/assets/img/image-20240508230453843.57b00d50.webp" alt="image-20240508230453843"></p> <h5 id="模拟请求超时"><a href="#模拟请求超时" class="header-anchor">#</a> 模拟请求超时</h5> <ol><li><p>服务提供方 cloud-provider-payment8001 故意写暂停 62 秒钟程序</p> <p><img src="/assets/img/image-20240508232455412.5f36750f.webp" alt="image-20240508232455412"></p></li> <li><p>服务调用方 cloud-consumer-feign-order80 写好捕捉超时异常</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/feign/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------支付微服务远程调用，按照id查询订单支付流水信息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResultData</span> resultData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调用开始-----:&quot;</span><span class="token operator">+</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData <span class="token operator">=</span> payFeignApi<span class="token punctuation">.</span><span class="token function">getPayInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调用结束-----:&quot;</span><span class="token operator">+</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC500</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/assets/img/image-20240508232609193.de1d8b26.webp" alt="image-20240508232609193"></p></li> <li><p>测试结果 http://localhost/feign/pay/get/1</p> <p><img src="/assets/img/image-20240508231615531.4a9297bd.webp" alt="image-20240508231615531"></p></li> <li><p><strong>结论：OpenFeign 默认等待 60 秒钟，超过后报错。</strong></p></li></ol> <h5 id="超时时间配置"><a href="#超时时间配置" class="header-anchor">#</a> 超时时间配置</h5> <ul><li>默认 OpenFeign 客户端等待 60 秒钟，但是服务端处理超过规定时间会导致 Feign 客户端返回报错。</li> <li>为了避免这样的情况，有时候我们需要设置 Feign 客户端的超时控制，默认 60 秒太长或者业务时间太短都不好。</li></ul> <p>在调用 OpenFeign 接口的项目的 yml 文件中开启 OpenFeign 客户端超时控制配置参数：</p> <ul><li>connectTimeout    连接超时时间	默认 60s</li> <li>readTimeout       请求处理超时时间  默认 2s</li></ul> <p><strong>全局配置：</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">config</span><span class="token punctuation">:</span>
          <span class="token key atrule">default</span><span class="token punctuation">:</span>
            <span class="token comment"># 连接超时时间</span>
            <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
            <span class="token comment"># 读取超时时间</span>
            <span class="token key atrule">readTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>指定配置：</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">config</span><span class="token punctuation">:</span>
          <span class="token comment"># default 设置的全局超时时间，指定服务名称可以设置单个服务的超时时间</span>
          <span class="token key atrule">default</span><span class="token punctuation">:</span>
            <span class="token comment">#连接超时时间</span>
            <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">4000</span>
            <span class="token comment">#读取超时时间</span>
            <span class="token key atrule">readTimeout</span><span class="token punctuation">:</span> <span class="token number">4000</span>
          
          <span class="token comment"># 为serviceC这个服务单独配置超时时间，单个配置的超时时间将会覆盖全局配置   </span>
          <span class="token key atrule">serviceC</span><span class="token punctuation">:</span>
            <span class="token comment">#连接超时时间</span>
            <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">2000</span>
            <span class="token comment">#读取超时时间</span>
            <span class="token key atrule">readTimeout</span><span class="token punctuation">:</span> <span class="token number">2000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><img src="/assets/img/image-20240508233506570.5a94fc93.webp" alt="image-20240508233506570"></p> <h4 id="openfeign-重试机制"><a href="#openfeign-重试机制" class="header-anchor">#</a> OpenFeign 重试机制</h4> <ol><li><p>默认重试机制是关闭的，给了默认值，调用一次后就结束。</p> <p><img src="/assets/img/image-20240509004541350.a8cf322d.webp" alt="image-20240509004541350"></p></li> <li><p>开启 Retryer 功能，新增配置类 <code>FeignConfig</code> 并修改 Retryer 配置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignConfig</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Retryer</span> <span class="token function">myRetryer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//return Retryer.NEVER_RETRY; //Feign默认配置是不走重试策略的</span>
        <span class="token comment">//最大请求次数为3(1+2)，初始间隔时间为100ms，重试间最大间隔时间为1s</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Retryer<span class="token punctuation">.</span>Default</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>结果，总体调用 3 次。</p> <ul><li>3 = 1(default)+2，一次 4s，三次 12s。</li> <li>目前控制台没有看到 3 次重试过程，只看到结果，是 feign 的日志打印问题。</li></ul> <p><img src="/assets/img/image-20240509005034664.d8bcd713.webp" alt="image-20240509005034664"></p></li></ol> <h4 id="openfeign-默认-httpclient-修改"><a href="#openfeign-默认-httpclient-修改" class="header-anchor">#</a> OpenFeign 默认 HttpClient 修改</h4> <h5 id="是什么-4"><a href="#是什么-4" class="header-anchor">#</a> 是什么</h5> <ul><li>OpenFeign 中 http client 如果不做特殊配置，OpenFeign 默认使用 JDK 自带的 <code>HttpURLConnection</code> 发送 HTTP 请求。</li> <li>由于默认 <code>HttpURLConnection</code> 没有连接池，性能和效率比较低，如果采用默认，性能上不是最优，所以可以对其优化。</li></ul> <h5 id="为什么替换为-apache-httpclient-5"><a href="#为什么替换为-apache-httpclient-5" class="header-anchor">#</a> 为什么替换为 Apache HttpClient 5</h5> <p><code>Apache HttpClient 5</code> 替换 OpenFeign 默认的 <code>HttpURLConnection</code>。</p> <ul><li><code>spring-cloud-starter-openfeign</code> 支持 <code>spring-cloud-starter-loadbalancer</code>。但是，作为一个可选的依赖项，如果您希望使用它，则需要确保已将其添加到项目中。</li> <li>要使用 OkHttpClient 支持的 Feign 客户端和 Http2Client Feign 客户端，请确保您要使用的客户端位于类路径上，并分别将 <code>spring.cloud.openfeign.okhttp.enabled</code> 或 <code>spring.cloud.openfeign.http2client.enabled</code> 设置为 <code>true</code>。</li> <li>当涉及到 Apache HttpClient 5 支持的 Feign 客户端时，确保 HttpClient 5 在类路径上就足够了，但是您仍然可以通过将 <code>spring.cloud.openfeign.httpclient.hc5.enabled</code> 设置为 <code>false</code>  来禁用它对 Feign 客户端的使用。当使用 ApacheHC5 时，您可以通过提供 <code>org.apache.hc.client5.http.impl.classic.CloseableHttpClient</code> 的 bean 来定制所使用的 HTTP 客户端。</li></ul> <p><img src="/assets/img/image-20240509010652071.56d5c009.webp" alt="image-20240509010652071"></p> <h5 id="修改微服务-cloud-consumer-openfeign-order80"><a href="#修改微服务-cloud-consumer-openfeign-order80" class="header-anchor">#</a> 修改微服务 cloud-consumer-openfeign-order80</h5> <ol><li><p>FeignConfig 类里面将 Retryer 属性修改为默认</p> <p><img src="/assets/img/image-20240509011101607.a911eaf8.webp" alt="image-20240509011101607"></p></li> <li><p>添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token comment">&lt;!-- httpclient5--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents.client5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- feign-hc5--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-hc5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>13.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>Apache HttpClient5 配置开启</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#  Apache HttpClient5 配置开启</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">hc5</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h4 id="openfeign-请求-响应压缩"><a href="#openfeign-请求-响应压缩" class="header-anchor">#</a> OpenFeign 请求/响应压缩</h4> <h5 id="官网说明"><a href="#官网说明" class="header-anchor">#</a> 官网说明</h5> <p><img src="/assets/img/image-20240509011702414.b82141bb.webp" alt="image-20240509011702414"></p> <h5 id="是什么-5"><a href="#是什么-5" class="header-anchor">#</a> 是什么</h5> <p><strong>对请求和响应进行 GZIP 压缩：</strong></p> <p>Spring Cloud OpenFeign 支持对请求和响应进行 GZIP 压缩，以减少通信过程中的性能损耗。</p> <p>通过下面的两个参数设置，就能开启请求与相应的压缩功能：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>spring.cloud.openfeign.compression.request.enabled=true
spring.cloud.openfeign.compression.response.enabled=true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>细粒度化设置：</strong></p> <p>对请求压缩做一些更细致的设置，比如下面的配置内容指定压缩的请求数据类型并设置了请求压缩的大小下限，只有超过这个大小的请求才会进行压缩：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>spring.cloud.openfeign.compression.request.enabled=true
spring.cloud.openfeign.compression.request.mime<span class="token punctuation">-</span>types=text/xml<span class="token punctuation">,</span>application/xml<span class="token punctuation">,</span>application/json <span class="token comment">#触发压缩数据类型</span>
spring.cloud.openfeign.compression.request.min<span class="token punctuation">-</span>request<span class="token punctuation">-</span>size=2048 <span class="token comment">#最小触发压缩的大小</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="yml-2"><a href="#yml-2" class="header-anchor">#</a> yml</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>openfeign<span class="token punctuation">-</span>order
  <span class="token comment">####Spring Cloud Consul for Service Discovery</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#优先使用服务ip进行注册</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">config</span><span class="token punctuation">:</span>
          <span class="token key atrule">default</span><span class="token punctuation">:</span>
          <span class="token comment">#cloud-payment-service:</span>
            <span class="token comment">#连接超时时间</span>
            <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">4000</span>
            <span class="token comment">#读取超时时间</span>
             <span class="token key atrule">readTimeout</span><span class="token punctuation">:</span> <span class="token number">4000</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">hc5</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">compression</span><span class="token punctuation">:</span>
        <span class="token key atrule">request</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">min-request-size</span><span class="token punctuation">:</span> <span class="token number">2048</span> <span class="token comment">#最小触发压缩的大小</span>
          <span class="token key atrule">mime-types</span><span class="token punctuation">:</span> text/xml<span class="token punctuation">,</span>application/xml<span class="token punctuation">,</span>application/json <span class="token comment">#触发压缩数据类型</span>
        <span class="token key atrule">response</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>注：压缩效果测试在下一章节体现</p> <h4 id="openfeign-日志打印功能"><a href="#openfeign-日志打印功能" class="header-anchor">#</a> OpenFeign 日志打印功能</h4> <h5 id="日志打印功能是什么"><a href="#日志打印功能是什么" class="header-anchor">#</a> 日志打印功能是什么</h5> <p>Feign 提供了日志打印功能，我们可以通过配置来调整日志级别，从而了解 Feign 中 Http 请求的细节，说白了就是对 Feign 接口的调用情况进行监控和输出。</p> <h5 id="日志级别"><a href="#日志级别" class="header-anchor">#</a> 日志级别</h5> <ul><li><code>NONE</code>：默认的，不显示任何日志；</li> <li><code>BASIC</code>：仅记录请求方法、URL、响应状态码及执行时间；</li> <li><code>HEADERS</code>：除了 <code>BASIC</code> 中定义的信息之外，还有请求和响应的头信息；</li> <li><code>FULL</code>：除了 <code>HEADERS</code> 中定义的信息之外，还有请求和响应的正文及元数据。</li></ul> <h5 id="配置日志-bean-feignloggerlevel"><a href="#配置日志-bean-feignloggerlevel" class="header-anchor">#</a> 配置日志 bean feignLoggerLevel</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignConfig</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Retryer</span> <span class="token function">myRetryer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Retryer</span><span class="token punctuation">.</span><span class="token constant">NEVER_RETRY</span><span class="token punctuation">;</span> <span class="token comment">//Feign默认配置是不走重试策略的</span>
        <span class="token comment">//最大请求次数为3(1+2)，初始间隔时间为100ms，重试间最大间隔时间为1s</span>
<span class="token comment">//        return new Retryer.Default(100,1,3);</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">feignLoggerLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">FULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="yml-文件里需要开启日志的-feign-客户端"><a href="#yml-文件里需要开启日志的-feign-客户端" class="header-anchor">#</a> YML 文件里需要开启日志的 Feign 客户端</h5> <p><img src="/assets/img/image-20240509012529509.338b1546.webp" alt="image-20240509012529509"></p> <p>公式（三段）：<strong>logging.level</strong> + 含有 <code>@FeignClient</code> 注解的完整带包名的接口名+debug</p> <p><img src="data:image/webp;base64,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" alt="image-20240509012547393"></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># feign日志以什么级别监控哪个接口</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">com</span><span class="token punctuation">:</span>
      <span class="token key atrule">atguigu</span><span class="token punctuation">:</span>
        <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
          <span class="token key atrule">apis</span><span class="token punctuation">:</span>
            <span class="token key atrule">PayFeignApi</span><span class="token punctuation">:</span> debug 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="后台日志查看"><a href="#后台日志查看" class="header-anchor">#</a> 后台日志查看</h5> <p><strong>带着压缩调用：</strong></p> <p><img src="/assets/img/image-20240509012943997.28279d05.webp" alt="image-20240509012943997"></p> <p><strong>去掉压缩调用：</strong></p> <p><img src="/assets/img/image-20240509013048845.cd4b9709.webp" alt="image-20240509013048845"></p> <h5 id="补充实验-重试机制"><a href="#补充实验-重试机制" class="header-anchor">#</a> 补充实验，重试机制</h5> <ol><li>类 <code>FeignConfig</code> 恢复为重试 3 次</li> <li>控制台看到 3 次过程</li></ol> <h3 id="openfeign-和-sentinel-集成实现-fallback-服务降级"><a href="#openfeign-和-sentinel-集成实现-fallback-服务降级" class="header-anchor">#</a> OpenFeign 和 Sentinel 集成实现 fallback 服务降级</h3> <p><font color="red">见后续 springcloud alibaba 篇章。</font></p> <h2 id="circuit-breaker-断路器"><a href="#circuit-breaker-断路器" class="header-anchor">#</a> Circuit Breaker 断路器</h2> <h3 id="hystrix-目前也进入维护模式"><a href="#hystrix-目前也进入维护模式" class="header-anchor">#</a> Hystrix 目前也进入维护模式</h3> <h4 id="是什么-6"><a href="#是什么-6" class="header-anchor">#</a> 是什么</h4> <p>Hystrix 是一个<strong>用于处理分布式系统的延迟和容错的开源库</strong>，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix 能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。</p> <h4 id="hystrix-官宣-停更进维"><a href="#hystrix-官宣-停更进维" class="header-anchor">#</a> Hystrix 官宣，停更进维</h4> <p><img src="/assets/img/image-20240509222412080.3d15e03c.webp" alt="image-20240509222412080"></p> <h4 id="hystrix-未来替换方案-resilience4j"><a href="#hystrix-未来替换方案-resilience4j" class="header-anchor">#</a> Hystrix 未来替换方案：Resilience4j</h4> <p><img src="/assets/img/image-20240509222450168.475696e2.webp" alt="image-20240509222450168"></p> <h3 id="circuit-breaker-概述"><a href="#circuit-breaker-概述" class="header-anchor">#</a> Circuit Breaker 概述</h3> <h4 id="_2023-年影响极大的真实生产故障"><a href="#_2023-年影响极大的真实生产故障" class="header-anchor">#</a> 2023 年影响极大的真实生产故障</h4> <ol><li>语雀崩了(2023.10.23)</li> <li>阿里系大部分产品(2023.11.12)</li> <li>阿里云产品控制台</li></ol> <h4 id="分布式系统面临的问题"><a href="#分布式系统面临的问题" class="header-anchor">#</a> 分布式系统面临的问题</h4> <p><strong>复杂分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免地失败。</strong></p> <p><strong>服务雪崩</strong>：</p> <ul><li>多个微服务之间调用的时候，假设微服务 A 调用微服务 B 和微服务 C，微服务 B 和微服务 C 又调用其它的微服务，这就是所谓的“扇出”。如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务 A 的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的“雪崩效应”。</li> <li>对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几秒钟内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障。这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。</li> <li>所以，通常当你发现一个模块下的某个实例失败后，这时候这个模块依然还会接收流量，然后这个有问题的模块还调用了其他的模块，这样就会发生级联故障，或者叫雪崩。</li></ul> <h4 id="诉求"><a href="#诉求" class="header-anchor">#</a> 诉求</h4> <ol><li><strong>问题</strong> <ul><li>禁止服务雪崩故障</li></ul></li> <li><strong>解决</strong> <ul><li>有问题的节点，快速熔断（快速返回失败处理或者返回默认兜底数据【服务降级】）。</li></ul></li></ol> <ul><li>”断路器”本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝），向调用方返回一个符合预期的、可处理的备选响应(FallBack)，而不是长时间的等待或者抛出调用方无法处理的异常，这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩。</li> <li>一句话，<strong>出故障了“保险丝”跳闸，别把整个家给烧了。</strong></li></ul> <h4 id="如何避免系统大面积故障"><a href="#如何避免系统大面积故障" class="header-anchor">#</a> 如何避免系统大面积故障</h4> <p><strong>Spring Cloud Circuit Breaker</strong></p> <ol><li>服务熔断
<ul><li>类比保险丝，保险丝闭合状态(CLOSE)可以正常使用，当达到最大服务访问后，直接拒绝访问跳闸限电(OPEN)，此刻调用方会接受服务降级的处理并返回友好兜底提示。</li> <li>就是家里保险丝，从闭合 CLOSE 供电状态→跳闸 OPEN 打开状态。</li></ul></li> <li>服务降级
<ul><li>服务器忙，请稍后再试。</li> <li>不让客户端等待并立刻返回一个友好提示，fallback。</li></ul></li> <li>服务限流
<ul><li>秒杀高并发等操作，严禁一窝蜂的过来拥挤，大家排队，一秒钟 N 个，有序进行。</li></ul></li> <li>服务限时</li> <li>服务预热</li> <li>接近实时的监控</li> <li>兜底处理动作</li> <li>......</li></ol> <h3 id="crcuit-breaker-是什么"><a href="#crcuit-breaker-是什么" class="header-anchor">#</a> <a href="https://spring.io/projects/spring-cloud-circuitbreaker/#overview" target="_blank" rel="noopener noreferrer">Crcuit Breaker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是什么</h3> <ul><li>CircuitBreaker 的目的是保护分布式系统免受故障和异常，提高系统的可用性和健壮性。</li> <li>当一个组件或服务出现故障时，CircuitBreaker 会迅速切换到 OPEN 状态（保险丝跳闸断电），阻止请求发送到该组件或服，从而避免更多的请求发送到该组件或服务。这可以减少对该组件或服务的负载，防止该组件或服务进一步崩溃，并使整个系统能够继续正常运行。</li> <li>同时，CircuitBreaker 还可以提高系统的可用性和健壮性，因为它可以在分布式系统的各个组件之间自动切换，从而避免单点故障的问题。</li></ul> <p><strong>Circuit Breaker 只是一套规范和接口，落地实现者是 Resilience4J。</strong></p> <h3 id="resilience4j"><a href="#resilience4j" class="header-anchor">#</a> <a href="https://github.com/resilience4j/resilience4j#1-introduction" target="_blank" rel="noopener noreferrer">Resilience4J<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <h4 id="是什么-7"><a href="#是什么-7" class="header-anchor">#</a> 是什么</h4> <p><img src="/assets/img/image-20240509224355671.9f3b26b2.webp" alt="image-20240509224355671"></p> <h4 id="能干啥-3"><a href="#能干啥-3" class="header-anchor">#</a> 能干啥</h4> <p><img src="/assets/img/image-20240509224448824.328dbae3.webp" alt="image-20240509224448824"></p> <h4 id="怎么玩-2"><a href="#怎么玩-2" class="header-anchor">#</a> 怎么玩</h4> <p><a href="https://resilience4j.readme.io/docs/circuitbreaker" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/index.md" target="_blank" rel="noopener noreferrer">中文手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="案例实战"><a href="#案例实战" class="header-anchor">#</a> 案例实战</h3> <h4 id="熔断-circuitbreaker-服务熔断-服务降级"><a href="#熔断-circuitbreaker-服务熔断-服务降级" class="header-anchor">#</a> 熔断(CircuitBreaker)（服务熔断+服务降级）</h4> <h5 id="断路器-3-大状态"><a href="#断路器-3-大状态" class="header-anchor">#</a> 断路器 3 大状态</h5> <p><img src="/assets/img/image-20240509225911153.969a561d.webp" alt="image-20240509225911153"></p> <h5 id="断路器-3-大状态之间的转换"><a href="#断路器-3-大状态之间的转换" class="header-anchor">#</a> 断路器 3 大状态之间的转换</h5> <p><img src="/assets/img/image-20240509225929325.1f745508.webp" alt="image-20240509225929325"></p> <h5 id="断路器所有配置参数参考"><a href="#断路器所有配置参数参考" class="header-anchor">#</a> 断路器所有配置参数参考</h5> <p><a href="https://resilience4j.readme.io/docs/circuitbreaker#create-and-configure-a-circuitbreaker" target="_blank" rel="noopener noreferrer">CircuitBreaker (readme.io)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/CircuitBreaker.md" target="_blank" rel="noopener noreferrer">Resilience4j-Guides-Chinese (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>默认 CircuitBreaker.java 配置类：<code>io.github.resilience4j.circuitbreaker.CircuitBreakerConfig</code></p> <p>中文手册简洁版：</p> <table><thead><tr><th>配置属性</th> <th>默认值</th> <th>描述</th></tr></thead> <tbody><tr><td><code>failure-rate-threshold</code></td> <td>50</td> <td>以百分比配置失败率峰值</td></tr> <tr><td><code>sliding-window-type</code></td> <td>COUNT_BASED</td> <td>断路器的滑动窗口期类型 可以基于“次数”（<code>COUNT_BASED</code>）或者“时间”（<code>TIME_BASED</code>）进行熔断，默认是 <code>COUNT_BASED</code>。</td></tr> <tr><td><code>sliding-window-size</code></td> <td>100</td> <td>若<code>COUNT_BASED</code>，则 10 次调用中有 50%失败（即 5 次）打开熔断断路器；若为 TIME_BASED 则，此时还有额外的两个设置属性，含义为：在 N 秒内（<code>sliding-window-size</code>）100%（<code>slow-call-rate-threshold</code>）的请求超过 N 秒（<code>slow-call-duration-threshold</code>）打开断路器。</td></tr> <tr><td><code>slowCallRateThreshold</code></td> <td>100</td> <td>以百分比的方式配置，断路器把调用时间大于 <code>slowCallDurationThreshold</code> 的调用视为慢调用，当慢调用比例大于等于峰值时，断路器开启，并进入服务降级。</td></tr> <tr><td><code>slowCallDurationThreshold</code></td> <td>60000 [ms]</td> <td>配置调用时间的峰值，高于该峰值的视为慢调用。</td></tr> <tr><td><code>permitted-number-of-calls-in-half-open-state</code></td> <td>10</td> <td>运行断路器在 <code>HALF_OPEN</code> 状态下时进行 N 次调用，如果故障或慢速调用仍然高于阈值，断路器再次进入打开状态。</td></tr> <tr><td><code>minimum-number-of-calls</code></td> <td>100</td> <td>在每个滑动窗口期样本数，配置断路器计算错误率或者慢调用率的最小调用数。比如设置为 5 意味着，在计算故障率之前，必须至少调用 5 次。如果只记录了 4 次，即使 4 次都失败了，断路器也不会进入到打开状态。</td></tr> <tr><td><code>wait-duration-in-open-state</code></td> <td>60000 [ms]</td> <td>从 <code>OPEN</code> 到 <code>HALF_OPEN</code> 状态需要等待的时间</td></tr></tbody></table> <h5 id="熔断-降级案例需求说明"><a href="#熔断-降级案例需求说明" class="header-anchor">#</a> 熔断+降级案例需求说明</h5> <ul><li>6 次访问中当执行方法的失败率达到 <strong>50%</strong> 时 <strong>CircuitBreaker</strong> 将进入开启 <strong>OPEN</strong> 状态(<strong>保险丝跳闸断电</strong>)拒绝所有请求。</li> <li>等待<strong>5</strong>秒后，<strong>CircuitBreaker</strong> 将自动从开启 <strong>OPEN</strong> 状态过渡到半开 <strong>HALF_OPEN</strong> 状态，允许一些请求通过以测试服务是否恢复正常。</li> <li>如还是异常 <strong>CircuitBreaker</strong> 将重新进入开启 <strong>OPEN</strong> 状态；如正常将进入关闭 <strong>CLOSE</strong> 闭合状态恢复正常处理请求。</li></ul> <p>具体时间和频次等属性见具体实际案例，这里只是作为 case 举例讲解。</p> <p><img src="/assets/img/image-20240509231136170.58461154.webp" alt="image-20240509231136170"></p> <h5 id="基于计数的滑动窗口-count-based"><a href="#基于计数的滑动窗口-count-based" class="header-anchor">#</a> 基于计数的滑动窗口 COUNT_BASED</h5> <ol><li><p>修改 cloud-provider-payment8001</p> <ul><li><p>新建 PayCircuitController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayCircuitController</span> <span class="token punctuation">{</span>
    <span class="token comment">//=========Resilience4j CircuitBreaker 的例子</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/circuit/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;----circuit id 不能负数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">9999</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello, circuit! inputId:  &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot; \t &quot;</span> <span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul></li> <li><p>cloud-api-commons 中 PayFeignApi 接口新增方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* Resilience4j CircuitBreaker 的例子
* @param id
* @return
*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/circuit/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>修改 cloud-consumer-feign-order80</p> <ul><li><p>pom.xml 新增依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--resilience4j-circuitbreaker--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-circuitbreaker-resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 由于断路保护等需要AOP实现，所以必须导入AOP包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>yml 新增配置（展示效果时 openfeign 超时时间设置为 20s）</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
	  <span class="token comment"># 开启circuitbreaker和分组激活 spring.cloud.openfeign.circuitbreaker.enabled</span>
	  <span class="token comment"># 默认不开启分组。</span>
      <span class="token comment"># 精确优先就是每个服务调用都将根据其所属的熔断器分组继续处理。</span>
      <span class="token comment"># 策略优先级：精确优先、分组次之(开了分组)、默认最后</span>
      <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#没开分组永远不用分组的配置。精确优先、分组次之(开了分组)、默认最后</span>
          
<span class="token comment"># Resilience4j CircuitBreaker 按照次数：COUNT_BASED 的例子</span>
<span class="token comment">#  6次访问中当执行方法的失败率达到50%时CircuitBreaker将进入开启OPEN状态(保险丝跳闸断电)拒绝所有请求。</span>
<span class="token comment">#  等待5秒后，CircuitBreaker 将自动从开启OPEN状态过渡到半开HALF_OPEN状态，允许一些请求通过以测试服务是否恢复正常。</span>
<span class="token comment">#  如还是异常CircuitBreaker 将重新进入开启OPEN状态；如正常将进入关闭CLOSE闭合状态恢复正常处理请求。</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
  <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">failureRateThreshold</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment">#设置50%的调用失败时打开断路器，超过失败请求百分⽐CircuitBreaker变为OPEN状态。</span>
        <span class="token key atrule">slidingWindowType</span><span class="token punctuation">:</span> COUNT_BASED <span class="token comment"># 滑动窗口的类型</span>
        <span class="token key atrule">slidingWindowSize</span><span class="token punctuation">:</span> <span class="token number">6</span> <span class="token comment">#滑动窗⼝的⼤⼩配置COUNT_BASED表示6个请求，配置TIME_BASED表示6秒</span>
        <span class="token key atrule">minimumNumberOfCalls</span><span class="token punctuation">:</span> <span class="token number">6</span> <span class="token comment">#断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。如果minimumNumberOfCalls为10，则必须最少记录10个样本，然后才能计算失败率。如果只记录了9次调用，即使所有9次调用都失败，断路器也不会开启。</span>
        <span class="token key atrule">automaticTransitionFromOpenToHalfOpenEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否启用自动从开启状态过渡到半开状态，默认值为false。如果启用，CircuitBreaker将自动从开启状态过渡到半开状态，并允许一些请求通过以测试服务是否恢复正常</span>
        <span class="token key atrule">waitDurationInOpenState</span><span class="token punctuation">:</span> 5s <span class="token comment">#从OPEN到HALF_OPEN状态需要等待的时间</span>
        <span class="token key atrule">permittedNumberOfCallsInHalfOpenState</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果其中有任何一个请求失败，CircuitBreaker将重新进入开启状态。</span>
        <span class="token key atrule">recordExceptions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> java.lang.Exception
    <span class="token key atrule">instances</span><span class="token punctuation">:</span>
      <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
        <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li> <li><p>新建 OrderCircuitController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderCircuitController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayFeignApi</span> payFeignApi<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/circuit/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@CircuitBreaker</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span> fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myCircuitFallback&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuitBreaker</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myCircuit</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// myCircuitFallback就是服务降级后的兜底处理方法</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuitFallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里是容错处理逻辑，返回备用结果</span>
        <span class="token keyword">return</span> <span class="token string">&quot;myCircuitFallback，系统繁忙，请稍后再试-----/(ㄒoㄒ)/~~&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>系统繁忙，请稍后再试。不让调用者等待并立刻返回一个友好提示，fallback。</p></li></ul></li> <li><p>测试（按照错误次数达到多少后开启断路）</p> <ul><li>正确请求：http://localhost/feign/pay/circuit/11</li> <li>错误请求：http://localhost/feign/pay/circuit/-4</li> <li>一次 error 一次 OK，第 6 次时调正确的也失败。
<ul><li>失败 50%错误后触发熔断并给出服务降级，告知调用者服务不可用。</li> <li>此时就算是输入正确的访问地址也无法调用服务（我明明是正确的也不让用/(ㄒoㄒ）/~~)，它还在断路中（OPEN 状态），一会儿过度到半开并继续正确地址访问，慢慢切换回 CLOSE 状态，可以正常访问了链路回复。</li></ul></li> <li>多次故意填写错误值。
<ul><li>多次故意填写错误值（负 4），然后慢慢填写正确值（正整数 11），发现刚开始不满足条件，就算是正确的访问地址也不能进行。</li></ul></li></ul></li></ol> <h5 id="基于时间的滑动窗口-time-based"><a href="#基于时间的滑动窗口-time-based" class="header-anchor">#</a> 基于时间的滑动窗口 TIME_BASED</h5> <p><img src="/assets/img/image-20240510000646964.a3d17436.webp" alt="image-20240510000646964"></p> <ol><li><p>修改 cloud-consumer-feign-order80 YML</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># Resilience4j CircuitBreaker 按照时间：TIME_BASED 的例子</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
  <span class="token key atrule">timelimiter</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> 10s <span class="token comment">#神坑的位置，timelimiter 默认限制远程1s，超于1s就超时异常，配置了降级，就走降级逻辑</span>
  <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">failureRateThreshold</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment">#设置50%的调用失败时打开断路器，超过失败请求百分⽐CircuitBreaker变为OPEN状态。</span>
        <span class="token key atrule">slowCallDurationThreshold</span><span class="token punctuation">:</span> 2s <span class="token comment">#慢调用时间阈值，高于这个阈值的视为慢调用并增加慢调用比例。</span>
        <span class="token key atrule">slowCallRateThreshold</span><span class="token punctuation">:</span> <span class="token number">30</span> <span class="token comment">#慢调用百分比峰值，断路器把调用时间⼤于slowCallDurationThreshold，视为慢调用，当慢调用比例高于阈值，断路器打开，并开启服务降级</span>
        <span class="token key atrule">slidingWindowType</span><span class="token punctuation">:</span> TIME_BASED <span class="token comment"># 滑动窗口的类型</span>
        <span class="token key atrule">slidingWindowSize</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#滑动窗口的大小配置，配置TIME_BASED表示2秒</span>
        <span class="token key atrule">minimumNumberOfCalls</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。</span>
        <span class="token key atrule">permittedNumberOfCallsInHalfOpenState</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#半开状态允许的最大请求数，默认值为10。</span>
        <span class="token key atrule">waitDurationInOpenState</span><span class="token punctuation">:</span> 5s <span class="token comment">#从OPEN到HALF_OPEN状态需要等待的时间</span>
        <span class="token key atrule">recordExceptions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> java.lang.Exception
    <span class="token key atrule">instances</span><span class="token punctuation">:</span>
      <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
        <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>为避免影响实验效果，记得关闭，FeignConfig 自己写的重试 3 次</p></li> <li><p>测试（慢查询）</p> <ul><li>一次超时，一次正常访问，同时进行
<ul><li>http://localhost/feign/pay/circuit/9999：故意超时，将会单独报错</li> <li>http://localhost/feign/pay/circuit/11：可以访问，我是正常的</li></ul></li> <li>多个超时请求，一次正常访问，同时进行。
<ul><li>正常访问也受到了牵连，因为服务熔断不能访问了。</li></ul></li></ul></li></ol> <h5 id="小总结-2"><a href="#小总结-2" class="header-anchor">#</a> 小总结</h5> <p><strong>断路器开启或者关闭的条件：</strong></p> <ol><li>当满足一定的峰值和失败率达到一定条件后，断路器将会进入 OPEN 状态（保险丝跳闸），服务熔断。</li> <li>当 OPEN 的时候，所有请求都不会调用主业务逻辑方法，而是直接走 fallback method 兜底背锅方法，服务降级。</li> <li>一段时间之后，这个时候断路器会从 OPEN 进入到 HALF_OPEN 半开状态，会放几个请求过去探探链路是否通？
<ul><li>如成功，断路器会关闭 CLOSE（类似保险丝闭合，恢复可用）；</li> <li>如失败，继续开启。重复上述。</li></ul></li></ol> <p><font color="red">注：建议不要混合用，推荐按照调用次数 count_based。</font></p> <h4 id="隔离-bulkhead"><a href="#隔离-bulkhead" class="header-anchor">#</a> 隔离(BulkHead)</h4> <h5 id="是什么-8"><a href="#是什么-8" class="header-anchor">#</a> 是什么</h5> <p><a href="https://resilience4j.readme.io/docs/bulkhead" target="_blank" rel="noopener noreferrer">Bulkhead (readme.io)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/bulkhead.md" target="_blank" rel="noopener noreferrer">Resilience4j-Guides-Chinese (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>bulkhead：（船的）舱壁/（飞机的）隔板</p> <p>隔板来自造船行业，床仓内部一般会分成很多小隔舱，一旦一个隔舱漏水因为隔板的存在而不至于影响其它隔舱和整体船。</p> <p>限制并发量。</p> <h5 id="能干啥-4"><a href="#能干啥-4" class="header-anchor">#</a> 能干啥</h5> <p><strong>依赖隔离&amp;负载保护：用来限制对于下游服务的最大并发数量的限制</strong></p> <h5 id="两种隔离实现方式"><a href="#两种隔离实现方式" class="header-anchor">#</a> 两种隔离实现方式</h5> <p>Resilience4j 提供了如下两种隔离的实现方式，可以限制并发执行的数量：</p> <p><img src="/assets/img/image-20240510003432219.68213d7c.webp" alt="image-20240510003432219"></p> <h5 id="实现-semaphorebulkhead-信号量舱壁"><a href="#实现-semaphorebulkhead-信号量舱壁" class="header-anchor">#</a> 实现 SemaphoreBulkhead（信号量舱壁）</h5> <h6 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h6> <p>基本上就是 JUC 信号灯内容的同样思想</p> <p><img src="/assets/img/image-20240510220000811.70da10a4.webp" alt="image-20240510220000811"></p> <p><strong>信号量舱壁(SemaphoreBulkhead)原理：</strong></p> <ul><li>当信号量有空闲时，进入系统的请求会直接获取信号量并开始业务处理。</li> <li>当信号量全被占用时，接下来的请求将会进入阻塞状态，SemaphoreBulkhead 提供了一个阻塞计时器，
<ul><li>如果阻塞状态的请求在阻塞计时内无法获取到信号量则系统会拒绝这些请求。</li> <li>若请求在阻塞计时内获取到了信号量，那将直接获取信号量并执行相应的业务处理。</li></ul></li></ul> <p>类：<code>io.github.resilience4j.bulkhead.internal.SemaphoreBulkhead</code></p> <p><img src="/assets/img/image-20240510220302083.57a0e892.webp" alt="image-20240510220302083"></p> <h6 id="实战"><a href="#实战" class="header-anchor">#</a> 实战</h6> <table><thead><tr><th>属性配置</th> <th>默认值</th> <th>描述</th></tr></thead> <tbody><tr><td><code>maxConcurrentCalls</code></td> <td>25</td> <td>隔离允许线程并发执行的最大数量</td></tr> <tr><td><code>maxWaitDuration</code></td> <td>0</td> <td>当达到并发调用数量时，新的线程执行时将被阻塞，这个属性表示最长的等待时间。</td></tr></tbody></table> <ol><li><p>cloud-provider-payment8001 支付微服务修改 PayCircuitController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//=========Resilience4j bulkhead 的例子</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/bulkhead/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkhead</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;----bulkhead id 不能-4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">9999</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token string">&quot;Hello, bulkhead! inputId:  &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot; \t &quot;</span> <span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>PayFeignApi 接口新增舱壁 api 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Resilience4j Bulkhead 的例子
 * @param id
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/bulkhead/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkhead</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>cloud-consumer-feign-order80</p> <ul><li>POM.xml 新增依赖</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--resilience4j-bulkhead--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>resilience4j-bulkhead<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>yml 新增 bulkhead 配置</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#### resilience4j bulkhead 的例子</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
  <span class="token key atrule">bulkhead</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">maxConcurrentCalls</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># 隔离允许并发线程执行的最大数量</span>
        <span class="token key atrule">maxWaitDuration</span><span class="token punctuation">:</span> 1s <span class="token comment"># 当达到并发调用数量时，新的线程的阻塞时间，我只愿意等待1秒，过时不候进舱壁兜底fallback</span>
    <span class="token key atrule">instances</span><span class="token punctuation">:</span>
      <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
        <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
  <span class="token key atrule">timelimiter</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> 20s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>OrderCircuitController 业务类新增方法</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* (船的)舱壁,隔离
* @param id
* @return
*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/bulkhead/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bulkhead</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span> fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myBulkheadFallback&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">Bulkhead<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">SEMAPHORE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkhead</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myBulkhead</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkheadFallback</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;myBulkheadFallback，隔板超出最大数量限制，系统繁忙，请稍后再试-----/(ㄒoㄒ)/~~&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>测试</p> <ul><li><p>步骤</p> <ul><li>浏览器新打开 2 个窗口，各点一次，分别点击 http://localhost/feign/pay/bulkhead/9999</li> <li>每个请求调用需要耗时 5 秒，2 个线程瞬间达到配置过的最大并发数 2</li> <li>此时第 3 个请求正常的请求访问http://localhost/feign/pay/bulkhead/3 直接被舱壁限制隔离了，访问不到 8001</li> <li>等其中一个窗口停止了，再去正常访问，并发数小于 2 了，就可以正常访问</li></ul></li> <li><p>结果</p> <p><img src="/assets/img/image-20240510221948618.288392a2.webp" alt="image-20240510221948618"></p> <ul><li>可以看到因为本案例并发线程数为 2(maxConcurrentCalls: 2)，只让 2 个线程进入执行，其他请求降直接降级。</li></ul></li></ul></li></ol> <h5 id="实现-fixedthreadpoolbulkhead-固定线程池舱壁"><a href="#实现-fixedthreadpoolbulkhead-固定线程池舱壁" class="header-anchor">#</a> 实现 FixedThreadPoolBulkhead（固定线程池舱壁）</h5> <h6 id="概述-2"><a href="#概述-2" class="header-anchor">#</a> 概述</h6> <p>基本上就是 JUC-线程池内容的同样思想</p> <ul><li>FixedThreadPoolBulkhead 的功能与 SemaphoreBulkhead 一样也是 <strong>用于限制并发执行的次数</strong> 的，但是二者的实现原理存在差别而且表现效果也存在细微的差别。FixedThreadPoolBulkhead 使用一个固定线程池和一个等待队列来实现舱壁。</li> <li>当线程池中存在空闲时，则此时进入系统的请求将直接进入线程池开启新线程或使用空闲线程来处理请求。</li> <li>当线程池中无空闲时时，接下来的请求将进入等待队列，</li> <li>若等待队列仍然无剩余空间时接下来的请求将直接被拒绝，</li> <li>在队列中的请求等待线程池出现空闲时，将进入线程池进行业务处理。</li> <li>另外：ThreadPoolBulkhead 只对 CompletableFuture 方法有效，所以必须创建返回 CompletableFuture 类型的方法。</li></ul> <p>类：<code>io.github.resilience4j.bulkhead.internal.FixedThreadPoolBulkhead</code></p> <p>底层就是 JUC 里面的线程池 ThreadPoolExecutor</p> <p><img src="/assets/img/image-20240510223748430.6b067289.webp" alt="image-20240510223748430"></p> <p>submit 进线程池返回 <code>CompletableFuture&lt;T&gt;</code></p> <p><img src="/assets/img/image-20240510223852174.d0ad72c9.webp" alt="image-20240510223852174"></p> <h6 id="实战-2"><a href="#实战-2" class="header-anchor">#</a> 实战</h6> <p><img src="/assets/img/image-20240510224300286.ef0f427b.webp" alt="image-20240510224300286"></p> <ol><li><p>修改 cloud-consumer-feign-order80</p> <ul><li><p>POM 增加依赖（同上）</p></li> <li><p>YML</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">####resilience4j bulkhead -THREADPOOL的例子</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
  <span class="token key atrule">timelimiter</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> 10s <span class="token comment">#timelimiter默认限制远程1s，超过报错不好演示效果所以加上10秒</span>
  <span class="token key atrule">thread-pool-bulkhead</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">core-thread-pool-size</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">max-thread-pool-size</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">queue-capacity</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">instances</span><span class="token punctuation">:</span>
      <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
        <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
<span class="token comment"># spring.cloud.openfeign.circuitbreaker.group.enabled 请设置为false 新启线程和原来主线程脱离</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="/assets/img/image-20240510224053699.e546c7ac.webp" alt="image-20240510224053699"></p></li> <li><p>OrderCircuitController 业务类新增方法（注释原/feign/pay/bulkhead/{id}请求方法）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* (船的)舱壁,隔离,THREADPOOL
* @param id
* @return
*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/bulkhead/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bulkhead</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span> fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myBulkheadPoolFallback&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">Bulkhead<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">THREADPOOL</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">myBulkheadTHREADPOOL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;enter the method!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;exist the method!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myBulkhead</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot; Bulkhead.Type.THREADPOOL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">myBulkheadPoolFallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Bulkhead.Type.THREADPOOL，系统繁忙，请稍后再试-----/(ㄒoㄒ)/~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ul></li> <li><p>测试地址</p> <ul><li>http://localhost/feign/pay/bulkhead/1</li> <li>http://localhost/feign/pay/bulkhead/2</li> <li>http://localhost/feign/pay/bulkhead/3</li></ul> <p><img src="/assets/img/image-20240510224352773.2c1fdaa9.webp" alt="image-20240510224352773"></p></li></ol> <h4 id="限流-ratelimiter"><a href="#限流-ratelimiter" class="header-anchor">#</a> 限流(RateLimiter)</h4> <h5 id="是什么-9"><a href="#是什么-9" class="header-anchor">#</a> 是什么</h5> <p><a href="https://resilience4j.readme.io/docs/ratelimiter" target="_blank" rel="noopener noreferrer">RateLimiter (readme.io)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/ratelimiter.md" target="_blank" rel="noopener noreferrer">ratelimiter-Chinese (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>限流（频率控制）</strong></p> <ul><li><p>限流就是限制最大访问流量。系统能提供的最大并发是有限的，同时来的请求又太多，就需要限流。</p> <ul><li>比如商城秒杀业务，瞬时大量请求涌入，服务器忙不过就只好排队限流了，和去景点排队买票和去医院办理业务排队等号道理相同。</li></ul></li> <li><p>所谓限流，就是通过对并发访问/请求进行限速，或者对一个时间窗口内的请求进行限速，以保护应用系统，一旦达到限制速率则可以拒绝服务、排队或等待、降级等处理。</p></li></ul> <h5 id="常见限流算法"><a href="#常见限流算法" class="header-anchor">#</a> 常见限流算法</h5> <h6 id="漏斗算法-leaky-bucket"><a href="#漏斗算法-leaky-bucket" class="header-anchor">#</a> 漏斗算法(Leaky Bucket)</h6> <ul><li>一个固定容量的漏桶，按照设定常量固定速率流出水滴，类似医院打吊针，不管源头流量多大，设定匀速流出。</li> <li>如果流入水滴超出了桶的容量，则流入的水滴将会溢出了（被丢弃），而漏桶容量是不变的。</li></ul> <p><img src="/assets/img/image-20240510230443481.80324f33.webp" alt="image-20240510230443481"></p> <p><strong>缺点：<strong>有两个变量，一个是桶的大小，支持流量突发增多时可以存多少的水(burst)，另一个是</strong>水桶漏洞的大小(rate)</strong>。因为漏桶的漏出速率是固定的参数，所以，即使网络中不存在资源冲突（没有发生拥塞），漏桶算法也不能使流突发(burst)到端口速率。因此，<strong>漏桶算法对于存在突发特性的流量来说缺乏效率。</strong></p> <p><img src="/assets/img/image-20240510230603958.1b4b9b21.webp" alt="image-20240510230603958"></p> <h6 id="令牌桶算法-token-bucket"><a href="#令牌桶算法-token-bucket" class="header-anchor">#</a> 令牌桶算法(Token Bucket)</h6> <p>SpringCloud 默认使用该算法。</p> <p><img src="/assets/img/image-20240510230657754.be88f2bd.webp" alt="image-20240510230657754"></p> <h6 id="滚动时间窗口-tumbling-time-window"><a href="#滚动时间窗口-tumbling-time-window" class="header-anchor">#</a> 滚动时间窗口(tumbling time window)</h6> <ul><li>允许固定数量的请求进入（比如 1 秒取 4 个数据相加，超过 25 值就 over），超过数量就拒绝或者排队，等下一个时间段进入。</li> <li>由于是在一个时间间隔内进行限制，如果用户在上个时间间隔结束前请求（但没有超过限制），同时在当前时间间隔刚开始请求（同样没超过限制），在各自的时间间隔内，这些请求都是正常的。下图统计了 3 次，but......</li></ul> <p><img src="/assets/img/image-20240510230833532.a974d564.webp" alt="image-20240510230833532"></p> <p><strong>缺点</strong>：间隔临界的一段时间内的请求就会超过系统限制，可能导致系统被压垮。</p> <p><img src="/assets/img/image-20240510230913197.3f2853ad.webp" alt="image-20240510230913197"></p> <h6 id="滑动时间窗口-sliding-time-window"><a href="#滑动时间窗口-sliding-time-window" class="header-anchor">#</a> 滑动时间窗口(sliding time window)</h6> <ul><li><p>顾名思义，该时间窗口是滑动的。所以，从概念上讲，这里有两个方面的概念需要理解：</p> <ul><li>窗口：需要定义窗口的大小。</li> <li>滑动：需要定义在窗口中滑动的大小，但理论上讲滑动的大小不能超过窗口大小。</li></ul></li> <li><p>滑动窗口算法是把固定时间片进行划分并且随着时间移动，移动方式为开始时间点变为时间列表中的第 2 个时间点，结束时间点增加一个时间点，不断重复，通过这种方式可以巧妙的避开计数器的临界点的问题。下图统计了 5 次</p></li></ul> <p><img src="/assets/img/image-20240510231104566.5a6bb6f9.webp" alt="image-20240510231104566"></p> <h5 id="实战-3"><a href="#实战-3" class="header-anchor">#</a> 实战</h5> <table><thead><tr><th>属性</th> <th>默认值</th> <th>描述</th></tr></thead> <tbody><tr><td><code>timeoutDuration</code></td> <td>5 秒</td> <td>线程等待权限的默认等待时间</td></tr> <tr><td><code>limitRefreshPeriod</code></td> <td>500 纳秒</td> <td>限流器每隔 limitRefreshPeriod 刷新一次，将允许处理的最大请求数量重置为 limitForPeriod。</td></tr> <tr><td><code>limitForPeriod</code></td> <td>50</td> <td>在一次刷新周期内，允许执行的最大请求数</td></tr></tbody></table> <ol><li><p>cloud-provider-payment8001 支付微服务修改 PayCircuitController 新增 myRatelimit 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//=========Resilience4j ratelimit 的例子</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/ratelimit/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myRatelimit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello, myRatelimit欢迎到来 inputId:  &quot;</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">&quot; \t &quot;</span> <span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>PayFeignApi 接口新增限流 api 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Resilience4j Ratelimit 的例子
 * @param id
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/ratelimit/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myRatelimit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>修改 cloud-consumer-feign-order80</p> <ul><li><p>POM.xml 新增依赖</p> <div class="language-XML line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--resilience4j-ratelimiter--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>resilience4j-ratelimiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>YML 新增 ratelimiter 限流配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">####resilience4j ratelimiter 限流的例子</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
  <span class="token key atrule">ratelimiter</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">limitForPeriod</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#在一次刷新周期内，允许执行的最大请求数</span>
        <span class="token key atrule">limitRefreshPeriod</span><span class="token punctuation">:</span> 1s <span class="token comment"># 限流器每隔limitRefreshPeriod刷新一次，将允许处理的最大请求数量重置为limitForPeriod</span>
        <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 线程等待权限的默认等待时间</span>
    <span class="token key atrule">instances</span><span class="token punctuation">:</span>
      <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
        <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>修改 order 的 controller</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/ratelimit/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RateLimiter</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myRatelimitFallback&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkhead</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myRatelimit</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myRatelimitFallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;你被限流了，禁止访问/(ㄒoㄒ)/~~&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul></li> <li><p>测试</p> <ul><li><p>http://localhost/feign/pay/ratelimit/11</p> <p><img src="/assets/img/image-20240510231823521.105aa0e3.webp" alt="image-20240510231823521"></p></li></ul></li></ol> <h2 id="sleuth-micrometer-zipkin-分布式链路追踪"><a href="#sleuth-micrometer-zipkin-分布式链路追踪" class="header-anchor">#</a> Sleuth(Micrometer)+ZipKin 分布式链路追踪</h2> <h3 id="sleuth-目前也进入维护模式"><a href="#sleuth-目前也进入维护模式" class="header-anchor">#</a> Sleuth 目前也进入维护模式</h3> <p>Sleuth 官宣，改头换面</p> <p><img src="/assets/img/image-20240510233911889.2c20057e.webp" alt="image-20240510233911889"></p> <p>Sleuth 未来替换方案：Micrometer Tracing</p> <h3 id="分布式链路追踪概述"><a href="#分布式链路追踪概述" class="header-anchor">#</a> 分布式链路追踪概述</h3> <p><strong>问：为什么会出现这个技术？</strong></p> <p>答：在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的的服务节点调用来协同产生最后的请求结果，每一个前段请求都会形成一条复杂的分布式服务调用链路，链路中的任何一环出现高延时或错误都会引起整个请求最后的失败。</p> <p><strong>问：需要解决哪些问题？</strong></p> <p>答：在分布式与微服务场景下，我们需要解决如下问题：</p> <ol><li>在大规模分布式与微服务集群下，如何实时观测系统的整体调用链路情况。</li> <li>在大规模分布式与微服务集群下，如何快速发现并定位到问题。</li> <li>在大规模分布式与微服务集群下，如何尽可能精确的判断故障对系统的影响范围与影响程度。</li> <li>在大规模分布式与微服务集群下，如何尽可能精确的梳理出服务之间的依赖关系，并判断出服务之间的依赖关系是否合理。</li> <li>在大规模分布式与微服务集群下，如何尽可能精确的分析整个系统调用链路的性能与瓶颈点。</li> <li>在大规模分布式与微服务集群下，如何尽可能精确的分析系统的存储瓶颈与容量规划。</li></ol> <p><strong>上述问题就是我们的落地议题答案：</strong></p> <p>分布式链路追踪技术要解决的问题，分布式链路追踪(Distributed Tracing)，就是将一次分布式请求还原成调用链路，进行日志记录，性能监控并将一次分布式请求的调用情况集中展示。比如各个服务节点上的耗时、请求具体到达哪台机器上、每个服务节点的请求状态等等。</p> <h3 id="新一代-spring-cloud-sleuth-micrometer"><a href="#新一代-spring-cloud-sleuth-micrometer" class="header-anchor">#</a> 新一代 Spring Cloud Sleuth：Micrometer</h3> <h4 id="官网重要提示"><a href="#官网重要提示" class="header-anchor">#</a> 官网重要提示</h4> <p>sleuth 被 micrometer 替代</p> <p><a href="https://micrometer.io/docs/tracing" target="_blank" rel="noopener noreferrer">新一代 Sleuth：Micrometer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://spring.io/projects/spring-cloud-sleuth#overview" target="_blank" rel="noopener noreferrer">Spring Cloud Sleuth<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>说明：</p> <ol><li><p>老项目还能用 Sleuth 开发吗？可以，但能用 micrometer 就用 micrometer。</p></li> <li><p>版本注意：Sleuth 不支持 Spring Boot 3.x，只支持  2.x。</p> <p><img src="/assets/img/image-20240510234910937.08a14798.webp" alt="image-20240510234910937"></p></li></ol> <h4 id="zipkin"><a href="#zipkin" class="header-anchor">#</a> zipkin？</h4> <p>Spring Cloud Sleuth(micrometer)提供了一套完整的分布式链路追踪(Distributed Tracing)解决方案且兼容支持了 zipkin 展现。</p> <p><img src="/assets/img/image-20240510235219533.3fefe36c.webp" alt="image-20240510235219533"></p> <h4 id="小总结-3"><a href="#小总结-3" class="header-anchor">#</a> 小总结</h4> <p>将一次分布式请求还原成调用链路，进行日志记录和性能监控，并将一次分布式请求的调用情况集中 web 展示。</p> <h4 id="行业内比较成熟的其它分布式链路追踪技术解决方案"><a href="#行业内比较成熟的其它分布式链路追踪技术解决方案" class="header-anchor">#</a> 行业内比较成熟的其它分布式链路追踪技术解决方案</h4> <p><img src="/assets/img/image-20240510235248523.ad0149b9.webp" alt="image-20240510235248523"></p> <p>能用 micrometer 就用 micrometer，否则推荐 Skywalking。</p> <h3 id="分布式链路追踪原理"><a href="#分布式链路追踪原理" class="header-anchor">#</a> 分布式链路追踪原理</h3> <p>假定三个微服务调用的链路如下图所示：Service 1 调用 Service 2，Service 2 调用 Service 3 和 Service 4。</p> <p><img src="/assets/img/image-20240510235432430.6c4f05e8.webp" alt="image-20240510235432430"></p> <p><strong>上一步完整的调用链路：</strong></p> <p><img src="/assets/img/image-20240510235519612.33d108bf.webp" alt="image-20240510235519612"></p> <p>一条链路追踪会在每个服务调用的时候加上 Trace ID 和 Span ID。链路通过 TraceId 唯一标识，Span 标识发起的请求信息，各 span 通过 parent id 关联起来 （Span:表示调用链路来源，通俗的理解 span 就是一次请求信息）。</p> <p><strong>简洁版调用链路追踪：</strong></p> <p>一条链路通过 Trace Id 唯一标识，Span 标识发起的请求信息，各 span 通过 parent id 关联起来。</p> <p><img src="data:image/webp;base64,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" alt="image-20240510235637054"></p> <ol><li>第一个节点：Span ID = A，Parent ID = null，Service 1 接收到请求。</li> <li>第二个节点：Span ID = B，Parent ID= A，Service 1 发送请求到 Service 2 返回响应给 Service 1 的过程。</li> <li>第三个节点：Span ID = C，Parent ID= B，Service 2 的 中间解决过程。</li> <li>第四个节点：Span ID = D，Parent ID= C，Service 2 发送请求到 Service 3 返回响应给 Service 2 的过程。</li> <li>第五个节点：Span ID = E，Parent ID= D，Service 3 的中间解决过程。</li> <li>第六个节点：Span ID = F，Parent ID= C，Service 3 发送请求到 Service 4 返回响应给 Service 3 的过程。</li> <li>第七个节点：Span ID = G，Parent ID= F，Service 4 的中间解决过程。</li> <li>通过 Parent ID 就可找到父节点，整个链路即可以进行跟踪追溯了。</li></ol> <h3 id="zipkin-2"><a href="#zipkin-2" class="header-anchor">#</a> Zipkin</h3> <h4 id="是什么-10"><a href="#是什么-10" class="header-anchor">#</a> 是什么</h4> <p><a href="https://zipkin.io/" target="_blank" rel="noopener noreferrer">OpenZipkin · A distributed tracing system<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Zipkin 是一种分布式链路跟踪系统图形化的工具，Zipkin 是 Twitter 开源的分布式跟踪系统，能够收集微服务运行过程中的实时调用链路信息，并能够将这些调用链路信息展示到 Web 图形化界面上供开发人员分析，开发人员能够从 ZipKin 中分析出调用链路中的性能瓶颈，识别出存在问题的应用程序，进而定位问题和解决问题。</p> <h4 id="zipkin-为什么出现-单有-sleuth-micrometer-行不行"><a href="#zipkin-为什么出现-单有-sleuth-micrometer-行不行" class="header-anchor">#</a> Zipkin 为什么出现？单有 Sleuth(Micrometer)行不行？</h4> <p><img src="/assets/img/image-20240511000224587.15d3fe63.webp" alt="image-20240511000224587"></p> <p>说明：</p> <ul><li>当没有配置 Sleuth 链路追踪的时候，INFO 信息里面是 [passjava-question,,,]，后面跟着三个空字符串。</li> <li>当配置了 Sleuth 链路追踪的时候，追踪到的信息是 [passjava-question,504a5360ca906016,e55ff064b3941956,false] ，第一个是 Trace ID，第二个是 Span ID。只有日志没有图，观看不方便，不美观，so，引入图形化 Zipkin 链路监控让你好看，O(∩_∩)O</li></ul> <h4 id="zipkin-下载-安装-运行"><a href="#zipkin-下载-安装-运行" class="header-anchor">#</a> Zipkin 下载+安装+运行</h4> <ol><li><a href="https://zipkin.io/pages/quickstart.html" target="_blank" rel="noopener noreferrer">下载主页<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://search.maven.org/remote_content?g=io.zipkin&amp;a=zipkin-server&amp;v=LATEST&amp;c=exec" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>运行 jar</li> <li>运行控制台：http://localhost:9411/zipkin/</li></ol> <p><img src="/assets/img/image-20240511001443228.0459f802.webp" alt="image-20240511001443228"></p> <h3 id="micrometer-zipkin-搭建链路监控案例步骤"><a href="#micrometer-zipkin-搭建链路监控案例步骤" class="header-anchor">#</a> Micrometer+ZipKin 搭建链路监控案例步骤</h3> <h4 id="micrometer-zipkin-两者各自的分工"><a href="#micrometer-zipkin-两者各自的分工" class="header-anchor">#</a> Micrometer+ZipKin 两者各自的分工</h4> <p>Micrometer：数据采样</p> <p>ZipKin：图形展示</p> <h4 id="步骤-4"><a href="#步骤-4" class="header-anchor">#</a> 步骤</h4> <ol><li><p>总体父工程 POM</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 增加以下属性--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>micrometer-tracing.version</span><span class="token punctuation">&gt;</span></span>1.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>micrometer-tracing.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>micrometer-observation.version</span><span class="token punctuation">&gt;</span></span>1.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>micrometer-observation.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feign-micrometer.version</span><span class="token punctuation">&gt;</span></span>12.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feign-micrometer.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zipkin-reporter-brave.version</span><span class="token punctuation">&gt;</span></span>2.17.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>zipkin-reporter-brave.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 增加以下依赖包--&gt;</span>
        <span class="token comment">&lt;!--micrometer-tracing-bom导入链路追踪版本中心  1--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-tracing.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--micrometer-tracing指标追踪  2--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-tracing.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bridge-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-tracing.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--micrometer-observation 4--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-observation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-observation.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--feign-micrometer 5--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${feign-micrometer.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--zipkin-reporter-brave 6--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.zipkin.reporter2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zipkin-reporter-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${zipkin-reporter-brave.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><ul><li><p>引入 jar 包解释：</p> <ul><li><p>由于 Micrometer Tracing 是一个门面工具自身并没有实现完整的链路追踪系统，具体的链路追踪另外需要引入的是第三方链路追踪系统的依赖。</p> <p><img src="/assets/img/image-20240511003102653.b79aa551.webp" alt="image-20240511003102653"></p></li></ul></li></ul></li> <li><p>服务提供者 cloud-provider-payment8001</p> <ul><li><p>POM 新增依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--micrometer-tracing指标追踪  1--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 2--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bridge-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--micrometer-observation 3--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-observation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--feign-micrometer 4--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--zipkin-reporter-brave 5--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.zipkin.reporter2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zipkin-reporter-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>YML 新增 zipkin 配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># ========================zipkin===================</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
    <span class="token key atrule">tracing</span><span class="token punctuation">:</span>
      <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9411/api/v2/spans
  <span class="token key atrule">tracing</span><span class="token punctuation">:</span>
    <span class="token key atrule">sampling</span><span class="token punctuation">:</span>
      <span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1.0</span> <span class="token comment">#采样率默认为0.1(0.1就是10次只能有一次被记录下来)，值越大收集越及时。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>新建业务类 PayMicrometerController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayMicrometerController</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * Micrometer(Sleuth)进行链路监控的例子
     * @param id
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/micrometer/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myMicrometer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello, 欢迎到来myMicrometer inputId:  &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot; \t    服务返回:&quot;</span> <span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul></li> <li><p>API 接口 PayFeignApi</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* Micrometer(Sleuth)进行链路监控的例子
* @param id
* @return
*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/micrometer/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myMicrometer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>服务调用者 cloud-consumer-feign-order80</p> <ul><li><p>POM 新增链路追踪相关的五个依赖包（同 8001）</p></li> <li><p>YML 新增 zipkin 图形展现地址和采样率设置（同 8001）</p></li> <li><p>新建业务类 OrderMicrometerController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderMicrometerController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayFeignApi</span> payFeignApi<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/micrometer/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myMicrometer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myMicrometer</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul></li></ol> <h4 id="测试-7"><a href="#测试-7" class="header-anchor">#</a> 测试</h4> <ol><li><p>本次案例，默认已经成功启动 Zipkin</p></li> <li><p>依次启动 8001/80 两个微服务并注册进入 Consul</p></li> <li><p>测试地址：http://localhost/feign/micrometer/1</p></li> <li><p>打开浏览器访问：http://localhost:9411</p> <ul><li><p>查看链路</p> <p><img src="/assets/img/image-20240511005431900.eb481ea8.webp" alt="image-20240511005431900"></p> <p><img src="/assets/img/image-20240511005447786.2b6458fa.webp" alt="image-20240511005447786"></p></li> <li><p>查看依赖关系</p> <p><img src="/assets/img/image-20240511005633737.ea658fad.webp" alt="image-20240511005633737"></p></li></ul></li></ol> <h2 id="gateway-新一代网关"><a href="#gateway-新一代网关" class="header-anchor">#</a> Gateway 新一代网关</h2> <h3 id="概述-3"><a href="#概述-3" class="header-anchor">#</a> 概述</h3> <h4 id="是什么-11"><a href="#是什么-11" class="header-anchor">#</a> 是什么</h4> <p><a href="https://docs.spring.io/spring-cloud-gateway/reference/index.html" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway 4.1.3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.4/reference/html/#gateway-starter" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway 4.0.4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Gateway 提供了一个库，用于在 SpringWebFlux 或 SpringWebMVC 之上构建 API 网关服务。Spring Cloud Gateway 旨在为微服务架构提供一种简单有效的统一的 API 路由管理方式，并为它们提供跨领域的关注点，例如：安全性、监控/度量和恢复能力。</p> <p>体系定位：</p> <ul><li>Cloud 全家桶中有个很重要的组件就是网关，在 1.x 版本中都是采用的 Zuul 网关；</li> <li>但在 2.x 版本中，zuul 的升级一直跳票，SpringCloud 最后自己研发了一个网关 SpringCloud Gateway 替代 Zuul，</li> <li>那就是 SpringCloud Gateway。一句话：gateway 是原 zuul1.x 版的替代。</li></ul> <p><img src="/assets/img/image-20240512154052021.1a4e40d2.webp" alt="image-20240512154052021"></p> <h4 id="微服务架构中网关在哪里"><a href="#微服务架构中网关在哪里" class="header-anchor">#</a> 微服务架构中网关在哪里</h4> <p>feign 是服务间的调用，当请求 A 服务，但 A 需要 B 服务。</p> <p>网关是在 A 之前，Nginx 是在网关之前。</p> <p><img src="/assets/img/image-20240512154127056.40007832.webp" alt="image-20240512154127056"></p> <h4 id="能干嘛"><a href="#能干嘛" class="header-anchor">#</a> 能干嘛</h4> <ol><li>反向代理</li> <li>鉴权</li> <li>流量控制</li> <li>熔断</li> <li>日志监控</li></ol> <h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <ul><li>Spring Cloud Gateway 组件的核心是一系列的过滤器，通过这些过滤器可以将客户端发送的请求转发（路由）到对应的微服务。</li> <li>Spring Cloud Gateway 是加在整个微服务最前沿的防火墙和代理器，隐藏微服务结点 IP 端口信息，从而加强安全保护。</li> <li>Spring Cloud Gateway 本身也是一个微服务，需要注册进服务注册中心。</li></ul> <p><img src="/assets/img/image-20240512154315553.2b54d769.webp" alt="image-20240512154315553"></p> <h3 id="gateway-三大核心"><a href="#gateway-三大核心" class="header-anchor">#</a> Gateway 三大核心</h3> <ul><li><strong>Route（路由）</strong>：路由是构建网关的基本模块。它由 ID，目标 URI，一系列的断言和过滤器组成，如果断言为 true 则匹配该路由。</li> <li><strong>Predicate（断言）</strong>：参考的是 Java8 的函数断言 <code>java.util.function.Predicate</code>。输入类型是 <code>SpringFrameworkServerWebExchange</code>。开发人员可以匹配 HTTP 请求中的所有内容（例如请求头或请求参数），如果请求与断言相匹配则进行路由。</li> <li><strong>Filter（过滤）</strong>：指的是 Spring 框架中特定工厂构建的 GatewayFilter 的实例，使用过滤器，可以在请求被路由前或者之后对请求进行修改。</li></ul> <p><strong>总结：</strong></p> <ul><li>web 前端请求，通过一些匹配条件，定位到真正的服务节点。并在这个转发过程的前后，进行一些精细化控制。</li> <li>predicate 就是我们的匹配条件。</li> <li>filter，就可以理解为一个无所不能的拦截器。</li> <li>有了这两个元素，再加上目标 uri，就可以实现一个具体的路由了。</li></ul> <p><img src="/assets/img/image-20240512155111811.9d7f2216.webp" alt="image-20240512155111811"></p> <h3 id="gateway-工作流程"><a href="#gateway-工作流程" class="header-anchor">#</a> Gateway 工作流程</h3> <ul><li>客户端向 Spring Cloud Gateway 发出请求。然后在 Gateway Handler Mapping 中找到与请求相匹配的路由，将其发送到 Gateway Web Handler。Handler 再通过指定的过滤器链来将请求发送到我们实际的服务执行业务逻辑，然后返回。</li> <li>过滤器之间用虚线分开是因为过滤器可能会在发送代理请求之前(Pre)或之后(Post)执行业务逻辑。</li> <li>在<code>pre</code>类型的过滤器可以做参数校验、权限校验、流量监控、日志输出、协议转换等;</li> <li>在<code>post</code>类型的过滤器中可以做响应内容、响应头的修改，日志的输出，流量监控等有着非常重要的作用。</li></ul> <p><img src="/assets/img/image-20240512155252265.210d9656.webp" alt="image-20240512155252265"></p> <p>核心逻辑：<font color="red"><strong>路由转发 + 断言判断 + 执行过滤器链</strong></font></p> <h3 id="入门配置"><a href="#入门配置" class="header-anchor">#</a> 入门配置</h3> <h4 id="建-module-2"><a href="#建-module-2" class="header-anchor">#</a> 建 Module</h4> <p>新建 module cloud-gateway9527</p> <h4 id="改-pom-4"><a href="#改-pom-4" class="header-anchor">#</a> 改 POM</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-gateway9527<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--gateway--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--服务注册发现consul discovery,网关也要注册进服务注册中心统一管控--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 指标监控健康检查的actuator,网关是响应式编程删除掉spring-boot-starter-web dependency--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="写-yml"><a href="#写-yml" class="header-anchor">#</a> 写 YML</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway <span class="token comment">#以微服务注册进consul或nacos服务列表内</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span> <span class="token comment">#配置consul地址</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="主启动"><a href="#主启动" class="header-anchor">#</a> 主启动</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">//服务注册和发现</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main9527</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main9527</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="业务类-4"><a href="#业务类-4" class="header-anchor">#</a> 业务类</h4> <p>无，不写任何业务代码，网关和业务无关</p> <h4 id="测试-8"><a href="#测试-8" class="header-anchor">#</a> 测试</h4> <ol><li>先启动 8500 服务中心 Consul</li> <li>再启动 9527 网关入驻</li></ol> <h3 id="_9527-网关如何做路由映射"><a href="#_9527-网关如何做路由映射" class="header-anchor">#</a> 9527 网关如何做路由映射</h3> <h4 id="_9527-网关如何做路由映射-2"><a href="#_9527-网关如何做路由映射-2" class="header-anchor">#</a> 9527 网关如何做路由映射</h4> <ol><li><p>诉求：我们目前不想暴露 8001 端口，希望在 8001 真正的支付微服务外面套一层 9527 网关</p></li> <li><p>8001 新建 PayGateWayController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayGateWayController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">PayService</span> payService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/gateway/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pay</span> pay <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/gateway/info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getGatewayInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;gateway info test：&quot;</span> <span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>启动 8001 支付</p></li> <li><p>8001 自测通过</p> <ul><li>http://localhost:8001/pay/gateway/get/1</li> <li>http://localhost:8001/pay/gateway/info</li></ul></li></ol> <h4 id="_9527-网关-yml-新增配置"><a href="#_9527-网关-yml-新增配置" class="header-anchor">#</a> 9527 网关 YML 新增配置</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>                <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>

        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh2 <span class="token comment">#pay_routh2                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>                <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/info/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="测试-1"><a href="#测试-1" class="header-anchor">#</a> 测试 1</h4> <ol><li><p>启动 Consul 8500 服务</p></li> <li><p>启动 8001 支付</p></li> <li><p>启动 9527 网关</p></li> <li><p>访问说明</p> <ul><li><p>添加网关前</p> <ul><li>http://localhost:8001/pay/gateway/get/1</li> <li>http://localhost:8001/pay/gateway/info</li></ul></li> <li><p>隐真示假，映射说明</p> <p><img src="/assets/img/image-20240512162629079.39f96f19.webp" alt="image-20240512162629079"></p></li> <li><p>添加网关后：访问端口更换为网关端口 9527</p> <ul><li>http://localhost:9527/pay/gateway/get/1</li> <li>http://localhost:9527/pay/gateway/info</li></ul></li></ul></li> <li><p>目前 8001 支付微服务前面添加 GateWay 成功</p></li></ol> <p><img src="/assets/img/image-20240512162812634.b54bcdf5.webp" alt="image-20240512162812634"></p> <h4 id="测试-2-2"><a href="#测试-2-2" class="header-anchor">#</a> 测试 2</h4> <h5 id="启动订单微服务测试-看看是否通过网关"><a href="#启动订单微服务测试-看看是否通过网关" class="header-anchor">#</a> 启动订单微服务测试，看看是否通过网关？</h5> <p>我们启动 80 订单微服务，它从 Consul 注册中心通过微服务名称找到 8001 支付微服务进行调用，</p> <p>80 → 9527 → 8001</p> <p>要求访问 9527 网关后才能访问 8001，如果我们此时启动 80 订单，可以做到吗？</p> <ol><li><p>修改 cloud-api-commons PayFeignApi 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * GateWay进行网关测试案例01
 * @param id
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/gateway/get/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * GateWay进行网关测试案例02
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/gateway/info&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getGatewayInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>修改 cloud-consumer-feign-order80，新建 OrderGateWayController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderGateWayController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayFeignApi</span> payFeignApi<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/gateway/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/gateway/info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getGatewayInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">getGatewayInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>网关开启：测试通过√</p> <ul><li>http://localhost/feign/pay/gateway/get/1</li> <li>http://localhost/feign/pay/gateway/info</li></ul></li> <li><p>网关关闭：测试通过√</p></li> <li><p>结论</p> <ul><li>9527 网关是否启动，毫无影响，o(╥﹏╥)o</li> <li>目前的配置来看，网关被绕开了......</li></ul></li></ol> <h5 id="正确配置"><a href="#正确配置" class="header-anchor">#</a> 正确配置</h5> <ul><li><strong>同一家公司自己人，系统内环境，直接找微服务</strong></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">)</span><span class="token comment">//自己人内部，自己访问自己，写微服务名字OK</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayFeignApi</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>不同家公司有外人，系统外访问，先找网关再服务</strong></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//@FeignClient(value = &quot;cloud-payment-service&quot;)</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;cloud-gateway&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayFeignApi</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/image-20240512164219295.5bb62346.webp" alt="image-20240512164219295"></p> <ol><li><p>刷新 feign 接口 jar 包</p></li> <li><p>重启 80 订单微服务</p></li> <li><p>有网关正常 success</p> <p><img src="/assets/img/image-20240512165532353.58c2a1d2.webp" alt="image-20240512165532353"></p></li> <li><p>无网关异常</p> <p><img src="/assets/img/image-20240512165501136.64a333b4.webp" alt="image-20240512165501136"></p></li></ol> <h4 id="存在问题-2"><a href="#存在问题-2" class="header-anchor">#</a> 存在问题</h4> <p>网关 9527 的 yml 配置，<strong>映射写死问题</strong>。</p> <p><img src="/assets/img/image-20240512165626421.cbfef89e.webp" alt="image-20240512165626421"></p> <h3 id="gateway-高级特性"><a href="#gateway-高级特性" class="header-anchor">#</a> GateWay 高级特性</h3> <h4 id="route-以微服务名-动态获取服务-uri"><a href="#route-以微服务名-动态获取服务-uri" class="header-anchor">#</a> Route 以微服务名-动态获取服务 URI</h4> <h5 id="痛点"><a href="#痛点" class="header-anchor">#</a> 痛点</h5> <p>映射写死问题（如上）</p> <h5 id="是什么-12"><a href="#是什么-12" class="header-anchor">#</a> 是什么</h5> <p><img src="/assets/img/image-20240512170047487.2a652b6f.webp" alt="image-20240512170047487"></p> <h5 id="解决-uri-地址写死问题"><a href="#解决-uri-地址写死问题" class="header-anchor">#</a> 解决 uri 地址写死问题</h5> <p>由固定 URI 修改为通过微服务名动态获取</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token comment">#uri: http://localhost:8001                #匹配后提供服务的路由地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>

        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh2 <span class="token comment">#pay_routh2                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token comment">#uri: http://localhost:8001                #匹配后提供服务的路由地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/info/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="测试-1-2"><a href="#测试-1-2" class="header-anchor">#</a> 测试 1</h5> <ol><li>重启网关 9527，80/8001 保持不变</li> <li>http://localhost/feign/pay/gateway/get/1</li></ol> <h5 id="测试-2-3"><a href="#测试-2-3" class="header-anchor">#</a> 测试 2</h5> <p>如果将 8001 微服务 yml 文件端口修改为 8007，照样可以访问（实际启动的程序是 main8001 但是端口名改为 8007）</p> <p>依据微服务名字，匹配查找即可：<code>uri: lb://cloud-payment-service</code></p> <h4 id="predicate-断言-谓词"><a href="#predicate-断言-谓词" class="header-anchor">#</a> Predicate 断言（谓词）</h4> <h5 id="是什么-13"><a href="#是什么-13" class="header-anchor">#</a> 是什么</h5> <p><a href="https://docs.spring.io/spring-cloud-gateway/reference/spring-cloud-gateway/request-predicates-factories.html" target="_blank" rel="noopener noreferrer">Route Predicate Factories :: Spring Cloud Gateway<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>Spring Cloud Gateway 将路由匹配作为 Spring WebFlux HandlerMapping 基础架构的一部分。</li> <li>Spring Cloud Gateway 包含许多内置的 Route Predicate Factories。所有这些 Predicate 都匹配 HTTP 请求的不同属性。</li> <li>Spring Cloud Gateway 创建 Route 时，使用 RoutePredicateFactory 创建 Predicate 对象，Predicate 对象可以赋值给 Route，</li> <li>多个路由断言工厂通过 <code>and</code> 逻辑语句组合在一起。</li></ul> <p>启动微服务 gateway9527 看看 IDEA 后台的输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Loaded RoutePredicateFactory [After]
Loaded RoutePredicateFactory [Before]
Loaded RoutePredicateFactory [Between]
Loaded RoutePredicateFactory [Cookie]
Loaded RoutePredicateFactory [Header]
Loaded RoutePredicateFactory [Host]
Loaded RoutePredicateFactory [Method]
Loaded RoutePredicateFactory [Path]
Loaded RoutePredicateFactory [Query]
Loaded RoutePredicateFactory [ReadBody]
Loaded RoutePredicateFactory [RemoteAddr]
Loaded RoutePredicateFactory [XForwardedRemoteAddr]
Loaded RoutePredicateFactory [Weight]
Loaded RoutePredicateFactory [CloudFoundryRouteService]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="整体架构概述"><a href="#整体架构概述" class="header-anchor">#</a> 整体架构概述</h5> <p><img src="/assets/img/image-20240512173043936.9a230f2a.webp" alt="image-20240512173043936"></p> <h5 id="常用的内置-route-predicate"><a href="#常用的内置-route-predicate" class="header-anchor">#</a> 常用的内置 Route Predicate</h5> <h6 id="配置语法总体概述"><a href="#配置语法总体概述" class="header-anchor">#</a> 配置语法总体概述</h6> <p>两种配置方式，二选一</p> <p><a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.4/reference/html/#configuring-route-predicate-factories-and-gateway-filter-factories" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>There are two ways to configure predicates and filters: shortcuts and fully expanded arguments. <strong>Most examples below use the shortcut way</strong>.</p></li> <li><p>Shortcut Configuration</p></li></ol> <p><img src="/assets/img/image-20240512173611073.cd6e4093.webp" alt="image-20240512173611073"></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Cookie=mycookie<span class="token punctuation">,</span>mycookievalue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="3"><li>Fully Expanded Arguments</li></ol> <p><img src="/assets/img/image-20240512173643143.fd1f3a25.webp" alt="image-20240512173643143"></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cookie
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> mycookie
            <span class="token key atrule">regexp</span><span class="token punctuation">:</span> mycookievalue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>测试地址：http://localhost:9527/pay/gateway/get/1</p> <h6 id="常用断言-api"><a href="#常用断言-api" class="header-anchor">#</a> 常用断言 api</h6> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#id：我们自定义的路由 ID，保持唯一</span>
<span class="token comment">##uri：目标服务地址</span>
<span class="token comment">##predicates：路由条件，Predicate接受一个输入参数返回一个布尔值。</span>
<span class="token comment">##            该属性包含多种默认方法来将Predicate组合成其他复杂的逻辑(比如：与，或，非)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li><p><strong>After/Before/Between Route Predicate Factory</strong></p> <ul><li><strong>After Route Predicate Factory</strong> 接受一个参数，即 <code>datetime</code> (这是一个 java <code>ZonedDateTime</code>)。<strong>此断言匹配在指定日期时间之后发生的请求</strong>。</li> <li><strong>Before Route Predicate Factory</strong> 接受一个参数，即 <code>datetime</code>。<strong>此断言匹配在指定日期时间之前发生的请求</strong>。</li> <li><strong>Between Route Predicate Factory</strong> 接受两个参数 datetime1 和 datetime2。<strong>此断言匹配在 datetime1 之后和 datetime2 之前发生的请求</strong>。datetime2 参数必须位于 datetime1 之后。</li></ul> <p>如何获得 <code>ZonedDateTime</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ZonedDateTime</span> zbj <span class="token operator">=</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认时区</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>zbj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>输出结果：<code>2024-05-12T20:26:08.937420100+08:00[Asia/Shanghai]</code></p> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> After=2024<span class="token punctuation">-</span>05<span class="token punctuation">-</span>12T20<span class="token punctuation">:</span>30<span class="token punctuation">:</span>08.937420100+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
            <span class="token punctuation">-</span> Before=2024<span class="token punctuation">-</span>05<span class="token punctuation">-</span>12T20<span class="token punctuation">:</span>44<span class="token punctuation">:</span>00.000+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
            <span class="token punctuation">-</span> Between=2024<span class="token punctuation">-</span>05<span class="token punctuation">-</span>12T20<span class="token punctuation">:</span>53<span class="token punctuation">:</span>00.000+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span><span class="token punctuation">,</span>2024<span class="token punctuation">-</span>05<span class="token punctuation">-</span>12T20<span class="token punctuation">:</span>54<span class="token punctuation">:</span>00.000+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p><strong>Cookie Route Predicate Factory</strong></p> <ul><li>Cookie Route Predicate Factory 接受两个参数: Cookie 名称和 regexp （它是 Java 正则表达式）。</li> <li>此断言会通过获取对应的 Cookie name 值和正则表达式去匹配，如果匹配上就会执行路由，如果没有匹配上则不执行。</li></ul> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Cookie=username<span class="token punctuation">,</span>xyz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><p>方法 1，原生命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 不带cookies访问</span>
<span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1
<span class="token comment"># 带cookies访问</span>
<span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1 <span class="token parameter variable">--cookie</span> <span class="token string">&quot;username=xyz&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>方法 2，postman</p> <p><img src="/assets/img/image-20240512211820995.1be91147.webp" alt="image-20240512211820995"></p></li></ul></li> <li><p><strong>Header Route Predicate Factory</strong></p> <ul><li>Header Route Predicate Factory 接受两个参数，属性名称 header 和正则表达式 regexp。</li> <li>此断言与具有和正则表达式匹配的给定名称的头匹配。此断言与具有给定名称的 header 属性名称匹配，其值与正则表达式相匹配。</li></ul> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+  <span class="token comment"># 请求头要有X-Request-Id属性并且值为整数的正则表达式</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1 <span class="token parameter variable">-H</span>  <span class="token string">&quot;X-Request-Id:123456&quot;</span>
<span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1 <span class="token parameter variable">-H</span>  <span class="token string">&quot;X-Request-Id:abcd&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><strong>Host Route Predicate Factory</strong></p> <ul><li>Host Route Predicate Factory 接收一组参数，一组匹配的域名列表。该模式是一个 Ant 样式的模式，用 <code>.</code> 号作为分隔符。</li> <li>这个断言通过参数中的主机地址作为匹配规则。</li></ul> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Host=<span class="token important">**.atguigu.com</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#正确</span>
<span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1 <span class="token parameter variable">-H</span>  <span class="token string">&quot;Host:www.atguigu.com&quot;</span>
<span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1 <span class="token parameter variable">-H</span>  <span class="token string">&quot;Host:java.atguigu.com&quot;</span>
<span class="token comment">#错误</span>
<span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1 <span class="token parameter variable">-H</span>  <span class="token string">&quot;Host:java.atguigu.net&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><strong>Path Route Predicate Factory</strong></p> <ul><li>Path Route Predicate Factory 有两个参数: 一个 Spring <code>PathMatcher</code> 模式列表和一个可选标志 <code>matchTrailingSlash</code> （默认为 true）。</li> <li>如果 <code>matchTrailingSlash</code> 设置为 false，则不会匹配请求路径 <code>/</code> 结尾的请求。</li></ul> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><strong>Query Route Predicate Factory</strong></p> <ul><li>Query Route Predicate Factory 接受两个参数: 一个必需的 <code>param</code> 和一个可选的 regexp （它是 Java 正则表达式）。</li> <li>请求必须包含查询指定的参数并满足正则表达式（如果指定）。</li></ul> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Query=username<span class="token punctuation">,</span> \d+  <span class="token comment"># 要有参数名username并且值还要是整数才能路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1?username<span class="token operator">=</span><span class="token number">123</span>
<span class="token comment"># 要有参数名username并且值还要是整数才能路由</span>
<span class="token function">curl</span> http://localhost:9527/pay/gateway/get/1?username<span class="token operator">=</span>abc 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><strong>RemoteAddr route predicate Factory</strong></p> <ul><li>RemoteAddr route predicate Factory 接受 <code>sources</code> 的列表（最小大小为 1） ，这些 <code>sources</code> 是 CIDR 符号（IPv4 或 IPv6）字符串，例如 192.168.0.1/16（其中 192.168.0.1 是 IP 地址，16 是子网掩码）。</li></ul> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> RemoteAddr=192.168.0.102/24 <span class="token comment"># 外部访问我的IP限制，最大跨度不超过32，目前是1~24它们是 CIDR 表示法。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>CIDR 网络 IP 划分：无类别域间路由 Classless Inter-Domain Routing 缩写</p> <p><img src="/assets/img/image-20240512220100953.574549e9.webp" alt="image-20240512220100953"></p></li> <li><p><strong>Method Route Predicate Factory</strong></p> <ul><li>接受一个 <code>methods</code> 参数，它是一个或多个参数，表示要匹配的 HTTP 方法，如 GET、POST。</li></ul> <p>示例配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Method=GET<span class="token punctuation">,</span>POST     <span class="token comment"># 配置某个请求地址，只能用Get/Post方法访问，方法限制</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ol> <h6 id="上述配置小总结"><a href="#上述配置小总结" class="header-anchor">#</a> 上述配置小总结</h6> <p><strong>Predicate 就是为了实现一组匹配规则，让请求过来找到对应的 Route 进行处理。</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway <span class="token comment">#以微服务注册进consul或nacos服务列表内</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span> <span class="token comment">#配置consul地址</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token comment">#uri: http://localhost:8001                #匹配后提供服务的路由地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token comment">#- After=2024-05-12T20:30:08.937420100+08:00[Asia/Shanghai] # 规定时间之后可访问</span>
            <span class="token comment">#- Before=2024-05-12T20:44:00.000+08:00[Asia/Shanghai]  # 超过规定时间不可访问</span>
            <span class="token comment">#- Between=2024-05-12T20:53:00.000+08:00[Asia/Shanghai],2024-05-12T20:54:00.000+08:00[Asia/Shanghai]</span>
            <span class="token comment">#- Cookie=username,xyz</span>
            <span class="token comment">#- Header=X-Request-Id, \d+  # 请求头要有X-Request-Id属性并且值为整数的正则表达式</span>
            <span class="token comment">#- Host=**.atguigu.com</span>
            <span class="token comment">#- Query=username, \d+  # 要有参数名username并且值还要是整数才能路由</span>
            <span class="token comment">#- RemoteAddr=192.168.0.1/24 # 外部访问我的IP限制，最大跨度不超过32，目前是1~24它们是 CIDR 表示法。</span>
            <span class="token punctuation">-</span> Method=GET<span class="token punctuation">,</span>POST     <span class="token comment"># 配置某个请求地址，只能用Get/Post方法访问，方法限制</span>

        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh2 <span class="token comment">#pay_routh2                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token comment">#uri: http://localhost:8001                #匹配后提供服务的路由地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/info/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h5 id="自定义断言-xxxroutepredicatefactory-规则"><a href="#自定义断言-xxxroutepredicatefactory-规则" class="header-anchor">#</a> 自定义断言，XXXRoutePredicateFactory 规则</h5> <h6 id="痛点-2"><a href="#痛点-2" class="header-anchor">#</a> 痛点</h6> <p>原有的断言配置不满足业务怎么办？自定义断言。</p> <p>模板套路：</p> <ul><li>要么继承 <code>AbstractRoutePredicateFactory</code> 抽象类</li> <li>要么实现 <code>RoutePredicateFactory</code> 接口</li> <li>开头任意取名，但是必须以 <code>RoutePredicateFactory</code> 后缀结尾</li></ul> <h6 id="自定义路由断言规则步骤套路"><a href="#自定义路由断言规则步骤套路" class="header-anchor">#</a> 自定义路由断言规则步骤套路</h6> <ol><li>新建类名 XXX 需要以 RoutePredicateFactory 结尾并继承 AbstractRoutePredicateFactory 类</li> <li>重写 apply 方法</li> <li>新建 apply 方法所需要的静态内部类 MyRoutePredicateFactory.Config，这个 Config 类就是我们的路由断言规则，重要</li> <li>空参构造方法，内部调用 super</li> <li>重写 apply 方法具体内容</li></ol> <p>注：需要导入 Lombok jar 包</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>mygateway</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 需求说明：自定义配置会员等级userType，按照钻、金、银和yml配置的会员等级，以适配是否可以访问
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRoutePredicateFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRoutePredicateFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">MyRoutePredicateFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerWebExchange</span><span class="token punctuation">&gt;</span></span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerWebExchange</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> serverWebExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 检查request的参数里面，userType是否为指定的值，符合配置就通过</span>
                <span class="token class-name">String</span> userType <span class="token operator">=</span> serverWebExchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;userType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>userType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token comment">// 如果说参数存在，就和config的数据进行比较</span>
                <span class="token keyword">return</span> userType<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getUserType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 不加此方法无法使用短格式配置方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">shortcutFieldOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;userType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 这个Config类就是我们的路由断言规则，重要</span>
    <span class="token annotation punctuation">@Validated</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Setter</span>
        <span class="token annotation punctuation">@Getter</span>
        <span class="token annotation punctuation">@NotEmpty</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> userType<span class="token punctuation">;</span> <span class="token comment">// 钻、金、银等用户等级</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway <span class="token comment">#以微服务注册进consul或nacos服务列表内</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span> <span class="token comment">#配置consul地址</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> My=diamond
<span class="token comment">#            - name: My</span>
<span class="token comment">#              args:</span>
<span class="token comment">#                userType: diamond</span>

        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh2 <span class="token comment">#pay_routh2                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/info/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h6 id="bug-分析"><a href="#bug-分析" class="header-anchor">#</a> bug 分析</h6> <p>如果自定义路由断言工厂 MyRoutePredicateFactory 没有实现 shortcutFieldOrder 方法，则在配置文件中就无法使用短格式配置方法。</p> <p><code>Caused by: org.springframework.boot.context.properties.bind.validation.BindValidationException: Binding validation errors on</code></p> <p><img src="/assets/img/image-20240512231112478.e0d3f83a.webp" alt="image-20240512231112478"></p> <p>解决方法：</p> <ol><li>使用 Fully Expanded Arguments</li> <li>实现 shortcutFieldOrder 方法</li></ol> <h6 id="测试-9"><a href="#测试-9" class="header-anchor">#</a> 测试</h6> <p>http://localhost:9527/pay/gateway/get/1?userType=diamond</p> <h4 id="filter-过滤"><a href="#filter-过滤" class="header-anchor">#</a> Filter 过滤</h4> <h5 id="概述-4"><a href="#概述-4" class="header-anchor">#</a> 概述</h5> <h6 id="是什么-14"><a href="#是什么-14" class="header-anchor">#</a> 是什么</h6> <p><a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.4/reference/html/#gatewayfilter-factories" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway:gatewayfilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>SpringMVC 里面的的拦截器 Interceptor，Servlet 的过滤器。</li> <li><code>pre</code>和 <code>post</code> 分别会在请求被执行前调用和被执行后调用。</li></ul> <h6 id="能干嘛-2"><a href="#能干嘛-2" class="header-anchor">#</a> 能干嘛</h6> <ul><li>请求鉴权</li> <li>异常处理</li> <li>记录接口调用时长统计（重点，大厂面试设计题）</li> <li>。。。。。。</li></ul> <h6 id="类型"><a href="#类型" class="header-anchor">#</a> 类型</h6> <ol><li>全局默认过滤器 Global Filters
<ul><li>gateway 出厂默认已有的，直接用即可，主要作用于所有的路由</li> <li>不需要在配置文件中配置，作用在所有的路由上，实现 GlobalFilter 接口即可</li></ul></li> <li>单一内置过滤器 GatewayFilter
<ul><li>也可以称为网关过滤器，这种过滤器主要是作用于单一路由或者某个路由分组</li></ul></li> <li>自定义过滤器</li></ol> <h5 id="gateway-常见的内置过滤器"><a href="#gateway-常见的内置过滤器" class="header-anchor">#</a> Gateway 常见的内置过滤器</h5> <h6 id="请求头-requestheader-相关组"><a href="#请求头-requestheader-相关组" class="header-anchor">#</a> 请求头(RequestHeader)相关组</h6> <ol><li><code>The AddRequestHeader GatewayFilter Factory</code>：新增指定请求头内容 ByName</li> <li><code>The RemoveRequestHeader GatewayFilter Factory</code>：删除请求头 ByName</li> <li><code>The SetRequestHeader GatewayFilter Factory</code>：修改请求头 ByName</li></ol> <ul><li><p>8001 微服务 PayGateWayController 新增方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/gateway/filter&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getGatewayFilter</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeaderNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> headName <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> headValue <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>headName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;request headName:&quot;</span> <span class="token operator">+</span> headName <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;request headValue:&quot;</span> <span class="token operator">+</span> headValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>headName<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;X-Request-atguigu1&quot;</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> headName<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;X-Request-atguigu2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> result <span class="token operator">+</span> headName <span class="token operator">+</span> <span class="token string">&quot;\t &quot;</span> <span class="token operator">+</span> headValue <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=============================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> customerId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;customerId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;request Parameter customerId: &quot;</span> <span class="token operator">+</span> customerId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> customerName <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;customerName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;request Parameter customerName: &quot;</span> <span class="token operator">+</span> customerName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=============================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;getGatewayFilter 过滤器 test： &quot;</span> <span class="token operator">+</span> result <span class="token operator">+</span> <span class="token string">&quot; \t &quot;</span> <span class="token operator">+</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>9527 网关 YML 添加过滤内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh3 <span class="token comment">#pay_routh3</span>
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service                <span class="token comment">#匹配后提供服务的路由地址</span>
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu1<span class="token punctuation">,</span>atguiguValue1  <span class="token comment"># 请求头kv，若一头含有多参则重写一行设置</span>
    <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu2<span class="token punctuation">,</span>atguiguValue2
    <span class="token punctuation">-</span> RemoveRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>site      <span class="token comment"># 删除请求头sec-fetch-site</span>
    <span class="token punctuation">-</span> SetRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>mode<span class="token punctuation">,</span> Blue<span class="token punctuation">-</span>updatebyzzyy <span class="token comment"># 将请求头sec-fetch-mode对应的值修改为Blue-updatebyzzyy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>重启 9527 和 8001 并再次调用地址：http://localhost:9527/pay/gateway/filter</p> <p><img src="/assets/img/image-20240512235428349.85966dce.webp" alt="image-20240512235428349"></p></li></ul> <h6 id="请求参数-requestparameter-相关组"><a href="#请求参数-requestparameter-相关组" class="header-anchor">#</a> 请求参数(RequestParameter)相关组</h6> <ol><li><code>The AddRequestParameter GatewayFilter Factory</code>：新增 url 请求参数</li> <li><code>The RemoveRequestParameter GatewayFilter Factory</code>：删除 url 请求参数</li></ol> <ul><li><p>YML 添加过滤内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh3 <span class="token comment">#pay_routh3</span>
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service                <span class="token comment">#匹配后提供服务的路由地址</span>
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu1<span class="token punctuation">,</span>atguiguValue1  <span class="token comment"># 请求头kv，若一头含有多参则重写一行设置</span>
    <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu2<span class="token punctuation">,</span>atguiguValue2
    <span class="token punctuation">-</span> RemoveRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>site      <span class="token comment"># 删除请求头sec-fetch-site</span>
    <span class="token punctuation">-</span> SetRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>mode<span class="token punctuation">,</span> Blue<span class="token punctuation">-</span>updatebyzzyy <span class="token comment"># 将请求头sec-fetch-mode对应的值修改为Blue-updatebyzzyy</span>
    <span class="token punctuation">-</span> AddRequestParameter=customerId<span class="token punctuation">,</span><span class="token number">9527001</span> <span class="token comment"># 新增请求参数Parameter：k ，v</span>
    <span class="token punctuation">-</span> RemoveRequestParameter=customerName   <span class="token comment"># 删除url请求参数customerName，你传递过来也是null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>重启 9527 和 8001</p> <ul><li><p>http://localhost:9527/pay/gateway/filter</p> <p><img src="/assets/img/image-20240513000146969.61d6715f.webp" alt="image-20240513000146969"></p></li> <li><p>http://localhost:9527/pay/gateway/filter?customerId=9999&amp;customerName=z3</p> <p><img src="/assets/img/image-20240513000213696.333a2d4f.webp" alt="image-20240513000213696"></p></li></ul></li></ul> <h6 id="响应头-responseheader-相关组"><a href="#响应头-responseheader-相关组" class="header-anchor">#</a> 响应头(ResponseHeader)相关组</h6> <ol><li><code>The AddResponseHeader GatewayFilter Factory</code>：新增响应头属性</li> <li><code>The SetResponseHeader GatewayFilter Factory</code>：修改响应头属性</li> <li><code>The RemoveResponseHeader GatewayFilter Factory</code>：删除响应头属性</li></ol> <ul><li><p>YML 添加过滤内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh3 <span class="token comment">#pay_routh3</span>
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service                <span class="token comment">#匹配后提供服务的路由地址</span>
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu1<span class="token punctuation">,</span>atguiguValue1  <span class="token comment"># 请求头kv，若一头含有多参则重写一行设置</span>
    <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu2<span class="token punctuation">,</span>atguiguValue2
    <span class="token punctuation">-</span> RemoveRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>site      <span class="token comment"># 删除请求头sec-fetch-site</span>
    <span class="token punctuation">-</span> SetRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>mode<span class="token punctuation">,</span> Blue<span class="token punctuation">-</span>updatebyzzyy <span class="token comment"># 将请求头sec-fetch-mode对应的值修改为Blue-updatebyzzyy</span>
    <span class="token punctuation">-</span> AddRequestParameter=customerId<span class="token punctuation">,</span><span class="token number">9527001</span> <span class="token comment"># 新增请求参数Parameter：k ，v</span>
    <span class="token punctuation">-</span> RemoveRequestParameter=customerName   <span class="token comment"># 删除url请求参数customerName，你传递过来也是null</span>
    <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>atguigu<span class="token punctuation">,</span> BlueResponse <span class="token comment"># 新增请求参数X-Response-atguigu并设值为BlueResponse</span>
    <span class="token punctuation">-</span> SetResponseHeader=Date<span class="token punctuation">,</span><span class="token datetime number">2099-11-11</span> <span class="token comment"># 设置回应头Date值为2099-11-11</span>
    <span class="token punctuation">-</span> RemoveResponseHeader=Content<span class="token punctuation">-</span>Type <span class="token comment"># 将默认自带Content-Type回应属性删除</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>重启 9527 和 8001</p> <p><img src="data:image/webp;base64,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" alt="image-20240513000940351"></p></li></ul> <h6 id="前缀和路径相关组"><a href="#前缀和路径相关组" class="header-anchor">#</a> 前缀和路径相关组</h6> <p>之前的正确地址：http://localhost:9527/pay/gateway/filter</p> <ol><li><p><code>The PrefixPath GatewayFilter Factory</code>：自动添加路径前缀</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Path=/gateway/filter/<span class="token important">**</span>              <span class="token comment"># 断言，为配合PrefixPath测试过滤，暂时注释掉/pay</span>
<span class="token key atrule">filters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> PrefixPath=/pay <span class="token comment"># http://localhost:9527/pay/gateway/filter  被分拆为：PrefixPath + Path</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>访问：http://localhost:9527/gateway/filter</p> <p><img src="/assets/img/image-20240513002125023.9152ced7.webp" alt="image-20240513002125023"></p> <p><img src="/assets/img/image-20240513002246977.737730b2.webp" alt="image-20240513002246977"></p></li> <li><p><code>The SetPath GatewayFilter Factory</code>：访问路径修改</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Path=/XYZ/abc/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>           <span class="token comment"># 断言，为配合SetPath测试，{segment}的内容最后被SetPath取代</span>
<span class="token key atrule">filters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> SetPath=/pay/gateway/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>  <span class="token comment"># {segment}表示占位符，你写abc也行但要上下一致</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>访问：http://localhost:9527/XYZ/abc/filter</p> <p><img src="/assets/img/image-20240513002702424.391ddc45.webp" alt="image-20240513002702424"></p></li> <li><p><code>The RedirectTo GatewayFilter Factory</code>：重定向到某个页面</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span> <span class="token comment"># 真实地址</span>
<span class="token key atrule">filters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RedirectTo=302<span class="token punctuation">,</span> http<span class="token punctuation">:</span>//www.atguigu.com/ <span class="token comment"># 访问http://localhost:9527/pay/gateway/filter跳转到http://www.atguigu.com/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>访问：http://localhost:9527/pay/gateway/filter</p></li></ol> <h6 id="default-filters"><a href="#default-filters" class="header-anchor">#</a> Default Filters</h6> <ul><li><p>要添加一个过滤器并将其应用于所有路由，可以使用 <code>spring.clod.gatewaydefault-filter</code>。</p></li> <li><p>此属性接受筛选器列表。</p></li> <li><p>配置在此处相当于全局通用，自定义秒变 Global</p></li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Default<span class="token punctuation">-</span>Red<span class="token punctuation">,</span> Default<span class="token punctuation">-</span>Blue
      <span class="token punctuation">-</span> PrefixPath=/httpbin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="gateway-自定义过滤器"><a href="#gateway-自定义过滤器" class="header-anchor">#</a> Gateway 自定义过滤器</h5> <h6 id="自定义全局-filter"><a href="#自定义全局-filter" class="header-anchor">#</a> 自定义全局 Filter</h6> <p><strong>面试题：统计接口调用耗时情况，如何落地，谈谈设计思路</strong></p> <p>通过自定义全局过滤器搞定上述需求</p> <p><strong>案例：自定义接口调用耗时统计的全局过滤器</strong></p> <p><a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-combined-global-filter-and-gatewayfilter-ordering" target="_blank" rel="noopener noreferrer">Combined Global Filter and GatewayFilter Ordering<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>新建类 MyGlobalFilter 并实现 GlobalFilter,Ordered 两个接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>mygateway</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BEGIN_VISIT_TIME</span> <span class="token operator">=</span> <span class="token string">&quot;begin_visit_time&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 开始调用方法的时间</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 先记录下访问接口的开始时间</span>
        exchange<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">BEGIN_VISIT_TIME</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2, 返回统计的各个结果给后台</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> beginVisitTime <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">BEGIN_VISIT_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beginVisitTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;访问接口主机：&quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;访问接口端口：&quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;访问接口URL：&quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;访问接口URL后面参数：&quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRawQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;访问接口时长：&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> beginVisitTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;毫秒&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;========================分割线========================\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 数字越小，优先级越高</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div></li> <li><p>YML</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway <span class="token comment">#以微服务注册进consul或nacos服务列表内</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span> <span class="token comment">#配置consul地址</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh2 <span class="token comment">#pay_routh2                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/info/<span class="token important">**</span>              <span class="token comment"># 断言，路径相匹配的进行路由</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh3 <span class="token comment">#pay_routh3</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service                <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span> <span class="token comment"># 真实地址</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li></ol> <h6 id="自定义条件-filter"><a href="#自定义条件-filter" class="header-anchor">#</a> 自定义条件 Filter</h6> <p>自定义单一内置过滤器 GatewayFilter，参考几个内置的过滤器。</p> <p>自定义网关过滤器规则步骤套路：</p> <ol><li>新建类名 XXX 需要以 GatewayFilterFactory 结尾，并继承 AbstractGatewayFilterFactory 类</li> <li>新建 XXXGatewayFilterFactory.Config 内部类</li> <li>重写 apply 方法</li> <li>重写 shortcutFieldOrder</li> <li>空参构造方法，内部调用 super</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>mygateway</span><span class="token punctuation">;</span>

<span class="token comment">// //单一内置过滤器GatewayFilter</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">MyGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">MyGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">MyGatewayFilterFactory<span class="token punctuation">.</span>Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GatewayFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入了自定义网关过滤器MyGatewayFilterFactory，status：&quot;</span> <span class="token operator">+</span> config<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">shortcutFieldOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Setter</span>
        <span class="token annotation punctuation">@Getter</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span> <span class="token comment">// 设置一个状态值/标志位，它等于多少，匹配才可以访问</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh3 <span class="token comment">#pay_routh3</span>
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> My=atguigu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>测试：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 错误</span>
http://localhost:9527/pay/gateway/filter
<span class="token comment"># 正确</span>
http://localhost:9527/pay/gateway/filter?atguigu<span class="token operator">=</span>java
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="gateway-整合阿里巴巴-sentinel-实现容错"><a href="#gateway-整合阿里巴巴-sentinel-实现容错" class="header-anchor">#</a> Gateway 整合阿里巴巴 Sentinel 实现容错</h3> <p><font color="red" size="5">见后续 springcloud alibaba 篇章</font></p> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <p><a href="https://pan.quark.cn/s/a488525b282c" target="_blank" rel="noopener noreferrer">尚硅谷 SpringCloud 第 3 季 2024 笔记<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/05/12, 21:02:41</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/micro-service-core/SpringCloud-Alibaba/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Spring Cloud Alibaba</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/micro-service-core/SpringCloud-Alibaba/">Spring Cloud Alibaba</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/java-web/chapter-9/"><div>
            第九章 前端工程化-下
            <!----></div></a> <span class="date">12-11</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/java-web/chapter-8/"><div>
            第八章 前端工程化-中
            <!----></div></a> <span class="date">12-11</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/java-web/chapter-7/"><div>
            第七章 前端工程化-上
            <!----></div></a> <span class="date">12-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2026
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1f9bc03c.js" defer></script><script src="/assets/js/3.be9e7e99.js" defer></script><script src="/assets/js/2.c36d0987.js" defer></script><script src="/assets/js/10.57dc9feb.js" defer></script>
  </body>
</html>
