<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud Alibaba | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.ca5c989c.js" as="script"><link rel="preload" href="/assets/js/3.f2884e99.js" as="script"><link rel="preload" href="/assets/js/2.81e8b964.js" as="script"><link rel="preload" href="/assets/js/12.04b9b957.js" as="script"><link rel="prefetch" href="/assets/js/1.f754fd0b.js"><link rel="prefetch" href="/assets/js/10.bde6e567.js"><link rel="prefetch" href="/assets/js/100.000718ad.js"><link rel="prefetch" href="/assets/js/101.863f022a.js"><link rel="prefetch" href="/assets/js/102.7b45f43b.js"><link rel="prefetch" href="/assets/js/103.ba5681a8.js"><link rel="prefetch" href="/assets/js/104.e35b7e87.js"><link rel="prefetch" href="/assets/js/105.15a150cd.js"><link rel="prefetch" href="/assets/js/106.aea81b3b.js"><link rel="prefetch" href="/assets/js/107.4f4dec09.js"><link rel="prefetch" href="/assets/js/108.0079fda6.js"><link rel="prefetch" href="/assets/js/109.7a5059de.js"><link rel="prefetch" href="/assets/js/11.fa1b0bc7.js"><link rel="prefetch" href="/assets/js/110.85007649.js"><link rel="prefetch" href="/assets/js/111.dbec93e3.js"><link rel="prefetch" href="/assets/js/112.f17a38c0.js"><link rel="prefetch" href="/assets/js/113.6478506e.js"><link rel="prefetch" href="/assets/js/114.6031c0db.js"><link rel="prefetch" href="/assets/js/115.d7094af2.js"><link rel="prefetch" href="/assets/js/116.316a6234.js"><link rel="prefetch" href="/assets/js/117.1336f5e0.js"><link rel="prefetch" href="/assets/js/118.4b882789.js"><link rel="prefetch" href="/assets/js/119.503f83be.js"><link rel="prefetch" href="/assets/js/120.af7d94d8.js"><link rel="prefetch" href="/assets/js/121.5cd3597d.js"><link rel="prefetch" href="/assets/js/122.82f45642.js"><link rel="prefetch" href="/assets/js/123.f2ba0b19.js"><link rel="prefetch" href="/assets/js/13.680e50fd.js"><link rel="prefetch" href="/assets/js/14.dfca4100.js"><link rel="prefetch" href="/assets/js/15.01784967.js"><link rel="prefetch" href="/assets/js/16.81c1d5ab.js"><link rel="prefetch" href="/assets/js/17.9a472859.js"><link rel="prefetch" href="/assets/js/18.5366cb68.js"><link rel="prefetch" href="/assets/js/19.b1b74ef9.js"><link rel="prefetch" href="/assets/js/20.e938fa21.js"><link rel="prefetch" href="/assets/js/21.3e38db33.js"><link rel="prefetch" href="/assets/js/22.f9d18654.js"><link rel="prefetch" href="/assets/js/23.8eea4b67.js"><link rel="prefetch" href="/assets/js/24.6fe732dc.js"><link rel="prefetch" href="/assets/js/25.b1885cb6.js"><link rel="prefetch" href="/assets/js/26.936ee89a.js"><link rel="prefetch" href="/assets/js/27.fb3beb63.js"><link rel="prefetch" href="/assets/js/28.af721a74.js"><link rel="prefetch" href="/assets/js/29.427b7eae.js"><link rel="prefetch" href="/assets/js/30.2af5e34e.js"><link rel="prefetch" href="/assets/js/31.60102330.js"><link rel="prefetch" href="/assets/js/32.746872da.js"><link rel="prefetch" href="/assets/js/33.9466d03b.js"><link rel="prefetch" href="/assets/js/34.c7f7b0ef.js"><link rel="prefetch" href="/assets/js/35.53799eb8.js"><link rel="prefetch" href="/assets/js/36.e8875fc1.js"><link rel="prefetch" href="/assets/js/37.c386b2c5.js"><link rel="prefetch" href="/assets/js/38.ee46082f.js"><link rel="prefetch" href="/assets/js/39.11d092ff.js"><link rel="prefetch" href="/assets/js/4.920d0610.js"><link rel="prefetch" href="/assets/js/40.4ee40bcf.js"><link rel="prefetch" href="/assets/js/41.81c3174c.js"><link rel="prefetch" href="/assets/js/42.18f42b9d.js"><link rel="prefetch" href="/assets/js/43.7426d1ac.js"><link rel="prefetch" href="/assets/js/44.d5baff75.js"><link rel="prefetch" href="/assets/js/45.7b25c5ca.js"><link rel="prefetch" href="/assets/js/46.dff72ed3.js"><link rel="prefetch" href="/assets/js/47.15531a4f.js"><link rel="prefetch" href="/assets/js/48.48bbc098.js"><link rel="prefetch" href="/assets/js/49.49acd468.js"><link rel="prefetch" href="/assets/js/5.847584a2.js"><link rel="prefetch" href="/assets/js/50.e26ee1bf.js"><link rel="prefetch" href="/assets/js/51.6728bddb.js"><link rel="prefetch" href="/assets/js/52.c238e7bf.js"><link rel="prefetch" href="/assets/js/53.025903f6.js"><link rel="prefetch" href="/assets/js/54.05baf03a.js"><link rel="prefetch" href="/assets/js/55.b6fc3e0a.js"><link rel="prefetch" href="/assets/js/56.8e5ef1fc.js"><link rel="prefetch" href="/assets/js/57.db41b6fb.js"><link rel="prefetch" href="/assets/js/58.b4cb51f8.js"><link rel="prefetch" href="/assets/js/59.423b27e1.js"><link rel="prefetch" href="/assets/js/6.b384c550.js"><link rel="prefetch" href="/assets/js/60.57eff889.js"><link rel="prefetch" href="/assets/js/61.387a5103.js"><link rel="prefetch" href="/assets/js/62.23ba2982.js"><link rel="prefetch" href="/assets/js/63.2d69780b.js"><link rel="prefetch" href="/assets/js/64.d3f669fb.js"><link rel="prefetch" href="/assets/js/65.f5410640.js"><link rel="prefetch" href="/assets/js/66.59887fb2.js"><link rel="prefetch" href="/assets/js/67.01fba30e.js"><link rel="prefetch" href="/assets/js/68.8a6bbb81.js"><link rel="prefetch" href="/assets/js/69.12e673c4.js"><link rel="prefetch" href="/assets/js/70.a227d4b3.js"><link rel="prefetch" href="/assets/js/71.bd6a3bd7.js"><link rel="prefetch" href="/assets/js/72.4f2efca4.js"><link rel="prefetch" href="/assets/js/73.7dbf57a8.js"><link rel="prefetch" href="/assets/js/74.28c26d0a.js"><link rel="prefetch" href="/assets/js/75.d36a4feb.js"><link rel="prefetch" href="/assets/js/76.9123efc1.js"><link rel="prefetch" href="/assets/js/77.cbe2020d.js"><link rel="prefetch" href="/assets/js/78.7ab3eb40.js"><link rel="prefetch" href="/assets/js/79.bc69c4a8.js"><link rel="prefetch" href="/assets/js/80.da17de0b.js"><link rel="prefetch" href="/assets/js/81.1d16813f.js"><link rel="prefetch" href="/assets/js/82.586f2e97.js"><link rel="prefetch" href="/assets/js/83.129cc5fa.js"><link rel="prefetch" href="/assets/js/84.83d65ed9.js"><link rel="prefetch" href="/assets/js/85.f4327096.js"><link rel="prefetch" href="/assets/js/86.866a7d4f.js"><link rel="prefetch" href="/assets/js/87.f8aba274.js"><link rel="prefetch" href="/assets/js/88.43c5a138.js"><link rel="prefetch" href="/assets/js/89.b47b6d86.js"><link rel="prefetch" href="/assets/js/9.ef15744b.js"><link rel="prefetch" href="/assets/js/90.4950712a.js"><link rel="prefetch" href="/assets/js/91.80bbaffe.js"><link rel="prefetch" href="/assets/js/92.0d03ce50.js"><link rel="prefetch" href="/assets/js/93.fff94cff.js"><link rel="prefetch" href="/assets/js/94.91d0e36d.js"><link rel="prefetch" href="/assets/js/95.15227fb3.js"><link rel="prefetch" href="/assets/js/96.b3ef20b0.js"><link rel="prefetch" href="/assets/js/97.9e5e1675.js"><link rel="prefetch" href="/assets/js/98.b213b526.js"><link rel="prefetch" href="/assets/js/99.1ec76897.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b448e12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title router-link-active">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" aria-current="page" class="nav-link router-link-exact-active router-link-active">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title router-link-active">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" aria-current="page" class="nav-link router-link-exact-active router-link-active">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/micro-service-core/SpringCloud/" class="sidebar-link">Spring Cloud</a></li><li><a href="/micro-service-core/SpringCloud-Alibaba/" aria-current="page" class="active sidebar-link">Spring Cloud Alibaba</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud-Alibaba/#springcloud-alibaba-入门简介" class="sidebar-link">SpringCloud Alibaba 入门简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#能干嘛" class="sidebar-link">能干嘛</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#怎么玩" class="sidebar-link">怎么玩</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud-Alibaba/#springcloud-alibaba-nacos-服务注册和配置中心" class="sidebar-link">SpringCloud Alibaba Nacos 服务注册和配置中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#总体介绍" class="sidebar-link">总体介绍</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-简介" class="sidebar-link">Nacos 简介</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#为什么叫-nacos-这个名字" class="sidebar-link">为什么叫 Nacos 这个名字</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么-2" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#能干啥" class="sidebar-link">能干啥</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#去哪下" class="sidebar-link">去哪下</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#各种注册中心比较" class="sidebar-link">各种注册中心比较</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-下载安装" class="sidebar-link">Nacos 下载安装</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-discovery-服务注册中心" class="sidebar-link">Nacos Discovery 服务注册中心</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#基于-nacos-的服务提供者" class="sidebar-link">基于 Nacos 的服务提供者</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#基于-nacos-的服务消费者" class="sidebar-link">基于 Nacos 的服务消费者</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#负载均衡" class="sidebar-link">负载均衡</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-config-服务配置中心" class="sidebar-link">Nacos Config 服务配置中心</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-作为配置中心配置步骤" class="sidebar-link">Nacos 作为配置中心配置步骤</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#建-module" class="sidebar-link">建 Module</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#pom" class="sidebar-link">POM</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#yml" class="sidebar-link">YML</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#主启动" class="sidebar-link">主启动</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#业务类" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#在-nacos-中添加配置信息-重点" class="sidebar-link">在 Nacos 中添加配置信息（重点）</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-中的匹配规则" class="sidebar-link">Nacos 中的匹配规则</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#案例步骤" class="sidebar-link">案例步骤</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#自带动态刷新调用接口查看配置信息" class="sidebar-link">自带动态刷新调用接口查看配置信息</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#历史配置" class="sidebar-link">历史配置</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-数据模型之-namespace-group-dataid" class="sidebar-link">Nacos 数据模型之 Namespace-Group-DataId</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#问题-多环境多项目管理" class="sidebar-link">问题：多环境多项目管理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#官网" class="sidebar-link">官网</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#namespace-group-dataid-三者关系-为什么这么设计" class="sidebar-link">Namespace+Group+DataId 三者关系？为什么这么设计？</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#nacos-的图形化管理界面" class="sidebar-link">Nacos 的图形化管理界面</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#三种方案加载配置" class="sidebar-link">三种方案加载配置</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#dataid-方案" class="sidebar-link">DataID 方案</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#group-方案" class="sidebar-link">Group 方案</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#namespace-方案" class="sidebar-link">Namespace 方案</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud-Alibaba/#springcloud-alibaba-sentinel-实现熔断与限流" class="sidebar-link">SpringCloud Alibaba Sentinel 实现熔断与限流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#sentinel" class="sidebar-link">Sentinel</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么-3" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#怎么玩-2" class="sidebar-link">怎么玩</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#服务雪崩" class="sidebar-link">服务雪崩</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#服务降级" class="sidebar-link">服务降级</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#服务熔断" class="sidebar-link">服务熔断</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#服务限流" class="sidebar-link">服务限流</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#服务隔离" class="sidebar-link">服务隔离</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#服务超时" class="sidebar-link">服务超时</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#安装-sentinel" class="sidebar-link">安装 Sentinel</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#微服务-8401-整合-sentinel-入门案例" class="sidebar-link">微服务 8401 整合 Sentinel 入门案例</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#启动-nacos8848-成功" class="sidebar-link">启动 Nacos8848 成功</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#启动-sentinel8080-成功" class="sidebar-link">启动 Sentinel8080 成功</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#新建微服务-8401" class="sidebar-link">新建微服务 8401</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#启动-8401-微服务后查看-sentienl-控制台" class="sidebar-link">启动 8401 微服务后查看 sentienl 控制台</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#流控规则" class="sidebar-link">流控规则</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#基本介绍" class="sidebar-link">基本介绍</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#流控模式" class="sidebar-link">流控模式</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#直接" class="sidebar-link">直接</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#关联" class="sidebar-link">关联</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#链路" class="sidebar-link">链路</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#流控效果" class="sidebar-link">流控效果</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#快速失败-默认的流控处理" class="sidebar-link">快速失败（默认的流控处理）</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#预热-warmup" class="sidebar-link">预热 WarmUp</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#排队等待" class="sidebar-link">排队等待</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#流控效果-v2-并发线程数" class="sidebar-link">流控效果 V2（并发线程数）</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#熔断规则" class="sidebar-link">熔断规则</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#官网-2" class="sidebar-link">官网</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#基本介绍-2" class="sidebar-link">基本介绍</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#新增熔断规则实战" class="sidebar-link">新增熔断规则实战</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#慢调用比例" class="sidebar-link">慢调用比例</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么-4" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#名词解释" class="sidebar-link">名词解释</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#触发条件-熔断状态" class="sidebar-link">触发条件+熔断状态</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#测试-2" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#异常比例" class="sidebar-link">异常比例</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么-5" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#测试-3" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#异常数" class="sidebar-link">异常数</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么-6" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#测试-4" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#sentinelresource-注解" class="sidebar-link">@SentinelResource 注解</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么-7" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#启动-nacos、sentinel" class="sidebar-link">启动 Nacos、Sentinel</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#按照-rest-地址限流-默认限流返回" class="sidebar-link">按照 rest 地址限流+默认限流返回</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#按-sentinelresource-资源名称限流-自定义限流返回" class="sidebar-link">按 SentinelResource 资源名称限流+自定义限流返回</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#按-sentinelresource-资源名称限流-自定义限流返回-服务降级处理" class="sidebar-link">按 SentinelResource 资源名称限流+自定义限流返回+服务降级处理</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#热点规则" class="sidebar-link">热点规则</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#基本介绍-3" class="sidebar-link">基本介绍</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#代码" class="sidebar-link">代码</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#测试-5" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#参数例外项" class="sidebar-link">参数例外项</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#特例情况" class="sidebar-link">特例情况</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#配置-2" class="sidebar-link">配置</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#测试-6" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#前提条件" class="sidebar-link">前提条件</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#授权规则" class="sidebar-link">授权规则</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#授权规则概述" class="sidebar-link">授权规则概述</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#演示授权规则-黑名单禁止" class="sidebar-link">演示授权规则，黑名单禁止</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#配置-3" class="sidebar-link">配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#测试-7" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#规则持久化" class="sidebar-link">规则持久化</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#是什么-8" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#怎么玩-3" class="sidebar-link">怎么玩</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#步骤" class="sidebar-link">步骤</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#openfeign-和-sentinel-集成实现-fallback-服务降级" class="sidebar-link">OpenFeign 和 Sentinel 集成实现 fallback 服务降级</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#需求说明" class="sidebar-link">需求说明</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#程序解耦" class="sidebar-link">程序解耦</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#编码步骤" class="sidebar-link">编码步骤</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#启动-nacos、sentinel-2" class="sidebar-link">启动 Nacos、Sentinel</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#修改服务提供方-cloudalibaba-provider-payment9001" class="sidebar-link">修改服务提供方 cloudalibaba-provider-payment9001</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#修改-cloud-api-commons" class="sidebar-link">修改 cloud-api-commons</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#修改-cloudalibaba-consumer-nacos-order83" class="sidebar-link">修改 cloudalibaba-consumer-nacos-order83</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#测试验证" class="sidebar-link">测试验证</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#gateway-和-sentinel-集成实现服务限流" class="sidebar-link">GateWay 和 Sentinel 集成实现服务限流</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#需求说明-2" class="sidebar-link">需求说明</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#启动-nacos、sentinel-3" class="sidebar-link">启动 Nacos、Sentinel</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#编码步骤-2" class="sidebar-link">编码步骤</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#测试验证-2" class="sidebar-link">测试验证</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-core/SpringCloud-Alibaba/#springcloud-alibaba-seate-处理分布式事务" class="sidebar-link">SpringCloud Alibaba Seate 处理分布式事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#面试题" class="sidebar-link">面试题</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#分布式事务问题如何产生" class="sidebar-link">分布式事务问题如何产生？</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#seata-简介" class="sidebar-link">Seata 简介</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#seata-工作流程简介" class="sidebar-link">Seata 工作流程简介</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#seata-server2-0-0-安装" class="sidebar-link">Seata-Server2.0.0 安装</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#seata-案例实战-数据库和表准备" class="sidebar-link">Seata 案例实战-数据库和表准备</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#seata-案例实战-微服务编码落地实现" class="sidebar-link">Seata 案例实战-微服务编码落地实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#业务需求" class="sidebar-link">业务需求</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#mybaits-一键生成" class="sidebar-link">Mybaits 一键生成</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#修改公共-cloud-api-commons-新增库存和账户两个-feign-服务接口" class="sidebar-link">修改公共 cloud-api-commons 新增库存和账户两个 Feign 服务接口</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#新建订单-order-微服务" class="sidebar-link">新建订单 Order 微服务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#建-module-2" class="sidebar-link">建 Module</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#改-pom" class="sidebar-link">改 POM</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#写-yml" class="sidebar-link">写 YML</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#主启动-2" class="sidebar-link">主启动</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#业务类-2" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#entities" class="sidebar-link">entities</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#ordermapper" class="sidebar-link">OrderMapper</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#service-接口及实现" class="sidebar-link">Service 接口及实现</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#ordercontroller" class="sidebar-link">OrderController</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#新建库存-storage-微服务" class="sidebar-link">新建库存 Storage 微服务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#建-module-3" class="sidebar-link">建 Module</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#改-pom-2" class="sidebar-link">改 POM</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#写-yml-2" class="sidebar-link">写 YML</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#主启动-3" class="sidebar-link">主启动</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#业务类-3" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#entities-2" class="sidebar-link">entities</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#ordermapper-2" class="sidebar-link">OrderMapper</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#service-接口及实现-2" class="sidebar-link">Service 接口及实现</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#controller" class="sidebar-link">Controller</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#新建账户-account-微服务" class="sidebar-link">新建账户 Account 微服务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#建-module-4" class="sidebar-link">建 Module</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#改-pom-3" class="sidebar-link">改 POM</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#写-yml-3" class="sidebar-link">写 YML</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#主启动-4" class="sidebar-link">主启动</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-core/SpringCloud-Alibaba/#业务类-4" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#entities-3" class="sidebar-link">entities</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#ordermapper-3" class="sidebar-link">OrderMapper</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#service-接口及实现-3" class="sidebar-link">Service 接口及实现</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-core/SpringCloud-Alibaba/#controller-2" class="sidebar-link">Controller</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#seata-案例实战-测试" class="sidebar-link">Seata 案例实战-测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#服务启动情况" class="sidebar-link">服务启动情况</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#数据库初始情况" class="sidebar-link">数据库初始情况</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#正常下单" class="sidebar-link">正常下单</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#超时异常出错-没有-globaltransactional" class="sidebar-link">超时异常出错，没有@GlobalTransactional</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-core/SpringCloud-Alibaba/#超时异常解决-添加-globaltransactional" class="sidebar-link">超时异常解决，添加@GlobalTransactional</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-core/SpringCloud-Alibaba/#seata-原理小总结和面试题" class="sidebar-link">Seata 原理小总结和面试题</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>持久层框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>相关知识</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/micro-service-core/#微服务核心" data-v-06225672>微服务核心</a></li><li data-v-06225672><a href="/micro-service-core/#SpringCloud" data-v-06225672>SpringCloud</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-05-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Spring Cloud Alibaba<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="springcloud-alibaba-入门简介"><a href="#springcloud-alibaba-入门简介" class="header-anchor">#</a> SpringCloud Alibaba 入门简介</h2> <h3 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么</h3> <p><a href="https://github.com/alibaba/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">alibaba/spring-cloud-alibaba (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/2023.x/README-zh.md" target="_blank" rel="noopener noreferrer">README-zh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/2022/zh-cn/2022.0.0.0-RC2.html" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba 参考文档（中文）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/2022/en-us/2022.0.0.0-RC2.html" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba Reference Documentation （英文）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://sca.aliyun.com/" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>简单易用：Spring Cloud Alibaba 作为<strong>一站式的微服务构建方案</strong>，用户只需要添加一些注解和少量配置，就可以通过阿里中间件来迅速搭建分布式应用系统。</li> <li>扩展性强：Spring Cloud Alibaba 基于 Spring Cloud 微服务解决方案规范，可便捷地对其中的组件进行扩展和替换。</li> <li>生产等级：核心组件都经过过阿里巴巴多年双十一洪峰考验，成熟稳定。</li> <li>能力全面：针对微服务架构中的服务注册与发现、分布式消息、微服务限流降级、分布式事务和微服务治理等重要领域，都提供了对应解决方案。</li></ul> <p>组件：</p> <p><strong><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>：把流量作为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</p> <p><strong><a href="https://github.com/alibaba/Nacos" target="_blank" rel="noopener noreferrer">Nacos<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>：一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p> <p><strong><a href="https://rocketmq.apache.org/" target="_blank" rel="noopener noreferrer">RocketMQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>：一款开源的分布式消息系统，基于高可用分布式集群技术，提供低延时的、高可靠的消息发布与订阅服务。</p> <p><strong><a href="https://github.com/seata/seata" target="_blank" rel="noopener noreferrer">Seata<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>：阿里巴巴开源产品，一个易于使用的高性能微服务分布式事务解决方案。</p> <p><strong><a href="https://www.aliyun.com/product/oss" target="_blank" rel="noopener noreferrer">Alibaba Cloud OSS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>: 阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。您可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。</p> <p><strong><a href="https://cn.aliyun.com/aliware/schedulerx" target="_blank" rel="noopener noreferrer">Alibaba Cloud SchedulerX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>: 阿里中间件团队开发的一款分布式任务调度产品，提供秒级、精准、高可靠、高可用的定时（基于 Cron 表达式）任务调度服务。</p> <p><strong><a href="https://www.aliyun.com/product/sms" target="_blank" rel="noopener noreferrer">Alibaba Cloud SMS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>: 覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</p> <h3 id="能干嘛"><a href="#能干嘛" class="header-anchor">#</a> 能干嘛</h3> <ul><li><strong>服务限流降级</strong>：默认支持 WebServlet、WebFlux、OpenFeign、RestTemplate、Spring Cloud Gateway、Dubbo 和 RocketMQ 限流降级功能的接入，可以在运行时通过控制台实时修改限流降级规则，还支持查看限流降级 Metrics 监控。</li> <li><strong>服务注册与发现</strong>：适配 Spring Cloud 服务注册与发现标准，默认集成对应 Spring Cloud 版本所支持的负载均衡组件的适配。</li> <li><strong>分布式配置管理</strong>：支持分布式系统中的外部化配置，配置更改时自动刷新。</li> <li><strong>消息驱动能力</strong>：基于 Spring Cloud Stream 为微服务应用构建消息驱动能力。</li> <li><strong>分布式事务</strong>：使用 <code>@GlobalTransactional</code> 注解， 高效并且对业务零侵入地解决分布式事务问题。</li> <li><strong>阿里云对象存储</strong>：阿里云提供的海量、安全、低成本、高可靠的云存储服务。支持在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li> <li><strong>分布式任务调度</strong>：提供秒级、精准、高可靠、高可用的定时（基于 Cron 表达式）任务调度服务。同时提供分布式的任务执行模型，如网格任务。网格任务支持海量子任务均匀分配到所有 Worker(schedulerx-client)上执行。</li> <li><strong>阿里云短信服务</strong>：覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</li></ul> <h3 id="怎么玩"><a href="#怎么玩" class="header-anchor">#</a> 怎么玩</h3> <p><img src="/assets/img/image-20240513222516242.193205a0.webp" alt="image-20240513222516242"></p> <h2 id="springcloud-alibaba-nacos-服务注册和配置中心"><a href="#springcloud-alibaba-nacos-服务注册和配置中心" class="header-anchor">#</a> SpringCloud Alibaba Nacos 服务注册和配置中心</h2> <h3 id="总体介绍"><a href="#总体介绍" class="header-anchor">#</a> 总体介绍</h3> <p><img src="/assets/img/image-20240513223528601.c350fea9.webp" alt="image-20240513223528601"></p> <h3 id="nacos-简介"><a href="#nacos-简介" class="header-anchor">#</a> Nacos 简介</h3> <h4 id="为什么叫-nacos-这个名字"><a href="#为什么叫-nacos-这个名字" class="header-anchor">#</a> 为什么叫 Nacos 这个名字</h4> <p>Nacos: Dynamic Naming and Configuration Service</p> <p>前四个字母分别为 Naming 和 Configuration 的前两个字母，最后的 s 为 Service。</p> <h4 id="是什么-2"><a href="#是什么-2" class="header-anchor">#</a> 是什么</h4> <p><a href="https://nacos.io/" target="_blank" rel="noopener noreferrer">Nacos 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</strong></p> <p><strong>总结</strong>：Nacos 就是注册中心 + 配置中心的组合</p> <p>等价于</p> <ul><li>Nacos = Eureka+Config +Bus</li> <li>Nacos = Spring Cloud Consul</li></ul> <h4 id="能干啥"><a href="#能干啥" class="header-anchor">#</a> 能干啥</h4> <ol><li>替代 Eureka/Consul 做服务注册中心</li> <li>替代(Config+Bus)/Consul 做服务配置中心和满足动态刷新广播通知</li></ol> <h4 id="去哪下"><a href="#去哪下" class="header-anchor">#</a> 去哪下</h4> <p><a href="https://nacos.io/download/nacos-server/" target="_blank" rel="noopener noreferrer">Nacos Server 下载 | Nacos<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="各种注册中心比较"><a href="#各种注册中心比较" class="header-anchor">#</a> 各种注册中心比较</h4> <p><img src="/assets/img/image-20240513224211437.c1da126f.webp" alt="image-20240513224211437"></p> <p>据说 Nacos 在阿里巴巴内部有超过 10 万的实例运行，已经过了类似双十一等各种大型流量的考验，Nacos 默认是 AP 模式，但也可以调整切换为 CP，我们一般用默认 AP 即可。</p> <h3 id="nacos-下载安装"><a href="#nacos-下载安装" class="header-anchor">#</a> Nacos 下载安装</h3> <p><a href="https://nacos.io/docs/v2/quickstart/quick-start/" target="_blank" rel="noopener noreferrer">Nacos 快速开始<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://nacos.io/zh-cn/docs/v2/quickstart/quick-start.html" target="_blank" rel="noopener noreferrer">Nacos 旧版文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>启动命令（standalone 代表着单机模式运行，非集群模式）:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Linux/Unix/Mac</span>
<span class="token function">sh</span> startup.sh <span class="token parameter variable">-m</span> standalone
<span class="token comment"># 如果您使用的是ubuntu系统，或者运行脚本报错提示[[符号找不到，可尝试如下运行：</span>
<span class="token function">bash</span> startup.sh <span class="token parameter variable">-m</span> standalone

<span class="token comment"># Windows </span>
startup.cmd <span class="token parameter variable">-m</span> standalone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>关闭服务器</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Linux/Unix/Mac</span>
<span class="token function">sh</span> shutdown.sh

<span class="token comment"># Windows</span>
shutdown.cmd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>命令运行成功后直接访问 http://localhost:8848/nacos</p> <p>默认账号密码都是 <code>nacos</code></p> <h3 id="nacos-discovery-服务注册中心"><a href="#nacos-discovery-服务注册中心" class="header-anchor">#</a> Nacos Discovery 服务注册中心</h3> <p>通过 <code>Nacos Server</code> 和 <code>spring-cloud-starter-alibaba-nacos-discovery</code> 实现服务的注册与发现。</p> <h4 id="基于-nacos-的服务提供者"><a href="#基于-nacos-的服务提供者" class="header-anchor">#</a> 基于 Nacos 的服务提供者</h4> <ol><li><p>新建 Module：cloudalibaba-provider-payment9001</p></li> <li><p>POM.xml 添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-provider-payment9001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos-discovery--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot通用依赖模块--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--test--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div></li> <li><p>YML 添加配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#配置Nacos地址</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/assets/img/image-20240513233919201.bc51774f.webp" alt="image-20240513233919201"></p></li> <li><p>主启动类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main9001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main9001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>业务类 PayAlibabaController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayAlibabaController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;nacos registry, serverPort: &quot;</span> <span class="token operator">+</span> serverPort <span class="token operator">+</span> <span class="token string">&quot;\t id&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>测试</p> <ul><li>http://localhost:9001/pay/nacos/11</li> <li>http://localhost:8848/nacos</li> <li><img src="/assets/img/image-20240513234327624.47e2d223.webp" alt="image-20240513234327624"></li> <li>nacos8848 注册中心+服务提供者 pay9001 都 OK 了</li></ul></li></ol> <h4 id="基于-nacos-的服务消费者"><a href="#基于-nacos-的服务消费者" class="header-anchor">#</a> 基于 Nacos 的服务消费者</h4> <ol><li><p>新建 Module：cloudalibaba-consumer-nacos-order83</p></li> <li><p>POM.xml 添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-consumer-nacos-order83<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos-discovery--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--loadbalancer--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div></li> <li><p>YML 添加配置</p> <p><img src="/assets/img/image-20240513232645534.a28c0ede.webp" alt="image-20240513232645534"></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
<span class="token comment">#消费者将要去访问的微服务名称(nacos微服务提供者叫什么你写什么)</span>
<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>主启动类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main83</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main83</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>业务类</p> <ul><li><p>配置 config</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestTemplateConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment">//赋予RestTemplate负载均衡的能力</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>OrderNacosController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;$server-url.nacos-user-service&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverURL<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/pay/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">paymentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>serverURL <span class="token operator">+</span> <span class="token string">&quot;/pay/nacos/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;    我是OrderNacosController83调用者。。。。。。&quot;</span>；
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul></li> <li><p>测试</p> <ul><li><p>nacos 控制台</p> <p><img src="/assets/img/image-20240513234634535.a19c2989.webp" alt="image-20240513234634535"></p></li> <li><p>http://localhost:83/consumer/pay/nacos/14</p></li></ul></li></ol> <h4 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h4> <ol><li>参照 9001 新建 9002（直接拷贝虚拟端口映射）<code>-DServer.port=9002</code> <ul><li><img src="/assets/img/image-20240514000029844.5695a027.webp" alt="image-20240514000029844"></li> <li><img src="/assets/img/image-20240514000048981.8d54b38e.webp" alt="image-20240514000048981"></li> <li><img src="/assets/img/image-20240514000128122.2d686bfd.webp" alt="image-20240514000128122"></li></ul></li> <li>测试
<ul><li>http://localhost:83/consumer/pay/nacos/14</li> <li>看到端口号 9001/9002 交替出现，负载均衡达到</li></ul></li></ol> <h3 id="nacos-config-服务配置中心"><a href="#nacos-config-服务配置中心" class="header-anchor">#</a> Nacos Config 服务配置中心</h3> <h4 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h4> <ul><li>之前案例 Consul 8500 服务配置动态变更功能可以被 Nacos 取代</li> <li>通过 Nacos 和 spring-cloud-starter-alibaba-nacos-config 实现中心化全局配置的动态变更</li></ul> <p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/2022/zh-cn/2022.0.0.0-RC2.html#_spring_cloud_alibaba_nacos_config" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba 参考中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="nacos-作为配置中心配置步骤"><a href="#nacos-作为配置中心配置步骤" class="header-anchor">#</a> Nacos 作为配置中心配置步骤</h4> <h5 id="建-module"><a href="#建-module" class="header-anchor">#</a> 建 Module</h5> <p>新建 module <code>cloudalibaba-config-nacos-client3377</code></p> <h5 id="pom"><a href="#pom" class="header-anchor">#</a> POM</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-config-nacos-client3377<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--bootstrap--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos-config--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos-discovery--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h5 id="yml"><a href="#yml" class="header-anchor">#</a> YML</h5> <ul><li>Nacos 同 Consul 一样，在项目初始化时，要保证先从配置中心进行配置拉取，</li> <li>拉取配置之后，才能保证项目的正常启动，为了满足<strong>动态刷新</strong>和<strong>全局广播通知</strong></li> <li>springboot 中配置文件的加载是存在优先级顺序的，bootstrap 优先级高于 application</li></ul> <ol><li>bootstrap.yml:</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code># nacos配置
spring:
  application:
    name: nacos-config-client
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848 #Nacos服务注册中心地址
      config:
        server-addr: localhost:8848 #Nacos作为配置中心地址
        file-extension: yaml #指定yaml格式的配置

# nacos端配置文件DataId的命名规则是：
# ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}
# 本案例的DataID是:nacos-config-client-dev.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="2"><li>application.yml</li></ol> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 表示开发环境</span>
      <span class="token comment">#active: prod # 表示生产环境</span>
    <span class="token comment">#active: test # 表示测试环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="主启动"><a href="#主启动" class="header-anchor">#</a> 主启动</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClient3377</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosConfigClient3377</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="业务类"><a href="#业务类" class="header-anchor">#</a> 业务类</h5> <ul><li><p>通过 Spring Cloud 原生注解 <code>@RefreshScope</code> 实现配置自动更新</p></li> <li><p>NacosConfigClientController.java:</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">//在控制器类加入@RefreshScope注解使当前类下的配置支持Nacos的动态刷新功能。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${config.info}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> configInfo<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/config/info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="在-nacos-中添加配置信息-重点"><a href="#在-nacos-中添加配置信息-重点" class="header-anchor">#</a> 在 Nacos 中添加配置信息（重点）</h5> <h6 id="nacos-中的匹配规则"><a href="#nacos-中的匹配规则" class="header-anchor">#</a> Nacos 中的匹配规则</h6> <p><a href="https://nacos.io/docs/v2/ecology/use-nacos-with-spring-cloud/" target="_blank" rel="noopener noreferrer">Nacos 融合 Spring Cloud，成为注册配置中心 | Nacos<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Nacos 中的 <code>dataid</code> 的组成格式及与 SpringBoot 配置文件中的匹配规则：</p> <p><img src="/assets/img/image-20240514222027249.3e9b38ea.webp" alt="image-20240514222027249"></p> <p>最后公式：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20240514222405354.47a1f19b.webp" alt="image-20240514222405354"></p> <h6 id="案例步骤"><a href="#案例步骤" class="header-anchor">#</a> 案例步骤</h6> <p>nacos 后台管理-&gt;配置管理-&gt;配置列表-&gt;创建配置</p> <p>本案例的 DataID 是：<code>nacos-config-client-dev.yaml</code></p> <p><img src="/assets/img/image-20240514222759962.86d7d851.webp" alt="image-20240514222759962"></p> <h5 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h5> <ol><li>启动 Nacos 且在 nacos 后台管理-配置列表下已经存在对应的 yaml 配置文件</li> <li>运行 cloud-config-nacos-client3377 的主启动类</li> <li>调用接口查看配置信息：http://localhost:3377/config/info</li></ol> <h5 id="自带动态刷新调用接口查看配置信息"><a href="#自带动态刷新调用接口查看配置信息" class="header-anchor">#</a> 自带动态刷新调用接口查看配置信息</h5> <p>修改下 Nacos 中的 yaml 配置文件，再次调用查看配置的接口，就会发现配置已经刷新</p> <h5 id="历史配置"><a href="#历史配置" class="header-anchor">#</a> 历史配置</h5> <ul><li><p>Nacos 会记录配置文件的历史版本默认保留 30 天，此外还有一键回滚功能，回滚操作将会触发配置更新</p></li> <li><p>回滚</p> <p><img src="/assets/img/image-20240514223102516.8db44620.webp" alt="image-20240514223102516"></p></li></ul> <h3 id="nacos-数据模型之-namespace-group-dataid"><a href="#nacos-数据模型之-namespace-group-dataid" class="header-anchor">#</a> Nacos 数据模型之 Namespace-Group-DataId</h3> <h4 id="问题-多环境多项目管理"><a href="#问题-多环境多项目管理" class="header-anchor">#</a> 问题：多环境多项目管理</h4> <p>问题 1：</p> <p>实际开发中，通常一个系统会准备</p> <p>dev 开发环境</p> <p>test 测试环境</p> <p>prod 生产环境。</p> <p>如何保证指定环境启动时服务能正确读取到 Nacos 上相应环境的配置文件呢？</p> <p>问题 2：</p> <p>一个大型分布式微服务系统会有很多微服务子项目，</p> <p>每个微服务项目又都会有相应的开发环境、测试环境、预发环境、正式环境......</p> <p>那怎么对这些微服务配置进行分组和命名空间管理呢？</p> <h4 id="官网"><a href="#官网" class="header-anchor">#</a> 官网</h4> <p><a href="https://nacos.io/zh-cn/docs/architecture.html" target="_blank" rel="noopener noreferrer">Nacos 架构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="namespace-group-dataid-三者关系-为什么这么设计"><a href="#namespace-group-dataid-三者关系-为什么这么设计" class="header-anchor">#</a> Namespace+Group+DataId 三者关系？为什么这么设计？</h4> <p>Nacos 数据模型 Key 由三元组唯一确定, Namespace 默认是空串，公共命名空间(public)，分组默认是 DEFAULT_GROUP。</p> <p><img src="/assets/img/image-20240514001339297.9e8dcb82.webp" alt="image-20240514001339297"></p> <ol><li>是什么：类似 Java 里面的 package 名和类名，最外层的 Namespace 是可以用于区分部署环境的，Group 和 DataID 逻辑上区分两个目标对象</li> <li>默认值：Namespace=public，Group=DEFAULT_GROUP
<ul><li>Nacos 默认的命名空间是 public，Namespace 主要用来实现隔离。</li> <li>比方说我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个 Namespace，不同的 Namespace 之间是隔离的。</li> <li>Group 默认是 DEFAULT_GROUP，Group 可以把不同的微服务划分到同一个分组里面去</li></ul></li> <li>Service 就是微服务：一个 Service 可以包含一个或者多个 Cluster（集群），Nacos 默认 Cluster 是 DEFAULT，Cluster 是对指定微服务的一个虚拟划分。</li></ol> <p><img src="data:image/webp;base64,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" alt="image-20240514001418721"></p> <p><img src="/assets/img/image-20240514001429697.d84ca64a.webp" alt="image-20240514001429697"></p> <h4 id="nacos-的图形化管理界面"><a href="#nacos-的图形化管理界面" class="header-anchor">#</a> Nacos 的图形化管理界面</h4> <ul><li><p>命名空间 Namespace</p> <p><img src="/assets/img/image-20240514001706518.0a76ca37.webp" alt="image-20240514001706518"></p></li> <li><p>配置管理</p> <p><img src="/assets/img/image-20240514001719255.4126593d.webp" alt="image-20240514001719255"></p></li></ul> <h4 id="三种方案加载配置"><a href="#三种方案加载配置" class="header-anchor">#</a> 三种方案加载配置</h4> <h5 id="dataid-方案"><a href="#dataid-方案" class="header-anchor">#</a> DataID 方案</h5> <ul><li><p>指定 <code>spring.profile.active</code> 和配置文件的 <code>DataID</code> 来使不同环境下读取不同的配置</p></li> <li><p>默认空间 public+默认分组 DEFAULT_GROUP+<strong>新建 DataID</strong></p> <ul><li><p>新建 test 配置 DataID：<code>nacos-config-client-test.yaml</code>：</p> <p><img src="/assets/img/image-20240514224419337.f46af34a.webp" alt="image-20240514224419337"></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">config</span><span class="token punctuation">:</span>
  <span class="token key atrule">info</span><span class="token punctuation">:</span> welcome to nacos global config<span class="token punctuation">,</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client<span class="token punctuation">-</span>dev.yaml<span class="token punctuation">,</span> version=2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li> <li><p>修改 YML</p> <ul><li><p>通过 spring.profile.active 属性就能进行多环境下配置文件的读取</p></li> <li><p>application.yml：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token comment">#active: dev # 表示开发环境</span>
    <span class="token comment">#active: prod # 表示生产环境</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test <span class="token comment"># 表示测试环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>bootstrap.yml：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># nacos配置 一种:默认空间+默认分组+新建DataID</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos服务注册中心地址</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos作为配置中心地址</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#指定yaml格式的配置</span>

<span class="token comment"># nacos端配置文件DataId的命名规则是：</span>
<span class="token comment"># ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}</span>
<span class="token comment"># 本案例的DataID是:nacos-config-client-dev.yaml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ul></li> <li><p>测试：http://localhost:3377/config/info</p></li></ul> <h5 id="group-方案"><a href="#group-方案" class="header-anchor">#</a> Group 方案</h5> <ul><li><p>通过 Group 实现环境区分</p></li> <li><p>默认空间 public + <strong>新建 PROD_GROUP</strong> + <strong>新建 DataID</strong></p> <ul><li><p>新建 prod 配置 DataID：<code>nacos-config-client-prod.yaml</code></p></li> <li><p>新建 Group：<code>PROD_GROUP</code></p> <p><img src="/assets/img/image-20240514225617113.1f2acf47.webp" alt="image-20240514225617113"></p></li></ul></li> <li><p>修改 YML</p> <ul><li><p>在 config 下增加一条 group 的配置即可。</p> <ul><li>可配置为 <code>PROD_GROUP</code></li></ul></li> <li><p>application.yml：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token comment">#active: dev # 表示开发环境</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> prod <span class="token comment"># 表示生产环境</span>
    <span class="token comment">#active: test # 表示测试环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>bootstrap.yml：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># nacos配置 第2种:默认空间+新建分组+新建DataID</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos服务注册中心地址</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos作为配置中心地址</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#指定yaml格式的配置</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> PROD_GROUP

<span class="token comment"># nacos端配置文件DataId的命名规则是：</span>
<span class="token comment"># ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}</span>
<span class="token comment"># 本案例的DataID是:nacos-config-client-dev.yaml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul></li> <li><p>测试：http://localhost:3377/config/info</p></li></ul> <h5 id="namespace-方案"><a href="#namespace-方案" class="header-anchor">#</a> Namespace 方案</h5> <ul><li><p>通过 Namespace 实现命名空间环境区分</p> <ul><li><p>新建 Namespace：<code>Prod_Namespace</code></p></li> <li><p>新建 Namespace 但命名空间 ID 不填（系统自动生成）：<code>Prod2_Namespace</code></p> <p><img src="/assets/img/image-20240514225925643.b5bca763.webp" alt="image-20240514225925643"></p></li></ul></li> <li><p><strong>Prod_Namespace</strong> + PROD_GROUP + DataID(nacos-config-client-prod.yaml)</p> <ul><li><p>选定 Prod_Namespace 后新建</p> <p><img src="/assets/img/image-20240514230056893.22a2eae0.webp" alt="image-20240514230056893"></p></li> <li><p>命名空间：<code>Prod_Namespace</code></p></li> <li><p>Data ID：<code>nacos-config-client-prod.yaml</code></p></li> <li><p>GROUP：<code>PROD_GROUP</code></p> <p><img src="/assets/img/image-20240514230359046.77066ace.webp" alt="image-20240514230359046"></p></li></ul></li> <li><p>修改 YML</p> <ul><li><p>在 config 下增加一条 <code>namespace: Prod_Namespace</code></p></li> <li><p>application.yml：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token comment">#active: dev # 表示开发环境</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> prod <span class="token comment"># 表示生产环境</span>
    <span class="token comment">#active: test # 表示测试环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>bootstrap.yml：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># nacos配置 第3种:新建空间+新建分组+新建DataID</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos服务注册中心地址</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos作为配置中心地址</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#指定yaml格式的配置</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> PROD_GROUP
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> Prod_Namespace

<span class="token comment"># nacos端配置文件DataId的命名规则是：</span>
<span class="token comment"># ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}</span>
<span class="token comment"># 本案例的DataID是:nacos-config-client-dev.yaml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ul></li> <li><p>测试：http://localhost:3377/config/info</p></li></ul> <h2 id="springcloud-alibaba-sentinel-实现熔断与限流"><a href="#springcloud-alibaba-sentinel-实现熔断与限流" class="header-anchor">#</a> SpringCloud Alibaba Sentinel 实现熔断与限流</h2> <h3 id="sentinel"><a href="#sentinel" class="header-anchor">#</a> Sentinel</h3> <h4 id="是什么-3"><a href="#是什么-3" class="header-anchor">#</a> 是什么</h4> <p><a href="https://sentinelguard.io/zh-cn/docs/introduction.html" target="_blank" rel="noopener noreferrer">中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D" target="_blank" rel="noopener noreferrer">介绍 · alibaba/Sentinel Wiki (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/2022/zh-cn/2022.0.0.0-RC2.html#_spring_cloud_alibaba_sentinel" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba 参考文档 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">alibaba/Sentinel(github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>Sentinel 是面向分布式、多语言异构化服务架构的流量治理组件，主要以流量为切入点，从流量路由、流量控制、流量整形、熔断降级、系统自适应过载保护、热点流量防护等多个维度来帮助开发者保障微服务的稳定性。</p></li> <li><p>等价对标：Spring Cloud Circuit Breaker</p></li> <li><p>Sentinel 具有以下特征:</p> <ul><li><p><strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</p></li> <li><p><strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</p></li> <li><p><strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Apache Dubbo、gRPC、Quarkus 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。同时 Sentinel 提供 Java/Go/C++ 等多语言的原生实现。</p></li> <li><p><strong>完善的 SPI 扩展机制</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</p></li></ul></li></ul> <p><img src="/assets/img/50505538-2c484880-0aaf-11e9-9ffc-cbaaef20be2b.be123c2f.webp" alt=""></p> <h4 id="怎么玩-2"><a href="#怎么玩-2" class="header-anchor">#</a> 怎么玩</h4> <h5 id="服务雪崩"><a href="#服务雪崩" class="header-anchor">#</a> 服务雪崩</h5> <ul><li>多个微服务之间调用的时候，假设微服务 A 调用微服务 B 和微服务 C，微服务 B 和微服务 C 又调用其它的微服务，这就是所谓的“扇出”。如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务 A 的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的“雪崩效应”。</li> <li>对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几秒钟内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障。这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。</li> <li>所以，通常当你发现一个模块下的某个实例失败后，这时候这个模块依然还会接收流量，然后这个有问题的模块还调用了其他的模块，这样就会发生级联故障，或者叫雪崩。</li></ul> <h5 id="服务降级"><a href="#服务降级" class="header-anchor">#</a> 服务降级</h5> <ul><li>服务降级，说白了就是一种服务托底方案，如果服务无法完成正常的调用流程，就使用默认的托底方案来返回数据。</li> <li>例如，在商品详情页一般都会展示商品的介绍信息，一旦商品详情页系统出现故障无法调用时，会直接获取缓存中的商品介绍信息返回给前端页面。</li></ul> <h5 id="服务熔断"><a href="#服务熔断" class="header-anchor">#</a> 服务熔断</h5> <ul><li>在分布式与微服务系统中，如果下游服务因为访问压力过大导致响应很慢或者一直调用失败时，上游服务为了保证系统的整体可用性，会暂时断开与下游服务的调用连接。这种方式就是熔断。</li> <li>类比保险丝达到最大服务访问后，直接拒绝访问，拉闸限电，然后调用服务降级的方法并返回友好提示。</li></ul> <p>服务熔断一般情况下会有三种状态：闭合、开启和半熔断</p> <ul><li>闭合状态（保险丝闭合通电 OK）：服务一切正常，没有故障时，上游服务调用下游服务时，不会有任何限制。</li> <li>开启状态（保险丝断开通电 Error）：上游服务不再调用下游服务的接口，会直接返回上游服务中预定的方法。</li> <li>半熔断状态：处于开启状态时，上游服务会根据一定的规则，尝试恢复对下游服务的调用。此时，上游服务会以有限的流量来调用下游服务，同时，会监控调用的成功率。如果成功率达到预期，则进入关闭状态。如果未达到预期，会重新进入开启状态。</li></ul> <h5 id="服务限流"><a href="#服务限流" class="header-anchor">#</a> 服务限流</h5> <ul><li>服务限流就是限制进入系统的流量，以防止进入系统的流量过大而压垮系统。</li> <li>其主要的作用就是保护服务节点或者集群后面的数据节点，防止瞬时流量过大使服务和数据崩溃（如前端缓存大量实效），造成不可用；</li> <li>还可用于平滑请求，类似秒杀高并发等操作，严禁一窝蜂的过来拥挤，大家排队，一秒钟 N 个，有序进行。</li></ul> <p>限流算法有两种，一种就是简单的请求总量计数，一种就是时间窗口限流（一般为 1s），如令牌桶算法和漏牌桶算法就是时间窗口的限流算法。</p> <h5 id="服务隔离"><a href="#服务隔离" class="header-anchor">#</a> 服务隔离</h5> <ul><li>有点类似于系统的垂直拆分，就按照一定的规则将系统划分成多个服务模块，并且每个服务模块之间是互相独立的，不会存在强依赖的关系。</li> <li>如果某个拆分后的服务发生故障后，能够将故障产生的影响限制在某个具体的服务内，不会向其他服务扩散，自然也就不会对整体服务产生致命的影响。</li></ul> <p>互联网行业常用的服务隔离方式有：线程池隔离和信号量隔离。</p> <h5 id="服务超时"><a href="#服务超时" class="header-anchor">#</a> 服务超时</h5> <ul><li>整个系统采用分布式和微服务架构后，系统被拆分成一个个小服务，就会存在服务与服务之间互相调用的现象，从而形成一个个调用链。</li> <li>形成调用链关系的两个服务中，主动调用其他服务接口的服务处于调用链的上游，提供接口供其他服务调用的服务处于调用链的下游。</li> <li>服务超时就是在上游服务调用下游服务时，设置一个最大响应时间，如果超过这个最大响应时间下游服务还未返回结果，则断开上游服务与下游服务之间的请求连接，释放资源。</li></ul> <h3 id="安装-sentinel"><a href="#安装-sentinel" class="header-anchor">#</a> 安装 Sentinel</h3> <p>Sentinel 分为两个部分:</p> <ul><li>核心库（Java 客户端）不依赖任何框架/库，能够运行于所有 Java 运行时环境，同时对 Dubbo / Spring Cloud 等框架也有较好的支持。</li> <li>控制台(Dashboard)基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器。</li></ul> <p><a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">Releases · alibaba/Sentinel (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>运行命令：</strong></p> <ul><li><p>前提：1. Java 环境 OK；2. 8080 端口不能被占用</p></li> <li><p>命令：<code>java -jar sentinel-dashboard-1.8.7.jar</code></p></li></ul> <p><strong>访问 sentinel 管理界面：</strong></p> <ul><li>登录账号密码均为 sentinel</li> <li>http://localhost:8080</li></ul> <h3 id="微服务-8401-整合-sentinel-入门案例"><a href="#微服务-8401-整合-sentinel-入门案例" class="header-anchor">#</a> 微服务 8401 整合 Sentinel 入门案例</h3> <h4 id="启动-nacos8848-成功"><a href="#启动-nacos8848-成功" class="header-anchor">#</a> 启动 Nacos8848 成功</h4> <ul><li><code>startup.cmd -m standalone</code></li> <li>http://localhost:8848/nacos/#/login</li></ul> <h4 id="启动-sentinel8080-成功"><a href="#启动-sentinel8080-成功" class="header-anchor">#</a> 启动 Sentinel8080 成功</h4> <ul><li><code>java -jar sentinel-dashboard-1.8.7.jar</code></li></ul> <h4 id="新建微服务-8401"><a href="#新建微服务-8401" class="header-anchor">#</a> 新建微服务 8401</h4> <ol><li><p>cloudalibaba-sentinel-service8401：将被哨兵纳入管控的 8401 微服务提供者</p></li> <li><p>POM</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-sentinel-service8401<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud alibaba sentinel --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos-discovery--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot通用依赖模块--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--test--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div></li> <li><p>YML</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8401</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>         <span class="token comment">#Nacos服务注册中心地址</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span> <span class="token comment">#配置Sentinel dashboard控制台服务地址</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span> <span class="token comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>主启动</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main8401</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main8401</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>业务类 FlowLimitController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowLimitController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testA&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;------testA&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testB&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;------testB&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>启动微服务 8401 并访问</p></li></ol> <h4 id="启动-8401-微服务后查看-sentienl-控制台"><a href="#启动-8401-微服务后查看-sentienl-控制台" class="header-anchor">#</a> 启动 8401 微服务后查看 sentienl 控制台</h4> <p>空空如也，啥都没有</p> <p><strong>Sentinel 采用的懒加载说明:</strong></p> <ul><li>注意：想使用 Sentinel 对某个接口进行限流和降级等操作，一定要先访问下接口，使 Sentinel 检测出相应的接口</li> <li>执行一次访问即可
<ul><li>http://localhost:8401/testA</li> <li>http://localhost:8401/testB</li></ul></li></ul> <p><img src="/assets/img/image-20240515222730444.4986b873.webp" alt="image-20240515222730444"></p> <h3 id="流控规则"><a href="#流控规则" class="header-anchor">#</a> 流控规则</h3> <h4 id="基本介绍"><a href="#基本介绍" class="header-anchor">#</a> 基本介绍</h4> <p>Sentinel 能够对流量进行控制，主要是监控应用的 QPS 流量或者并发线程数等指标，如果达到指定的阈值时，就会被流量进行控制，以避免服务被瞬时的高并发流量击垮，保证服务的高可靠性。参数见最下方：</p> <table><thead><tr><th>参数</th> <th style="text-align:left;">介绍</th></tr></thead> <tbody><tr><td>资源名</td> <td style="text-align:left;">资源的唯一名称，默认就是请求的接口路径，可以自行修改，但是要保证唯一。</td></tr> <tr><td>针对来源</td> <td style="text-align:left;">具体针对某个微服务进行限流，默认值为 default，表示不区分来源，全部限流。</td></tr> <tr><td>阈值类型</td> <td style="text-align:left;">QPS 表示通过 QPS 进行限流，并发线程数表示通过并发线程数限流。</td></tr> <tr><td>单机阈值</td> <td style="text-align:left;">与阈值类型组合使用。如果阈值类型选择的是 QPS，表示当调用接口的 QPS 达到阈值时，进行限流操作。<br>如果阈值类型选择的是并发线程数，则表示当调用接口的并发线程数达到阈值时，进行限流操作。</td></tr> <tr><td>是否集群</td> <td style="text-align:left;">选中则表示集群环境，不选中则表示非集群环境。</td></tr></tbody></table> <p><img src="/assets/img/image-20240515224410268.84f7f663.webp" alt="image-20240515224410268"></p> <h4 id="流控模式"><a href="#流控模式" class="header-anchor">#</a> 流控模式</h4> <h5 id="直接"><a href="#直接" class="header-anchor">#</a> 直接</h5> <ul><li><p>默认的流控模式，当接口达到限流条件时，直接开启限流功能。</p></li> <li><p>配置及说明</p> <ul><li><p>表示 1 秒钟内查询 1 次就是 OK，若超过次数 1，就直接-快速失败，报默认错误</p> <p><img src="/assets/img/image-20240515224818888.8f078c22.webp" alt="image-20240515224818888"></p></li></ul></li> <li><p>测试</p> <ul><li>快速点击访问http://localhost:8401/testA</li> <li>结果：<code>Blocked by Sentinel (flow limiting)</code></li> <li>直接调用默认报错信息，技术方面 OK，but,是否应该有我们自己的后续处理？类似有个 fallback 的兜底方法？</li></ul></li></ul> <h5 id="关联"><a href="#关联" class="header-anchor">#</a> 关联</h5> <ul><li><p>是什么</p> <ul><li>当关联的资源达到阈值时，就限流自己</li> <li>当与 A 关联的资源 B 达到阀值后，就限流 A 自己</li></ul></li> <li><p>配置 A</p> <ul><li><p>设置效果：当关联资源/testB 的 qps 阀值超过 1 时，就限流/testA 的 Rest 访问地址，当关联资源到阈值后限制配置好的资源名</p> <p><img src="/assets/img/image-20240515225135892.83c5c0c4.webp" alt="image-20240515225135892"></p></li> <li><p>Jmeter 模拟并发密集访问 testB</p> <ul><li><p>https://jmeter.apache.org/download_jmeter.cgi</p> <p><img src="/assets/img/image-20240515230122246.d1d70521.webp" alt="image-20240515230122246"></p></li> <li><p>大批量线程高并发访问 B，导致 A 失效了</p></li></ul></li> <li><p>运行后发现 testA 挂了</p></li></ul></li></ul> <h5 id="链路"><a href="#链路" class="header-anchor">#</a> 链路</h5> <ul><li><p>来自不同链路的请求对同一个目标访问时，实施针对性的不同限流措施，比如 C 请求来访问就限流，D 请求来访问就是 OK</p></li> <li><p>修改微服务 cloudalibaba-sentinel-service8401</p> <ul><li><p>新建 FlowLimitService</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowLimitService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;common&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">common</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------FlowLimitService come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>修改 FlowLimitController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 流控-链路演示demo
 * C和D两个请求都访问flowLimitService.common()方法，阈值到达后对C限流，对D不管
 */</span>
<span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">FlowLimitService</span> flowLimitService<span class="token punctuation">;</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testC&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flowLimitService<span class="token punctuation">.</span><span class="token function">common</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testC&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testD&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flowLimitService<span class="token punctuation">.</span><span class="token function">common</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testD&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>修改 YML</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8401</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>         <span class="token comment">#Nacos服务注册中心地址</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span> <span class="token comment">#配置Sentinel dashboard控制台服务地址</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span> <span class="token comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span>
      <span class="token comment">###添加以下内容###</span>
      <span class="token key atrule">web-context-unify</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># controller层的方法对service层调用不认为是同一个根链路</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul></li> <li><p>sentinel 配置</p> <ul><li><p>说明：C 和 D 两个请求都访问 <code>flowLimitService.common()</code> 方法，对 C 限流，对 D 不管</p> <p><img src="/assets/img/image-20240515230658785.a0af7f98.webp" alt="image-20240515230658785"></p></li></ul></li> <li><p>测试</p> <ul><li>http://localhost:8401/testC</li> <li>C 链路超过一秒钟一次后，就发生限流</li> <li>D 链路 Ok</li></ul></li></ul> <h4 id="流控效果"><a href="#流控效果" class="header-anchor">#</a> 流控效果</h4> <h5 id="快速失败-默认的流控处理"><a href="#快速失败-默认的流控处理" class="header-anchor">#</a> 快速失败（默认的流控处理）</h5> <p>直接失败，抛出异常 <code>Blocked by Sentinel (flow limiting)</code></p> <h5 id="预热-warmup"><a href="#预热-warmup" class="header-anchor">#</a> 预热 WarmUp</h5> <ol><li><p><a href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8" target="_blank" rel="noopener noreferrer">限流 冷启动 · alibaba/Sentinel Wiki (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/image-20240515231609246.12920f3e.webp" alt="image-20240515231609246"></p></li> <li><p>公式：阈值除以冷却因子 coldFactor（默认值为 3）,经过预热时长后才会达到阈值</p> <p><code>com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController</code></p> <p><img src="/assets/img/image-20240515231726654.b9babcbe.webp" alt="image-20240515231726654"></p></li> <li><p>WarmUp 配置</p> <p><img src="/assets/img/image-20240515231829986.556103cc.webp" alt="image-20240515231829986"></p></li> <li><p>多次点击http://localhost:8401/testB，刚开始不行，后续慢慢 OK</p></li> <li><p>应用场景：如：秒杀系统在开启的瞬间，会有很多流量上来，很有可能把系统打死，预热方式就是把为了保护系统，可慢慢的把流量放进来，慢慢的把阈值增长到设置的阈值。</p></li></ol> <h5 id="排队等待"><a href="#排队等待" class="header-anchor">#</a> 排队等待</h5> <ol><li><p>是什么</p> <p><img src="/assets/img/image-20240515232034627.a6bdb641.webp" alt="image-20240515232034627"></p></li> <li><p>修改 FlowLimitController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testE&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;      testE,排队等待&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testE&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>http://localhost:8401/testE</p></li> <li><p>sentinel 配置</p> <p><img src="/assets/img/image-20240515232816025.19519233.webp" alt="image-20240515232816025"></p></li></ol> <h4 id="流控效果-v2-并发线程数"><a href="#流控效果-v2-并发线程数" class="header-anchor">#</a> 流控效果 V2（并发线程数）</h4> <ul><li><p>sentinel 配置</p> <p><img src="data:image/webp;base64,UklGRmQdAABXRUJQVlA4IFgdAAAQqwCdASqRAmgBPpFIn0wlpCMiIRIaALASCWdu4XVQ9Fg1OdQ68OvmfEngo9BX+z9JjoNf2T0Aecj6Pv9n02n/X9iT+h/7z/////4Fv1N9bf/0+zJ/jPWG/cD1AP//wUnlf+8dp/9//sHi7+LfKf2/8wPXrxT9Nuo78e+3n8D+2eePeD8CvmP2Avyv+Uf8D+r+NX/af1v9sfBt0j/Gf9D1BfVP5h/tf7/+WXn8f0n+G9RPzj+0f9X+9fjT9gH8p/cP1b/zXgU/bv977Af89/tf/k/xfuq/xv/c/zf5S+0T88/zX/v/0nwE/zT+yf9r/H+297Gv3T///unfuF//xJWuIWWKzLbHyaBalWGEnN8SrEKqtc6OrAiem6Jn94ij7qo4pnBVcXjqJ/xJY9RP+JLHqJ/xJY9RP+JLHce8nFbd0DE/weqGPPB8lkh7xSfCWBA4Y8udzl47ugJ5dsuivLcwDwI0w9u5WhjvlwTwkww2XsSWPUT/iSx6if8SWPUT/iSx6hb5dUNkkk0/iHRWtt/xJY9RP+JLHqJ/xJY9RP+IdEzisxH8BunFZV049wGiHEAXT7WDl6yVRsLnecXzCIF7UXA9ZXUaYe3crQw9u5Whh7ZOpafspkHRkaIxj/EOtWN2iLLu6VApmAknLzMTvhM/jdizc96/w8vYkseon/EljviqIn8QmrA3PSN+A4UMLxdo02zabJUhFVWBt+IIKkRgepSwxNvxBBUiMD1KWGJUMgKI6/riFyUYfEliamhYx9kRwpeyedptUD6j4U64pFALF0jA3FVmU1LcHOz3yT9OGtFXktSi37Ap1231aYI3nh2AwF3ab3dMWovXGTdXYDTxN0Y1gnFptU3fSMBn+H8NV14dYRt/SqsDcuhqiqrA2/EEFSIwPUpYYm34ggqQ/6BsIEjrNMJDQd8KGF4oBWMpOCGAmYiD1KWGJt5bK7I1D3H8BY2UnCKetmP+LsQOMYNutMcHGMG3WmODjGDbrTHBx4ZlRo0+igMP9cR8OI5QkSsWrypLly+037WEyXD+pOfzVnGkejs2Gm9GizqIbl06uUlQCZS9FXDFi3Q8SSesLtiOKWm4LCccDzBCSOKjAb1LxBXGfvsGlPUXQFx+h5F7+GrxWa3o/2rvoh9DVBrRNugeRw4x/ghrZEpG10TIqxst9tX8lJlQdRMalqlmJZK5G+DUxTwqiWY5hY/hTQJwr2VRiF7BDI9wlD6aL/pR0WbWsPHv9Q8iKqmGjf1JroYqLOjei7l58eHk+ZzonaFOdM4qf8KuPN3EHv/nz2GdjZScIuPqJ4UWOH74UMPbwnxhjIyqqwNvsD3UiMD1KVUpt+H+4YRgepSwxNZo+yUoVS4u5AmgTSniAxKCUmSiQWseptylHP/XR1ncGz1nDQ3dLTlgsxgn66yWIFc8wT9dZLD7VWwPyjniQKGXRPPKgpS19HOV5bmAeBGmHt3K0MPbuVofLo1sPbuVoYe3bx2xYTFzgmRn69ytDD27laGINe1/t3K0MPbuVfO+NCRKhrGNjhlJvzgD7GmpZ/bxdZ4h1rH4dXluYB4EaY73uLtl0V5bmAeBv5kiyeXbLory3MBFRBG/w8vYkseon/Elj1E/4kseon/Elj1E/C+DVsYzCBGmHt3K0MPbuVoYe3Orv2Nhbzl/Pce5KRCcJBnAyFmHt3K0MPbuVoYe3crQwq36OEHraepCW5ISQS5HWbw5PNOBANvnKmLxO2wqLXlsYzCBGmHt3K0MPbuVoYe3QMeIq1mXzeJXWUoNQ5YWT5PDvdxZvQLIcbS3oJtg0DbU16GHt3K0MPbuVoYe3crQxZ4cyYXPlcAA/umfp2sPfyvj0KuoK1raL71dFCHU+/eQuzwbOzarHWthc9mCqeZp931LwK2/6loZ4tWJ81nHh43Dp7d2NVYZFYKnyLlYYfF+G/0wGrPMRYCDvdTopofox1qjeb+eO3AJ4QT9bfVud3D0fCABTJm3RpQ0QRLvvAREY4otbikLwiGbJUsPaXn1YpZa8KiT8jSuYxC5cBTes/j5uc4+/DuOVgvJHicWCn4R4/5tFmQrHjdd7IT0p/pUi1PL+mcc3k01VKDshAdiF+NVHrZHdKS62zlANxl/7B1Lyq7YZPXwT0bhP0umpkAvadQMunQ0rabPgyGwNyM483eQcgfawzM3CL178ML969L9qdTuPjTn+SVkYDcosriw0vWz1jtlkI2x27jxeEwRpuUxYTNGKIIIn5/+/vAYJ7/JHDguh/TKWPCRBETbgoSNl5Drqbh7cq73InWFj9DNMV7bnYfr5bIrJBPvuKPl4QxekiGbIj4a3QdycSzplkC1kS1EkYDWopTQFnb+ekgjVWdGPXbBNX3BcLezl6Hg+UgdiYYMsj2QS4JQQaYHN784yK8XZZs3WEw8sqoMib76yngbGAByw0Uo0dheso7x3nkjlFhAykQKkmAZ9oAT1epQtsKCAA75tQ/9j+LojXFaM/pqhOmGahtF4tH7to9TsHzUuz1CFAmQKjRs64tctUU8St9ivryhK4kRulG7JeT7037xyB4dkp1j1SR6Q520EarHdLyLyTiKffJz8OBqA3uhV5xg8QKisHFg9c15SEJ9xuwqDYe3dulKygA3qfFEuItQ6meUMdPcAjy770s0Rx5GZ6lV4hTiL9DY5lzFxetvWvKzDtyUDw4uO8mROEg5xe57ZtOR00+r1XVxbivy79lIYv4tncFgTM8h+H7fgIjgrHuIjF1ct09cuNMYK+Cq7Ds11ocS4sl0umx5Rxv+HOj0AAABPbkUB/D2uvRK2OSRfnEr4AAAA4Qb5bGWGcaF99gAQQ1emyaWDtSlwBuAAAyLkwOWCQ47PX8bn/zfKlk4yd3inOVK4ZKiJR41EPK/7n3TDKHMeSRvQpz/WL4V/0nF9Mf5Skl/rcYPW4MoTTNdUz+KVoksJFaZDt76bwqTxA8FxOUliT9pUxNSaL0yq5CR+qmqrwCn+1F177v2KBwnWntTEadDxs+fO8/+hS5xg8LVuP9qoD9dx4dcyvoBsmkAHrI0SnoPEtoi6+aULJ5mOcg/pedyIiqnNhV9QiEGAD7VzklzjHu29fD0PWIIIhJ/4qcb6Kvh6qmI69UGPcHgs5uu+TSqoGkIW20S60R8lry/Ah0kZbFlu7EJPU/3lw40pqpKmi8ArBTcgXqpCEWMF6CVsDlHXSt/6WH2G3L6beZQ93NGlWYTO1mX1xS0OjJEaVFEJfqlF/5V74IABI4e5Zp18giIs3zc3i4zyivTU+BJ7cmQUY0lO4HS4n7kHh0VxbLfUs9w+W1Hv0UGFbHW5/QPgfMtnDP/R7DVGJE7UyW8TYvMOokaoukmT4nwYnH0qP6X9U9FAh/ophmA6f/kQ/ALR57/qTRBzyR/f83SC4q4gnK8bQw4GYcHdNMqg34wK07j1m3N597K8bZGaNE/nZI/A8TiUVnJAZATx0eRhhbAKomhYnEgbO2F/Zn0/2IQfwifIHS6pQimcqFG0/qjLss1AO34qwIpSW8c+cr8HN68SZE5pAM4/RjxSgzP6+wGQX5vgaeXH/xpmhI0BVzgAOjRCY3x3TEQmy86jMQ6mjkEc5ypLGaKwpwjACM282R3trxuXg/Fy5j6ZVxdi774vO7i0tst7Y66mFk/AFLvI3XUwsn4Apd5G66mFk/AFLvI3XUwsn4Apd5G66mFk/AFLuhk6oXSlgid8rwYQZpnLix66VZlno3l3xJXOact1tSVbVsuV47lGNaqJ3EHk3OWDL1UX+AuvJ2RP6h/mVU9YVRvRAfKdV2rbbrW1BnegqF+MS1NBJbA50BEsZWkBgvlrt4f0Hj0xing64L4KjY5wHclIGC0YXpHUngklJ/r6lFhpqfo6fErGNbPT0qM2QQFdPqSBnMYAqUrPMyBLAWV+poMUiLkuYA0RNkfAZWCd/XFd9jh1cjEu9S3ozoeknL7+obxNNeVQlmbbHcoW3HO+DBCUr8S9cjkudqoMLuXPbezzI9dH4wa2Jis43gs2CLdI4oCe9boQJmwbX6vGusmmAhx0qjcOJTUWuABxkxmBwZVsVxi3+0eVGN3oHkP89RX1UoQj7FBV1VTBMiE1O2G2WzchOQHaYuXf82EqBLF0gyekcznOYaowUaooVveL0zLZvzkI6/gt94F8hsCx6jnPlkZLOTplI2ZT3e/r0PkRg4LkgCIR4fe2SocwHiX/sza54sFKRZXAEmKt0VXSWEgs5U7rBPakKkKUA22XozOMDIHrMAaD+IjtDE9Boi1rOXLGd2wAAAACeVkvdAwSvRYPX+X4sa4TfYMWHTaibftxKb2MmBUnvwr1VL5GzN/3caSem5dpNAaz/DULxzCdYA3185Zku+OR3uyo3j9sW3E8po6lL1JWUHxKtbpXuLNJCvh5oq63DFAY2LBuKMyT7WfLiWQNN/d7RWv9+jJIVySHCFAqPx42hFPFaYCIeBQO45dlMwXMYIZuthofqZSe3bTSKliKtAmknmNslGTDrcmVlba1j/MEH11ARIDlKhPqL/xg+dSBPnKkB+9toeI0FdFtwHkvQ+ivLMOB33Bd3uv5o2VHCmiMrqCJTAVFHgT1tIsOTKocU3YUT8ab7tqL8gF7buOTXsvcpH9QvZ0C3bqDh+mY2YRHE1yCF5Bt7/WjgqWmfqVRsaznT3ZbXAHld0xxlqkf3/uV/aP/MVMx/3rc5s2nNhQweZqpWLiebmjRbjyuFEmtx5XCiTW48rhRJrceVwok1uOuqM3WHQLnZoJHuGB7AZmw8/bn2y53du1JqAwRd0DTYIW6iGHPDvkS6JRT/Kcr7f/79b7qvx5Qrz+NDzp/EsWLGBpZHg2jD6EdNhsDdZRtgxiSlA2u5JrlVUAusFzzAVuu/24IOULJ1NdkgWKZ5uReqUmRXiEwM/MUSkU/ebkR7lafKpncZr86/wk3t/nX+azpqTWELOWxQJEwn3i9GuO/XpUQHuTJ1MsfIKruwenimfPg6gvLVJRRdsjghiq+g7jkf+ntGGnz5bsnchdeZjpwHGvrIjaZCSUve2shkUwFU0JqzRR99qYSIx+Cd3tQ0DlqDK4dWMCBrSuLY5qmXEeWww8o9LEA13PIHS9N01NJlbQrIo8DOxyr2tPgFb/6dU9LqZQ8c8T2tSElfztJ/9WN/q+vrtj9WNAyLxBzHGRZsaTmwqXj2OYmJXvy9tH8oWrFPcqB6DFOg9a77RW/cw5JYixU8UpCUZVproUQePO8C816B8Sw9cC4OtlU53mJbTuAeYiBzt7bRDgDfBhNnhQo/2T+/LCFjhexfJlcpk9ZXt/hpFOXzFOdIdQceTPpde7sHPTSpOzgUCxQ/m0ghRnsLq5l3n6AL2bEYVsf95Yo3i4fFyj/Vh+WrBAIm2pyTnQqzBHg3ZmyQR9z7JSAHYdHzVo95sJQyMTqpyxZG8TC0t90UL0k/UnV6b2J+ZRhljDFak2mDSJYkLgCqzKh65jhs4OmWAI5mL5znR2VApTZHi1HZdZPqC0Bs020y/8+3WvCEXWOAdsQOCtDgDJMIHxDxJP3wOsZWKU4zK2WJu1yUucgMP7GHpe16WgB0X1IxO/lokdOKAJMRE+MDsaSOed2mYIxbnpkzDTO/lpzZfPrL+dusQF0cgjVkGoiWK+/AdzTHhMK5xb3JJpb8JICpaIiIbMWjsZH1rl/3DTY3ouEp4pqBkHx5heaPAYjLqS6QksQ98CaaP7CYBo2hUkJoZCXpsYKDqCGs5GmgBtcyfYEhrcQld5BAiEEcAUhSgI+VCWY91tEoMiAVw9xhO15pptun7itGuOvdfkmjlLY4+QdI8vtVi/DtG4OL4B12p+AGeHt0y3djznVVnyNut0oaoqF7+O103GXaIKnx0QEzxHv/MQSxgr2WCx0HPir2m0FAAQQxc7xZssk6NdewuZHBjYF0uAD0sJYDGGqjCIjTgjM3vqFA7kZfdnQgrojhvF5yNHb4x22ZsKMVj0lFVo5Oev3sWCPYq7Qiu6ctvgaqG2RFuPAHef7KAcKcuWzSLNH4ViY5/wrtO0dtL7UsrlB9hsHI/NUC7cL59o888+fVRekiYjzp/e/9k80XCJ0WxeVUgjHjDltefEvnNxiuhsBfmznoYOKictV512YPD/Icy4NzjCUeWIC4OxvuothQdzGs7kyb7YtUUdVP72BV3ob+zvhAYlaMRCGVOmuUj1BkrfZrMNeW0f6KUPMbEKV7C+g1QPsaGeDYQKU0tmiDIlWe8T5j4E5n+ComCEbQIPZU4a4PMdbSGf/z4JN/5+zRW3d5eTml2N5FcvIbbHhOFA0COFZZSoi2o8PrQ0SHdgKTnMWbQPDS9rwynKhkXynNR5NQI5xKYPbJwVUvii2emWIRb3pdEstWTk7Egdp+eZBgSl25mOSdlhIR01w0dBi3qElQavF+iZ9SsmpXgS+jjI+I/lRXLM944SelKV1m6i11oYdK7pR6Icnsx+8sfKgWWHCr6zm6k3XGNmcoVrl8JT+DpXMEQDNDbb8uufsef+TO7i/3eOZCp1nVXpG0vcUj9BY5zlYrlxHrt50arqMrt+dUYupMoZZAbEDlLiW5YIdzbF+0FJ5nZyDzAxrtHMeJmgl4MleytuMVkZy1NlSfH0DQJdFFLR5IBZBN1MZ4VZHBOB/jEdf5tajoYxGzPjcPS1RSobs86rEP3ofH0/VWQcO/fgXl/vEdTxLLo9qPjl71MqLlWj5X/j0r6sNOalwnqd1Pk+lLP+oF7ZFZWC8vn0k/59z8tK14c+tA57MA3jLO8cQu6Jp4w7SdFNZfEPqw8w4qzSWwhJG5m9B/eiRgw78JKS2gg5fDoq/FlCQXNh8MSv4t7sr+8G6kSEB85SC7Qat1yKE2lksNCGRYHkqTfYJ2BxujG4R5yQfRtygkV6NeiKASF9cUijmAvY7Lu0aZydzrleyITG2Wt0kjGbxIIx6kX4YVgy9BEBnwjINuSMZ9rEIvBvBqNucugl8okSni2At7ll/BzGjJyE9CrxwH6MIAtyGK6dyvpTrCUpEcpoh5Fg26kXd2P9YWjpKyYi7GX6THL0c+j+aHzFfdjK5myuAaoSZWTk86JGx+PAhDpbiYLRptkQ/EjnfJHND4E5h8y8QZxOmTmhwR3q+Yif6bagq/8RMMogFKHwHT2U2w/+uzKzGfivlHBEHyOk/CwDDEk/iiRCo3J01v8MzRNwyzq2EFqKIcI1N5OXEQbqRXAB5wYYNJgt2t2uKGWb81lvRhB9D6cob3MnTszXPmgY0p76EnaEbU+WtJamYLXPGoqoA0XBnJsH5nvRLxL1mw5bMDF4/d6dsXKMePL+jXocSjjlN2wTjL0Ltovfp1vjjRMjy62l3w5zaxaW9Gj+R/3ybpDcvCfz3WE3KIKEq9IVz/7BQBaEbPgWasA3F+vH9SWJZKhaHhwFzLCQPmJAoGovw7FXfc/2nMHidg+0H3XxPxDlhOP5YdGDt8ewUddAlikuejT9KWbHfL6ZO6DGCAau5PictMGYjnBZvRmPZFzsI06TYGUrEyMLd7f4Q5LDNSk9AYQNjR6THCTW9favKd+YKX4d/8lurKmfXO2zlOU31oQDJUwSM+gmOT4QE02aMjTypCamEdY8GBgAsgQfHOVN/rBzVSJhqAVC09ZnYEstIYSJRQ1pvJbWWFjnuk9B6wfY1yNNvTsmaWux0Sn3U5wCJJ7GFUvJbohgUS4GrmU9fdtaLr13azMwBGR4lytY/oB/DSIJ5pj6gJSltNsBH+8gtELhP5FOOQq//tH+cp1R4KdLs3Fh1NnOPIWb6Ffsxpe7EHR+6hBUUPFFQUaJ/dhgDwMUVQ8yv9c7yuYMxjGiL20rE3KTw1Yi/90wKzi61Y/4cgrNzgp/+Cm3+J22kIcHzf+SXGkEA4ak7mN4n4MwScNzktQwo6ZVVItytuTz0LjJxKVO3xeOC/ubluyjxGQYHIvUH9RDr9lhKeajouixRT/KLNT+Q1b2h6zQvT8ysDYjy6zFn/yYav+58mxcGhHnkNgcarGI3bYtz6aZgTVdwv/VelGayz9cMYZrMkT2I2UpwIPxaA5vk4WjnHeMUchKPGaF1swHBjoSUQ0hdLcZP2ioOnY09fVEthwVDiEgGy/N0C0bsDWQoTxppe+6PIjYE7TEo/onqTcaW6k9U7lWjDEGDQl2fE2LbsjZkMcsQYkXoN48lmekWmDEHZlIKPxf2MPYBoTBvQktHqkJNaNx7EazgTKRDFAbB7thvKUaLO43NM5kj4DXMpHZCkFURY6DlweQPxiwjVPBkoIiedjRkvNJ/+TyX2wTkXJMisjfgB+9AAAAAAABI0npTPLic1yrDBfkYQJGxJ79H/BqoHtpswmlhQIHfs6wa1v0M8R9beyjf/b2icpJeSm4x4jxnP8FNs5HpR2Gv0iZw6mfCfpzWM9H4DTSXj5V11pGTP/3KakJZcNX3c60+hCVtrBSA2W2YBACQfeog7KMzFdGpD/z8mEvKVtvwAAKVACKuhW+StEe3r7/hNj6quARNVwT2LsiuYoodnxMhm2LrfZxH8VOvsVHsSw/15rCemPBl/AgCpSRj2pUm7jrvxKAVhOrldx9OMjs6SWCfTpMFetElXrQpujn4ER7TFia2Psj5qeA4GJtrT3/4BYtqAFXUl4FgRhbPgtSR2AUBAuejsKYxtJSc74QQRvelsSA3AAAZrORcMFAGgAczAKE4EoV4hsNuz2mVq7C4YzEUVRCfmjKRaZInVTgwOtV1Mun64GHb4o2BnZ2vrVQqdJveo81hQTFGeGnUQlYkrpWc/7Sd3jYtdLql4cdrroTZbycxztEq0Lx3j4Tbbu4DfUxwVPcnQcrCdzhj3xwLxTvLvbGcidXT9HTJw50YAslB+ctDtiaKEPh2usVAEy5Apwj2Elet9uNIUOOHXQAEEvMRQglbYnbPN18x8Qho9xYt2HUfeSghZmUOyaeXtzkxyfKwU5HwJ9KS6ryxfLDM8P44U31JENuzVsMSPRkwRsStm7VbvXwEL4uONTfaWfo43++TxFCrXtHKsfyHEgs8nPdYfNz6zm0GCLjbph8J5uv3cwpokD6kcX7jBgNcnm9D2B6oRjVXwXeu/DAAFilm80H04sVws9FOF1qYfNnGiMSCXjIcue/eCr5H6iQi35kiQAL9QAAAAPcGBRjP3x2AAAAD+cAAGUn6C9c55NIqB+r0vXEyjN3YklGCBnjuCThcAQolzYBZi6X/Hdyf37KdFRKUhpSOK87Tt21dK+zQAzvagMK155ZM9gb4DTTFA2j5r/uT3p9f/2oAACfRTLQZTW5x4MsDRVOw65nctH0NbV3obov2BW+0TD054hnmtadUyRVbmPvy2pRzom247TOXXz+twu2JSQMsSroXloLvV32pVThuS1LzEOIKjenrsrJ3DdcCep2+c+a0n9+VyfUOVuckupEQEdUpdNU5LLCjrdrd9vqKY1bLv+br35stgMfoXMtT2b2tbB+X2Fzy5ZSZHLsd+7Sb7sEHolLAQYcjzF64euRmdYOPODhzG56ychI+e4Ov+71/rceH3ayJGfla7eZj4JE88dUi56/d8PCCSFCEbc8Hci9hOKUVRLOz2GWHPpm5x0g7iwTYWOaZ1DwLiAMczT3n2DZL9U2IJcLaW452M5xhSDjZDqaADjVMzrD0BgF5INJKte0S8F4e6dwFTS1Tsz+9JVo1mQPaXLyiAPXkgmDZcDDqLe/07rOW/iaUea54C8W2GRBWrwFiZUcgjIwi/njeCjSqhSxM2sBpwAANs47+vG4L4X056B+k1nJLrjCIPPC9m8iK+v4Rfd7dcua3EnTmEIgGS8aQt+hxeIhIgwe1TupCO8t1JMMDGVcZYzzuRe2AWLqZeOX4iWObpX52Igve0c6MI7l7LgBtMVKDPPwAZs6FeMujCM20lvlHiMK+Q7KpwTTxaB0Z7U6TGB6jbRkXknPWXR5h6wb0Ci+p6MxCOlf6xrLjFUoAzw0vbCSPrO2FItGFENGhvq8kAeyXBqgAAAAB7AAAAA=" alt="image-20240515233743492"></p></li> <li><p>Jmeter 模拟多个线程并发+循环请求</p> <p><img src="/assets/img/image-20240515233802894.c7fa7728.webp" alt="image-20240515233802894"></p></li> <li><p>http://localhost:8401/testB</p> <ul><li>Jmeter 给它打满了，大部分我们自己访问都不好使，偶尔 Jmeter 线程切换系统判定没访问，我们自己的点击才有点机会</li></ul></li></ul> <h3 id="熔断规则"><a href="#熔断规则" class="header-anchor">#</a> 熔断规则</h3> <h4 id="官网-2"><a href="#官网-2" class="header-anchor">#</a> 官网</h4> <p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7" target="_blank" rel="noopener noreferrer">熔断降级 · alibaba/Sentinel Wiki (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="基本介绍-2"><a href="#基本介绍-2" class="header-anchor">#</a> 基本介绍</h4> <ul><li>Sentinel 熔断降级会在调用链路中某个资源出现不稳定状态时（例如调用超时或异常比例升高），对这个资源的调用进行限制，让请求快速失败，避免影响到其它的资源而导致级联错误。</li> <li>当资源被降级后，在接下来的降级时间窗口之内，对该资源的调用都自动熔断（默认行为是抛出 DegradeException）。</li></ul> <p><img src="/assets/img/image-20240515235253046.314133bc.webp" alt="image-20240515235253046"></p> <p><strong>Sentinel 主要提供了三个熔断策略</strong></p> <ul><li>慢调用比例 (<code>SLOW_REQUEST_RATIO</code>)：选择以慢调用比例作为阈值，需要设置允许的慢调用 RT（即最大的响应时间），请求的响应时间大于该值则统计为慢调用。当单位统计时长（<code>statIntervalMs</code>）内请求数目大于设置的最小请求数目，并且慢调用的比例大于阈值，则接下来的熔断时长内请求会自动被熔断。经过熔断时长后熔断器会进入探测恢复状态（HALF-OPEN 状态），若接下来的一个请求响应时间小于设置的慢调用 RT 则结束熔断，若大于设置的慢调用 RT 则会再次被熔断。</li> <li>异常比例 (<code>ERROR_RATIO</code>)：当单位统计时长（<code>statIntervalMs</code>）内请求数目大于设置的最小请求数目，并且异常的比例大于阈值，则接下来的熔断时长内请求会自动被熔断。经过熔断时长后熔断器会进入探测恢复状态（HALF-OPEN 状态），若接下来的一个请求成功完成（没有错误）则结束熔断，否则会再次被熔断。异常比率的阈值范围是 <code>[0.0, 1.0]</code>，代表 0% - 100%。</li> <li>异常数 (<code>ERROR_COUNT</code>)：当单位统计时长内的异常数目超过阈值之后会自动进行熔断。经过熔断时长后熔断器会进入探测恢复状态（HALF-OPEN 状态），若接下来的一个请求成功完成（没有错误）则结束熔断，否则会再次被熔断。</li></ul> <h4 id="新增熔断规则实战"><a href="#新增熔断规则实战" class="header-anchor">#</a> 新增熔断规则实战</h4> <h5 id="慢调用比例"><a href="#慢调用比例" class="header-anchor">#</a> 慢调用比例</h5> <h6 id="是什么-4"><a href="#是什么-4" class="header-anchor">#</a> 是什么</h6> <p><img src="/assets/img/image-20240515235522311.10b9bfd2.webp" alt="image-20240515235522311"></p> <h6 id="名词解释"><a href="#名词解释" class="header-anchor">#</a> 名词解释</h6> <p>进入熔断状态判断依据：在统计时长内，<strong>实际请求数目＞设定的最小请求数</strong>  且   <strong>实际慢调用比例＞比例阈值</strong> ，进入熔断状态。</p> <p><img src="data:image/webp;base64,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" alt="image-20240515235657452"></p> <ol><li>调用：一个请求发送到服务器，服务器给与响应，一个响应就是一个调用。</li> <li>最大 RT：即最大的响应时间，指系统对请求作出响应的业务处理时间。</li> <li>慢调用：处理业务逻辑的实际时间&gt;设置的最大 RT 时间，这个调用叫做慢调用。</li> <li>慢调用比例：在所有调用中，慢调用占有实际的比例＝慢调用次数➗总调用次数</li> <li>比例阈值：自己设定的 ， 比例阈值＝慢调用次数➗调用次数</li> <li>统计时长：时间的判断依据</li> <li>最小请求数：设置的调用最小请求数，上图比如 1 秒钟打进来 10 个线程（大于我们配置的 5 个了）调用被触发</li></ol> <h6 id="触发条件-熔断状态"><a href="#触发条件-熔断状态" class="header-anchor">#</a> 触发条件+熔断状态</h6> <ol><li><p>熔断状态（保险丝跳闸断电，不可访问）：在接下来的熔断时长内请求会自动被熔断</p></li> <li><p>探测恢复状态（探路先锋）：熔断时长结束后进入探测恢复状态</p></li> <li><p>结束熔断（保险丝闭合恢复，可以访问）：在探测恢复状态，如果接下来的一个请求响应时间小于设置的慢调用 RT，则结束熔断，否则继续熔断。</p></li></ol> <h6 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试</h6> <ol><li><p>代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 新增熔断规则-慢调用比例
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testF&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//暂停几秒钟线程</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----测试:新增熔断规则-慢调用比例 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testF 新增熔断规则-慢调用比例&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>配置</p> <p><img src="data:image/webp;base64,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" alt="image-20240515235657452"></p></li> <li><p>jmeter 压测</p> <p><img src="/assets/img/image-20240516220017968.77c5c83f.webp" alt="image-20240516220017968"></p></li> <li><p>结论</p> <p><strong>假如在统计时长内，实际请求数目＞最小请求数且慢调用比例＞比例阈值 ，断路器打开（保险丝跳闸）微服务不可用(Blocked by Sentinel (flow limiting))，进入熔断状态 5 秒</strong>；后续停止 jmeter，没有这么大的访问量了，单独用浏览器访问 rest 地址，断路器关闭（保险丝恢复，合上闸口），微服务恢复 OK。</p></li></ol> <h5 id="异常比例"><a href="#异常比例" class="header-anchor">#</a> 异常比例</h5> <h6 id="是什么-5"><a href="#是什么-5" class="header-anchor">#</a> 是什么</h6> <p><img src="/assets/img/image-20240516000205055.b718b431.webp" alt="image-20240516000205055"></p> <h6 id="测试-3"><a href="#测试-3" class="header-anchor">#</a> 测试</h6> <ol><li><p>代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 新增熔断规则-异常比例
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testG&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----测试:新增熔断规则-异常比例 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testG,新增熔断规则-异常比例 &quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>配置</p> <ul><li>不配置 Sentinel，对于<code>int age=10/0</code>，调一次错一次报错 error，页面报【Whitelabel Error Page】或全局异常</li> <li>配置 Sentinel，对于<code>int age=10/0</code>，如符合如下异常比例启动熔断，页面报【Blocked by Sentinel (flow limiting)】</li></ul> <p><img src="/assets/img/image-20240516230031543.e53f9054.webp" alt="image-20240516230031543"></p></li> <li><p>jmeter 压测：修改调用请求，其余设置同满调用比例</p></li> <li><p>结论</p> <ul><li>注：将全局异常 Handler 关了，否则看不出效果来，都会被捕获。</li> <li>按照上述配置，单独访问一次，必然来一次报错一次(int age = 10/0)达到 100%，调一次错一次报错 error；</li> <li>开启 jmeter 后，直接高并发发送请求，多次调用达到我们的配置条件了。</li> <li>断路器开启（保险丝跳闸），微服务不可用了，不再报错 error 而是服务熔断+服务降级，出提示 Blocked by Sentinel (flow limiting)。</li></ul></li></ol> <h5 id="异常数"><a href="#异常数" class="header-anchor">#</a> 异常数</h5> <h6 id="是什么-6"><a href="#是什么-6" class="header-anchor">#</a> 是什么</h6> <p><img src="/assets/img/image-20240515235916826.90f00e97.webp" alt="image-20240515235916826"></p> <h6 id="测试-4"><a href="#测试-4" class="header-anchor">#</a> 测试</h6> <ol><li><p>代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 新增熔断规则-异常数
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testH&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testH</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----测试:新增熔断规则-异常数 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testH,新增熔断规则-异常数 &quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>配置</p> <p><img src="/assets/img/image-20240516231142285.285092e6.webp" alt="image-20240516231142285"></p></li> <li><p>jmeter 压测：修改调用请求，其余设置同满调用比例</p></li> <li><p>结论</p> <ul><li>http://localhost:8401/testH，第一次访问绝对报错，因为除数不能为零，我们看到 error 窗口；</li> <li>开启 jmeter 后，直接高并发干爆他发送请求，多次调用达到我们的配置条件了。</li> <li>但是 jmeter 开工，上述配置表示，在 1 秒钟内最少请求 2 次，当异常数大于 1 时，会触发熔断操作断路器开启（保险丝跳闸），微服务不可用了，熔断的时长为 5 秒，不再报错 error 而是服务降级了出提示 Blocked by Sentinel (flow limiting) 。</li></ul></li></ol> <h3 id="sentinelresource-注解"><a href="#sentinelresource-注解" class="header-anchor">#</a> <code>@SentinelResource</code> 注解</h3> <h4 id="是什么-7"><a href="#是什么-7" class="header-anchor">#</a> 是什么</h4> <ul><li><p>SentinelResource 是一个<strong>流量防卫防护组件注解，用于指定防护资源，对配置的资源进行流量控制、熔断降级等功能</strong>。</p></li> <li><p>@SentinelResource 注解说明</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SentinelResource</span> <span class="token punctuation">{</span>

    <span class="token comment">//资源名称</span>
    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//entry类型，标记流量的方向，取值IN/OUT，默认是OUT</span>
    <span class="token class-name">EntryType</span> <span class="token function">entryType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">EntryType</span><span class="token punctuation">.</span><span class="token constant">OUT</span><span class="token punctuation">;</span>
    <span class="token comment">//资源分类</span>
    <span class="token keyword">int</span> <span class="token function">resourceType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//处理BlockException的函数名称,函数要求：</span>
    <span class="token comment">//1. 必须是 public</span>
    <span class="token comment">//2.返回类型 参数与原方法一致</span>
    <span class="token comment">//3. 默认需和原方法在同一个类中。若希望使用其他类的函数，可配置blockHandlerClass ，并指定blockHandlerClass里面的方法。</span>
    <span class="token class-name">String</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//存放blockHandler的类,对应的处理函数必须static修饰。</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">blockHandlerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//用于在抛出异常的时候提供fallback处理逻辑。 fallback函数可以针对所</span>
    <span class="token comment">//有类型的异常（除了 exceptionsToIgnore 里面排除掉的异常类型）进行处理。函数要求：</span>
    <span class="token comment">//1. 返回类型与原方法一致</span>
    <span class="token comment">//2. 参数类型需要和原方法相匹配</span>
    <span class="token comment">//3. 默认需和原方法在同一个类中。若希望使用其他类的函数，可配置fallbackClass ，并指定fallbackClass里面的方法。</span>
    <span class="token class-name">String</span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//存放fallback的类。对应的处理函数必须static修饰。</span>
    <span class="token class-name">String</span> <span class="token function">defaultFallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//用于通用的 fallback 逻辑。默认fallback函数可以针对所有类型的异常进</span>
    <span class="token comment">//行处理。若同时配置了 fallback 和 defaultFallback，以fallback为准。函数要求：</span>
    <span class="token comment">//1. 返回类型与原方法一致</span>
    <span class="token comment">//2. 方法参数列表为空，或者有一个 Throwable 类型的参数。</span>
    <span class="token comment">//3. 默认需要和原方法在同一个类中。若希望使用其他类的函数，可配置fallbackClass ，并指定 fallbackClass 里面的方法。</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">fallbackClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 

    <span class="token comment">//需要trace的异常</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exceptionsToTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token class-name">Throwable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//指定排除忽略掉哪些异常。排除的异常不会计入异常统计，也不会进入fallback逻辑，而是原样抛出。</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exceptionsToIgnore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div></li></ul> <h4 id="启动-nacos、sentinel"><a href="#启动-nacos、sentinel" class="header-anchor">#</a> 启动 Nacos、Sentinel</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>startup.cmd <span class="token parameter variable">-m</span> standalone
<span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.7.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="按照-rest-地址限流-默认限流返回"><a href="#按照-rest-地址限流-默认限流返回" class="header-anchor">#</a> 按照 rest 地址限流+默认限流返回</h4> <ol><li><p>通过访问的 rest 地址来限流，会返回 Sentinel 自带默认的限流处理信息</p></li> <li><p>业务类 RateLimitController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimitController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/byUrl&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">byUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;按rest地址限流测试OK&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>访问一次 http://localhost:8401/rateLimit/byUrl</p></li> <li><p>Sentinel 控制台配置</p> <p><img src="/assets/img/image-20240516232513074.30bb05bb.webp" alt="image-20240516232513074"></p></li> <li><p>测试：疯狂点击http://localhost:8401/rateLimit/byUrl，会返回<strong>Sentinel 自带的限流处理结果 Blocked by Sentinel (flow limiting)，默认</strong></p></li></ol> <h4 id="按-sentinelresource-资源名称限流-自定义限流返回"><a href="#按-sentinelresource-资源名称限流-自定义限流返回" class="header-anchor">#</a> 按 SentinelResource 资源名称限流+自定义限流返回</h4> <p>不想用默认的限流提示(Blocked by Sentinel (flow limiting))，<strong>想返回自定义限流的提示</strong></p> <ol><li><p>RateLimitController 添加方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/byResource&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;byResourceSentinelResource&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;handleException&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;按资源名称SentinelResource限流测试OK，O(∩_∩)O&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;服务不可用@SentinelResource启动&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;o(╥﹏╥)o&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>测试地址：http://localhost:8401/rateLimit/byResource</p></li> <li><p>配置流控规则</p> <ul><li><p>配置步骤</p> <p><img src="/assets/img/image-20240516233041295.eaa44f55.webp" alt="image-20240516233041295"></p></li> <li><p>图形配置和代码关系</p> <p><img src="/assets/img/image-20240516233130697.158dab0d.webp" alt="image-20240516233130697"></p></li></ul></li> <li><p>测试</p> <ul><li><p>1 秒钟点击 1 下，OK</p></li> <li><p>超过上述，疯狂点击，返回了自定义的限流处理信息，限流发生</p> <ul><li><p>sentinel 默认</p> <p><img src="data:image/webp;base64,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" alt="image-20240516233243490"></p></li> <li><p>自定义限流提示</p> <p><img src="data:image/webp;base64,UklGRkwYAABXRUJQVlA4IEAYAACwaACdASrJAYcAPpE+nEqloyKhqBOqCLASCU3fiKgAdQPFkB+4o1huV8H/8Ccvqv+j8WOFT0G/+Lp4f6X9M/ehzwn/R9S/kAerF/2PYN/pn+6///uAfwj+6et7/7P3Q+Ej/Mf+P0zvUA///qAf//rZ+pX+A7Nf7N+WHm34T/SPuV6vmQPp2/wvQn+Q/Yn9L/bfN7/Vf1DxV99P9L/XPYF/J/5b/kP7R4+P9p2802nqC+2f0z/Xf4X8nPPs/nvQT8p/pX/S9wD+U/0P/XfcJ8af8D/YeKZ9r/0vsA/yv+2f8n+2flb9K375/1v83+bXtH/QP8D/2P818Av8y/p3/H/vP+W96P/7+3b9v///7p/7Vf/MqNswwfocVL2MMcFu5rblPjRdCdamizizjiZAvMSXXqKOZPRFX0MNin9fA6mpmRK8rZNJhbDAkVt59/brj75kmunzg37TOt+APytfJPWluHtjNDIbxoxE7Owl2a/xbv9QubRvUwRDBWwsosig3pdqG8YiBF4Xw/rnVFnLfi/M+1CrzmSq/GvWHXbE8jJL+mKAmSWEJgL1NePg6HutkAelhySrFtbH2B7QW/DnHbLV4CtfYCW7ooDq3m4UWx0I8chLNqtbAszMw0wFo2kvvypLnzM2eteVJ1JNgNqLSXpw+ho4DrmX/D8wz5tjlo/+vEiL7afBxYHcsLKYUSnwglNF3JG2dUrau9hY2v4WYiVlxlqJlFaM0PuNJZDse0ZTg33QOMuuD2bbPp5V1hO+YG7nkFcxWOhgzslAwa6TLoAUgCIUaIu/345bUB+IwY/h4K0xvAFQmg9QWr5RmPW++MU2hAxjdTGRq8Thpo7ARgyTLfzKckcgDJV/j4aw0kdRljdaZI5AGSZb+ZTkOu9QCgxGablwZXtYze9Cexivh3NJUoSbH+R/AOd1SsvcSE+e0RA2Z2D7ZO/Rcce6IxLXdw1ieKp1YsnXivmqeR7UZy5XBvMBXnHHJYJfCk+tLIgoxdX9Tmj66s1fr6jCkTa//fcuSII0GbXQdjUV0r6W/QRq3CYmpq6zQBkmXz83crbFkjI+SdPbu++nXpb2FRS+Z/8ynJHIAyTLfzKckcgDJMt/MpyRyAMky38ynJHHoAAA/u01uTOqTp8giwoBudZuyrV3q8KYN54ucYVDBM+M/4IqcMHWoH6mRXkADDqlKDYP3kF7W4TUAGro5boIaxWdKqz2GIT38EVb7omkfXiUltWFUMrGO8FBKWQEapWQRrn0xIsoGE8Qi9lyvEw6igA7QTEnJbvCsbp3xjc/6LmYCKj6wVhjweBI9gp9tC/0lJH//wIL8mRHN1iOlEk37XMDuP+bX/7EHuklfPf7Z7S1NJmVI4ge3BxY0ifjVlGdRc/GV6WMuA6u0wrbMB2zpD4XcwesRsOSbLZrIOZ16MKy2B62ep+5k3OuiJzJEdt/ZSMtGbY0Lj0ycarfyBkeLAY9TUyuV1Z9oTjwmmkuuPC7W7r6+cKhUd21ump56kdZyrigMwSydLe6fLITzKbEQPrb5KCeiiFKkgUIGjni8iI4dOtkITZMmbvzRNNLVT15jVaVe3PiXGZxY9UQzqpf5geGo1j0lkSkPFowD4I5E/nfPJYscKQH7uRkp7Zh1E73rvADa8igbbnAVAo3OOC3iuwNK4yZ0xAn7Ln/1WxERLAUU5coFPM8KlPZVRNb7PsZ3YGIZnmNNhV8pPCaJSVKjUxLFZr6SyJSHi0dGIzrHrtEq8BXEmb1NNZyGQiJVp5yp497QXjDV5iGgtQCwxCor5VUMyJ9GmoY2iteatoQxDsovF1eMmAPTKKkjf5neVdha4tDQIdZsOUw3RXTSsQtAqIlypzBFT+nQWNUT27EXwdSeGRiN4Nrg6P5eVwHkPhkXTuD49J1FqUxqxyfxHi0l4FF1rATzm47fXUnkZHjhfJ3ufW73z6S00ZVflhjHQ+r1DR+QdilTerRUZENiZpKXMcv1/fp3kFfPGz73xrtPXX3ZRiWALguwxrDJx9PWDINbknPy2gPOBtqOlSUz3251MwVIKFPkqtPUTF70wycf6P9S2INE43o5YEoVRiW/brrdp9p6MpmF03by3AUe5mPqK6uj85wLIYwx1IJTVHz7+5uTUhbUWbutG4Pn0i+mb5wudaSLsmn6pDAzv/i4C92OOvOxLjUQ8SmQipQ2Zo9jPfEn+AxAlIRZiDkiDUqmzzpaPG2VAzDBRqWYgcyyh/e2JU7zlWUmIBgj9UfrWNxRVgK59wUucRz1eg/UE//vUqdB6XiejsvqSoUqZNE2ilD+wxBXce5TEn5lw+hMEQPBlCaAGt77cN4THdH2Ih032UX5AWuwJMbFlrX2dOBuE0SJLhMrsoET5/Nyx1e/48JTsF1Vd+/rjMzeLTlrYHfS7oBKBY9nDaeMkEKktND7D/qERoDaHjQPD38098u+D5R2CIfHsKzaJHXsQ6ssFkjQ1hXcMwjSs6v9eSOMEfS0kd31HPQTUOYm7T5aP+8thz3/GQxGQ9iAofFhuB7J2R+wuq3/fevKyXBF4tZxMGhl6AJug2+zPxJYBghbj3R0fFDtAUVyAKQ9pn74/gxfz4n8SCHe0SknPGxDUHBjScu2R04LxNRyvD1K0lgJH9ueSyiuj5+K/mEL9+yEOHK+oaXhlTlH1Mw3djWrmlorw2iDUytoRKUU5A6pZp3FIBB97nglefNQUoLjAyHfVJHCEVdbnWC1eYHXR+6VHjt/ogkN8n7QZFelnr6wOzaLnUjEUkN4/rDVzIGdHnt28y/r8gOZBFJLQAiVVqkPJboywnpFhs3lP5SgrAOr3DgPwrtPZrAuacohSYvOOgmlYO1UMOXGuctCIpr8PiIjMKXxsK3/HmfxGtAZiUyU8HlnW0gxHgX247zU/U7S1oWyjJi20pBY+KfWTURNH7p1GsTtGQeIflgmr9jR480qoGobHgodXKddhUFjZUGK+4KDUrtJDlKlV+dPIUuR3DMw3gNKNpsgxSFghKnfOoRPno4S0r88tm5oj+qQKoT11fv8U8R1KDu7WNKtcok/F0JanUap292LIJ0rxvmQ95fyB6tTtCOy9oqNctgPuMZ9nxSvbe36305EalT84fEutnVxEEzHJroJ9RMh6OVd42LeiPOl/ryFX8WMd0JIg1SzP86fZWofXWhEJ7nHlUbqTezbM4NKBrz/rvQu1ejzg3Gb1TYSInlryFN754UIv1WOGVpDb+W9Lye6qniA0hqyoryX0ee0j36Q2t45WgWokpaHyVfEG85t0hH0js/KCkZkiIyYpB4f45ZtXlPoaXmGfpmUAQTdQwcY4LILi2BLHeZ7NU3Yf03xSvtRHb8Cd2YahVbWc4jo/JlggQHZo6RnAJX3IDlRUvZI1Zu9kwdO39iuNLSYr4T3r5RGqV8coJAOO1g1vZBwGdaWjLsY0fHg264jTBOmVPh2IsjKkmOQmDZrbGDqw3siBZVecjlYV2hLWUD5t53dCII6HaUw47voWGhhnlQaWPwOqGppbwJOaFaksUsBLvDlVbANqwhYMk0m4/xFIMnJrKby2xG5l4QJAEDYF9+7BhZ5kGRKktvyLtdEjJKIKmonqllhX4qNJ7efxWtQioajLYeQn7dsSos2NZuKMbL1g64ZJIt8bQftm5oBoae5WyBgsOZh/nV4k2Cq9lhfOPMTA2InLD4A18BhpAwvo6XdU1b0AyAM/OcAnc1+KGVQWUoSC6jfTgMkY4YtsXYJ5FyMIcV0ICLhGYl74+A4J5h01AeydYl3I3WXCCDkuiIvWp1idQ9LnhcQyGqYFqqjIk4wuvBO5sTfgUz9UMsH4gWyiDylZxS6kMbuvMLGrf0t9pMfg+39cmBvqeZLMgYdV7o8+mj5lHTHIK8IZ9Jf6Jt3EcKTDOGzyFiNtSkctP9+afrH2VZW5fqXy2yqQ4MFFIs4XUcZrVdXBtTeeJ79+NFgUnGcr2ynf25AzU+Tj3CdzoQXylrB3Q5RdVHKhyNcNvYQeMIYk470+mcaCqkfNK1iUEtAQ2H++Q09neig4b/4+Q4fyBZbf82Wsd2RfnH+IGAnmj52CixvjszT9qgPu5ZB5/RP5oxp580bX5I9NaNNMr9Y0oNKzylUjvV5Xx+jlLam1P9xtJQdtieL/R+AdAXli4l1XvOCu8IT9PXUJX0XrENA/6EejGjomTo1YH5lWQKIo3+bkDeOHaqtgbkX72LXj2lk/QPIbP/Ow4CINzOrfI3/EktdAwBEbGAbmSNUAMsHsy0xCkmbUZBYzLxfe9egpZdakFwf/lDyNc0AK/K4Y9WLnxOkmXK4H99zsZ6VZMVqEif870lgxAgxD3vADdvT09x1ONYJCzAnd1QQpmknlWaNwVC5R2hjkFoCkWQbxJlDpy4KvIYAhEWdgCgK0PWAsZTb9OQHvCLHvFPypHv+GZwK9mZqLwlc+/IwaWsAiVM9xoaXtb53ShMoMRQltb+FcUJ2L9F+tkKR6gxu4s4vvFfDMKiTE3kmmlJKoSuLut1I97EG2zkoBfdae1L2keXzhuru75ErqYjXrpmsi6niA6qENnBWtNU8IksV9Gjv55/ULCCmsc6glEzFDU9jJ1BmgQVxFANdVG07tuU2RC+Fl/kD/G9eEeAKvAatF0bxusIuAY73hoinFVDJ1tZionc7pHaEIygBImpTH6Xs9xVZJRkfyt592THbGGjpAde52MX96gc+XkTS6vKGLir5c33UAZ8Fu8B8wVpf6FHVEcwxfyKl5Z4jzsoCodZ90EDWTSmiS9Q9Wug+JFTw1KUkU8fZTZ1w0/hYBhPxWZKZQF3dC65pGX5ZCgyXgqSPprzzWRGYfPtP1EAZu0CK1VdVkC4VFxJmnj08lkPIISwVL6kzwNpv+MpCSIBJlzVuF2MEBwCzpjS0p5ivAny6jUbO5NGUNUs6xv24nGAqTjAm1EFhncQTnMT7AbGYdDPecs5n2TO6VCatDUvIPTq6wGwPZ32RDAblxntXoQMbBWG5vCBgjrvE5AW2vidOgdMslcWovNTswtcrCqnt6Cb7VCl746iv+cArqAzRbmCZwspf4AbtAFgApganU60GWAAACq7HbEUXv3g8412sG5+Cxu88m9I7oAf4gQ2cAB7AJx4w2Xqbjm7CJZyV+ApN+sOcSwU1V8kEq+w+Z+7d3CRxdi/xTgEfacvS5hCBE2E0CsBlYD+h9itSauBb0FleM8fe16Gg7sAhooSPr1F9oykOfZqs8SIGzAcIM2ZZIhSw/gBhJq2VdUaj/VcUEfaOP1ld3wDcTkXRKyZEl6IkJ6zNwh1ZFi53+MVr7u+NKzPvvZ2rvme4amEKGJHCgEE8WqCA74u5UY9FSmvPbReI5mqgWxz/1KgY6wq0GpkjDbGc12f/8kHSYIkDpLw/qydE3Uw1iOCGmmh4krj74jN6byxthv5hp9ft+C1DGVQy7AWxTDtQ3bGrDrj+YS6wAt1CMFI0ORzD3nw4RRlK9+9dZVtHHcPpDXfcxHFneXMD4aZbkPQSzCIa8fs1skK9wm7AHItF1XSPmO4QJGFbwlBT5UBJ3AgbKt3pWmc2iAcq2zX8jSXNXKPPrL9DLorbQf9k7uad9yOG/QZ9AiPILAUy6waFiycagtL3e8xXr/CC5gYgucjMuDGdpaorq5zDigC3dA0YBGvXr6AsUY6c4ogcMUO91ndMbtI+Ct2zGKjGjb8GkZAVZcQc02fdbAGd+0UMInBUY328NJ/NxbFAjkCsTI+2X6x/MSkyc30NDMhwfakA8Te5QTwL4I+OJUb4zaTsM9js3QgPPZH7HdMHjEEZ2CPDRhmqHPF39LizZv4J1VH9ADPgBA0OXF0YYZoiw6haAxE+tZ9O4YaJhJ6/G4PQYK0zIO9vDutcfgtwq9cjWNqNf+A7Pfz/MreQcByyZXtPVvNvqvsUIfwUysZJV4OJSlTwG4u+dTwv2iGIVNwHRC6/bPD0mGDwDHP1nGHbSBLA2GBtT6/MRW+EOTTW5OKrU1Haa8eh9DsCAKGYyDcYE0XFkYdPxFVqZTgfU81apof7Sk+u2cd1op3EGcJSO/kCnF502nY9W0U8gqhPw7PQDjlpVoDZu+/3e4fly9KsRMS5f9OSaZ9XWtCdxmav0ZTeoApGopXn97dikubpSOh//NwxnNyddtuRJcq1Y/bvLferibzDXxQhyyE5YiKfXKxFDWPM28bBzE5KryqzR4N+RZv3TH2tdu1WUP6FKoYCR8FAKdAme22HL0TrzUAzjAMsl9KV10ZY/GP/fQKIayONjfEJBebiO6IDZva25AY6CCYl5g8G79pdtUEG6YXb4MDOxecqOUk3izfjOAunXUj/517Oamwv//rEMUqIA5Weq4th1f8i9oKegdMvwv/4GJufqRh6bm33lcRXjbxyXez/rPlw6mNMHk13qp+5xk4HNA1l592t2TZ3qXvFi6bqnXPZxqH/GoSPjtlbbVj6Zc+DiZDcuBeEKHW+F16YB2B//4MnZP4+UhE73OSTWd2iYtOXnXzozkCY2CNn+4oI4Y6SPE+J9IxWWakRsir9vWE4jZJJE0CxpFAxixoJPJT2P0iXq97BXL73qw/jPcCIGn6aSprH9bwHjp/8CtPUNVIA6C9NoQPjgYHEQrUeZO8zrnWAVRUpWns0PsN4PdKyNrmqzPOmWdWOKKOx+tCG7qYuNPWBJur9VJ/3qnkZZ4Zj48WBmWQ0TAct2o/eM8/nbr/8gJAnyHjyFRgwRrDts+vtDCALXXqSoi1W26Do56/hqodJ65cdD6WVrxS7lTS014mDsej6rIrK8bvYOEkq/VtFe4jdvYaMaGmzmRaxLJh/rHeeyg0Cy0Z+1D8AKVsTqF1uIR6yYp2cyJ0rW3RjsohvMTfVWOfrxscrVH8sVoJ8wGvqRZn2I2vP4sYrt1IiIqP/0Ez9XlVwkwi+B0qZXLpekXDdhdst3oWkb6YJ3oaIayzRWhFz6LTMu70DtbS1tkWS2mpWZNGaK+55g0+euSGRXPBD5/jfzi/NMJ3LOycY4j5GWU/TsxDhy38Xc7/1uasO0Z4uDc4Oge/hnngQK0OcHazESlYi+BDriyVZQ0xx/nFIlIbbbdtrGIK2HNdD4MjQ7QnqFBgATw0m/0TEEiC+gsJaJWJrrFb3zQB7RmQ5Iei11sYspJh6aP5l+FF13I2s8ya5Nv9KV51X0mJKZcP+boUf2s0R0CWCQa0KOXPhkvPLQC44cKp0na2scrRW9JzHVuCOv1dFt2Xks9QbuVL2FWZul9yCHX9ItRKK9CB6dljXNnuAMu1WIzGMxHU4ycVP7Igbueu1PGHWN2jKeZSbPmnQRMwjdZG1nSVPbPeHfNo/HJWabSdYrxHDUwnppaNSIhquMqTz6MaGWqprFF5f/uuoCyJA8IiRb3PBJ8v9Uvly0XRbWJNseb0DioMr73vShF3RB57GRHIepnV/j01z6Ony7/SyEvjZDSRpsE9hWyVdPwBsNdNrFFwkAPkUG8AMxuPXDgUCnejudNMLz6aXVQyuCl7gzHL8tK38438WLVLq9OlOADAqNn76nDyDK+DmWronNrQcUIOrSR1BNE6vSjOqhQKrwTDhpp6+TCL4WP6TmiLJZ7jDmfe991ei6bM/DcWEZ97Ua8FUW7nKZltkpHqWptvvzmtrKdDpH/+d366ZqoUDbdCloXkrHmPg2CFa7ar562cggafvKClqPyMQdnhCLSou+yZX9gOP8ZCLLt2D7tPHy/u1ROZWnkKfcBhbrMo5C1OMWxCt3oj1iBFDBKcOYQ+ANjIiUVoGG+aCeu8wI/4Ypf1rIezY4NL90Lp190UAbrPdgUmjIxs+hWkGY5rEFNFEMdYLjmDzDzW1sJpXLtmYdrCRrb3wyGimOPy9rGCuUNGEPM6t96M+vtkNKVeMBb7qQWSWAvd5oyEOajO5i9LBMPsFvfbLV+pHS+O0FghQb9gYAOAqjdG4l3N905tzr8cDjq/6T1dlxiVCBxeyALQct3JeSUTqigjmI1JSTDDAXA5Bu48o2Pi+Df0IasGfmq8X2Ju9c0Sv/JYK904TcJPrRjAY7EUH9C6q3W+R/qG3CK+9g+QrZ93+zjUGaNGMRDXta9Sa8nVXIbEXh3lWdGAt9iYY5TPTkEKBq9nMyohrcyo7Np7UhoQkKu0oiSb9WYgf1TarVvgjqnGTKcjl/kAz92hdn7LvXNjbIPo2zAjpM1oPwkIMQfTk3FddtfZw8R/gko/+yNN0U59GP5dgi3yQeYEcgAecMiA35EgfsroAAAAAAAAAAAAAAAAAAAAAAAA" alt="image-20240516233258537"></p></li></ul></li></ul></li></ol> <h4 id="按-sentinelresource-资源名称限流-自定义限流返回-服务降级处理"><a href="#按-sentinelresource-资源名称限流-自定义限流返回-服务降级处理" class="header-anchor">#</a> 按 SentinelResource 资源名称限流+自定义限流返回+服务降级处理</h4> <p>按 SentinelResource 配置，点击超过限流配置返回自定义限流提示+<strong>程序异常返回 fallback 服务降级</strong></p> <ol><li><p>RateLimitController 添加方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/doAction/{p1}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;doActionSentinelResource&quot;</span><span class="token punctuation">,</span>
        blockHandler <span class="token operator">=</span> <span class="token string">&quot;doActionBlockHandler&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token string">&quot;doActionFallback&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doAction</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> p1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;p1等于零直接异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">&quot;doAction&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doActionBlockHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> p1<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;sentinel配置自定义限流了:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;sentinel配置自定义限流了&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doActionFallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> p1<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;程序逻辑异常了:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;程序逻辑异常了&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>测试地址：http://localhost:8401/rateLimit/doAction/2</p></li> <li><p>配置流控规则</p> <ul><li><p>图形配置和代码关系</p> <p><img src="/assets/img/image-20240516234156985.b14b97f0.webp" alt="image-20240516234156985"></p></li> <li><p>表示 1 秒钟内查询次数大于 1，就跑到我们自定义的处流，限流</p></li></ul></li> <li><p>测试</p> <ul><li>http://localhost:8401/rateLimit/doAction/2
<ul><li>1 秒钟点击 1 下，OK。</li> <li>超过上述，疯狂点击，<strong>返回了自己定义的限流处理信息</strong>，限流发生，配合了 sentinel 设定的规则</li></ul></li> <li>http://localhost:8401/rateLimit/doAction/0
<ul><li>p1 参数为零，异常发生，<strong>返回了自己定义的服务降级处理</strong></li></ul></li></ul></li> <li><p>小结</p> <ul><li>blockHandler，主要针对 sentinel 配置后出现的违规情况处理</li> <li>fallback，程序异常了 JVM 抛出的异常服务降级</li> <li>两者可以同时共存</li></ul></li></ol> <h3 id="热点规则"><a href="#热点规则" class="header-anchor">#</a> 热点规则</h3> <h4 id="基本介绍-3"><a href="#基本介绍-3" class="header-anchor">#</a> 基本介绍</h4> <p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81" target="_blank" rel="noopener noreferrer">热点参数限流 · alibaba/Sentinel Wiki (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>何为热点？热点即经常访问的数据。很多时候我们希望统计某个热点数据中访问频次最高的 Top K 数据，并对其访问进行限制。比如：</p> <ul><li>商品 ID 为参数，统计一段时间内最常购买的商品 ID 并进行限制</li> <li>用户 ID 为参数，针对一段时间内频繁访问的用户 ID 进行限制</li></ul> <h4 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h4> <p>RateLimitController 添加方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testHotKey&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;testHotKey&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;dealHandler_testHotKey&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testHotKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p1<span class="token punctuation">,</span> 
                         <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p2&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testHotKey&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">dealHandler_testHotKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> p1<span class="token punctuation">,</span> <span class="token class-name">String</span> p2<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;-----dealHandler_testHotKey&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h4> <p><img src="/assets/img/image-20240516235334822.43a9baeb.webp" alt="image-20240516235334822"></p> <ul><li>限流模式只支持 QPS 模式，固定写死了。（这才叫热点）</li> <li><code>@SentinelResource</code>注解的方法参数索引，0 代表第一个参数，1 代表第二个参数，以此类推</li> <li>单机阀值以及统计窗口时长表示在此窗口时间超过阀值就限流。</li> <li>上面的抓图就是第一个参数有值的话，1 秒的 QPS 为 1，超过就限流，限流后调用 <code>dealHandler_testHotKey</code> 支持方法。</li></ul> <h4 id="测试-5"><a href="#测试-5" class="header-anchor">#</a> 测试</h4> <ol><li>error
<ul><li>http://localhost:8401/testHotKey?p1=abc</li> <li>含有参数 P1，当每秒访问的频率超过 1 次时，会触发 Sentinel 的限流操作</li></ul></li> <li>error
<ul><li>http://localhost:8401/testHotKey?p1=abc&amp;p2=33</li> <li>含有参数 P1，当每秒访问的频率超过 1 次时，会触发 Sentinel 的限流操作</li></ul></li> <li>right
<ul><li>http://localhost:8401/testHotKey?p2=abc</li> <li>没有热点参数 P1，不断访问则不会触发限流操作</li></ul></li></ol> <h4 id="参数例外项"><a href="#参数例外项" class="header-anchor">#</a> 参数例外项</h4> <p>上述案例演示了第一个参数 p1，当 QPS 超过 1 秒 1 次点击后马上被限流</p> <h5 id="特例情况"><a href="#特例情况" class="header-anchor">#</a> 特例情况</h5> <ol><li>普通正常限流
<ul><li>含有 P1 参数，超过 1 秒钟一个后，达到阈值 1 后马上被限流</li></ul></li> <li>例外特殊限流
<ul><li>我们期望 p1 参数当它是某个特殊值时，到达某个约定值后【普通正常限流】规则突然例外、失效了，它的限流值和平时不一样</li> <li>假如当 p1 的值等于 5 时，它的阈值可以达到 200 或其它值</li></ul></li></ol> <h5 id="配置-2"><a href="#配置-2" class="header-anchor">#</a> 配置</h5> <p><img src="/assets/img/image-20240517000453541.e9d4cffe.webp" alt="image-20240517000453541"></p> <h5 id="测试-6"><a href="#测试-6" class="header-anchor">#</a> 测试</h5> <ul><li>http://localhost:8401/testHotKey?p1=5
<ul><li>超过 1 秒钟一个后，达到阈值 200 后才会被限流</li> <li>当 p1 等于 5 的时候，阈值变为 200</li></ul></li> <li>http://localhost:8401/testHotKey?p1=3
<ul><li>超过 1 秒钟一个后，达到阈值后马上被限流</li> <li>当 p1 不等于 5 的时候，阈值就是平常的【普通正常限流】规则</li></ul></li></ul> <h5 id="前提条件"><a href="#前提条件" class="header-anchor">#</a> 前提条件</h5> <p>热点参数的注意点，参数必须是基本类型或者 String</p> <h3 id="授权规则"><a href="#授权规则" class="header-anchor">#</a> 授权规则</h3> <h4 id="授权规则概述"><a href="#授权规则概述" class="header-anchor">#</a> 授权规则概述</h4> <p><a href="https://github.com/alibaba/Sentinel/wiki/%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener noreferrer">黑白名单控制 · alibaba/Sentinel Wiki (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>在某些场景下，需要根据调用接口的来源判断是否允许执行本次请求。此时就可以使用 Sentinel 提供的授权规则来实现，Sentinel 的授权规则能够根据请求的来源判断是否允许本次请求通过。</li> <li>在 Sentinel 的授权规则中，提供了 白名单与黑名单 两种授权类型。白放行、黑禁止</li></ul> <h4 id="演示授权规则-黑名单禁止"><a href="#演示授权规则-黑名单禁止" class="header-anchor">#</a> 演示授权规则，黑名单禁止</h4> <ol><li><p>添加 EmpowerController</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmpowerController</span> <span class="token comment">//Empower授权规则，用来处理请求的来源</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/empower&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">requestSentinel4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试Sentinel授权规则empower&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Sentinel授权规则&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>添加 MyRequestOriginParser</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>handler</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRequestOriginParser</span> <span class="token keyword">implements</span> <span class="token class-name">RequestOriginParser</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">parseOrigin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;serverName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>启动 8401 后先访问成功 http://localhost:8401/empower</p></li></ol> <h4 id="配置-3"><a href="#配置-3" class="header-anchor">#</a> 配置</h4> <p><img src="/assets/img/image-20240517001555177.684c2380.webp" alt="image-20240517001555177"></p> <h4 id="测试-7"><a href="#测试-7" class="header-anchor">#</a> 测试</h4> <ul><li>error
<ul><li>http://localhost:8401/empower?serverName=test</li> <li>http://localhost:8401/empower?serverName=test2</li> <li>Blocked by Sentinel (flow limiting)</li></ul></li> <li>说明：上述 2 个 rest 地址，serverName=test 或 serverName=test2 是处于黑名单的状态，无法访问，会发现无法访问，被 Sentinel 限流了</li> <li>right：http://localhost:8401/empower?serverName=ab</li></ul> <h3 id="规则持久化"><a href="#规则持久化" class="header-anchor">#</a> 规则持久化</h3> <h4 id="是什么-8"><a href="#是什么-8" class="header-anchor">#</a> 是什么</h4> <p>一旦我们重启微服务应用，sentinel 规则将消失，生产环境需要将配置规则进行持久化</p> <h4 id="怎么玩-3"><a href="#怎么玩-3" class="header-anchor">#</a> 怎么玩</h4> <p>将限流配置规则持久化进 Nacos 保存，只要刷新 8401 某个 rest 地址，sentinel 控制台的流控规则就能看到，只要 Nacos 里面的配置不删除，针对 8401 上 sentinel 上的流控规则持续有效</p> <h4 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h4> <p>修改 cloudalibaba-sentinel-service8401</p> <ol><li><p>POM</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>YML</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8401</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>         <span class="token comment">#Nacos服务注册中心地址</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span> <span class="token comment">#配置Sentinel dashboard控制台服务地址</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span> <span class="token comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span>
      <span class="token key atrule">web-context-unify</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># controller层的方法对service层调用不认为是同一个根链路</span>
      <span class="token comment"># 添加Nacos数据源配置</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">ds1</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> DEFAULT_GROUP
            <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow <span class="token comment"># com.alibaba.cloud.sentinel.datasource.RuleType</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="/assets/img/image-20240517003513382.ab02ab4a.webp" alt="image-20240517003513382"></p> <p><img src="/assets/img/image-20240517003525257.09b9b452.webp" alt="image-20240517003525257"></p></li> <li><p>添加 Nacos 业务规则配置</p> <p><img src="/assets/img/image-20240517003610901.c00dd8e5.webp" alt="image-20240517003610901"></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/rateLimit/byUrl&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;limitApp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;strategy&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;controlBehavior&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;clusterMode&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>resource：资源名称；
limitApp：来源应用；
grade：阈值类型，0表示线程数，1表示QPS；
count：单机阈值；
strategy：流控模式，0表示直接，1表示关联，2表示链路；
controlBehavior：流控效果，0表示快速失败，1表示Warm Up，2表示排队等待；
clusterMode：是否集群。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>快速访问测试接口：http://localhost:8401/rateLimit/byUrl</p> <ul><li>上面地址访问后等待 3 秒钟</li> <li>启动 8401 后刷新 sentinel 发现业务规则有了</li></ul></li> <li><p>停止 8401 再看 sentinel</p> <ul><li>停机后流量控制规则没有了</li></ul></li> <li><p>重新启动 8401 再看 sentinel</p> <ul><li>开始还是没有，稍等一会儿，多次调用</li> <li>配置出现了，持久化验证通过</li></ul></li></ol> <h3 id="openfeign-和-sentinel-集成实现-fallback-服务降级"><a href="#openfeign-和-sentinel-集成实现-fallback-服务降级" class="header-anchor">#</a> OpenFeign 和 Sentinel 集成实现 fallback 服务降级</h3> <h4 id="需求说明"><a href="#需求说明" class="header-anchor">#</a> 需求说明</h4> <p><code>cloudalibaba-consumer-nacos-order83</code>  通过 OpenFeign 调用  <code>cloudalibaba-provider-payment9001</code></p> <ol><li><p>83  通过 OpenFeign 调用 9001 微服务，正常访问 OK</p></li> <li><p>83  通过 OpenFeign 调用 9001 微服务，异常访问 error</p> <ul><li>访问者要有 fallback 服务降级的情况，不要持续访问 9001 加大微服务负担，但是通过 feign 接口调用的又方法各自不同，</li> <li>如果每个不同方法都加一个 fallback 配对方法，会导致代码膨胀不好管理，工程埋雷....../(ㄒoㄒ)/~~</li></ul></li> <li><p><code>public @interface FeignClient</code></p> <ul><li>通过 fallback 属性进行统一配置，feign 接口里面定义的全部方法都走统一的服务降级，<strong>一个搞定即可</strong>。</li></ul></li> <li><p>9001 微服务自身还带着 sentinel 内部配置的流控规则，如果满足也会被触发，也即本例有 2 个 Case</p> <ul><li>OpenFeign 接口的统一 fallback 服务降级处理</li> <li>Sentinel 访问触发了自定义的限流配置,在注解@SentinelResource 里面配置的 blockHandler 方法。</li></ul></li></ol> <h4 id="程序解耦"><a href="#程序解耦" class="header-anchor">#</a> 程序解耦</h4> <p><img src="/assets/img/image-20240518194530970.fbc3ab47.webp" alt="image-20240518194530970"></p> <h4 id="编码步骤"><a href="#编码步骤" class="header-anchor">#</a> 编码步骤</h4> <h5 id="启动-nacos、sentinel-2"><a href="#启动-nacos、sentinel-2" class="header-anchor">#</a> 启动 Nacos、Sentinel</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>startup.cmd <span class="token parameter variable">-m</span> standalone
<span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.7.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="修改服务提供方-cloudalibaba-provider-payment9001"><a href="#修改服务提供方-cloudalibaba-provider-payment9001" class="header-anchor">#</a> 修改服务提供方 cloudalibaba-provider-payment9001</h5> <ol><li><p>改 POM，增加 sentinel 依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--alibaba-sentinel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>写 YML，增加 sentinel  配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#配置Nacos地址</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span> <span class="token comment">#配置Sentinel dashboard控制台服务地址</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span> <span class="token comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>业务类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayAlibabaController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;nacos registry, serverPort: &quot;</span> <span class="token operator">+</span> serverPort <span class="token operator">+</span> <span class="token string">&quot;\t id&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/nacos/get/{orderNo}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;getPayByOrderNo&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;handlerBlockHandler&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayByOrderNo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;orderNo&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//模拟从数据库查询出数据并赋值给DTO</span>
        <span class="token class-name">PayDTO</span> payDTO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayDTO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payDTO<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payDTO<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span>orderNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        payDTO<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">9.9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payDTO<span class="token punctuation">.</span><span class="token function">setPayNo</span><span class="token punctuation">(</span><span class="token string">&quot;pay:&quot;</span> <span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">fastUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payDTO<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;查询返回值：&quot;</span> <span class="token operator">+</span> payDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">handlerBlockHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;orderNo&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC500</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;getPayByOrderNo服务不可用，&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;触发sentinel流控配置规则&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;o(╥﹏╥)o&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*
    fallback服务降级方法纳入到Feign接口统一处理，全局一个
    public ResultData myFallBack(@PathVariable(&quot;orderNo&quot;) String orderNo,Throwable throwable)
    {
        return ResultData.fail(ReturnCodeEnum.RC500.getCode(),&quot;异常情况：&quot;+throwable.getMessage());
    }
    */</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></li> <li><p>启动 9001 微服务自测：http://localhost:9001/pay/nacos/get/ord1024</p></li></ol> <h5 id="修改-cloud-api-commons"><a href="#修改-cloud-api-commons" class="header-anchor">#</a> 修改 cloud-api-commons</h5> <ol><li><p>POM，增加 sentinel 依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--alibaba-sentinel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>新增 PayFeignSentinelApi 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>apis</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;nacos-payment-provider&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token class-name">PayFeignSentinelApiFallBack</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayFeignSentinelApi</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/nacos/get/{orderNo}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayByOrderNo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;orderNo&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>为远程调用新建全局统一服务降级类 fallback = PayFeignSentinelApiFallBack.class</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>apis</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayFeignSentinelApiFallBack</span> <span class="token keyword">implements</span> <span class="token class-name">PayFeignSentinelApi</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayByOrderNo</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC500</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;对方服务宕机或不可用，FallBack服务降级o(╥﹏╥)o&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>gav 坐标</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h5 id="修改-cloudalibaba-consumer-nacos-order83"><a href="#修改-cloudalibaba-consumer-nacos-order83" class="header-anchor">#</a> 修改 cloudalibaba-consumer-nacos-order83</h5> <ol><li><p>改 POM</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--    cloud-api-commons中已经引入openfeign和 sentinel，这里也可以不引入   --&gt;</span>
<span class="token comment">&lt;!--openfeign--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--alibaba-sentinel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>写 YML，激活 Sentinel 对 Feign 的支持</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
<span class="token comment">#消费者将要去访问的微服务名称(nacos微服务提供者叫什么你写什么)</span>
<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider

<span class="token comment"># 激活Sentinel对Feign的支持</span>
<span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>主启动：添加 <code>@EnableFeignClients</code> 启动 Feign 的功能</p></li> <li><p>业务类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">PayFeignSentinelApi</span> payFeignSentinelApi<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/consumer/pay/nacos/get/{orderNo}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayByOrderNo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;orderNo&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> payFeignSentinelApi<span class="token punctuation">.</span><span class="token function">getPayByOrderNo</span><span class="token punctuation">(</span>orderNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>启动 83 微服务，第 1 次</p> <ul><li><p>故障现象</p> <p><img src="/assets/img/image-20240518214811408.44d0d17f.webp" alt="image-20240518214811408"></p></li> <li><p>导致原因</p> <ul><li>springboot+springcloud 版本太高导致和阿里巴巴 Sentinel 不兼容</li></ul></li> <li><p>解决方案</p> <ul><li><p>方法一：总体父工程 POM.xml 中，boot+cloud 降低版本，cloud-alibaba 版本不变</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--&lt;spring.boot.version&gt;3.2.0&lt;/spring.boot.version&gt;
&lt;spring.cloud.version&gt;2023.0.0&lt;/spring.cloud.version&gt;--&gt;</span>
<span class="token comment">&lt;!-- 上面的配置暂时为本案例注释掉，版本降级一下。
讲解完后请恢复上述高版本保持前后配置一致，请用下面的版本替代上述 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>3.0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>2022.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>2022.0.0.0-RC2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>方法二：总体父工程 POM.xml 中，boot+cloud 版本不变，cloud-alibaba 版本升级</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>2023.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--&lt;spring.cloud.alibaba.version&gt;2022.0.0.0-RC2&lt;/spring.cloud.alibaba.version&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>2023.0.0.0-RC1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>     
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li></ul></li> <li><p>启动 83 微服务，第 2 次&gt;：一切正常</p></li></ol> <h4 id="测试验证"><a href="#测试验证" class="header-anchor">#</a> 测试验证</h4> <ol><li><p>9001 正常启动后，再启动 83 通过 feign 调用</p></li> <li><p>测试地址：http://localhost:83/consumer/pay/nacos/get/1024</p> <p><img src="/assets/img/image-20240518220601044.1970ccfe.webp" alt="image-20240518220601044"></p></li> <li><p>sentinel 流控为例，进行配置</p> <p><img src="/assets/img/image-20240518220630294.5a826838.webp" alt="image-20240518220630294"></p> <ul><li><p>继续频繁访问测试地址后触发了 Sentinel 的流控规则，<strong>blockHandler 起效</strong></p> <p><img src="/assets/img/image-20240518220711849.f5753208.webp" alt="image-20240518220711849"></p></li></ul></li> <li><p>9001 宕机了，83 通过 feign 调用</p> <ul><li><p>测试 83 调用 9001，此时<strong>故意关闭 9001 微服务提供者</strong>，看 83 消费侧自动降级，不会被耗死</p> <p><img src="/assets/img/image-20240518220819354.66f7512d.webp" alt="image-20240518220819354"></p></li></ul></li> <li><p>恢复父工程版本号</p></li></ol> <h3 id="gateway-和-sentinel-集成实现服务限流"><a href="#gateway-和-sentinel-集成实现服务限流" class="header-anchor">#</a> GateWay 和 Sentinel 集成实现服务限流</h3> <h4 id="需求说明-2"><a href="#需求说明-2" class="header-anchor">#</a> 需求说明</h4> <p><code>cloudalibaba-sentinel-gateway9528</code> 保护 <code>cloudalibaba-provider-payment9001</code></p> <h4 id="启动-nacos、sentinel-3"><a href="#启动-nacos、sentinel-3" class="header-anchor">#</a> 启动 Nacos、Sentinel</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>startup.cmd <span class="token parameter variable">-m</span> standalone
<span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.7.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="编码步骤-2"><a href="#编码步骤-2" class="header-anchor">#</a> 编码步骤</h4> <ol><li><p>建 Module：<code>cloudalibaba-sentinel-gateway9528</code></p></li> <li><p>改 POM</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-sentinel-gateway9528<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-transport-simple-http<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.8.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-spring-cloud-gateway-adapter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.8.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.annotation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.annotation-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></li> <li><p>写 YML</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9528</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>gateway     <span class="token comment"># sentinel+gataway整合Case</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #路由的ID(类似mysql主键ID)，没有固定规则但要求唯一，建议配合服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9001</span>                <span class="token comment">#匹配后提供服务的路由地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/pay/<span class="token important">**</span>                      <span class="token comment"># 断言，路径相匹配的进行路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>主启动</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main9528</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main9528</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>业务类</p> <ul><li><p>参考官网配置说明案例改写 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81#spring-cloud-gateway" target="_blank" rel="noopener noreferrer">网关限流 · alibaba/Sentinel Wiki (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>配置 config</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token comment">// 使用时只需注入对应的 SentinelGatewayFilter 实例以及 SentinelGatewayBlockExceptionHandler 实例即可</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayConfiguration</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ViewResolver</span><span class="token punctuation">&gt;</span></span> viewResolvers<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ServerCodecConfigurer</span> serverCodecConfigurer<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">GatewayConfiguration</span><span class="token punctuation">(</span><span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">ViewResolver</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> viewResolversProvider<span class="token punctuation">,</span>
                                <span class="token class-name">ServerCodecConfigurer</span> serverCodecConfigurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>viewResolvers <span class="token operator">=</span> viewResolversProvider<span class="token punctuation">.</span><span class="token function">getIfAvailable</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token operator">::</span><span class="token function">emptyList</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>serverCodecConfigurer <span class="token operator">=</span> serverCodecConfigurer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SentinelGatewayBlockExceptionHandler</span> <span class="token function">sentinelGatewayBlockExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Register the block exception handler for Spring Cloud Gateway.</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SentinelGatewayBlockExceptionHandler</span><span class="token punctuation">(</span>viewResolvers<span class="token punctuation">,</span> serverCodecConfigurer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">sentinelGatewayFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SentinelGatewayFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostConstruct</span> <span class="token comment">//javax.annotation.PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//处理/自定义返回的例外信息</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GatewayFlowRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GatewayFlowRule</span><span class="token punctuation">(</span><span class="token string">&quot;pay_routh1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIntervalSec</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">GatewayRuleManager</span><span class="token punctuation">.</span><span class="token function">loadRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BlockRequestHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlockRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;errorCode&quot;</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">TOO_MANY_REQUESTS</span><span class="token punctuation">.</span><span class="token function">getReasonPhrase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;errorMessage&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;请求太过频繁，系统忙不过来，触发限流(sentinel+gataway整合Case)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">TOO_MANY_REQUESTS</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">BodyInserters</span><span class="token punctuation">.</span><span class="token function">fromValue</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">GatewayCallbackManager</span><span class="token punctuation">.</span><span class="token function">setBlockHandler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></li></ul></li></ol> <h4 id="测试验证-2"><a href="#测试验证-2" class="header-anchor">#</a> 测试验证</h4> <ol><li><p>原生 url：http://localhost:9001/pay/nacos/333</p></li> <li><p>加网关：http://localhost:9528/pay/nacos/333</p></li> <li><p>sentinel+gateway：加快点击频率，出现限流容错</p> <p><img src="/assets/img/image-20240518222018490.af8c37f5.webp" alt="image-20240518222018490"></p></li></ol> <h2 id="springcloud-alibaba-seate-处理分布式事务"><a href="#springcloud-alibaba-seate-处理分布式事务" class="header-anchor">#</a> SpringCloud Alibaba Seate 处理分布式事务</h2> <h3 id="面试题"><a href="#面试题" class="header-anchor">#</a> 面试题</h3> <ol><li><p>你简历上写用微服务 boot/cloud 做过项目，你不可能只有一个数据库吧？请你谈谈多个数据库之间你如何处理分布式事务？</p> <ul><li><p>在订单支付成功后，交易中心会调用订单中心的服务把订单状态更新，并调用物流中心的服务通知商品发货，同时还要调用积分中心的服务为用户增加相应的积分。<strong>如何保障分布式事务一致性，成为了确保订单业务稳定运行的核心诉求之一</strong>。</p> <p><img src="/assets/img/image-20240518230540968.4e984a90.webp" alt="image-20240518230540968"></p></li></ul></li> <li><p>阿里巴巴的 Seata-AT 模式如何做到对业务的无侵入？</p></li> <li><p>对于分布式事务问题，你知道的解决方案有哪些?请你谈谈？</p> <ol><li>2PC（两阶段提交）</li> <li>3PC（三阶段提交）</li> <li>TCC 方案
<ul><li>TCC(Try-Confirm-Cancel)又被称补偿事务</li> <li>类似 2PC 的柔性分布式解决方案，2PC 改良版</li></ul></li> <li>LocalMessage 本地消息表</li> <li>独立消息微服务+RabbitMQ/KafKa 组件，实现可靠消息最终一致性方案</li> <li>最大努力通知方案</li></ol></li></ol> <h3 id="分布式事务问题如何产生"><a href="#分布式事务问题如何产生" class="header-anchor">#</a> 分布式事务问题如何产生？</h3> <p><strong>面试题都指向一个重要问题：</strong></p> <ul><li>一次业务操作需要<strong>跨多个数据源</strong>或需要跨多个系统进行远程调用，就会产生分布式事务问题；</li> <li>but，关系型数据库提供的能力是基于<strong>单机事务</strong>的，一旦遇到分布式事务场景，就需要通过更多其他技术手段来解决问题。</li></ul> <p><strong>分布式事务 before：</strong></p> <ul><li>单机单库没这个问题</li> <li>表结构的关系从 1:1 → 1:N → N:N</li></ul> <p><strong>分布式事务 after：</strong></p> <ul><li><p>单体应用被拆分成微服务应用，原来的三个模块被拆分成<strong>三个独立的应用</strong>，分别使用<strong>三个独立的数据源</strong>，业务操作需要调用三个服务来完成。</p></li> <li><p>此时<strong>每个服务自己内部的数据一致性由本地事务来保证，但是全局的数据一致性问题没法保证</strong>。</p> <p><img src="/assets/img/image-20240518235313369.6facdbd6.webp" alt="image-20240518235313369"></p></li></ul> <p><strong>结论</strong>：迫切希望提供一种分布式事务框架，解决微服务架构下的分布式事务问题</p> <h3 id="seata-简介"><a href="#seata-简介" class="header-anchor">#</a> Seata 简介</h3> <p><strong>官网：</strong></p> <p><a href="https://github.com/apache/incubator-seata" target="_blank" rel="noopener noreferrer">apache/incubator-seata<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://seata.apache.org/zh-cn/" target="_blank" rel="noopener noreferrer">Apache Seata<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Seata: Simple Extensible Autonomous Transaction Architecture 简单可扩展自治事务框架</p> <p><strong>官网解释：Seata 是一款开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。</strong></p> <p><strong>发展历程：</strong></p> <p><img src="/assets/img/image-20240518232017394.8e318481.webp" alt="image-20240518232017394"></p> <p><strong>怎么玩：</strong></p> <ul><li><p>本地 <code>@Transactional</code></p></li> <li><p>全局 <code>@GlobalTransactional</code></p></li> <li><p>Seata 的分布式交易解决方案：</p> <p><img src="/assets/img/image-20240518235720020.ce9f725b.webp" alt="image-20240518235720020"></p> <p>只需要使用一个 <code>@GlobalTransactional</code> 注解在业务方法上。</p></li></ul> <p><strong><code>@Transactional</code> 失效场景：</strong></p> <ol><li>表不支持事务</li> <li>方法不是 public</li> <li>方法是静态的</li> <li>事务方法被内部调用，使用 this 调用</li> <li>异常处理不当</li> <li>注解没有被 Spring 扫描到</li> <li>事务内新开的子线程</li> <li>...</li></ol> <h3 id="seata-工作流程简介"><a href="#seata-工作流程简介" class="header-anchor">#</a> Seata 工作流程简介</h3> <p><strong>纵观整个分布式事务的管理，就是全局事务 ID 的传递和变更，要让开发者无感知</strong></p> <p><img src="/assets/img/image-20240518232646855.120deebe.webp" alt="image-20240518232646855"></p> <p><strong>Seata 对分布式事务的协调和控制就是 1+3：</strong></p> <ul><li>1 个 XID：XID 是全局事务的唯一标识，它可以在服务的调用链路中传递，绑定到服务的事务上下文中。</li> <li>官网版 3 个概念(TC → TM → RM)：
<ul><li><strong>TC (Transaction Coordinator) - 事务协调者</strong> <ul><li>维护全局和分支事务的状态，驱动全局事务提交或回滚。</li></ul></li> <li><strong>TM (Transaction Manager) - 事务管理器</strong> <ul><li>定义全局事务的范围：开始全局事务、提交或回滚全局事务。</li></ul></li> <li><strong>RM (Resource Manager) - 资源管理器</strong> <ul><li>管理分支事务处理的资源，与 TC 交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。</li></ul></li></ul></li> <li>周阳版本 3 个概念(TC → TM → RM)：
<ul><li><strong>TC (Transaction Coordinator) - 事务协调者</strong> <ul><li><strong>就是 Seata</strong>，负责维护全局事务和分支事务的状态，驱动全局事务提交或回滚。</li></ul></li> <li><strong>TM (Transaction Manager) - 事务管理器</strong> <ul><li><strong>标注全局 <code>@GlobalTransactional</code> 启动入口动作的微服务模块</strong>（比如订单模块），它是事务的发起者，负责定义全局事务的范围，并根据 TC 维护的全局事务和分支事务状态，做出开始事务、提交事务、回滚事务的决议。</li></ul></li> <li><strong>RM (Resource Manager) - 资源管理器</strong> <ul><li><strong>就是 mysql 数据库本身</strong>，可以是多个 RM，负责管理分支事务上的资源，向 TC 注册分支事务，汇报分支事务状态，驱动分支事务的提交或回滚。</li></ul></li></ul></li></ul> <p><img src="/assets/img/image-20240518234149716.5e833942.webp" alt="image-20240518234149716"></p> <p><strong>分布式事务的执行流程-小总结：</strong></p> <ul><li>三个组件相互协作，TC 以 Seata 服务器(Server)形式独立部署，TM 和 RM 则是以 Seata Client 的形式集成在微服务中运行，</li> <li>流程如下：
<ol><li>TM 向 TC 申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的 XID；</li> <li>XID 在微服务调用链路的上下文中传播；</li> <li>RM 向 TC 注册分支事务，将其纳入 XID 对应全局事务的管辖；</li> <li>TM 向 TC 发起针对 XID 的全局提交或回滚决议；</li> <li>TC 调度 XID 下管辖的全部分支事务完成提交或回滚请求。</li></ol></li></ul> <p><img src="/assets/img/image-20240518233530671.e4d0ba1f.webp" alt="image-20240518233530671"></p> <p><img src="/assets/img/image-20240518233548477.2be5b0b4.webp" alt="image-20240518233548477"></p> <p><strong>各事务模式</strong>：<a href="https://seata.apache.org/zh-cn/docs/user/mode/at/" target="_blank" rel="noopener noreferrer">Seata 各事务模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="seata-server2-0-0-安装"><a href="#seata-server2-0-0-安装" class="header-anchor">#</a> Seata-Server2.0.0 安装</h3> <ol><li><p><a href="https://seata.apache.org/zh-cn/unversioned/download/seata-server" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://github.com/apache/incubator-seata/releases" target="_blank" rel="noopener noreferrer">下载版本 Releases<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://seata.apache.org/zh-cn/docs/user/configurations" target="_blank" rel="noopener noreferrer">各种 seata 参数配置官网参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://seata.apache.org/zh-cn/docs/ops/deploy-guide-beginner" target="_blank" rel="noopener noreferrer">Seata 新手部署指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>mysql8.0 数据库里面建库+建表</p> <ul><li><p>建库 seata</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata<span class="token punctuation">;</span>
<span class="token keyword">USE</span> seata<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>在上一步 seata 库里建表</p> <ul><li><p>建表 SQL 地址：https://github.com/apache/incubator-seata/blob/develop/script/server/db/mysql.sql</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- -------------------------------- The script used when storeMode is 'db' --------------------------------</span>
<span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_status_gmt_modified<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>        <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>      <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>         <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'0:locked ,1:rollbacking'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span>       <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_value<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>expire<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'AsyncCommitting'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'RetryCommitting'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'RetryRollbacking'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'TxTimeoutCheck'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div></li></ul></li></ul></li> <li><p>更改配置</p> <ul><li><p>修改 <code>seata-server-2.0.0\conf\application.yml</code> 配置文件，记得先备份</p> <p><img src="/assets/img/image-20240519000443681.6d645195.webp" alt="image-20240519000443681"></p></li> <li><p><code>application.yml</code> 定稿版</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7091</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>logback<span class="token punctuation">-</span>spring.xml
  <span class="token key atrule">file</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>log.home<span class="token punctuation">:</span>$<span class="token punctuation">{</span>user.home<span class="token punctuation">}</span>/logs/seata<span class="token punctuation">}</span>
  <span class="token key atrule">extend</span><span class="token punctuation">:</span>
    <span class="token key atrule">logstash-appender</span><span class="token punctuation">:</span>
      <span class="token key atrule">destination</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">4560</span>
    <span class="token key atrule">kafka-appender</span><span class="token punctuation">:</span>
      <span class="token key atrule">bootstrap-servers</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">topic</span><span class="token punctuation">:</span> logback_to_logstash

<span class="token key atrule">console</span><span class="token punctuation">:</span>
  <span class="token key atrule">user</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> seata
    <span class="token key atrule">password</span><span class="token punctuation">:</span> seata
<span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token comment"># support: nacos, consul, apollo, zk, etcd3</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP <span class="token comment">#后续自己在nacos里面新建,不想新建SEATA_GROUP，就写DEFAULT_GROUP</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">context-path</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token comment"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP <span class="token comment">#后续自己在nacos里面新建,不想新建SEATA_GROUP，就写DEFAULT_GROUP</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster</span><span class="token punctuation">:</span> default
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
  <span class="token key atrule">store</span><span class="token punctuation">:</span>
    <span class="token comment"># support: file 、 db 、 redis 、 raft</span>
    <span class="token key atrule">mode</span><span class="token punctuation">:</span> db
    <span class="token key atrule">db</span><span class="token punctuation">:</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span> druid
      <span class="token key atrule">db-type</span><span class="token punctuation">:</span> mysql
      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
      <span class="token key atrule">user</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
      <span class="token key atrule">min-conn</span><span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token key atrule">max-conn</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token key atrule">global-table</span><span class="token punctuation">:</span> global_table
      <span class="token key atrule">branch-table</span><span class="token punctuation">:</span> branch_table
      <span class="token key atrule">lock-table</span><span class="token punctuation">:</span> lock_table
      <span class="token key atrule">distributed-lock-table</span><span class="token punctuation">:</span> distributed_lock
      <span class="token key atrule">query-limit</span><span class="token punctuation">:</span> <span class="token number">1000</span>
      <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">5000</span>
  <span class="token comment">#  server:</span>
  <span class="token comment">#    service-port: 8091 #If not configured, the default is '${server.port} + 1000'</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> SeataSecretKey0c382ef121d778043159209298fd40bf3850a017
    <span class="token key atrule">tokenValidityInMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">ignore</span><span class="token punctuation">:</span>
      <span class="token key atrule">urls</span><span class="token punctuation">:</span> /<span class="token punctuation">,</span>/<span class="token important">**/*.css</span><span class="token punctuation">,</span>/<span class="token important">**/*.js</span><span class="token punctuation">,</span>/<span class="token important">**/*.html</span><span class="token punctuation">,</span>/<span class="token important">**/*.map</span><span class="token punctuation">,</span>/<span class="token important">**/*.svg</span><span class="token punctuation">,</span>/<span class="token important">**/*.png</span><span class="token punctuation">,</span>/<span class="token important">**/*.jpeg</span><span class="token punctuation">,</span>/<span class="token important">**/*.ico</span><span class="token punctuation">,</span>/api/v1/auth/login<span class="token punctuation">,</span>/metadata/v1/<span class="token important">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div></li></ul></li> <li><p>先启动 Nacos2.2.3 端口号 8848</p> <ul><li><code>startup.cmd -m standalone</code></li> <li>命令运行成功后直接访问 http://localhost:8848/nacos
<ul><li>默认账号密码都是 nacos</li></ul></li></ul></li> <li><p>再启动 seata-server-2.0.0</p> <ul><li><p><code>D:\devSoft\seata-server-2.0.0\bin</code></p></li> <li><p><code>seata-server.bat</code> 命令执行后</p></li> <li><p>http://localhost:7091</p> <p><img src="/assets/img/image-20240519000807656.558cc691.webp" alt="image-20240519000807656"></p> <p><img src="/assets/img/image-20240519000754195.71f1a751.webp" alt="image-20240519000754195"></p></li></ul></li></ol> <h3 id="seata-案例实战-数据库和表准备"><a href="#seata-案例实战-数据库和表准备" class="header-anchor">#</a> Seata 案例实战-数据库和表准备</h3> <p><strong>订单 + 库存+ 账户 3 个业务数据库 MySQL 准备</strong></p> <p><strong>分布式事务本案例业务说明：</strong></p> <ul><li>这里我们创建三个服务，一个订单服务，一个库存服务，一个账户服务。</li> <li>当用户下单时，会在订单服务中创建一个订单，然后通过远程调用库存服务来扣减下单商品的库存；</li> <li>再通过远程调用账户服务来扣减用户账户里面的余额；</li> <li>最后在订单服务中修改订单状态为已完成。该操作跨越三个数据库，有两次远程调用，很明显会有分布式事务问题。</li> <li>下订单 → 减库存 → 扣余额 → 改（订单）状态</li></ul> <p><strong>数据库和表的创建：</strong></p> <ol><li>创建 3 个业务数据库 DATABASE
<ul><li>seata_order：存储订单的数据库；</li> <li>seata_storage：存储库存的数据库；</li> <li>seata_account：存储账户信息的数据库。</li></ul></li> <li>按照上述 3 库分别建对应的 undo_log 回滚日志表
<ul><li>订单-库存-账户 3 个库下都需要建各自的 undo_log 回滚日志表</li> <li><a href="https://github.com/apache/incubator-seata/blob/v2.0.0/script/client/at/db/mysql.sql" target="_blank" rel="noopener noreferrer">官网创建 sql<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>注：undo_log 为 AT 模式专用，其它模式不需要</strong></li></ul></li> <li>按照上述 3 库分别建对应业务表</li></ol> <p><strong>完整 sql：</strong></p> <ol><li><p>建 seata_order 库+建 t_order 表+undo_log 表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># order</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_order<span class="token punctuation">;</span>
<span class="token keyword">USE</span> seata_order<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>product_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'产品id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>count<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'数量'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>money<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span> <span class="token punctuation">(</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'金额'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单状态: 0:创建中; 1:已完结'</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_order<span class="token punctuation">;</span>


<span class="token comment">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>     <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'branch transaction id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>           <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'global transaction id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'undo_log context,such as serialization'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">LONGBLOB</span>     <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'rollback info'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span>    <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'0:normal status,1:defense status'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'create datetime'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span>  <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'modify datetime'</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COMMENT</span> <span class="token operator">=</span><span class="token string">'AT transaction mode undo table'</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>ix_log_created<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li> <li><p>建 seata_storage 库+建 t_storage 表+undo_log 表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#storage</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_storage<span class="token punctuation">;</span>
<span class="token keyword">USE</span> seata_storage<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_storage <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>product_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'产品id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'总库存'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'已用库存'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'剩余库存'</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_storage<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>product_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_storage<span class="token punctuation">;</span>

<span class="token comment">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>     <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'branch transaction id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>           <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'global transaction id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'undo_log context,such as serialization'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">LONGBLOB</span>     <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'rollback info'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span>    <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'0:normal status,1:defense status'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'create datetime'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span>  <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'modify datetime'</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COMMENT</span> <span class="token operator">=</span><span class="token string">'AT transaction mode undo table'</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>ix_log_created<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li> <li><p>建 seata_account 库+建 t_account 表+undo_log 表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#account</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_account<span class="token punctuation">;</span>
<span class="token keyword">USE</span> seata_account<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_account <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span> <span class="token punctuation">(</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'总额度'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span> <span class="token punctuation">(</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'已用余额'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span> <span class="token punctuation">(</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'剩余可用额度'</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_account<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'1000'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_account<span class="token punctuation">;</span>

<span class="token comment">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>     <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'branch transaction id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>           <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'global transaction id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'undo_log context,such as serialization'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">LONGBLOB</span>     <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'rollback info'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span>    <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'0:normal status,1:defense status'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'create datetime'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span>  <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'modify datetime'</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COMMENT</span> <span class="token operator">=</span><span class="token string">'AT transaction mode undo table'</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>ix_log_created<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li></ol> <h3 id="seata-案例实战-微服务编码落地实现"><a href="#seata-案例实战-微服务编码落地实现" class="header-anchor">#</a> Seata 案例实战-微服务编码落地实现</h3> <p><strong>订单/库存/账户业务微服务 Java 开发准备</strong></p> <h4 id="业务需求"><a href="#业务需求" class="header-anchor">#</a> 业务需求</h4> <p><font color="red" size="5"><b>下订单 → 减库存 → 扣余额 → 改（订单）状态</b></font></p> <h4 id="mybaits-一键生成"><a href="#mybaits-一键生成" class="header-anchor">#</a> Mybaits 一键生成</h4> <ol><li><p>config.properties</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#t_pay表包名</span>
<span class="token key attr-name">package.name</span><span class="token punctuation">=</span><span class="token value attr-value">com.atguigu.cloud</span>

<span class="token comment"># mysql8.0</span>
<span class="token key attr-name">jdbc.driverClass</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span> <span class="token value attr-value">jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
<span class="token key attr-name">jdbc.user</span> <span class="token punctuation">=</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">jdbc.password</span> <span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># seata_order</span>
<span class="token comment">#jdbc.driverClass = com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#jdbc.url = jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
<span class="token comment">#jdbc.user = root</span>
<span class="token comment">#jdbc.password =123456</span>

<span class="token comment"># seata_storage</span>
<span class="token comment">#jdbc.driverClass = com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#jdbc.url = jdbc:mysql://localhost:3306/seata_storage?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
<span class="token comment">#jdbc.user = root</span>
<span class="token comment">#jdbc.password =123456</span>

<span class="token comment"># seata_account</span>
<span class="token comment">#jdbc.driverClass = com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#jdbc.url = jdbc:mysql://localhost:3306/seata_account?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
<span class="token comment">#jdbc.user = root</span>
<span class="token comment">#jdbc.password =123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>generatorConfig.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">generatorConfiguration</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatorConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>config.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetRuntime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MyBatis3Simple<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultModelType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beginningDelimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>`<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>endingDelimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>`<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tk.mybatis.mapper.generator.MapperPlugin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mappers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tk.mybatis.mapper.common.Mapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>caseSensitive<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbcConnection</span> <span class="token attr-name">driverClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.driverClass}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">connectionURL</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">userId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.user}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbcConnection</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaModelGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.entities<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlMapGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.mapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaClientGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.mapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>XMLMAPPER<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>t_pay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">domainObjectName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Pay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatedKey</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlStatement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--  seata_order --&gt;</span>
        <span class="token comment">&lt;!--&lt;table tableName=&quot;t_order&quot; domainObjectName=&quot;Order&quot;&gt;
            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt;
        &lt;/table&gt;--&gt;</span>

        <span class="token comment">&lt;!--seata_storage--&gt;</span>
        <span class="token comment">&lt;!--&lt;table tableName=&quot;t_storage&quot; domainObjectName=&quot;Storage&quot;&gt;
            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt;
        &lt;/table&gt;--&gt;</span>

        <span class="token comment">&lt;!--seata_account--&gt;</span>
        <span class="token comment">&lt;!--&lt;table tableName=&quot;t_account&quot; domainObjectName=&quot;Account&quot;&gt;
            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt;
        &lt;/table&gt;--&gt;</span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatorConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div></li></ol> <h4 id="修改公共-cloud-api-commons-新增库存和账户两个-feign-服务接口"><a href="#修改公共-cloud-api-commons-新增库存和账户两个-feign-服务接口" class="header-anchor">#</a> 修改公共 cloud-api-commons 新增库存和账户两个 Feign 服务接口</h4> <ol><li><p>StorageFeignApi</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>apis</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;seata-storage-service&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageFeignApi</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 扣减库存
     * @param productId
     * @param count
     * @return
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/storage/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResultData</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;productId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>AccountFeignApi</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>apis</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;seata-account-service&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountFeignApi</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 扣减账户余额
     * @param userId
     * @param money
     * @return
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/account/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResultData</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h4 id="新建订单-order-微服务"><a href="#新建订单-order-微服务" class="header-anchor">#</a> 新建订单 Order 微服务</h4> <h5 id="建-module-2"><a href="#建-module-2" class="header-anchor">#</a> 建 Module</h5> <p>新建 module：<code>seata-order-service2001</code></p> <h5 id="改-pom"><a href="#改-pom" class="header-anchor">#</a> 改 POM</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-order-service2001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--alibaba-seata--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--openfeign--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--loadbalancer--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--cloud-api-commons--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot集成druid连接池--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mybatis和springboot整合--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Mysql数据库驱动8 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--persistence--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--通用Mapper4--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- fastjson2 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--test--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br></div></div><h5 id="写-yml"><a href="#写-yml" class="header-anchor">#</a> 写 YML</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>order<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>         <span class="token comment">#Nacos服务注册中心地址</span>
  <span class="token comment"># ==========applicationName + druid-mysql8 driver===================</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata_order<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
<span class="token comment"># ========================mybatis===================</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.cloud.entities
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># ========================seata===================</span>
<span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> default_tx_group <span class="token comment"># 事务组，由它获得TC服务的集群名称</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">vgroup-mapping</span><span class="token punctuation">:</span> <span class="token comment"># 点击源码分析</span>
      <span class="token key atrule">default_tx_group</span><span class="token punctuation">:</span> default <span class="token comment"># 事务组与TC服务集群的映射关系</span>
  <span class="token key atrule">data-source-proxy-mode</span><span class="token punctuation">:</span> AT

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">io</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><strong>seata 配置详细过度版</strong>（了解即可，太详细也不好维护）：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#seata:</span>
<span class="token comment">#  registry: # seata注册配置</span>
<span class="token comment">#    type: nacos # seata注册类型</span>
<span class="token comment">#    nacos:</span>
<span class="token comment">#      application: seata-server #seata应用名称</span>
<span class="token comment">#      server-addr: 127.0.0.1:8848</span>
<span class="token comment">#      namespace: &quot;&quot;</span>
<span class="token comment">#      group: SEATA_GROUP</span>
<span class="token comment">#      cluster: default</span>
<span class="token comment">#  config:             # seata配置抓取</span>
<span class="token comment">#    nacos:</span>
<span class="token comment">#      server-addr: 127.0.0.1:8848</span>
<span class="token comment">#      namespace: &quot;&quot;</span>
<span class="token comment">#      group: SEATA_GROUP</span>
<span class="token comment">#      username: nacos</span>
<span class="token comment">#      password: nacos</span>
<span class="token comment">#  tx-service-group: default_tx_group # 事务组，由它获得TC服务的集群名称</span>
<span class="token comment">#  service:</span>
<span class="token comment">#    vgroup-mapping:</span>
<span class="token comment">#      default_tx_group: default # 事务群组的映射配置关系</span>
<span class="token comment">#  data-source-proxy-mode: AT</span>
<span class="token comment">#  application-id: seata-server</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="主启动-2"><a href="#主启动-2" class="header-anchor">#</a> 主启动</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.cloud.mapper&quot;</span><span class="token punctuation">)</span> <span class="token comment">//import tk.mybatis.spring.annotation.MapperScan;</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">//服务注册和发现</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataOrderMainApp2001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SeataOrderMainApp2001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="业务类-2"><a href="#业务类-2" class="header-anchor">#</a> 业务类</h5> <h6 id="entities"><a href="#entities" class="header-anchor">#</a> entities</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>entities</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 表名：t_order
*/</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;t_order&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;JDBC&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 用户id
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 产品id
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> productId<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 数量
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 金额
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> money<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 订单状态: 0:创建中; 1:已完结
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h6 id="ordermapper"><a href="#ordermapper" class="header-anchor">#</a> OrderMapper</h6> <ol><li><p>OrderMapper 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>resources 文件夹下新建 mapper 文件夹后添加 OrderMapper.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloud.mapper.OrderMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloud.entities.Order<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--
          WARNING - @mbg.generated
        --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>product_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>productId<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>status<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>status<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ol> <h6 id="service-接口及实现"><a href="#service-接口及实现" class="header-anchor">#</a> Service 接口及实现</h6> <ol><li><p>OrderService</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 创建订单
     * @param order
     */</span>
    <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>OrderServiceImpl</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 下订单-&gt;减库存-&gt;扣余额-&gt;改(订单)状态
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span> <span class="token comment">//订单微服务通过OpenFeign去调用库存微服务</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageFeignApi</span> storageFeignApi<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span> <span class="token comment">//订单微服务通过OpenFeign去调用账户微服务</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountFeignApi</span> accountFeignApi<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;zzyy-create-order&quot;</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// xid 全局事务id的检查，重要</span>
        <span class="token class-name">String</span> xid <span class="token operator">=</span> <span class="token class-name">RootContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1. 新建订单</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;------------------开始新建订单&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;xid:&quot;</span> <span class="token operator">+</span> xid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 订单新建时默认初始订单状态是零</span>
        <span class="token comment">// 订单状态 status：0：创建中；1：已完结</span>
        order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">insertSelective</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 插入订单成功后获得插入mysql的实体对象</span>
        <span class="token class-name">Order</span> orderFromDB<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 从mysql里面查出刚插入的记录</span>
            orderFromDB <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// orderFromDB = orderMapper.selectByPrimaryKey(order.getId());</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; 新建订单成功，orderFromDB info: &quot;</span> <span class="token operator">+</span> orderFromDB<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2. 扣减库存</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; 订单微服务开始调用Storage库存，做扣减count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            storageFeignApi<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>orderFromDB<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderFromDB<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; 订单微服务结束调用Storage库存，做扣减完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 3. 扣减账号余额</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; 订单微服务开始调用Account账号，做扣减money&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            accountFeignApi<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>orderFromDB<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderFromDB<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; 订单微服务结束调用Account账号，做扣减完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 4. 修改订单状态</span>
            <span class="token comment">// 将订单状态从0修改为1，表示已经完成</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; 修改订单状态&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderFromDB<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Example</span> whereCondition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Example<span class="token punctuation">.</span>Criteria</span> criteria <span class="token operator">=</span> whereCondition<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> orderFromDB<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">int</span> updateResult <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">updateByExampleSelective</span><span class="token punctuation">(</span>orderFromDB<span class="token punctuation">,</span> whereCondition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; 修改订单状态完成&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> updateResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt; orderFromDB info: &quot;</span> <span class="token operator">+</span> orderFromDB<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;------------------结束新建订单&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;xid:&quot;</span> <span class="token operator">+</span> xid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div></li></ol> <h6 id="ordercontroller"><a href="#ordercontroller" class="header-anchor">#</a> OrderController</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 创建订单
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/order/create&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        orderService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="新建库存-storage-微服务"><a href="#新建库存-storage-微服务" class="header-anchor">#</a> 新建库存 Storage 微服务</h4> <h5 id="建-module-3"><a href="#建-module-3" class="header-anchor">#</a> 建 Module</h5> <p>新建 Module：<code>seata-storage-service2002</code></p> <h5 id="改-pom-2"><a href="#改-pom-2" class="header-anchor">#</a> 改 POM</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-storage-service2002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--alibaba-seata--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--openfeign--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--loadbalancer--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--cloud_commons_utils--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot集成druid连接池--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mybatis和springboot整合--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Mysql数据库驱动8 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--persistence--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--通用Mapper4--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- fastjson2 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--test--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br></div></div><h5 id="写-yml-2"><a href="#写-yml-2" class="header-anchor">#</a> 写 YML</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2002</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>storage<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>         <span class="token comment">#Nacos服务注册中心地址</span>
  <span class="token comment"># ==========applicationName + druid-mysql8 driver===================</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata_storage<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
<span class="token comment"># ========================mybatis===================</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.cloud.entities
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment"># ========================seata===================</span>
<span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> default_tx_group <span class="token comment"># 事务组，由它获得TC服务的集群名称</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">vgroup-mapping</span><span class="token punctuation">:</span>
      <span class="token key atrule">default_tx_group</span><span class="token punctuation">:</span> default <span class="token comment"># 事务组与TC服务集群的映射关系</span>
  <span class="token key atrule">data-source-proxy-mode</span><span class="token punctuation">:</span> AT

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">io</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h5 id="主启动-3"><a href="#主启动-3" class="header-anchor">#</a> 主启动</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.cloud.mapper&quot;</span><span class="token punctuation">)</span> <span class="token comment">//import tk.mybatis.spring.annotation.MapperScan;</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">//服务注册和发现</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataStorageMainApp2002</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SeataStorageMainApp2002</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="业务类-3"><a href="#业务类-3" class="header-anchor">#</a> 业务类</h5> <h6 id="entities-2"><a href="#entities-2" class="header-anchor">#</a> entities</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>entities</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 表名：t_storage
*/</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;t_storage&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Storage</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;JDBC&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 产品id
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> productId<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 总库存
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> total<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 已用库存
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> used<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 剩余库存
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> residue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h6 id="ordermapper-2"><a href="#ordermapper-2" class="header-anchor">#</a> OrderMapper</h6> <ol><li><p>StorageMapper 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Storage</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 减库存
     * @param productId
     * @param count
     */</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;productId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>resources 文件夹下新建 mapper 文件夹后添加 StorageMapper.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloud.mapper.StorageMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloud.entities.Storage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--
          WARNING - @mbg.generated
        --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>product_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>productId<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decrease<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        UPDATE
            t_storage
        SET used    = used + #{count},
            residue = residue - #{count}
        WHERE product_id = #{productId}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ol> <h6 id="service-接口及实现-2"><a href="#service-接口及实现-2" class="header-anchor">#</a> Service 接口及实现</h6> <ol><li><p>StorageService</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 扣减库存
     * @param productId
     * @param count
     */</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>StorageServiceImpl</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StorageServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageMapper</span> storageMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 扣减库存
     * @param productId
     * @param count
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;storage-service中扣减库存开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        storageMapper<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>productId<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;storage-service中扣减库存结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ol> <h6 id="controller"><a href="#controller" class="header-anchor">#</a> Controller</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StorageController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 扣减库存
     * @param productId
     * @param count
     * @return
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/storage/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        storageService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>productId<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;扣减库存成功!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="新建账户-account-微服务"><a href="#新建账户-account-微服务" class="header-anchor">#</a> 新建账户 Account 微服务</h4> <h5 id="建-module-4"><a href="#建-module-4" class="header-anchor">#</a> 建 Module</h5> <p>新建 module：<code>seata-account-service2003</code></p> <h5 id="改-pom-3"><a href="#改-pom-3" class="header-anchor">#</a> 改 POM</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-account-service2003<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--alibaba-seata--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--openfeign--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--loadbalancer--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--cloud_commons_utils--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot集成druid连接池--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mybatis和springboot整合--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Mysql数据库驱动8 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--persistence--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--通用Mapper4--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- fastjson2 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--test--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br></div></div><h5 id="写-yml-3"><a href="#写-yml-3" class="header-anchor">#</a> 写 YML</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2003</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>account<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>         <span class="token comment">#Nacos服务注册中心地址</span>
  <span class="token comment"># ==========applicationName + druid-mysql8 driver===================</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata_account<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
<span class="token comment"># ========================mybatis===================</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.cloud.entities
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># ========================seata===================</span>
<span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> default_tx_group <span class="token comment"># 事务组，由它获得TC服务的集群名称</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">vgroup-mapping</span><span class="token punctuation">:</span>
      <span class="token key atrule">default_tx_group</span><span class="token punctuation">:</span> default <span class="token comment"># 事务组与TC服务集群的映射关系</span>
  <span class="token key atrule">data-source-proxy-mode</span><span class="token punctuation">:</span> AT

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">io</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h5 id="主启动-4"><a href="#主启动-4" class="header-anchor">#</a> 主启动</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.cloud.mapper&quot;</span><span class="token punctuation">)</span> <span class="token comment">//import tk.mybatis.spring.annotation.MapperScan;</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataAccountMainApp2003</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SeataAccountMainApp2003</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="业务类-4"><a href="#业务类-4" class="header-anchor">#</a> 业务类</h5> <h6 id="entities-3"><a href="#entities-3" class="header-anchor">#</a> entities</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>entities</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 表名：t_account
*/</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;t_account&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * id
     */</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;JDBC&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 用户id
     */</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 总额度
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> total<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 已用余额
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> used<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 剩余可用额度
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> residue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h6 id="ordermapper-3"><a href="#ordermapper-3" class="header-anchor">#</a> OrderMapper</h6> <ol><li><p>AccountMapper 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 本次消费金额
     * @param userId
     * @param money
     */</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>resources 文件夹下新建 mapper 文件夹后添加 AccountMapper.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloud.mapper.AccountMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloud.entities.Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--
          WARNING - @mbg.generated
        --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--
          money   本次消费金额
          t_account数据库表
          total总额度 = 累计已消费金额(used) + 剩余可用额度(residue)
      --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decrease<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        UPDATE
            t_account
        SET residue = residue - #{money},
            used    = used + #{money}
        WHERE user_id = #{userId};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li></ol> <h6 id="service-接口及实现-3"><a href="#service-接口及实现-3" class="header-anchor">#</a> Service 接口及实现</h6> <ol><li><p>AccountService</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 扣减账户余额
     * @param userId 用户id
     * @param money 本次消费金额
     */</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>AccountServiceImpl</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountService</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>AccountService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 扣减账户余额
     * @param userId 用户id
     * @param money 本次消费金额
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">Long</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;account-service中扣减账户余额开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountMapper<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//myTimeOut();</span>
        <span class="token comment">//int age = 10/0;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;account-service中扣减账户余额结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 模拟超时异常，全局事务回滚
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">myTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></li></ol> <h6 id="controller-2"><a href="#controller-2" class="header-anchor">#</a> Controller</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 扣减账户余额
     * @param userId
     * @param money
     * @return
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/account/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> money<span class="token punctuation">)</span><span class="token punctuation">{</span>
        accountService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;扣减账户余额成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="seata-案例实战-测试"><a href="#seata-案例实战-测试" class="header-anchor">#</a> Seata 案例实战-测试</h3> <h4 id="服务启动情况"><a href="#服务启动情况" class="header-anchor">#</a> 服务启动情况</h4> <ol><li>启动 Nacos</li> <li>启动 Seata</li> <li>启动订单微服务 2001</li> <li>启动库存微服务 2002</li> <li>启动账户微服务 2003</li></ol> <h4 id="数据库初始情况"><a href="#数据库初始情况" class="header-anchor">#</a> 数据库初始情况</h4> <p><img src="/assets/img/image-20240519173238735.dd233da2.webp" alt="image-20240519173238735"></p> <h4 id="正常下单"><a href="#正常下单" class="header-anchor">#</a> 正常下单</h4> <p>此注：此时我们没有在订单模块添加 <code>@GlobalTransactional</code> 注解</p> <p>测试地址：http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100</p> <p>1 号用户花费 100 块钱买了 10 个 1 号产品</p> <p><strong>正常下单，第 1 次：</strong></p> <ul><li><p>故障现象：</p> <p><img src="/assets/img/image-20240519182204099.29f0ece3.webp" alt="image-20240519182204099"></p></li> <li><p>故障原因：springboot+springcloud 版本太高导致和阿里巴巴 Seata 不兼容</p></li> <li><p>解决方案：总体父工程，boot+cloud 降低版本</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--&lt;spring.boot.version&gt;3.2.0&lt;/spring.boot.version&gt;
&lt;spring.cloud.version&gt;2023.0.0&lt;/spring.cloud.version&gt; --&gt;</span>
<span class="token comment">&lt;!--上面的配置暂时为本案例注释掉，版本降级一下。
讲解完后请恢复上述高版本保持前后配置一致，请用下面的任一个版本替代上述 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>3.0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>2022.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--仅为了整合openfeign + alibaba seata的案例，降低版本处理下--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>3.1.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>2022.0.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <p><strong>正常下单，第 2 次</strong>：一切正常</p> <h4 id="超时异常出错-没有-globaltransactional"><a href="#超时异常出错-没有-globaltransactional" class="header-anchor">#</a> 超时异常出错，没有@GlobalTransactional</h4> <ol><li><p>修改 seata-account-service2003 微服务 AccountServiceImpl 添加超时</p> <p><img src="/assets/img/image-20240519185456048.806380e0.webp" alt="image-20240519185456048"></p></li> <li><p>故障情况：当库存和账户金额扣减后，订单状态并没有设置为已经完成，没有从零改为 1</p></li> <li><p>运行时异常同理。</p></li></ol> <h4 id="超时异常解决-添加-globaltransactional"><a href="#超时异常解决-添加-globaltransactional" class="header-anchor">#</a> 超时异常解决，添加@GlobalTransactional</h4> <ol><li><p>AccountServiceImpl 保留超时方法</p></li> <li><p>OrderServiceImpl 添加 <code>@GlobalTransactional</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;zzyy-create-order&quot;</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>此时，订单模块就是 TM，也是其中一个 RM</p></li> <li><p>查看 Seata 后台：http://localhost:7091/#/login</p> <ul><li><p>全局事务 ID</p> <p><img src="/assets/img/image-20240519204525977.682b1af9.webp" alt="image-20240519204525977"></p></li> <li><p>全局锁</p> <p><img src="/assets/img/image-20240519204550838.e7821ac0.webp" alt="image-20240519204550838"></p></li></ul></li> <li><p>下单后数据库 3 个库数据并没有任何改变，被回滚了</p> <ul><li><p>业务中...</p> <ul><li><p>按照正常逻辑，本该有新记录入库，等待最后完成提交。</p> <p><img src="/assets/img/image-20240519204652024.9364f546.webp" alt="image-20240519204652024"></p></li></ul></li> <li><p>回滚后</p> <ul><li><p>order 记录都添加不进来</p> <ul><li><p>上一步准备新增的记录被彻底回滚了，保证的一致性。</p> <p><img src="data:image/webp;base64,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" alt="image-20240519204758274"></p></li></ul></li> <li><p>全部回退</p></li></ul></li></ul></li></ol> <h3 id="seata-原理小总结和面试题"><a href="#seata-原理小总结和面试题" class="header-anchor">#</a> Seata 原理小总结和面试题</h3> <p><strong>AT 模式如何做到对业务的无侵入</strong></p> <p><strong>是什么：</strong></p> <p><img src="/assets/img/image-20240519001054552.d213b034.webp" alt="image-20240519001054552"></p> <p><strong>一阶段加载：</strong></p> <p>在一阶段，Seata 会拦截“业务 SQL”，</p> <ol><li>解析 SQL 语义，找到“业务 SQL”要更新的业务数据，在业务数据被更新前，将其保存成“before image”，</li> <li>执行“业务 SQL”更新业务数据，在业务数据更新之后，</li> <li>其保存成“after image”，最后生成行锁。</li></ol> <p>以上操作全部在一个数据库事务内完成，这样保证了一阶段操作的原子性。</p> <p><img src="/assets/img/image-20240519001140886.f48b66cb.webp" alt="image-20240519001140886"></p> <p><strong>二阶段分 2 种情况：</strong></p> <ol><li><p>正常提交</p> <ul><li><p>二阶段如是顺利提交的话，因为“业务 SQL”在一阶段已经提交至数据库，所以 Seata 框架只需<strong>将一阶段保存的快照数据和行锁删掉，完成数据清理即可</strong>。</p> <p><img src="/assets/img/image-20240519001256319.bcb001ed.webp" alt="image-20240519001256319"></p></li></ul></li> <li><p>异常回滚</p> <ul><li><p>二阶段回滚：</p> <ul><li><p><strong>二阶段如果是回滚的话，Seata 就需要回滚一阶段已经执行的“业务 SQL”，还原业务数据</strong>。</p></li> <li><p>回滚方式便是用“before image”还原业务数据；但在还原前要首先要校验脏写，对比“数据库当前业务数据”和 “after image”，</p></li> <li><p>如果两份数据完全一致就说明没有脏写，可以还原业务数据，如果不一致就说明有脏写，出现脏写就需要转人工处理。</p> <p><img src="/assets/img/image-20240519001333351.ec1c95a4.webp" alt="image-20240519001333351"></p></li></ul></li></ul></li></ol></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/06/12, 00:25:27</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/micro-service-core/SpringCloud/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Spring Cloud</div></a> <a href="/micro-service-core/MyBatis/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">持久层框架之 MyBatis</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/micro-service-core/SpringCloud/" class="prev">Spring Cloud</a></span> <span class="next"><a href="/micro-service-core/MyBatis/">持久层框架之 MyBatis</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/jdbc-core/"><div>
            JDBC 核心技术(JDK21版)
            <!----></div></a> <span class="date">09-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/"><div>
            第00章_写在前面
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/"><div>
            第01章_Linux 下 MySQL 的安装与使用
            <!----></div></a> <span class="date">05-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca5c989c.js" defer></script><script src="/assets/js/3.f2884e99.js" defer></script><script src="/assets/js/2.81e8b964.js" defer></script><script src="/assets/js/12.04b9b957.js" defer></script>
  </body>
</html>
