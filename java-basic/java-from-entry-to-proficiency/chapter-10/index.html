<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第10章_多线程 | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.ca5c989c.js" as="script"><link rel="preload" href="/assets/js/3.f2884e99.js" as="script"><link rel="preload" href="/assets/js/2.81e8b964.js" as="script"><link rel="preload" href="/assets/js/26.936ee89a.js" as="script"><link rel="prefetch" href="/assets/js/1.f754fd0b.js"><link rel="prefetch" href="/assets/js/10.bde6e567.js"><link rel="prefetch" href="/assets/js/100.000718ad.js"><link rel="prefetch" href="/assets/js/101.863f022a.js"><link rel="prefetch" href="/assets/js/102.7b45f43b.js"><link rel="prefetch" href="/assets/js/103.ba5681a8.js"><link rel="prefetch" href="/assets/js/104.e35b7e87.js"><link rel="prefetch" href="/assets/js/105.15a150cd.js"><link rel="prefetch" href="/assets/js/106.aea81b3b.js"><link rel="prefetch" href="/assets/js/107.4f4dec09.js"><link rel="prefetch" href="/assets/js/108.0079fda6.js"><link rel="prefetch" href="/assets/js/109.7a5059de.js"><link rel="prefetch" href="/assets/js/11.fa1b0bc7.js"><link rel="prefetch" href="/assets/js/110.85007649.js"><link rel="prefetch" href="/assets/js/111.dbec93e3.js"><link rel="prefetch" href="/assets/js/112.f17a38c0.js"><link rel="prefetch" href="/assets/js/113.6478506e.js"><link rel="prefetch" href="/assets/js/114.6031c0db.js"><link rel="prefetch" href="/assets/js/115.d7094af2.js"><link rel="prefetch" href="/assets/js/116.316a6234.js"><link rel="prefetch" href="/assets/js/117.1336f5e0.js"><link rel="prefetch" href="/assets/js/118.4b882789.js"><link rel="prefetch" href="/assets/js/119.503f83be.js"><link rel="prefetch" href="/assets/js/12.04b9b957.js"><link rel="prefetch" href="/assets/js/120.af7d94d8.js"><link rel="prefetch" href="/assets/js/121.5cd3597d.js"><link rel="prefetch" href="/assets/js/122.82f45642.js"><link rel="prefetch" href="/assets/js/123.f2ba0b19.js"><link rel="prefetch" href="/assets/js/13.680e50fd.js"><link rel="prefetch" href="/assets/js/14.dfca4100.js"><link rel="prefetch" href="/assets/js/15.01784967.js"><link rel="prefetch" href="/assets/js/16.81c1d5ab.js"><link rel="prefetch" href="/assets/js/17.9a472859.js"><link rel="prefetch" href="/assets/js/18.5366cb68.js"><link rel="prefetch" href="/assets/js/19.b1b74ef9.js"><link rel="prefetch" href="/assets/js/20.e938fa21.js"><link rel="prefetch" href="/assets/js/21.3e38db33.js"><link rel="prefetch" href="/assets/js/22.f9d18654.js"><link rel="prefetch" href="/assets/js/23.8eea4b67.js"><link rel="prefetch" href="/assets/js/24.6fe732dc.js"><link rel="prefetch" href="/assets/js/25.b1885cb6.js"><link rel="prefetch" href="/assets/js/27.fb3beb63.js"><link rel="prefetch" href="/assets/js/28.af721a74.js"><link rel="prefetch" href="/assets/js/29.427b7eae.js"><link rel="prefetch" href="/assets/js/30.2af5e34e.js"><link rel="prefetch" href="/assets/js/31.60102330.js"><link rel="prefetch" href="/assets/js/32.746872da.js"><link rel="prefetch" href="/assets/js/33.9466d03b.js"><link rel="prefetch" href="/assets/js/34.c7f7b0ef.js"><link rel="prefetch" href="/assets/js/35.53799eb8.js"><link rel="prefetch" href="/assets/js/36.e8875fc1.js"><link rel="prefetch" href="/assets/js/37.c386b2c5.js"><link rel="prefetch" href="/assets/js/38.ee46082f.js"><link rel="prefetch" href="/assets/js/39.11d092ff.js"><link rel="prefetch" href="/assets/js/4.920d0610.js"><link rel="prefetch" href="/assets/js/40.4ee40bcf.js"><link rel="prefetch" href="/assets/js/41.81c3174c.js"><link rel="prefetch" href="/assets/js/42.18f42b9d.js"><link rel="prefetch" href="/assets/js/43.7426d1ac.js"><link rel="prefetch" href="/assets/js/44.d5baff75.js"><link rel="prefetch" href="/assets/js/45.7b25c5ca.js"><link rel="prefetch" href="/assets/js/46.dff72ed3.js"><link rel="prefetch" href="/assets/js/47.15531a4f.js"><link rel="prefetch" href="/assets/js/48.48bbc098.js"><link rel="prefetch" href="/assets/js/49.49acd468.js"><link rel="prefetch" href="/assets/js/5.847584a2.js"><link rel="prefetch" href="/assets/js/50.e26ee1bf.js"><link rel="prefetch" href="/assets/js/51.6728bddb.js"><link rel="prefetch" href="/assets/js/52.c238e7bf.js"><link rel="prefetch" href="/assets/js/53.025903f6.js"><link rel="prefetch" href="/assets/js/54.05baf03a.js"><link rel="prefetch" href="/assets/js/55.b6fc3e0a.js"><link rel="prefetch" href="/assets/js/56.8e5ef1fc.js"><link rel="prefetch" href="/assets/js/57.db41b6fb.js"><link rel="prefetch" href="/assets/js/58.b4cb51f8.js"><link rel="prefetch" href="/assets/js/59.423b27e1.js"><link rel="prefetch" href="/assets/js/6.b384c550.js"><link rel="prefetch" href="/assets/js/60.57eff889.js"><link rel="prefetch" href="/assets/js/61.387a5103.js"><link rel="prefetch" href="/assets/js/62.23ba2982.js"><link rel="prefetch" href="/assets/js/63.2d69780b.js"><link rel="prefetch" href="/assets/js/64.d3f669fb.js"><link rel="prefetch" href="/assets/js/65.f5410640.js"><link rel="prefetch" href="/assets/js/66.59887fb2.js"><link rel="prefetch" href="/assets/js/67.01fba30e.js"><link rel="prefetch" href="/assets/js/68.8a6bbb81.js"><link rel="prefetch" href="/assets/js/69.12e673c4.js"><link rel="prefetch" href="/assets/js/70.a227d4b3.js"><link rel="prefetch" href="/assets/js/71.bd6a3bd7.js"><link rel="prefetch" href="/assets/js/72.4f2efca4.js"><link rel="prefetch" href="/assets/js/73.7dbf57a8.js"><link rel="prefetch" href="/assets/js/74.28c26d0a.js"><link rel="prefetch" href="/assets/js/75.d36a4feb.js"><link rel="prefetch" href="/assets/js/76.9123efc1.js"><link rel="prefetch" href="/assets/js/77.cbe2020d.js"><link rel="prefetch" href="/assets/js/78.7ab3eb40.js"><link rel="prefetch" href="/assets/js/79.bc69c4a8.js"><link rel="prefetch" href="/assets/js/80.da17de0b.js"><link rel="prefetch" href="/assets/js/81.1d16813f.js"><link rel="prefetch" href="/assets/js/82.586f2e97.js"><link rel="prefetch" href="/assets/js/83.129cc5fa.js"><link rel="prefetch" href="/assets/js/84.83d65ed9.js"><link rel="prefetch" href="/assets/js/85.f4327096.js"><link rel="prefetch" href="/assets/js/86.866a7d4f.js"><link rel="prefetch" href="/assets/js/87.f8aba274.js"><link rel="prefetch" href="/assets/js/88.43c5a138.js"><link rel="prefetch" href="/assets/js/89.b47b6d86.js"><link rel="prefetch" href="/assets/js/9.ef15744b.js"><link rel="prefetch" href="/assets/js/90.4950712a.js"><link rel="prefetch" href="/assets/js/91.80bbaffe.js"><link rel="prefetch" href="/assets/js/92.0d03ce50.js"><link rel="prefetch" href="/assets/js/93.fff94cff.js"><link rel="prefetch" href="/assets/js/94.91d0e36d.js"><link rel="prefetch" href="/assets/js/95.15227fb3.js"><link rel="prefetch" href="/assets/js/96.b3ef20b0.js"><link rel="prefetch" href="/assets/js/97.9e5e1675.js"><link rel="prefetch" href="/assets/js/98.b213b526.js"><link rel="prefetch" href="/assets/js/99.1ec76897.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b448e12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link router-link-active">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link router-link-active">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>核心</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Java从入门到精通(JDK17版)</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-1/" class="sidebar-link">第01章_Java 语言概述</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-2/" class="sidebar-link">第02章_变量与运算符</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-3/" class="sidebar-link">第03章_流程控制语句</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-4/" class="sidebar-link">第04章_IDEA 的安装与使用</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-5/" class="sidebar-link">第05章_数组</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-6/" class="sidebar-link">第06章_面向对象编程（基础）</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-7/" class="sidebar-link">第07章_面向对象编程（进阶）</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-8/" class="sidebar-link">第08章_面向对象编程（高级）</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-9/" class="sidebar-link">第09章_异常处理</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/" aria-current="page" class="active sidebar-link">第10章_多线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#本章专题与脉络" class="sidebar-link">本章专题与脉络</a></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-相关概念" class="sidebar-link">1. 相关概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-1-程序、进程与线程" class="sidebar-link">1.1 程序、进程与线程</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-2-查看进程和线程" class="sidebar-link">1.2 查看进程和线程</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-3-线程调度" class="sidebar-link">1.3 线程调度</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-4-多线程程序的优点" class="sidebar-link">1.4 多线程程序的优点</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-5-补充概念" class="sidebar-link">1.5 补充概念</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-5-1-单核-cpu-和多核-cpu" class="sidebar-link">1.5.1 单核 CPU 和多核 CPU</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_1-5-2-并行与并发" class="sidebar-link">1.5.2 并行与并发</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_2-创建和启动线程" class="sidebar-link">2.创建和启动线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_2-1-概述" class="sidebar-link">2.1 概述</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_2-2-方式-1-继承-thread-类" class="sidebar-link">2.2 方式 1：继承 Thread 类</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_2-3-方式-2-实现-runnable-接口" class="sidebar-link">2.3 方式 2：实现 Runnable 接口</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_2-4-变形写法" class="sidebar-link">2.4 变形写法</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_2-5-对比两种方式" class="sidebar-link">2.5 对比两种方式</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_2-6-练习" class="sidebar-link">2.6 练习</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_3-thread-类的常用结构" class="sidebar-link">3. Thread 类的常用结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_3-1-构造器" class="sidebar-link">3.1 构造器</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_3-2-常用方法系列-1" class="sidebar-link">3.2 常用方法系列 1</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_3-3-常用方法系列-2" class="sidebar-link">3.3 常用方法系列 2</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_3-4-常用方法系列-3" class="sidebar-link">3.4 常用方法系列 3</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_3-5-守护线程-了解" class="sidebar-link">3.5 守护线程（了解）</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_4-多线程的生命周期" class="sidebar-link">4. 多线程的生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_4-1-jdk1-5-之前-5-种状态" class="sidebar-link">4.1 JDK1.5 之前：5 种状态</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_4-2-jdk1-5-及之后-6-种状态" class="sidebar-link">4.2 JDK1.5 及之后：6 种状态</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-线程安全问题及解决" class="sidebar-link">5. 线程安全问题及解决</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-1-同一个资源问题和线程安全问题" class="sidebar-link">5.1 同一个资源问题和线程安全问题</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-1-1-局部变量不能共享" class="sidebar-link">5.1.1 局部变量不能共享</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-1-2-不同对象的实例变量不共享" class="sidebar-link">5.1.2 不同对象的实例变量不共享</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-1-3-静态变量是共享的" class="sidebar-link">5.1.3 静态变量是共享的</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-1-4-同一个对象的实例变量共享" class="sidebar-link">5.1.4 同一个对象的实例变量共享</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-1-5-抽取资源类-共享同一个资源对象" class="sidebar-link">5.1.5 抽取资源类，共享同一个资源对象</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-2-同步机制解决线程安全问题" class="sidebar-link">5.2 同步机制解决线程安全问题</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-2-1-同步机制解决线程安全问题的原理" class="sidebar-link">5.2.1 同步机制解决线程安全问题的原理</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-2-2-同步代码块和同步方法" class="sidebar-link">5.2.2 同步代码块和同步方法</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-2-3-同步锁机制" class="sidebar-link">5.2.3 同步锁机制</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-2-4-synchronized-的锁是什么" class="sidebar-link">5.2.4 synchronized 的锁是什么</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-2-5-同步操作的思考顺序" class="sidebar-link">5.2.5 同步操作的思考顺序</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-2-6-代码演示" class="sidebar-link">5.2.6 代码演示</a></li><li class="sidebar-sub-header level5"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#示例一-静态方法加锁" class="sidebar-link">示例一：静态方法加锁</a></li><li class="sidebar-sub-header level5"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#示例二-非静态方法加锁" class="sidebar-link">示例二：非静态方法加锁</a></li><li class="sidebar-sub-header level5"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#示例三-同步代码块" class="sidebar-link">示例三：同步代码块</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_5-3-练习" class="sidebar-link">5.3 练习</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_6-再谈同步" class="sidebar-link">6. 再谈同步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_6-1-单例设计模式的线程安全问题" class="sidebar-link">6.1 单例设计模式的线程安全问题</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_6-1-1-饿汉式没有线程安全问题" class="sidebar-link">6.1.1 饿汉式没有线程安全问题</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_6-1-2-懒汉式线程安全问题" class="sidebar-link">6.1.2 懒汉式线程安全问题</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_6-2-死锁" class="sidebar-link">6.2 死锁</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_6-3-jdk5-0-新特性-lock-锁" class="sidebar-link">6.3 JDK5.0 新特性：Lock（锁）</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-线程的通信" class="sidebar-link">7. 线程的通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-1-线程间通信" class="sidebar-link">7.1 线程间通信</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-2-等待唤醒机制" class="sidebar-link">7.2 等待唤醒机制</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-3-举例" class="sidebar-link">7.3 举例</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-4-调用-wait-和-notify-需注意的细节" class="sidebar-link">7.4 调用 wait 和 notify 需注意的细节</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-5-生产者与消费者问题" class="sidebar-link">7.5 生产者与消费者问题</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-6-面试题-区分-sleep-和-wait" class="sidebar-link">7.6 面试题：区分 sleep())和 wait()</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-7-是否释放锁的操作" class="sidebar-link">7.7 是否释放锁的操作</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-7-1-释放锁的操作" class="sidebar-link">7.7.1 释放锁的操作</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_7-7-2-不会释放锁的操作" class="sidebar-link">7.7.2 不会释放锁的操作</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_8-jdk5-0-新增线程创建方式" class="sidebar-link">8. JDK5.0 新增线程创建方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_8-1-新增方式一-实现-callable-接口" class="sidebar-link">8.1 新增方式一：实现 Callable 接口</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/java-from-entry-to-proficiency/chapter-10/#_8-2-新增方式二-使用线程池" class="sidebar-link">8.2 新增方式二：使用线程池</a></li></ul></li></ul></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-11/" class="sidebar-link">第11章_常用类和基础 API</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-12/" class="sidebar-link">第12章_集合框架</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-13/" class="sidebar-link">第13章_泛型</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-14/" class="sidebar-link">第14章_数据结构与集合源码</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-15/" class="sidebar-link">第15章_File 类与 IO 流</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-16/" class="sidebar-link">第16章_网络编程</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-17/" class="sidebar-link">第17章_反射机制</a></li><li><a href="/java-basic/java-from-entry-to-proficiency/chapter-18/" class="sidebar-link">第18章_JDK 8-17 新特性</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>MySQL从入门到高级-基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>MySQL从入门到高级-高级篇</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/java-basic/jdbc-core/" class="sidebar-link">JDBC 核心技术(JDK21版)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=Java%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>Java基础</a></li><li data-v-06225672><a href="/categories/?category=%E6%A0%B8%E5%BF%83" title="分类" data-v-06225672>核心</a></li><li data-v-06225672><a href="/categories/?category=Java%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%28JDK17%E7%89%88%29" title="分类" data-v-06225672>Java从入门到精通(JDK17版)</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-01-14</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">第10章_多线程<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="第-10-章-多线程"><a href="#第-10-章-多线程" class="header-anchor">#</a> 第 10 章_多线程</h1> <p>讲师：尚硅谷-宋红康（江湖人称：康师傅）</p> <p>官网：<a href="http://www.atguigu.com/" target="_blank" rel="noopener noreferrer">http://www.atguigu.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <h2 id="本章专题与脉络"><a href="#本章专题与脉络" class="header-anchor">#</a> 本章专题与脉络</h2> <p><img src="/assets/img/第3阶段：Java高级应用-第10章.d69a380d.webp" alt="第3阶段：Java高级应用-第10章"></p> <hr> <p>我们之前学习的程序在没有跳转语句的情况下，都是由上至下沿着一条路径依次执行。现在想要设计一个程序，可以同时有多条执行路径同时执行。比如，<code>一边游戏，一边qq聊天，一边听歌</code>，怎么设计？</p> <p><img src="/assets/img/c3dcb61e3b.b1f76565.webp" alt="c3dcb61e3b"></p> <p>要解决上述问题，需要使用<code>多进程</code>或者<code>多线程</code>来解决。</p> <h2 id="_1-相关概念"><a href="#_1-相关概念" class="header-anchor">#</a> 1. 相关概念</h2> <h3 id="_1-1-程序、进程与线程"><a href="#_1-1-程序、进程与线程" class="header-anchor">#</a> 1.1 程序、进程与线程</h3> <ul><li><p><strong>程序(program)</strong>：为完成特定任务，用某种语言编写的<code>一组指令的集合</code>。即指<code>一段静态的代码</code>，静态对象。</p></li> <li><p><strong>进程(process)</strong>：程序的一次执行过程，或是正在内存中运行的应用程序。如：运行中的 QQ，运行中的网易音乐播放器。</p> <ul><li>每个进程都有一个独立的内存空间，系统运行一个程序即是一个进程从创建、运行到消亡的过程。（生命周期）</li> <li>程序是静态的，进程是动态的</li> <li>进程作为<code>操作系统调度和分配资源的最小单位</code>（亦是系统运行程序的基本单位），系统在运行时会为每个进程分配不同的内存区域。</li> <li>现代的操作系统，大都是支持多进程的，支持同时运行多个程序。比如：现在我们上课一边使用编辑器，一边使用录屏软件，同时还开着画图板，dos 窗口等软件。</li></ul></li> <li><p><strong>线程(thread)</strong>：进程可进一步细化为线程，是程序内部的<code>一条执行路径</code>。一个进程中至少有一个线程。</p> <ul><li><p>一个进程同一时间若<code>并行</code>执行多个线程，就是支持多线程的。</p> <p><img src="/assets/img/image-20220331233204504.40308d60.webp" alt="image-20220331233204504"></p></li> <li><p>线程作为<code>CPU调度和执行的最小单位</code>。</p></li> <li><p>一个进程中的多个线程共享相同的内存单元，它们从同一个堆中分配对象，可以访问相同的变量和对象。这就使得线程间通信更简便、高效。但多个线程操作共享的系统资源可能就会带来<code>安全的隐患</code>。</p></li> <li><p>下图中，红框的蓝色区域为线程独享，黄色区域为线程共享。</p></li></ul> <p><img src="/assets/img/image-20220514175737426.814a9597.webp" alt="image-20220514175737426"></p> <blockquote><p>注意：</p> <p>不同的进程之间是不共享内存的。</p> <p>进程之间的数据交换和通信的成本很高。</p></blockquote></li></ul> <h3 id="_1-2-查看进程和线程"><a href="#_1-2-查看进程和线程" class="header-anchor">#</a> 1.2 查看进程和线程</h3> <p>我们可以在电脑底部任务栏，右键-----&gt;打开任务管理器，可以查看当前任务的进程：</p> <p>1、每个应用程序的运行都是一个进程</p> <p><img src="/assets/img/进程概念.07ec4a6c.webp" alt="进程概念"></p> <p>2、一个应用程序的多次运行，就是多个进程</p> <p><img src="/assets/img/1563267431480.b7c1450b.webp" alt="1563267431480"></p> <p>3、一个进程中包含多个线程</p> <p><img src="/assets/img/1563270525077.8496695b.webp" alt="1563270525077"></p> <h3 id="_1-3-线程调度"><a href="#_1-3-线程调度" class="header-anchor">#</a> 1.3 线程调度</h3> <ul><li><p><strong>分时调度</strong></p> <p>所有线程<code>轮流使用</code> CPU 的使用权，并且平均分配每个线程占用 CPU 的时间。</p></li> <li><p><strong>抢占式调度</strong></p> <p>让<code>优先级高</code>的线程以<code>较大的概率</code>优先使用 CPU。如果线程的优先级相同，那么会随机选择一个（线程随机性），Java 使用的为抢占式调度。</p> <p><img src="/assets/img/抢占式调度.a59fc5fd.webp" alt="抢占式调度"></p></li></ul> <h3 id="_1-4-多线程程序的优点"><a href="#_1-4-多线程程序的优点" class="header-anchor">#</a> 1.4 多线程程序的优点</h3> <p><strong>背景：</strong> 以单核 CPU 为例，只使用单个线程先后完成多个任务（调用多个方法），肯定比用多个线程来完成用的时间更短，为何仍需多线程呢？</p> <p><strong>多线程程序的优点：</strong></p> <ol><li><p>提高应用程序的响应。对图形化界面更有意义，可增强用户体验。</p></li> <li><p>提高计算机系统 CPU 的利用率</p></li> <li><p>改善程序结构。将既长又复杂的进程分为多个线程，独立运行，利于理解和修改</p></li></ol> <h3 id="_1-5-补充概念"><a href="#_1-5-补充概念" class="header-anchor">#</a> 1.5 补充概念</h3> <h4 id="_1-5-1-单核-cpu-和多核-cpu"><a href="#_1-5-1-单核-cpu-和多核-cpu" class="header-anchor">#</a> 1.5.1 单核 CPU 和多核 CPU</h4> <p>单核 CPU，在一个时间单元内，只能执行一个线程的任务。例如，可以把 CPU 看成是医院的医生诊室，在一定时间内只能给一个病人诊断治疗。所以单核 CPU 就是，代码经过前面一系列的前导操作（类似于医院挂号，比如有 10 个窗口挂号），然后到 cpu 处执行时发现，就只有一个 CPU（对应一个医生），大家排队执行。</p> <p>这时候想要提升系统性能，只有两个办法，要么提升 CPU 性能（让医生看病快点），要么多加几个 CPU（多整几个医生），即为多核的 CPU。</p> <p><code>问题：多核的效率是单核的倍数吗？</code>譬如 4 核 A53 的 cpu，性能是单核 A53 的 4 倍吗？理论上是，但是实际不可能，至少有两方面的损耗。</p> <ul><li><code>一个是多个核心的其他共用资源限制</code>。譬如，4 核 CPU 对应的内存、cache、寄存器并没有同步扩充 4 倍。这就好像医院一样，1 个医生换 4 个医生，但是做 B 超检查的还是一台机器，性能瓶颈就从医生转到 B 超检查了。</li> <li><code>另一个是多核CPU之间的协调管理损耗</code>。譬如多个核心同时运行两个相关的任务，需要考虑任务同步，这也需要消耗额外性能。好比公司工作，一个人的时候至少不用开会浪费时间，自己跟自己商量就行了。两个人就要开会同步工作，协调分配，所以工作效率绝对不可能达到 2 倍。</li></ul> <h4 id="_1-5-2-并行与并发"><a href="#_1-5-2-并行与并发" class="header-anchor">#</a> 1.5.2 并行与并发</h4> <ul><li><p><strong>并行(parallel)</strong>：指两个或多个事件在<code>同一时刻</code>发生（同时发生）。指在同一时刻，有<code>多条指令</code>在<code>多个CPU</code>上<code>同时</code>执行。比如：多个人同时做不同的事。</p> <p><img src="data:image/webp;base64,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" alt="image-20220401000804242"></p> <p><img src="/assets/img/image-20220513181758585.7c0bb2de.webp" alt="image-20220513181758585"></p></li> <li><p><strong>并发(concurrency)</strong>：指两个或多个事件在<code>同一个时间段内</code>发生。即在一段时间内，有<code>多条指令</code>在<code>单个CPU</code>上<code>快速轮换、交替</code>执行，使得在宏观上具有多个进程同时执行的效果。</p> <p><img src="data:image/webp;base64,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" alt="image-20220401000515678"></p> <p><img src="/assets/img/image-20220513181815978.2e77184e.webp" alt="image-20220513181815978"></p></li></ul> <p>在操作系统中，启动了多个程序，<code>并发</code>指的是在一段时间内宏观上有多个程序同时运行，这在单核 CPU 系统中，每一时刻只能有一个程序执行，即微观上这些程序是分时的交替运行，只不过是给人的感觉是同时运行，那是因为分时交替运行的时间是非常短的。</p> <p>而在多核 CPU 系统中，则这些可以<code>并发</code>执行的程序便可以分配到多个 CPU 上，实现多任务并行执行，即利用每个处理器来处理一个可以并发执行的程序，这样多个程序便可以同时执行。目前电脑市场上说的多核 CPU，便是多核处理器，核越多，<code>并行</code>处理的程序越多，能大大的提高电脑运行的效率。</p> <h2 id="_2-创建和启动线程"><a href="#_2-创建和启动线程" class="header-anchor">#</a> 2.创建和启动线程</h2> <h3 id="_2-1-概述"><a href="#_2-1-概述" class="header-anchor">#</a> 2.1 概述</h3> <ul><li><p>Java 语言的 JVM 允许程序运行多个线程，使用<code>java.lang.Thread</code>类代表<strong>线程</strong>，所有的线程对象都必须是 Thread 类或其子类的实例。</p></li> <li><p>Thread 类的特性</p> <ul><li>每个线程都是通过某个特定 Thread 对象的 run() 方法来完成操作的，因此把 run() 方法体称为<code>线程执行体</code>。</li> <li>通过该 Thread 对象的 start() 方法来启动这个线程，而非直接调用 run()</li> <li>要想实现多线程，必须在主线程中创建新的线程对象。</li></ul></li></ul> <h3 id="_2-2-方式-1-继承-thread-类"><a href="#_2-2-方式-1-继承-thread-类" class="header-anchor">#</a> 2.2 方式 1：继承 Thread 类</h3> <p>Java 通过继承 Thread 类来<strong>创建</strong>并<strong>启动多线程</strong>的步骤如下：</p> <ol><li>定义 Thread 类的子类，并重写该类的 run() 方法，该 run() 方法的方法体就代表了线程需要完成的任务</li> <li>创建 Thread 子类的实例，即创建了线程对象</li> <li>调用线程对象的 start()方法来启动该线程</li></ol> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>
<span class="token comment">//自定义线程类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义指定线程名称的构造方法</span>
    <span class="token keyword">public</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//调用父类的String参数的构造方法，指定线程的名称</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 重写run方法，完成该线程执行的逻辑
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;：正在执行！&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>测试类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMyThread</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建自定义线程对象1</span>
        <span class="token class-name">MyThread</span> mt1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">&quot;子线程1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//开启子线程1</span>
        mt1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//创建自定义线程对象2</span>
        <span class="token class-name">MyThread</span> mt2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">&quot;子线程2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//开启子线程2</span>
        mt2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//在主方法中执行for循环</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main线程！&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><img src="data:image/webp;base64,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" alt="image-20220401221215860"></p> <blockquote><p>注意：</p> <ol><li><p>如果自己手动调用 run()方法，那么就只是普通方法，没有启动多线程模式。</p></li> <li><p>run()方法由 JVM 调用，什么时候调用，执行的过程控制都有操作系统的 CPU 调度决定。</p></li> <li><p>想要启动多线程，必须调用 start 方法。</p></li> <li><p>一个线程对象只能调用一次 start()方法启动，如果重复调用了，则将抛出以上的异常“<code>IllegalThreadStateException</code>”。</p></li></ol></blockquote> <h3 id="_2-3-方式-2-实现-runnable-接口"><a href="#_2-3-方式-2-实现-runnable-接口" class="header-anchor">#</a> 2.3 方式 2：实现 Runnable 接口</h3> <p>Java 有单继承的限制，当我们无法继承 Thread 类时，那么该如何做呢？在核心类库中提供了 Runnable 接口，我们可以实现 Runnable 接口，重写 run() 方法，然后再通过 Thread 类的对象代理启动和执行我们的线程体 run() 方法</p> <p>步骤如下：</p> <ol><li><p>定义 Runnable 接口的实现类，并重写该接口的 run() 方法，该 run() 方法的方法体同样是该线程的线程执行体。</p></li> <li><p>创建 Runnable 实现类的实例，并以此实例作为 Thread 的 target 参数来创建 Thread 对象，该 Thread 对象才是真正
的线程对象。</p></li> <li><p>调用线程对象的 start() 方法，启动线程。调用 Runnable 接口实现类的 run 方法。</p></li></ol> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>测试类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMyRunnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建自定义类对象  线程任务对象</span>
        <span class="token class-name">MyRunnable</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建线程对象</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>mr<span class="token punctuation">,</span> <span class="token string">&quot;长江&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;黄河 &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>通过实现 Runnable 接口，使得该类有了多线程类的特征。所有的分线程要执行的代码都在 run 方法里面。</p> <p>在启动的多线程的时候，需要先通过 Thread 类的构造方法 Thread(Runnable target) 构造出对象，然后调用 Thread 对象的 start()方法来运行多线程代码。</p> <p>实际上，所有的多线程代码都是通过运行 Thread 的 start()方法来运行的。因此，不管是继承 Thread 类还是实现
Runnable 接口来实现多线程，最终还是通过 Thread 的对象的 API 来控制线程的，熟悉 Thread 类的 API 是进行多线程编程的基础。</p> <p>说明：Runnable 对象仅仅作为 Thread 对象的 target，Runnable 实现类里包含的 run()方法仅作为线程执行体。
而实际的线程对象依然是 Thread 实例，只是该 Thread 线程负责执行其 target 的 run()方法。</p> <p><img src="/assets/img/image-20220401222212377.00ee157a.webp" alt="image-20220401222212377"></p> <h3 id="_2-4-变形写法"><a href="#_2-4-变形写法" class="header-anchor">#</a> 2.4 变形写法</h3> <p><strong>使用匿名内部类对象来实现线程的创建和启动</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token string">&quot;新的线程！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;：正在执行！&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-5-对比两种方式"><a href="#_2-5-对比两种方式" class="header-anchor">#</a> 2.5 对比两种方式</h3> <p><strong>联系</strong></p> <p>Thread 类实际上也是实现了 Runnable 接口的类。即：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>区别</strong></p> <ul><li><p>继承 Thread：线程代码存放 Thread 子类 run 方法中。</p></li> <li><p>实现 Runnable：线程代码存在接口的子类的 run 方法。</p></li></ul> <p><strong>实现 Runnable 接口比继承 Thread 类所具有的优势</strong></p> <ul><li>避免了单继承的局限性</li> <li>多个线程可以共享同一个接口实现类的对象，非常适合多个相同线程来处理同一份资源。</li> <li>增加程序的健壮性，实现解耦操作，代码可以被多个线程共享，代码和线程独立。</li></ul> <h3 id="_2-6-练习"><a href="#_2-6-练习" class="header-anchor">#</a> 2.6 练习</h3> <p>创建两个分线程，让其中一个线程输出 1-100 之间的偶数，另一个线程输出 1-100 之间的奇数。</p> <h2 id="_3-thread-类的常用结构"><a href="#_3-thread-类的常用结构" class="header-anchor">#</a> 3. Thread 类的常用结构</h2> <h3 id="_3-1-构造器"><a href="#_3-1-构造器" class="header-anchor">#</a> 3.1 构造器</h3> <ul><li>public Thread() :分配一个新的线程对象。</li> <li>public Thread(String name) :分配一个指定名字的新的线程对象。</li> <li>public Thread(Runnable target) :指定创建线程的目标对象，它实现了 Runnable 接口中的 run 方法</li> <li>public Thread(Runnable target,String name) :分配一个带有指定目标新的线程对象并指定名字。</li></ul> <h3 id="_3-2-常用方法系列-1"><a href="#_3-2-常用方法系列-1" class="header-anchor">#</a> 3.2 常用方法系列 1</h3> <ul><li>public void run() :此线程要执行的任务在此处定义代码。</li> <li>public void start() :导致此线程开始执行; Java 虚拟机调用此线程的 run 方法。</li> <li>public String getName() :获取当前线程名称。</li> <li>public void setName(String name)：设置该线程名称。</li> <li>public static Thread currentThread() :返回对当前正在执行的线程对象的引用。在 Thread 子类中就是 this，通常用于主线程和 Runnable 实现类</li> <li>public static void sleep(long millis) :使当前正在执行的线程以指定的毫秒数暂停（暂时停止执行）。</li> <li>public static void yield()：yield 只是让当前线程暂停一下，让系统的线程调度器重新调度一次，希望优先级与当前线程相同或更高的其他线程能够获得执行机会，但是这个不能保证，完全有可能的情况是，当某个线程调用了 yield 方法暂停之后，线程调度器又将其调度出来重新执行。</li></ul> <h3 id="_3-3-常用方法系列-2"><a href="#_3-3-常用方法系列-2" class="header-anchor">#</a> 3.3 常用方法系列 2</h3> <ul><li><p>public final boolean isAlive()：测试线程是否处于活动状态。如果线程已经启动且尚未终止，则为活动状态。</p></li> <li><p>void join() ：等待该线程终止。</p> <p>void join(long millis) ：等待该线程终止的时间最长为 millis 毫秒。如果 millis 时间到，将不再等待。</p> <p>void join(long millis, int nanos) ：等待该线程终止的时间最长为 millis 毫秒 + nanos 纳秒。</p></li> <li><p>public final void stop()：<code>已过时</code>，不建议使用。强行结束一个线程的执行，直接进入死亡状态。run()即刻停止，可能会导致一些清理性的工作得不到完成，如文件，数据库等的关闭。同时，会立即释放该线程所持有的所有的锁，导致数据得不到同步的处理，出现数据不一致的问题。</p></li> <li><p>void suspend() / void resume() : 这两个操作就好比播放器的暂停和恢复。二者必须成对出现，否则非常容易发生死锁。suspend() 调用会导致线程暂停，但不会释放任何锁资源，导致其它线程都无法访问被它占用的锁，直到调用 resume()。<code>已过时</code>，不建议使用。</p></li></ul> <h3 id="_3-4-常用方法系列-3"><a href="#_3-4-常用方法系列-3" class="header-anchor">#</a> 3.4 常用方法系列 3</h3> <p>每个线程都有一定的优先级，同优先级线程组成先进先出队列（先到先服务），使用分时调度策略。优先级高的线程采用抢占式策略，获得较多的执行机会。每个线程默认的优先级都与创建它的父线程具有相同的优先级。</p> <ul><li>Thread 类的三个优先级常量：
<ul><li>MAX_PRIORITY(10)：最高优先级</li> <li>MIN _PRIORITY (1)：最低优先级</li> <li>NORM_PRIORITY (5)：普通优先级，默认情况下 main 线程具有普通优先级。</li></ul></li></ul> <ul><li>public final int getPriority() ：返回线程优先级</li> <li>public final void setPriority(int newPriority) ：改变线程的优先级，范围在[1,10]之间。</li></ul> <p>练习：获取 main 线程对象的名称和优先级。</p> <p>声明一个匿名内部类继承 Thread 类，重写 run 方法，在 run 方法中获取线程名称和优先级。设置该线程优先级为最高优先级并启动该线程。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;的优先级：&quot;</span> <span class="token operator">+</span> <span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		t<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token constant">MAX_PRIORITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot;的优先级：&quot;</span> <span class="token operator">+</span> 		                                          <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>案例：</p> <ul><li><p>声明一个匿名内部类继承 Thread 类，重写 run 方法，实现打印[1,100]之间的偶数，要求每隔 1 秒打印 1 个偶数。</p></li> <li><p>声明一个匿名内部类继承 Thread 类，重写 run 方法，实现打印[1,100]之间的奇数，</p> <ul><li>当打印到 5 时，让奇数线程暂停一下，再继续。</li> <li>当打印到 5 时，让奇数线程停下来，让偶数线程执行完再打印。</li></ul></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThreadStateChange</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> te <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;偶数线程：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        te<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;奇数线程：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//                        Thread.yield();</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            te<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">to</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>生产实践中的趣事：</p> <p><img src="/assets/img/这是要闹哪样.79e3f6df.webp" alt=""></p> <h3 id="_3-5-守护线程-了解"><a href="#_3-5-守护线程-了解" class="header-anchor">#</a> 3.5 守护线程（了解）</h3> <p>有一种线程，它是在后台运行的，它的任务是为其他线程提供服务的，这种线程被称为“守护线程”。JVM 的垃圾回收线程就是典型的守护线程。</p> <p>守护线程有个特点，就是如果所有非守护线程都死亡，那么守护线程自动死亡。形象理解：<code>兔死狗烹</code>，<code>鸟尽弓藏</code></p> <p>调用 setDaemon(true)方法可将指定线程设置为守护线程。必须在线程启动之前设置，否则会报 IllegalThreadStateException 异常。</p> <p>调用 isDaemon()可以判断线程是否是守护线程。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThread</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">MyDaemon</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		m<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		m<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main:&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyDaemon</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我一直守护者你...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="_4-多线程的生命周期"><a href="#_4-多线程的生命周期" class="header-anchor">#</a> 4. 多线程的生命周期</h2> <p>Java 语言使用 Thread 类及其子类的对象来表示线程，在它的一个完整的生命周期中通常要经历如下一些状态：</p> <h3 id="_4-1-jdk1-5-之前-5-种状态"><a href="#_4-1-jdk1-5-之前-5-种状态" class="header-anchor">#</a> 4.1 JDK1.5 之前：5 种状态</h3> <p>线程的生命周期有五种状态：新建(New)、就绪(Runnable)、运行(Running)、阻塞(Blocked)、死亡(Dead)。CPU 需要在多条线程之间切换，于是线程状态会多次在运行、阻塞、就绪之间切换。</p> <p><img src="/assets/img/image-20220401002307038.63ecd297.webp" alt="image-20220401002307038"></p> <p><strong>1.新建</strong></p> <p>当一个 Thread 类或其子类的对象被声明并创建时，新生的线程对象处于新建状态。此时它和其他 Java 对象一样，仅仅由 JVM 为其分配了内存，并初始化了实例变量的值。此时的线程对象并没有任何线程的动态特征，程序也不会执行它的线程体 run()。</p> <p><strong>2.就绪</strong></p> <p>但是当线程对象调用了 start()方法之后，就不一样了，线程就从新建状态转为就绪状态。JVM 会为其创建方法调用栈和程序计数器，当然，处于这个状态中的线程并没有开始运行，只是表示已具备了运行的条件，随时可以被调度。至于什么时候被调度，取决于 JVM 里线程调度器的调度。</p> <blockquote><p>注意：</p> <p>程序只能对新建状态的线程调用 start()，并且只能调用一次，如果对非新建状态的线程，如已启动的线程或已死亡的线程调用 start() 都会报错 IllegalThreadStateException 异常。</p></blockquote> <p><strong>3.运行</strong></p> <p>如果处于就绪状态的线程获得了 CPU 资源时，开始执行 run() 方法的线程体代码，则该线程处于运行状态。如果计算机只有一个 CPU 核心，在任何时刻只有一个线程处于运行状态，如果计算机有多个核心，将会有多个线程并行（Parallel）执行。</p> <p>当然，美好的时光总是短暂的，而且 CPU 讲究雨露均沾。对于抢占式策略的系统而言，系统会给每个可执行的线程一个小时间段来处理任务，当该时间用完，系统会剥夺该线程所占用的资源，让其回到就绪状态等待下一次被调度。此时其他线程将获得执行机会，而在选择下一个线程时，系统会适当考虑线程的优先级。</p> <p><strong>4.阻塞</strong></p> <p>当在运行过程中的线程遇到如下情况时，会让出 CPU 并临时中止自己的执行，进入阻塞状态：</p> <ul><li>线程调用了 sleep()方法，主动放弃所占用的 CPU 资源；</li> <li>线程试图获取一个同步监视器，但该同步监视器正被其他线程持有；</li> <li>线程执行过程中，同步监视器调用了 wait()，让它等待某个通知（notify）；</li> <li>线程执行过程中，同步监视器调用了 wait(time)</li> <li>线程执行过程中，遇到了其他线程对象的加塞(join)；</li> <li>线程被调用 suspend 方法被挂起（已过时，因为容易发生死锁）；</li></ul> <p>当前正在执行的线程被阻塞后，其他线程就有机会执行了。针对如上情况，当发生如下情况时会解除阻塞，让该线程重新进入就绪状态，等待线程调度器再次调度它：</p> <ul><li>线程的 sleep()时间到；</li> <li>线程成功获得了同步监视器；</li> <li>线程等到了通知(notify)；</li> <li>线程 wait 的时间到了</li> <li>加塞的线程结束了；</li> <li>被挂起的线程又被调用了 resume 恢复方法（已过时，因为容易发生死锁）；</li></ul> <p><strong>5.死亡</strong></p> <p>线程会以以下三种方式之一结束，结束后的线程就处于死亡状态：</p> <ul><li>run()方法执行完成，线程正常结束</li> <li>线程执行过程中抛出了一个未捕获的异常(Exception)或错误(Error)</li> <li>直接调用该线程的 stop()来结束该线程（已过时）</li></ul> <h3 id="_4-2-jdk1-5-及之后-6-种状态"><a href="#_4-2-jdk1-5-及之后-6-种状态" class="header-anchor">#</a> 4.2 JDK1.5 及之后：6 种状态</h3> <p>在 java.lang.Thread.State 的枚举类中这样定义：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
	<span class="token constant">NEW</span><span class="token punctuation">,</span>
	<span class="token constant">RUNNABLE</span><span class="token punctuation">,</span>
	<span class="token constant">BLOCKED</span><span class="token punctuation">,</span>
	<span class="token constant">WAITING</span><span class="token punctuation">,</span>
	<span class="token constant">TIMED_WAITING</span><span class="token punctuation">,</span>
	<span class="token constant">TERMINATED</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p><code>NEW（新建）</code>：线程刚被创建，但是并未启动。还没调用 start 方法。</p></li> <li><p><code>RUNNABLE（可运行）</code>：这里没有区分就绪和运行状态。因为对于 Java 对象来说，只能标记为可运行，至于什么时候运行，不是 JVM 来控制的了，是 OS 来进行调度的，而且时间非常短暂，因此对于 Java 对象的状态来说，无法区分。</p></li> <li><p><code>Teminated（被终止）</code>：表明此线程已经结束生命周期，终止运行。</p></li> <li><p>重点说明，根据 Thread.State 的定义，<strong>阻塞状态分为三种</strong>：<code>BLOCKED</code>、<code>WAITING</code>、<code>TIMED_WAITING</code>。</p> <ul><li><code>BLOCKED（锁阻塞）</code>：在 API 中的介绍为：一个正在阻塞、等待一个监视器锁（锁对象）的线程处于这一状态。只有获得锁对象的线程才能有执行机会。
<ul><li>比如，线程 A 与线程 B 代码中使用同一锁，如果线程 A 获取到锁，线程 A 进入到 Runnable 状态，那么线程 B 就进入到 Blocked 锁阻塞状态。</li></ul></li> <li><code>TIMED_WAITING（计时等待）</code>：在 API 中的介绍为：一个正在限时等待另一个线程执行一个（唤醒）动作的线程处于这一状态。
<ul><li>当前线程执行过程中遇到 Thread 类的<code>sleep</code>或<code>join</code>，Object 类的<code>wait</code>，LockSupport 类的<code>park</code>方法，并且在调用这些方法时，<code>设置了时间</code>，那么当前线程会进入 TIMED_WAITING，直到时间到，或被中断。</li></ul></li> <li><code>WAITING（无限等待）</code>：在 API 中介绍为：一个正在无限期等待另一个线程执行一个特别的（唤醒）动作的线程处于这一状态。
<ul><li>当前线程执行过程中遇到遇到 Object 类的<code>wait</code>，Thread 类的<code>join</code>，LockSupport 类的<code>park</code>方法，并且在调用这些方法时，<code>没有指定时间</code>，那么当前线程会进入 WAITING 状态，直到被唤醒。
<ul><li>通过 Object 类的 wait 进入 WAITING 状态的要有 Object 的 notify/notifyAll 唤醒；</li> <li>通过 Condition 的 await 进入 WAITING 状态的要有 Condition 的 signal 方法唤醒；</li> <li>通过 LockSupport 类的 park 方法进入 WAITING 状态的要有 LockSupport 类的 unpark 方法唤醒</li> <li>通过 Thread 类的 join 进入 WAITING 状态，只有调用 join 方法的线程对象结束才能让当前线程恢复；</li></ul></li></ul></li></ul></li></ul> <p>说明：当从 WAITING 或 TIMED_WAITING 恢复到 Runnable 状态时，如果发现当前线程没有得到监视器锁，那么会立刻转入 BLOCKED 状态。</p> <p><img src="/assets/img/image-20220524203355448.63871cbb.webp" alt="image-20220524203355448"></p> <p>或</p> <p><img src="/assets/img/线程的生命周期Thread.State.4caec346.webp" alt="线程的生命周期Thread.State"></p> <blockquote><p>我们在翻阅 API 的时候会发现 Timed Waiting（计时等待） 与 Waiting（无限等待） 状态联系还是很紧密的，
比如 Waiting（无限等待） 状态中 wait 方法是空参的，而 timed waiting（计时等待） 中 wait 方法是带参的。
这种带参的方法，其实是一种倒计时操作，相当于我们生活中的小闹钟，我们设定好时间，到时通知，可是
如果提前得到（唤醒）通知，那么设定好时间在通知也就显得多此一举了，那么这种设计方案其实是一举两
得。如果没有得到（唤醒）通知，那么线程就处于 Timed Waiting 状态，直到倒计时完毕自动醒来；如果在倒
计时期间得到（唤醒）通知，那么线程从 Timed Waiting 状态立刻唤醒。</p></blockquote> <p>举例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author 尚硅谷-宋红康
 * @create 22:15
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadStateTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SubThread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 状态 &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">Thread<span class="token punctuation">.</span>State</span><span class="token punctuation">.</span><span class="token constant">TERMINATED</span> <span class="token operator">!=</span> t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 状态 &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 状态 &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SubThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;打印：&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>命令行演示：</p> <p><img src="/assets/img/image-20220524195035355.671312c2.webp" alt="image-20220524195035355"></p> <h2 id="_5-线程安全问题及解决"><a href="#_5-线程安全问题及解决" class="header-anchor">#</a> 5. 线程安全问题及解决</h2> <p>当我们使用多个线程访问<strong>同一资源</strong>（可以是同一个变量、同一个文件、同一条记录等）的时候，若多个线程<code>只有读操作</code>，那么不会发生线程安全问题。但是如果多个线程中对资源有<code>读和写</code>的操作，就容易出现线程安全问题。</p> <p>举例：</p> <p><img src="/assets/img/image-20220401233218326.b607bd63.webp" alt="image-20220401233218326"></p> <p>类比：</p> <p><img src="/assets/img/当我以为我的代码很安全时，等等.5aa310e3.webp" alt=""></p> <h3 id="_5-1-同一个资源问题和线程安全问题"><a href="#_5-1-同一个资源问题和线程安全问题" class="header-anchor">#</a> 5.1 同一个资源问题和线程安全问题</h3> <p>案例：</p> <p>火车站要卖票，我们模拟火车站的卖票过程。因为疫情期间，本次列车的座位共 100 个（即，只能出售 100 张火车票）。我们来模拟车站的售票窗口，实现多个窗口同时售票的过程。注意：不能出现错票、重票。</p> <h4 id="_5-1-1-局部变量不能共享"><a href="#_5-1-1-局部变量不能共享" class="header-anchor">#</a> 5.1.1 局部变量不能共享</h4> <p>示例代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>unsafe<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Window</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        int ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">String<span class="token punctuation">[</span><span class="token punctuation">]</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Window w1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Window w2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Window w3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        w1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        w1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>结果：发现卖出 300 张票。</p> <p>问题：局部变量是每次调用方法都是独立的，那么每个线程的 run()的 ticket 是独立的，不是共享数据。</p> <h4 id="_5-1-2-不同对象的实例变量不共享"><a href="#_5-1-2-不同对象的实例变量不共享" class="header-anchor">#</a> 5.1.2 不同对象的实例变量不共享</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>unsafe</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TicketWindow</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketWindow</span> w1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TicketWindow</span> w2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TicketWindow</span> w3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        w1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        w1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        w3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>结果：发现卖出 300 张票。</p> <p>问题：不同的实例对象的实例变量是独立的。</p> <h4 id="_5-1-3-静态变量是共享的"><a href="#_5-1-3-静态变量是共享的" class="header-anchor">#</a> 5.1.3 静态变量是共享的</h4> <p>示例代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>unsafe</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TicketSaleThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加入这个，使得问题暴露的更明显</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketSaleThread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TicketSaleThread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TicketSaleThread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>运行结果：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">100</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">100</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">100</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">97</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">97</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">97</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">94</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">94</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">94</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">91</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">91</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">91</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">88</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">88</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">88</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">85</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">85</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">85</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">82</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">82</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">82</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">79</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">79</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">79</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">76</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">76</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">76</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">73</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">73</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">73</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">70</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">70</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">70</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">67</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">67</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">67</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">64</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">64</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">64</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">61</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">61</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">61</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">58</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">58</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">58</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">55</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">55</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">55</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">52</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">52</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">52</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">49</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">49</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">49</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">46</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">46</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">46</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">43</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">43</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">43</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">40</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">40</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">40</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">37</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">37</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">37</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">34</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">34</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">34</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">31</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">31</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">31</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">28</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">28</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">28</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">25</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">25</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">25</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">22</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">22</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">22</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">19</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">19</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">19</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">16</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">16</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">16</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">13</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">13</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">13</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">10</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">10</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">10</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">7</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">7</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">7</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">4</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">4</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">4</span>
窗口<span class="token number">3</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">1</span>
窗口<span class="token number">2</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">1</span>
窗口<span class="token number">1</span>卖出一张票，票号<span class="token operator">:</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><p>结果：发现卖出近 100 张票。</p> <p>问题 1：但是有重复票或负数票问题。</p> <p>原因：线程安全问题</p> <p>问题 2：如果要考虑有两场电影，各卖 100 张票等</p> <p>原因：TicketThread 类的静态变量，是所有 TicketThread 类的对象共享</p> <h4 id="_5-1-4-同一个对象的实例变量共享"><a href="#_5-1-4-同一个对象的实例变量共享" class="header-anchor">#</a> 5.1.4 同一个对象的实例变量共享</h4> <p>示例代码：多个 Thread 线程使用同一个 Runnable 对象</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>safe</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TicketSaleRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加入这个，使得问题暴露的更明显</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketSaleRunnable</span> tr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tr<span class="token punctuation">,</span> <span class="token string">&quot;窗口一&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tr<span class="token punctuation">,</span> <span class="token string">&quot;窗口二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tr<span class="token punctuation">,</span> <span class="token string">&quot;窗口三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>结果：发现卖出近 100 张票。</p> <p>问题：但是有重复票或负数票问题。</p> <p>原因：线程安全问题</p> <h4 id="_5-1-5-抽取资源类-共享同一个资源对象"><a href="#_5-1-5-抽取资源类-共享同一个资源对象" class="header-anchor">#</a> 5.1.5 抽取资源类，共享同一个资源对象</h4> <p>示例代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>unsafe</span><span class="token punctuation">;</span>

<span class="token comment">//1、编写资源类</span>
<span class="token keyword">class</span> <span class="token class-name">Ticket</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加入这个，使得问题暴露的更明显</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;没有票了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ticket<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//2、创建资源对象</span>
        <span class="token class-name">Ticket</span> ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3、启动多个线程操作资源类的对象</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token string">&quot;窗口一&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token string">&quot;窗口二&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;窗口三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>结果：发现卖出近 100 张票。</p> <p>问题：但是有重复票或负数票问题。</p> <p>原因：线程安全问题</p> <h3 id="_5-2-同步机制解决线程安全问题"><a href="#_5-2-同步机制解决线程安全问题" class="header-anchor">#</a> 5.2 同步机制解决线程安全问题</h3> <p>要解决上述多线程并发访问一个资源的安全性问题:也就是解决重复票与不存在票问题，Java 中提供了同步机制
(synchronized)来解决。</p> <p><img src="/assets/img/1563372934332.b1ff6022.webp" alt="1563372934332"></p> <p>根据案例简述：</p> <p>窗口 1 线程进入操作的时候，窗口 2 和窗口 3 线程只能在外等着，窗口 1 操作结束，窗口 1 和窗口 2 和窗口 3 才有机会进入代码去执行。也就是说在某个线程修改共享资源的时候，其他线程不能修改该资源，等待修改完毕同步之后，才能去抢夺 CPU 资源，完成对应的操作，保证了数据的同步性，解决了线程不安全的现象。</p> <p>为了保证每个线程都能正常执行原子操作，Java 引入了线程同步机制。注意:在任何时候,最多允许一个线程拥有同步锁，谁拿到锁就进入代码块，其他的线程只能在外等着(BLOCKED)。</p> <h4 id="_5-2-1-同步机制解决线程安全问题的原理"><a href="#_5-2-1-同步机制解决线程安全问题的原理" class="header-anchor">#</a> 5.2.1 同步机制解决线程安全问题的原理</h4> <p>同步机制的原理，其实就相当于给某段代码加“锁”，任何线程想要执行这段代码，都要先获得“锁”，我们称它为同步锁。因为 Java 对象在堆中的数据分为分为对象头、实例变量、空白的填充。而对象头中包含：</p> <ul><li>Mark Word：记录了和当前对象有关的 GC、锁标记等信息。</li> <li>指向类的指针：每一个对象需要记录它是由哪个类创建出来的。</li> <li>数组长度（只有数组对象才有）</li></ul> <p>哪个线程获得了“同步锁”对象之后，”同步锁“对象就会记录这个线程的 ID，这样其他线程就只能等待了，除非这个线程”释放“了锁对象，其他线程才能重新获得/占用”同步锁“对象。</p> <h4 id="_5-2-2-同步代码块和同步方法"><a href="#_5-2-2-同步代码块和同步方法" class="header-anchor">#</a> 5.2.2 同步代码块和同步方法</h4> <p><strong>同步代码块</strong>：synchronized 关键字可以用于某个区块前面，表示只对这个区块的资源实行互斥访问。
格式:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>同步锁<span class="token punctuation">)</span><span class="token punctuation">{</span>
     需要同步操作的代码
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>同步方法：</strong> synchronized 关键字直接修饰方法，表示同一时刻只有一个线程能进入这个方法，其他线程在外面等着。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    可能会产生线程安全问题的代码
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_5-2-3-同步锁机制"><a href="#_5-2-3-同步锁机制" class="header-anchor">#</a> 5.2.3 同步锁机制</h4> <p>在《Thinking in Java》中，是这么说的：对于并发工作，你需要某种方式来防止两个任务访问相同的资源（其实就是共享资源竞争）。 防止这种冲突的方法就是当资源被一个任务使用时，在其上加锁。第一个访问某项资源的任务必须锁定这项资源，使其他任务在其被解锁之前，就无法访问它了，而在其被解锁之时，另一个任务就可以锁定并使用它了。</p> <h4 id="_5-2-4-synchronized-的锁是什么"><a href="#_5-2-4-synchronized-的锁是什么" class="header-anchor">#</a> 5.2.4 synchronized 的锁是什么</h4> <p>同步锁对象可以是任意类型，但是必须保证竞争“同一个共享资源”的多个线程必须使用同一个“同步锁对象”。</p> <p>对于同步代码块来说，同步锁对象是由程序员手动指定的（很多时候也是指定为 this 或类名.class），但是对于同步方法来说，同步锁对象只能是默认的：</p> <ul><li><p>静态方法：当前类的 Class 对象（类名.class）</p></li> <li><p>非静态方法：this</p></li></ul> <h4 id="_5-2-5-同步操作的思考顺序"><a href="#_5-2-5-同步操作的思考顺序" class="header-anchor">#</a> 5.2.5 同步操作的思考顺序</h4> <p>1、如何找问题，即代码是否存在线程安全？（非常重要）
(1)明确哪些代码是多线程运行的代码
(2)明确多个线程是否有共享数据
(3)明确多线程运行代码中是否有多条语句操作共享数据</p> <p>2、如何解决呢？（非常重要）
对多条操作共享数据的语句，只能让一个线程都执行完，在执行过程中，其他线程不可以参与执行。
即所有操作共享数据的这些语句都要放在同步范围中</p> <p>3、切记：</p> <p>范围太小：不能解决安全问题</p> <p>范围太大：因为一旦某个线程抢到锁，其他线程就只能等待，所以范围太大，效率会降低，不能合理利用 CPU 资源。</p> <h4 id="_5-2-6-代码演示"><a href="#_5-2-6-代码演示" class="header-anchor">#</a> 5.2.6 代码演示</h4> <h5 id="示例一-静态方法加锁"><a href="#示例一-静态方法加锁" class="header-anchor">#</a> 示例一：静态方法加锁</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>safe</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TicketSaleThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//直接锁这里，肯定不行，会导致，只有一个窗口卖票</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">saleOneTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saleOneTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//锁对象是TicketSaleThread类的Class对象，而一个类的Class对象在内存中肯定只有一个</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//不加条件，相当于条件判断没有进入锁管控，线程安全问题就没有解决</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketSaleThread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TicketSaleThread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TicketSaleThread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;窗口3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h5 id="示例二-非静态方法加锁"><a href="#示例二-非静态方法加锁" class="header-anchor">#</a> 示例二：非静态方法加锁</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>safe</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketSaleRunnable</span> tr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketSaleRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tr<span class="token punctuation">,</span> <span class="token string">&quot;窗口一&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tr<span class="token punctuation">,</span> <span class="token string">&quot;窗口二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tr<span class="token punctuation">,</span> <span class="token string">&quot;窗口三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TicketSaleRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//直接锁这里，肯定不行，会导致，只有一个窗口卖票</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">saleOneTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">saleOneTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//锁对象是this，这里就是TicketSaleRunnable对象，因为上面3个线程使用同一个TicketSaleRunnable对象，所以可以</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//不加条件，相当于条件判断没有进入锁管控，线程安全问题就没有解决</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h5 id="示例三-同步代码块"><a href="#示例三-同步代码块" class="header-anchor">#</a> 示例三：同步代码块</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>safe</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//2、创建资源对象</span>
        <span class="token class-name">Ticket</span> ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3、启动多个线程操作资源类的对象</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token string">&quot;窗口一&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//不能给run()直接加锁，因为t1,t2,t3的三个run方法分别属于三个Thread类对象，</span>
                <span class="token comment">// run方法是非静态方法，那么锁对象默认选this，那么锁对象根本不是同一个</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>ticket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token string">&quot;窗口二&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>ticket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>ticket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;窗口三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//1、编写资源类</span>
<span class="token keyword">class</span> <span class="token class-name">Ticket</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//也可以直接给这个方法加锁，锁对象是this，这里就是Ticket对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;卖出一张票，票号:&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticket<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;没有票了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ticket<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="_5-3-练习"><a href="#_5-3-练习" class="header-anchor">#</a> 5.3 练习</h3> <p>银行有一个账户。
有两个储户分别向同一个账户存 3000 元，每次存 1000，存 3 次。每次存完打印账户余额。</p> <p>问题：该程序是否有安全问题，如果有，如何解决？</p> <p>【提示】
1，明确哪些代码是多线程运行代码，须写入 run()方法
2，明确什么是共享数据。
3，明确多线程运行代码中哪些语句是操作共享数据的。</p> <p>【拓展问题】可否实现两个储户交替存钱的操作</p> <h2 id="_6-再谈同步"><a href="#_6-再谈同步" class="header-anchor">#</a> 6. 再谈同步</h2> <h3 id="_6-1-单例设计模式的线程安全问题"><a href="#_6-1-单例设计模式的线程安全问题" class="header-anchor">#</a> 6.1 单例设计模式的线程安全问题</h3> <h4 id="_6-1-1-饿汉式没有线程安全问题"><a href="#_6-1-1-饿汉式没有线程安全问题" class="header-anchor">#</a> 6.1.1 饿汉式没有线程安全问题</h4> <p>饿汉式：在类初始化时就直接创建单例对象，而类初始化过程是没有线程安全问题的</p> <p>形式一：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>single<span class="token punctuation">.</span>hungry</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HungrySingle</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingle</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HungrySingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//对象是否声明为final 都可以</span>
    
    <span class="token keyword">private</span> <span class="token class-name">HungrySingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingle</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>形式二：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
public class HungryOne{
    public static final HungryOne INSTANCE = new HungryOne();
    private HungryOne(){}
}*/</span>

<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">HungryOne</span><span class="token punctuation">{</span>
    <span class="token constant">INSTANCE</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>测试类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>single<span class="token punctuation">.</span>hungry</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HungrySingleTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">HungrySingle</span> hs1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">HungrySingle</span> hs2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//演示存在的线程安全问题</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                hs1 <span class="token operator">=</span> <span class="token class-name">HungrySingle</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                hs2 <span class="token operator">=</span> <span class="token class-name">HungrySingle</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hs1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hs2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hs1 <span class="token operator">==</span> hs2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h4 id="_6-1-2-懒汉式线程安全问题"><a href="#_6-1-2-懒汉式线程安全问题" class="header-anchor">#</a> 6.1.2 懒汉式线程安全问题</h4> <p>懒汉式：延迟创建对象，第一次调用 getInstance 方法再创建对象</p> <p>形式一：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>single<span class="token punctuation">.</span>lazy</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazyOne</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LazyOne</span> instance<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">LazyOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">//方式1：</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">LazyOne</span> <span class="token function">getInstance1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//方式2：</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyOne</span> <span class="token function">getInstance2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">LazyOne</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//方式3：</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyOne</span> <span class="token function">getInstance3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">LazyOne</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加这个代码，暴露问题</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*
    注意：上述方式3中，有指令重排问题
    mem = allocate(); 为单例对象分配内存空间
    instance = mem;   instance引用现在非空，但还未初始化
    ctorSingleton(instance); 为单例对象通过instance调用构造器
    从JDK2开始，分配空间、初始化、调用构造器会在线程的工作存储区一次性完成，然后复制到主存储区。但是需要   
    volatile关键字，避免指令重排。
    */</span>
    
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>形式二：使用内部类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>single<span class="token punctuation">.</span>lazy</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingle</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">LazySingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazySingle</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Inner</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Inner</span><span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">LazySingle</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>内部类只有在外部类被调用才加载，产生 INSTANCE 实例；又不用加锁。</p> <p>此模式具有之前两个模式的优点，同时屏蔽了它们的缺点，是最好的单例模式。</p> <p>此时的内部类，使用 enum 进行定义，也是可以的。</p></blockquote> <p>测试类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>single<span class="token punctuation">.</span>lazy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestLazy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">LazyOne</span> s1 <span class="token operator">=</span> <span class="token class-name">LazyOne</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LazyOne</span> s2 <span class="token operator">=</span> <span class="token class-name">LazyOne</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//把s1和s2声明在外面，是想要在线程的匿名内部类中为s1和s2赋值</span>
    <span class="token class-name">LazyOne</span> s1<span class="token punctuation">;</span>
    <span class="token class-name">LazyOne</span> s2<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                s1 <span class="token operator">=</span> <span class="token class-name">LazyOne</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                s2 <span class="token operator">=</span> <span class="token class-name">LazyOne</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token class-name">LazySingle</span> obj1<span class="token punctuation">;</span>
    <span class="token class-name">LazySingle</span> obj2<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                obj1 <span class="token operator">=</span> <span class="token class-name">LazySingle</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                obj2 <span class="token operator">=</span> <span class="token class-name">LazySingle</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj1 <span class="token operator">==</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h3 id="_6-2-死锁"><a href="#_6-2-死锁" class="header-anchor">#</a> 6.2 死锁</h3> <p>不同的线程分别占用对方需要的同步资源不放弃，都在等待对方放弃自己需要的同步资源，就形成了线程的死锁。</p> <p><img src="data:image/webp;base64,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" alt="thread-lock"></p> <blockquote><p>【小故事】</p> <p>面试官：你能解释清楚什么是死锁，我就录取你！
面试者：你录取我，我就告诉你什么是死锁！
….
恭喜你，面试通过了</p></blockquote> <p>一旦出现死锁，整个程序既不会发生异常，也不会给出任何提示，只是所有线程处于阻塞状态，无法继续。</p> <p>举例 1：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLockTest</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">StringBuilder</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					<span class="token keyword">try</span> <span class="token punctuation">{</span>
						<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token keyword">try</span> <span class="token punctuation">{</span>
						<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					
					<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token punctuation">}</span>

				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>举例 2：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">B</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程名: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">&quot; 进入了A实例的foo方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ①</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程名: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">&quot; 企图调用B实例的last方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ③</span>
		b<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入了A类的last方法内部&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token class-name">A</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程名: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">&quot; 进入了B实例的bar方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ②</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程名: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">&quot; 企图调用A实例的last方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ④</span>
		a<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入了B类的last方法内部&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLock</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
	<span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">B</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;主线程&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 调用a对象的foo方法</span>
		a<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入了主线程之后&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;副线程&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 调用b对象的bar方法</span>
		b<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入了副线程之后&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DeadLock</span> dl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeadLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>dl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dl<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>举例 3：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDeadLock</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Object</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Object</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Owner</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Owner</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Customer</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Owner</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> goods<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> money<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Owner</span><span class="token punctuation">(</span><span class="token class-name">Object</span> goods<span class="token punctuation">,</span> <span class="token class-name">Object</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>goods <span class="token operator">=</span> goods<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>goods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;先给钱&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;发货&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> goods<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> money<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span><span class="token class-name">Object</span> goods<span class="token punctuation">,</span> <span class="token class-name">Object</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>goods <span class="token operator">=</span> goods<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;先发货&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>goods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;再给钱&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p><strong>诱发死锁的原因：</strong></p> <ul><li>互斥条件</li> <li>占用且等待</li> <li>不可抢夺（或不可抢占）</li> <li>循环等待</li></ul> <p>以上 4 个条件，同时出现就会触发死锁。</p> <p><strong>解决死锁：</strong></p> <p>死锁一旦出现，基本很难人为干预，只能尽量规避。可以考虑打破上面的诱发条件。</p> <p>针对条件 1：互斥条件基本上无法被破坏。因为线程需要通过互斥解决安全问题。</p> <p>针对条件 2：可以考虑一次性申请所有所需的资源，这样就不存在等待的问题。</p> <p>针对条件 3：占用部分资源的线程在进一步申请其他资源时，如果申请不到，就主动释放掉已经占用的资源。</p> <p>针对条件 4：可以将资源改为线性顺序。申请资源时，先申请序号较小的，这样避免循环等待问题。</p> <h3 id="_6-3-jdk5-0-新特性-lock-锁"><a href="#_6-3-jdk5-0-新特性-lock-锁" class="header-anchor">#</a> 6.3 JDK5.0 新特性：Lock（锁）</h3> <ul><li><p>JDK5.0 的新增功能，保证线程的安全。与采用 synchronized 相比，Lock 可提供多种锁方案，更灵活、更强大。Lock 通过显式定义同步锁对象来实现同步。同步锁使用 Lock 对象充当。</p></li> <li><p>java.util.concurrent.locks.Lock 接口是控制多个线程对共享资源进行访问的工具。锁提供了对共享资源的独占访问，每次只能有一个线程对 Lock 对象加锁，线程开始访问共享资源之前应先获得 Lock 对象。</p></li> <li><p>在实现线程安全的控制中，比较常用的是<code>ReentrantLock</code>，可以显式加锁、释放锁。</p> <ul><li>ReentrantLock 类实现了 Lock 接口，它拥有与 synchronized 相同的并发性和内存语义，但是添加了类似锁投票、定时锁等候和可中断锁等候的一些特性。此外，它还提供了在激烈争用情况下更佳的性能。</li></ul></li> <li><p>Lock 锁也称同步锁，加锁与释放锁方法，如下：</p> <ul><li>public void lock() :加同步锁。</li> <li>public void unlock() :释放同步锁。</li></ul></li> <li><p>代码结构</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>
    <span class="token comment">//1. 创建Lock的实例，必须确保多个线程共享同一个Lock实例</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReenTrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//2. 调动lock()，实现需共享的代码的锁定</span>
		lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token comment">//保证线程安全的代码;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">finally</span><span class="token punctuation">{</span>
            <span class="token comment">//3. 调用unlock()，释放共享代码的锁定</span>
			lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>注意：如果同步代码有异常，要将 unlock()写入 finally 语句块。</p></blockquote> <p>举例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Window</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token comment">//1. 创建Lock的实例，必须确保多个线程共享同一个Lock实例</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">try</span><span class="token punctuation">{</span>
                <span class="token comment">//2. 调动lock()，实现需共享的代码的锁定</span>
				lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">try</span> <span class="token punctuation">{</span>
						<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ticket<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
                <span class="token comment">//3. 调用unlock()，释放共享代码的锁定</span>
				lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLock</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Window</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p><strong>synchronized 与 Lock 的对比</strong></p> <ol><li>Lock 是显式锁（手动开启和关闭锁，别忘记关闭锁），synchronized 是隐式锁，出了作用域、遇到异常等自动解锁</li> <li>Lock 只有代码块锁，synchronized 有代码块锁和方法锁</li> <li>使用 Lock 锁，JVM 将花费较少的时间来调度线程，性能更好。并且具有更好的扩展性（提供更多的子类），更体现面向对象。</li> <li>（了解）Lock 锁可以对读不加锁，对写加锁，synchronized 不可以</li> <li>（了解）Lock 锁可以有多种获取锁的方式，可以从 sleep 的线程中抢到锁，synchronized 不可以</li></ol> <blockquote><p>说明：开发建议中处理线程安全问题优先使用顺序为：</p> <p>•    Lock ----&gt; 同步代码块 ----&gt; 同步方法</p></blockquote> <h2 id="_7-线程的通信"><a href="#_7-线程的通信" class="header-anchor">#</a> 7. 线程的通信</h2> <h3 id="_7-1-线程间通信"><a href="#_7-1-线程间通信" class="header-anchor">#</a> 7.1 线程间通信</h3> <p><strong>为什么要处理线程间通信：</strong></p> <p>当我们<code>需要多个线程</code>来共同完成一件任务，并且我们希望他们<code>有规律的执行</code>，那么多线程之间需要一些通信机制，可以协调它们的工作，以此实现多线程共同操作一份数据。</p> <p>比如：线程 A 用来生产包子的，线程 B 用来吃包子的，包子可以理解为同一资源，线程 A 与线程 B 处理的动作，一个是生产，一个是消费，此时 B 线程必须等到 A 线程完成后才能执行，那么线程 A 与线程 B 之间就需要线程通信，即—— <strong>等待唤醒机制。</strong></p> <h3 id="_7-2-等待唤醒机制"><a href="#_7-2-等待唤醒机制" class="header-anchor">#</a> 7.2 等待唤醒机制</h3> <p>这是多个线程间的一种<code>协作机制</code>。谈到线程我们经常想到的是线程间的<code>竞争（race）</code>，比如去争夺锁，但这并不是故事的全部，线程间也会有协作机制。</p> <p>在一个线程满足某个条件时，就进入等待状态（<code>wait() / wait(time)</code>）， 等待其他线程执行完他们的指定代码过后再将其唤醒（<code>notify()</code>）;或可以指定 wait 的时间，等时间到了自动唤醒；在有多个线程进行等待时，如果需要，可以使用 <code>notifyAll()</code>来唤醒所有的等待线程。wait/notify 就是线程间的一种协作机制。</p> <ol><li>wait：线程不再活动，不再参与调度，进入 <code>wait set</code> 中，因此不会浪费 CPU 资源，也不会去竞争锁了，这时的线程状态是 WAITING 或 TIMED_WAITING。它还要等着别的线程执行一个<code>特别的动作</code>，也即“<code>通知（notify）</code>”或者等待时间到，在这个对象上等待的线程从 wait set 中释放出来，重新进入到调度队列（<code>ready queue</code>）中</li> <li>notify：则选取所通知对象的 wait set 中的一个线程释放；</li> <li>notifyAll：则释放所通知对象的 wait set 上的全部线程。</li></ol> <blockquote><p>注意：</p> <p>被通知的线程被唤醒后也不一定能立即恢复执行，因为它当初中断的地方是在同步块内，而此刻它已经不持有锁，所以它需要再次尝试去获取锁（很可能面临其它线程的竞争），成功后才能在当初调用 wait 方法之后的地方恢复执行。</p> <p>总结如下：</p> <ul><li>如果能获取锁，线程就从 WAITING 状态变成 RUNNABLE（可运行） 状态；</li> <li>否则，线程就从 WAITING 状态又变成 BLOCKED（等待锁） 状态</li></ul></blockquote> <h3 id="_7-3-举例"><a href="#_7-3-举例" class="header-anchor">#</a> 7.3 举例</h3> <p>例题：使用两个线程打印 1-100。线程 1, 线程 2 交替打印</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Communication</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_7-4-调用-wait-和-notify-需注意的细节"><a href="#_7-4-调用-wait-和-notify-需注意的细节" class="header-anchor">#</a> 7.4 调用 wait 和 notify 需注意的细节</h3> <ol><li>wait 方法与 notify 方法必须要由<code>同一个锁对象调用</code>。因为：对应的锁对象可以通过 notify 唤醒使用同一个锁对象调用的 wait 方法后的线程。</li> <li>wait 方法与 notify 方法是属于 Object 类的方法的。因为：锁对象可以是任意对象，而任意对象的所属类都是继承了 Object 类的。</li> <li>wait 方法与 notify 方法必须要在<code>同步代码块</code>或者是<code>同步函数</code>中使用。因为：必须要<code>通过锁对象</code>调用这 2 个方法。否则会报 java.lang.IllegalMonitorStateException 异常。</li></ol> <h3 id="_7-5-生产者与消费者问题"><a href="#_7-5-生产者与消费者问题" class="header-anchor">#</a> 7.5 生产者与消费者问题</h3> <p>等待唤醒机制可以解决经典的“生产者与消费者”的问题。生产者与消费者问题（英语：Producer-consumer problem），也称有限缓冲问题（英语：Bounded-buffer problem），是一个多线程同步问题的经典案例。该问题描述了两个（多个）<code>共享固定大小缓冲区的线程</code>——即所谓的“生产者”和“消费者”——在实际运行时会发生的问题。</p> <p>生产者的主要作用是生成一定量的数据放到缓冲区中，然后重复此过程。与此同时，消费者也在缓冲区消耗这些数据。<strong>该问题的关键就是要保证生产者不会在缓冲区满时加入数据，消费者也不会在缓冲区中空时消耗数据。</strong></p> <p><strong>举例：</strong></p> <p>生产者(Productor)将产品交给店员(Clerk)，而消费者(Customer)从店员处取走产品，店员一次只能持有固定数量的产品（比如:20），如果生产者试图生产更多的产品，店员会叫生产者停一下，如果店中有空位放产品了再通知生产者继续生产；如果店中没有产品了，店员会告诉消费者等一下，如果店中有产品了再通知消费者来取走产品。</p> <p>类似的场景，比如厨师和服务员等。</p> <p><strong>生产者与消费者问题中其实隐含了两个问题：</strong></p> <ul><li>线程安全问题：因为生产者与消费者共享数据缓冲区，产生安全问题。不过这个问题可以使用同步解决。</li> <li>线程的协调工作问题：
<ul><li>要解决该问题，就必须让生产者线程在缓冲区满时等待(wait)，暂停进入阻塞状态，等到下次消费者消耗了缓冲区中的数据的时候，通知(notify)正在等待的线程恢复到就绪状态，重新开始往缓冲区添加数据。同样，也可以让消费者线程在缓冲区空时进入等待(wait)，暂停进入阻塞状态，等到生产者往缓冲区添加数据之后，再通知(notify)正在等待的线程恢复到就绪状态。通过这样的通信机制来解决此类问题。</li></ul></li></ul> <p><strong>代码实现：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerProducerTest</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Clerk</span> clerk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Clerk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Producer</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span>clerk<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token class-name">Consumer</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>clerk<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Consumer</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>clerk<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		p1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;生产者1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		c1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		c2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;消费者2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		p1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		c1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		c2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//生产者</span>
<span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Clerk</span> clerk<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token class-name">Clerk</span> clerk<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>clerk <span class="token operator">=</span> clerk<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=========生产者开始生产产品========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">//要求clerk去增加产品</span>
			clerk<span class="token punctuation">.</span><span class="token function">addProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//消费者</span>
<span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Clerk</span> clerk<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token class-name">Clerk</span> clerk<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>clerk <span class="token operator">=</span> clerk<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=========消费者开始消费产品========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">//要求clerk去减少产品</span>
			clerk<span class="token punctuation">.</span><span class="token function">minusProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//资源类</span>
<span class="token keyword">class</span> <span class="token class-name">Clerk</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> productNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//产品数量</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAX_PRODUCT</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MIN_PRODUCT</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token comment">//增加产品</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>productNum <span class="token operator">&lt;</span> <span class="token constant">MAX_PRODUCT</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			productNum<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
					<span class="token string">&quot;生产了第&quot;</span> <span class="token operator">+</span> productNum <span class="token operator">+</span> <span class="token string">&quot;个产品&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//唤醒消费者</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//减少产品</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">minusProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>productNum <span class="token operator">&gt;=</span> <span class="token constant">MIN_PRODUCT</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
					<span class="token string">&quot;消费了第&quot;</span> <span class="token operator">+</span> productNum <span class="token operator">+</span> <span class="token string">&quot;个产品&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			productNum<span class="token operator">--</span><span class="token punctuation">;</span>
			
			<span class="token comment">//唤醒生产者</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br></div></div><h3 id="_7-6-面试题-区分-sleep-和-wait"><a href="#_7-6-面试题-区分-sleep-和-wait" class="header-anchor">#</a> 7.6 面试题：区分 sleep())和 wait()</h3> <p>相同点：一旦执行，都会使得当前线程结束执行状态，进入阻塞状态。</p> <p>不同点：</p> <p>① 定义方法所属的类：sleep():Thread 中定义。  wait():Object 中定义</p> <p>② 使用范围的不同：sleep()可以在任何需要使用的位置被调用； wait():必须使用在同步代码块或同步方法中</p> <p>③ 都在同步结构中使用的时候，是否释放同步监视器的操作不同：sleep():不会释放同步监视器 ;wait():会释放同步监视器</p> <p>④ 结束等待的方式不同：sleep()：指定时间一到就结束阻塞。 wait():可以指定时间也可以无限等待直到 notify 或 notifyAll。</p> <h3 id="_7-7-是否释放锁的操作"><a href="#_7-7-是否释放锁的操作" class="header-anchor">#</a> 7.7 是否释放锁的操作</h3> <p>任何线程进入同步代码块、同步方法之前，必须先获得对同步监视器的锁定，那么何时会释放对同步监视器的锁定呢？</p> <h4 id="_7-7-1-释放锁的操作"><a href="#_7-7-1-释放锁的操作" class="header-anchor">#</a> 7.7.1 释放锁的操作</h4> <p>当前线程的同步方法、同步代码块执行结束。</p> <p>当前线程在同步代码块、同步方法中遇到 break、return 终止了该代码块、该方法的继续执行。</p> <p>当前线程在同步代码块、同步方法中出现了未处理的 Error 或 Exception，导致当前线程异常结束。</p> <p>当前线程在同步代码块、同步方法中执行了锁对象的 wait()方法，当前线程被挂起，并释放锁。</p> <h4 id="_7-7-2-不会释放锁的操作"><a href="#_7-7-2-不会释放锁的操作" class="header-anchor">#</a> 7.7.2 不会释放锁的操作</h4> <p>线程执行同步代码块或同步方法时，程序调用 Thread.sleep()、Thread.yield()方法暂停当前线程的执行。</p> <p>线程执行同步代码块时，其他线程调用了该线程的 suspend()方法将该该线程挂起，该线程不会释放锁（同步监视器）。</p> <ul><li>应尽量避免使用 suspend() 和 resume() 这样的过时来控制线程。</li></ul> <h2 id="_8-jdk5-0-新增线程创建方式"><a href="#_8-jdk5-0-新增线程创建方式" class="header-anchor">#</a> 8. JDK5.0 新增线程创建方式</h2> <h3 id="_8-1-新增方式一-实现-callable-接口"><a href="#_8-1-新增方式一-实现-callable-接口" class="header-anchor">#</a> 8.1 新增方式一：实现 Callable 接口</h3> <ul><li>与使用 Runnable 相比， Callable 功能更强大些
<ul><li>相比 run()方法，可以有返回值</li> <li>方法可以抛出异常</li> <li>支持泛型的返回值（需要借助 FutureTask 类，获取返回结果）</li></ul></li> <li>Future 接口（了解）
<ul><li>可以对具体 Runnable、Callable 任务的执行结果进行取消、查询是否完成、获取结果等。</li> <li>FutureTask 是 Futrue 接口的唯一的实现类</li> <li>FutureTask 同时实现了 Runnable, Future 接口。它既可以作为 Runnable 被线程执行，又可以作为 Future 得到 Callable 的返回值</li></ul></li> <li>缺点：在获取分线程执行结果的时候，当前线程（或是主线程）受阻塞，效率较低。</li> <li>代码举例</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
 * 创建多线程的方式三：实现Callable （jdk5.0新增的）
 */</span>
<span class="token comment">//1.创建一个实现Callable的实现类</span>
<span class="token keyword">class</span> <span class="token class-name">NumThread</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span> <span class="token punctuation">{</span>
    <span class="token comment">//2.实现call方法，将此线程需要执行的操作声明在call()中</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallableTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//3.创建Callable接口实现类的对象</span>
        <span class="token class-name">NumThread</span> numThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NumThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4.将此Callable接口实现类的对象作为传递到FutureTask构造器中，创建FutureTask的对象</span>
        <span class="token class-name">FutureTask</span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span>numThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.将FutureTask的对象作为参数传递到Thread类的构造器中，创建Thread对象，并调用start()</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//      接收返回值</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//6.获取Callable中call方法的返回值</span>
            <span class="token comment">//get()返回值即为FutureTask构造器参数Callable实现类重写的call()的返回值。</span>
            <span class="token class-name">Object</span> sum <span class="token operator">=</span> futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总和为：&quot;</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="_8-2-新增方式二-使用线程池"><a href="#_8-2-新增方式二-使用线程池" class="header-anchor">#</a> 8.2 新增方式二：使用线程池</h3> <p><strong>现有问题：</strong></p> <p>如果并发的线程数量很多，并且每个线程都是执行一个时间很短的任务就结束了，这样频繁创建线程就会大大降低系统的效率，因为频繁创建线程和销毁线程需要时间。</p> <p>那么有没有一种办法使得线程可以复用，即执行完一个任务，并不被销毁，而是可以继续执行其他的任务？</p> <p><strong>思路：</strong> 提前创建好多个线程，放入线程池中，使用时直接获取，使用完放回池中。可以避免频繁创建销毁、实现重复利用。类似生活中的公共交通工具。</p> <p><img src="/assets/img/线程池的理解.b050163c.webp" alt="线程池的理解"></p> <p><strong>好处：</strong></p> <ul><li><p>提高响应速度（减少了创建新线程的时间）</p></li> <li><p>降低资源消耗（重复利用线程池中线程，不需要每次都创建）</p></li> <li><p>便于线程管理</p> <ul><li>corePoolSize：核心池的大小</li> <li>maximumPoolSize：最大线程数</li> <li>keepAliveTime：线程没有任务时最多保持多长时间后会终止</li> <li>…</li></ul></li></ul> <p><strong>线程池相关 API</strong></p> <ul><li>JDK5.0 之前，我们必须手动自定义线程池。从 JDK5.0 开始，Java 内置线程池相关的 API。在 java.util.concurrent 包下提供了线程池相关 API：<code>ExecutorService</code> 和 <code>Executors</code>。</li> <li><code>ExecutorService</code>：真正的线程池接口。常见子类 ThreadPoolExecutor
<ul><li><code>void execute(Runnable command)</code> ：执行任务/命令，没有返回值，一般用来执行 Runnable</li> <li><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code>：执行任务，有返回值，一般又来执行 Callable</li> <li><code>void shutdown()</code> ：关闭连接池</li></ul></li> <li><code>Executors</code>：一个线程池的工厂类，通过此类的静态工厂方法可以创建多种类型的线程池对象。
<ul><li><code>Executors.newCachedThreadPool()</code>：创建一个可根据需要创建新线程的线程池</li> <li><code>Executors.newFixedThreadPool(int nThreads)</code>; 创建一个可重用固定线程数的线程池</li> <li><code>Executors.newSingleThreadExecutor()</code> ：创建一个只有一个线程的线程池</li> <li><code>Executors.newScheduledThreadPool(int corePoolSize)</code>：创建一个线程池，它可安排在给定延迟后运行命令或者定期地执行。</li></ul></li></ul> <p><strong>代码举例：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">NumberThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">NumberThread1</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">NumberThread2</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> evenSum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//记录偶数的和</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                evenSum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> evenSum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. 提供指定线程数量的线程池</span>
        <span class="token class-name">ExecutorService</span> service <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadPoolExecutor</span> service1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">)</span> service<span class="token punctuation">;</span>
<span class="token comment">//        //设置线程池的属性</span>
<span class="token comment">//        System.out.println(service.getClass());//ThreadPoolExecutor</span>
        service1<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置线程池中线程数的上限</span>

        <span class="token comment">//2.执行指定的线程的操作。需要提供实现Runnable接口或Callable接口实现类的对象</span>
        service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NumberThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//适合适用于Runnable</span>
        service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NumberThread1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//适合适用于Runnable</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Future</span> future <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NumberThread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//适合使用于Callable</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总和为：&quot;</span> <span class="token operator">+</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//3.关闭连接池</span>
        service<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/06/12, 00:25:27</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/java-basic/java-from-entry-to-proficiency/chapter-9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第09章_异常处理</div></a> <a href="/java-basic/java-from-entry-to-proficiency/chapter-11/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第11章_常用类和基础 API</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java-basic/java-from-entry-to-proficiency/chapter-9/" class="prev">第09章_异常处理</a></span> <span class="next"><a href="/java-basic/java-from-entry-to-proficiency/chapter-11/">第11章_常用类和基础 API</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/jdbc-core/"><div>
            JDBC 核心技术(JDK21版)
            <!----></div></a> <span class="date">09-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/"><div>
            第00章_写在前面
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/"><div>
            第01章_Linux 下 MySQL 的安装与使用
            <!----></div></a> <span class="date">05-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca5c989c.js" defer></script><script src="/assets/js/3.f2884e99.js" defer></script><script src="/assets/js/2.81e8b964.js" defer></script><script src="/assets/js/26.936ee89a.js" defer></script>
  </body>
</html>
