<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第16章_多版本并发控制 | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.1f9bc03c.js" as="script"><link rel="preload" href="/assets/js/3.be9e7e99.js" as="script"><link rel="preload" href="/assets/js/2.c36d0987.js" as="script"><link rel="preload" href="/assets/js/61.ed48312b.js" as="script"><link rel="prefetch" href="/assets/js/1.0094a9f8.js"><link rel="prefetch" href="/assets/js/10.57dc9feb.js"><link rel="prefetch" href="/assets/js/100.549e8107.js"><link rel="prefetch" href="/assets/js/101.cdc9900a.js"><link rel="prefetch" href="/assets/js/102.559eb4e1.js"><link rel="prefetch" href="/assets/js/103.e93e873a.js"><link rel="prefetch" href="/assets/js/104.f72a97fa.js"><link rel="prefetch" href="/assets/js/105.8a88aff1.js"><link rel="prefetch" href="/assets/js/106.a6928366.js"><link rel="prefetch" href="/assets/js/107.88f8c8a9.js"><link rel="prefetch" href="/assets/js/108.221fcd72.js"><link rel="prefetch" href="/assets/js/109.83b01a4c.js"><link rel="prefetch" href="/assets/js/11.95ba941a.js"><link rel="prefetch" href="/assets/js/110.3a8bfc21.js"><link rel="prefetch" href="/assets/js/111.e09a67c7.js"><link rel="prefetch" href="/assets/js/112.8f29c828.js"><link rel="prefetch" href="/assets/js/113.a3ec218a.js"><link rel="prefetch" href="/assets/js/114.46baaf9a.js"><link rel="prefetch" href="/assets/js/115.dca2a47e.js"><link rel="prefetch" href="/assets/js/116.95b35ab7.js"><link rel="prefetch" href="/assets/js/117.748a7942.js"><link rel="prefetch" href="/assets/js/118.9baa4784.js"><link rel="prefetch" href="/assets/js/119.c98d396a.js"><link rel="prefetch" href="/assets/js/12.3e375fac.js"><link rel="prefetch" href="/assets/js/120.c56ebb20.js"><link rel="prefetch" href="/assets/js/121.0046ecb9.js"><link rel="prefetch" href="/assets/js/122.9266562d.js"><link rel="prefetch" href="/assets/js/123.607dd163.js"><link rel="prefetch" href="/assets/js/124.f902b1cd.js"><link rel="prefetch" href="/assets/js/125.a1fc58d3.js"><link rel="prefetch" href="/assets/js/126.0f7e19b0.js"><link rel="prefetch" href="/assets/js/127.0849390a.js"><link rel="prefetch" href="/assets/js/128.948551ba.js"><link rel="prefetch" href="/assets/js/129.d9ca416a.js"><link rel="prefetch" href="/assets/js/13.e15907e1.js"><link rel="prefetch" href="/assets/js/130.24c7e3fb.js"><link rel="prefetch" href="/assets/js/131.1b011ee5.js"><link rel="prefetch" href="/assets/js/132.8751add7.js"><link rel="prefetch" href="/assets/js/133.715ef8cf.js"><link rel="prefetch" href="/assets/js/14.8bc7a04e.js"><link rel="prefetch" href="/assets/js/15.45052e8a.js"><link rel="prefetch" href="/assets/js/16.9c02512f.js"><link rel="prefetch" href="/assets/js/17.48a859d1.js"><link rel="prefetch" href="/assets/js/18.5c00cde2.js"><link rel="prefetch" href="/assets/js/19.a40de13b.js"><link rel="prefetch" href="/assets/js/20.df43b03f.js"><link rel="prefetch" href="/assets/js/21.ceeba2d0.js"><link rel="prefetch" href="/assets/js/22.1bba0f00.js"><link rel="prefetch" href="/assets/js/23.76e4c23a.js"><link rel="prefetch" href="/assets/js/24.f9c3a106.js"><link rel="prefetch" href="/assets/js/25.d3ac7e27.js"><link rel="prefetch" href="/assets/js/26.2dccc980.js"><link rel="prefetch" href="/assets/js/27.470222d7.js"><link rel="prefetch" href="/assets/js/28.0083644b.js"><link rel="prefetch" href="/assets/js/29.c51b5005.js"><link rel="prefetch" href="/assets/js/30.e4d96a02.js"><link rel="prefetch" href="/assets/js/31.a6e5f592.js"><link rel="prefetch" href="/assets/js/32.f513417c.js"><link rel="prefetch" href="/assets/js/33.a02e512f.js"><link rel="prefetch" href="/assets/js/34.828ac0a3.js"><link rel="prefetch" href="/assets/js/35.6a8d3b2a.js"><link rel="prefetch" href="/assets/js/36.a17d9cce.js"><link rel="prefetch" href="/assets/js/37.b28188f4.js"><link rel="prefetch" href="/assets/js/38.6c0bad74.js"><link rel="prefetch" href="/assets/js/39.4ac705c3.js"><link rel="prefetch" href="/assets/js/4.80fad3d6.js"><link rel="prefetch" href="/assets/js/40.e1295e6b.js"><link rel="prefetch" href="/assets/js/41.ab0dc1d3.js"><link rel="prefetch" href="/assets/js/42.abf81f78.js"><link rel="prefetch" href="/assets/js/43.c6055770.js"><link rel="prefetch" href="/assets/js/44.2adf0a62.js"><link rel="prefetch" href="/assets/js/45.dfeaf4aa.js"><link rel="prefetch" href="/assets/js/46.4b7c2b21.js"><link rel="prefetch" href="/assets/js/47.d4a6831e.js"><link rel="prefetch" href="/assets/js/48.e1366a45.js"><link rel="prefetch" href="/assets/js/49.1bebc46f.js"><link rel="prefetch" href="/assets/js/5.1478cf6c.js"><link rel="prefetch" href="/assets/js/50.668f9cb0.js"><link rel="prefetch" href="/assets/js/51.dea0d5d9.js"><link rel="prefetch" href="/assets/js/52.3000ebc8.js"><link rel="prefetch" href="/assets/js/53.66f5ad34.js"><link rel="prefetch" href="/assets/js/54.319b0662.js"><link rel="prefetch" href="/assets/js/55.ffc0758d.js"><link rel="prefetch" href="/assets/js/56.b67a2b8d.js"><link rel="prefetch" href="/assets/js/57.70e2950c.js"><link rel="prefetch" href="/assets/js/58.a0a2420f.js"><link rel="prefetch" href="/assets/js/59.01790419.js"><link rel="prefetch" href="/assets/js/6.3409ab2f.js"><link rel="prefetch" href="/assets/js/60.43219c1e.js"><link rel="prefetch" href="/assets/js/62.62ea2fef.js"><link rel="prefetch" href="/assets/js/63.d1527c65.js"><link rel="prefetch" href="/assets/js/64.b10abcac.js"><link rel="prefetch" href="/assets/js/65.2206c2d8.js"><link rel="prefetch" href="/assets/js/66.bd612805.js"><link rel="prefetch" href="/assets/js/67.ad9c475a.js"><link rel="prefetch" href="/assets/js/68.7f975389.js"><link rel="prefetch" href="/assets/js/69.36725aff.js"><link rel="prefetch" href="/assets/js/70.b3cfc9e1.js"><link rel="prefetch" href="/assets/js/71.ef2c6abc.js"><link rel="prefetch" href="/assets/js/72.77bf484b.js"><link rel="prefetch" href="/assets/js/73.ca8e0259.js"><link rel="prefetch" href="/assets/js/74.9aa20efa.js"><link rel="prefetch" href="/assets/js/75.9de36ec8.js"><link rel="prefetch" href="/assets/js/76.79e8f077.js"><link rel="prefetch" href="/assets/js/77.a71d38fe.js"><link rel="prefetch" href="/assets/js/78.2168cfa5.js"><link rel="prefetch" href="/assets/js/79.d830dc29.js"><link rel="prefetch" href="/assets/js/80.ed07f097.js"><link rel="prefetch" href="/assets/js/81.036542c0.js"><link rel="prefetch" href="/assets/js/82.ccd57590.js"><link rel="prefetch" href="/assets/js/83.08279d07.js"><link rel="prefetch" href="/assets/js/84.fb82a36b.js"><link rel="prefetch" href="/assets/js/85.cc257bf7.js"><link rel="prefetch" href="/assets/js/86.9b4a4d60.js"><link rel="prefetch" href="/assets/js/87.be2fbadd.js"><link rel="prefetch" href="/assets/js/88.5dbe3bf4.js"><link rel="prefetch" href="/assets/js/89.baa4fea0.js"><link rel="prefetch" href="/assets/js/9.9ffa17fb.js"><link rel="prefetch" href="/assets/js/90.0b8138d9.js"><link rel="prefetch" href="/assets/js/91.6c5e4907.js"><link rel="prefetch" href="/assets/js/92.d4a76597.js"><link rel="prefetch" href="/assets/js/93.8a94df70.js"><link rel="prefetch" href="/assets/js/94.ed88a857.js"><link rel="prefetch" href="/assets/js/95.2f75b854.js"><link rel="prefetch" href="/assets/js/96.6946c831.js"><link rel="prefetch" href="/assets/js/97.b26e97d9.js"><link rel="prefetch" href="/assets/js/98.07ba851b.js"><link rel="prefetch" href="/assets/js/99.347e0865.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.cc39ba74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li><li class="dropdown-subitem"><a href="/java-basic/java-web/" class="nav-link">JavaWeb 技术</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li><li class="dropdown-subitem"><a href="/java-basic/java-web/" class="nav-link">JavaWeb 技术</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>核心</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java从入门到精通(JDK17版)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>MySQL从入门到高级-基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>MySQL从入门到高级-高级篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/" class="sidebar-link">第00章_写在前面</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/" class="sidebar-link">第01章_Linux 下 MySQL 的安装与使用</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-2/" class="sidebar-link">第02章_MySQL 的数据目录</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-3/" class="sidebar-link">第03章_用户与权限管理</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/" class="sidebar-link">第04章_逻辑架构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-5/" class="sidebar-link">第05章_存储引擎</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-6/" class="sidebar-link">第06章_索引的数据结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-7/" class="sidebar-link">第07章_InnoDB 数据存储结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-8/" class="sidebar-link">第08章_索引的创建与设计原则</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/" class="sidebar-link">第09章_性能分析工具的使用</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-10/" class="sidebar-link">第10章_索引优化与查询优化</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-11/" class="sidebar-link">第11章_数据库的设计规范</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-12/" class="sidebar-link">第12章_数据库其它调优策略</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-13/" class="sidebar-link">第13章_事务基础知识</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-14/" class="sidebar-link">第14章_MySQL 事务日志</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-15/" class="sidebar-link">第15章_锁</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/" aria-current="page" class="active sidebar-link">第16章_多版本并发控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_1-什么是-mvcc" class="sidebar-link">1. 什么是 MVCC</a></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_2-快照读与当前读" class="sidebar-link">2. 快照读与当前读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_2-1-快照读" class="sidebar-link">2.1 快照读</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_2-2-当前读" class="sidebar-link">2.2 当前读</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_3-复习" class="sidebar-link">3. 复习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_3-1-再谈隔离级别" class="sidebar-link">3.1 再谈隔离级别</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_3-2-隐藏字段、undo-log-版本链" class="sidebar-link">3.2 隐藏字段、Undo Log 版本链</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_4-mvcc-实现原理之-readview" class="sidebar-link">4. MVCC 实现原理之 ReadView</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_4-1-什么是-readview" class="sidebar-link">4.1 什么是 ReadView</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_4-2-设计思路" class="sidebar-link">4.2 设计思路</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_4-3-readview-的规则" class="sidebar-link">4.3 ReadView 的规则</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_4-4-mvcc-整体操作流程" class="sidebar-link">4.4 MVCC 整体操作流程</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_5-举例说明" class="sidebar-link">5. 举例说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_5-1-read-committed-隔离级别下" class="sidebar-link">5.1 READ COMMITTED 隔离级别下</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_5-2-repeatable-read-隔离级别下" class="sidebar-link">5.2 REPEATABLE READ 隔离级别下</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_5-3-如何解决幻读" class="sidebar-link">5.3 如何解决幻读</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/#_6-总结" class="sidebar-link">6. 总结</a></li></ul></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/" class="sidebar-link">第17章_其它数据库日志</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-18/" class="sidebar-link">第18章_主从复制</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-19/" class="sidebar-link">第19章_数据库备份与恢复</a></li></ul></section></li><li><a href="/java-basic/jdbc-core/" class="sidebar-link">JDBC 核心技术(JDK21版)</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JavaWeb技术</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=Java%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>Java基础</a></li><li data-v-06225672><a href="/categories/?category=%E6%A0%B8%E5%BF%83" title="分类" data-v-06225672>核心</a></li><li data-v-06225672><a href="/categories/?category=MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7-%E9%AB%98%E7%BA%A7%E7%AF%87" title="分类" data-v-06225672>MySQL从入门到高级-高级篇</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-05-14</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">第16章_多版本并发控制<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="第-16-章-多版本并发控制"><a href="#第-16-章-多版本并发控制" class="header-anchor">#</a> 第 16 章 多版本并发控制</h1> <h2 id="_1-什么是-mvcc"><a href="#_1-什么是-mvcc" class="header-anchor">#</a> 1. 什么是 MVCC</h2> <p><code>MVCC（Multiversion Concurrency Control）</code>多版本并发控制。顾名思义，MVCC 是通过数据行的多个版本管理来实现数据库的<code>并发控制</code>。这项技术使得在 InnoDB 的事务隔离级别下执行<code>一致性读</code>操作有了保证。换言之，就是为了查询一些正在被另一个事务更新的行，并且可以看到它们被更新之前的值，这样在做查询的时候就不用等待另一个事务释放锁。</p> <p>MVCC 没有正式的标准，在不同的 DBMS 中 MVCC 的实现方式可能是不同的，也不是普遍使用的（大家可以参考相关的 DBMS 文档）。这里讲解 InnoDB 中 MVCC 的实现机制（MySQL 其它的存储引擎并不支持它）。</p> <h2 id="_2-快照读与当前读"><a href="#_2-快照读与当前读" class="header-anchor">#</a> 2. 快照读与当前读</h2> <p>MVCC 在 MySQL InnoDB 中的实现主要是为了提高数据库并发性能，用更好的方式去处理<code>读-写冲突</code>，做到即使有读写冲突时，也能做到<code>不加锁</code>，<code>非阻塞并发读</code>，而这个读指的就是<code>快照读</code>, 而非<code>当前读</code>。当前读实际上是一种加锁的操作，是悲观锁的实现。而 MVCC 本质是采用乐观锁思想的一种方式。</p> <h3 id="_2-1-快照读"><a href="#_2-1-快照读" class="header-anchor">#</a> 2.1 快照读</h3> <p>快照读又叫一致性读，读取的是快照数据。<strong>不加锁的简单的 SELECT 都属于快照读</strong>，即不加锁的非阻塞读。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> player <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之所以出现快照读的情况，是基于提高并发性能的考虑，快照读的实现是基于 MVCC，它在很多情况下，避免了加锁操作，降低了开销。</p> <p>既然是基于多版本，那么快照读可能读到的并不一定是数据的最新版本，而有可能是之前的历史版本。</p> <p>快照读的前提是隔离级别不是串行级别，串行级别下的快照读会退化成当前读。</p> <h3 id="_2-2-当前读"><a href="#_2-2-当前读" class="header-anchor">#</a> 2.2 当前读</h3> <p>当前读读取的是记录的最新版本（最新数据，而不是历史版本的数据），读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。加锁的 SELECT，或者对数据进行增删改都会进行当前读。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span><span class="token punctuation">;</span> <span class="token comment"># 共享锁</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span> <span class="token comment"># 排他锁</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token keyword">values</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># 排他锁</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># 排他锁</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># 排他锁</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_3-复习"><a href="#_3-复习" class="header-anchor">#</a> 3. 复习</h2> <h3 id="_3-1-再谈隔离级别"><a href="#_3-1-再谈隔离级别" class="header-anchor">#</a> 3.1 再谈隔离级别</h3> <p>我们知道事务有 4 个隔离级别，可能存在三种并发问题</p> <p><img src="/assets/img/Concurrency_Issues_Isolation_Levels1.c02703ef.webp" alt="Concurrency_Issues_Isolation_Levels1.webp"></p> <p>在 MySQL 中，默认的隔离级别是可重复读，可以解决脏读和不可重复读的问题，如果仅从定义的角度来看，它并不能解决幻读问题。如果我们想要解决幻读问题，就需要采用串行化的方式，也就是将隔离级别提升到最高，但这样一来就会大幅降低数据库的事务并发能力。</p> <p>MVCC 可以不采用锁机制，而是通过乐观锁的方式来解决不可重复读和幻读问题！它可以在大多数情况下替代行级锁，降低系统的开销。</p> <p><img src="/assets/img/Concurrency_Issues_MVCC.32554fc9.webp" alt="Concurrency_Issues_MVCC.webp"></p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <ul><li>针对<strong>快照读</strong>（普通 select 语句），是通过 <strong>MVCC 方式解决了幻读</strong>。因为可重复读隔离级别下，事务执行过程中看到的数据，一直跟这个事务启动时看到的数据是一致的，即使中途有其他事务插入了一条数据，查询不出来这条数据的，所以就很好了避免幻读问题。</li> <li>针对<strong>当前读</strong>（select … for update 等语句），是通过 <strong>next-key lock（记录锁 + 间隙锁）方式解决了幻读</strong>。因为当执行 select … for update 语句的时候，会加上 next-key lock，如果有其他事务在 next-key lock 锁范围内插入了一条记录，那么这个插入语句就会被阻塞，无法成功插入，所以就很好了避免幻读问题。</li></ul></div> <h3 id="_3-2-隐藏字段、undo-log-版本链"><a href="#_3-2-隐藏字段、undo-log-版本链" class="header-anchor">#</a> 3.2 隐藏字段、Undo Log 版本链</h3> <p>回顾一下 undo 日志的版本链，对于使用<code>InnoDB</code>存储引擎的表来说，它的聚簇索引记录中都包含两个必要的隐藏列。</p> <ul><li><code>trx_id</code>：每次一个事务对某条聚簇索引记录进行改动时，都会把该事务的<code>事务id</code>赋值给<code>trx_id</code>隐藏列。</li> <li><code>roll_pointer</code>：每次对某条聚簇索引记录进行改动时，都会把旧的版本写入到<code>undo 日志</code>中，然后这个隐藏列就相当于一个指针，可以通过它来找到该记录修改前的信息。</li></ul> <p><strong>举例：student 表数据如下</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span><span class="token keyword">from</span> student<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name   <span class="token operator">|</span> class  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 张三   <span class="token operator">|</span> 一班    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>假设插入该记录的<code>事务id</code>为<code>8</code>，那么此刻该条记录的示意图如下所示:</p> <p><img src="data:image/webp;base64,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" alt="MVCC_Record_RollPointer.webp"></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>insert undo 只在事务回滚时起作用，当事务提交后，该类型的 undo 日志就没用了，它占用的 Undo Log Segment 也会被系统回收（也就是该 undo 日志占用的 Undo 页面链表要么被重用，要么被释放）。</p></div> <p>假设之后两个事务 id 分别为<code>10</code>、<code>20</code>的事务对这条记录进行<code>UPDATE</code>操作，操作流程如下：</p> <table><thead><tr><th style="text-align:left;">发生时间顺序</th> <th style="text-align:left;">事务 10</th> <th style="text-align:left;">事务 20</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">BEGIN;</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;"></td> <td style="text-align:left;">BEGIN;</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">UPDATE student SET name=&quot;李四&quot; WHERE id=1;</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">4</td> <td style="text-align:left;">UPDATE student SET name=&quot;王五&quot; WHERE id=1;</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">5</td> <td style="text-align:left;">COMMIT;</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">6</td> <td style="text-align:left;"></td> <td style="text-align:left;">UPDATE student SET name=&quot;钱七&quot; WHERE id=1;</td></tr> <tr><td style="text-align:left;">7</td> <td style="text-align:left;"></td> <td style="text-align:left;">UPDATE student SET name=&quot;宋八&quot; WHERE id=1;</td></tr> <tr><td style="text-align:left;">8</td> <td style="text-align:left;"></td> <td style="text-align:left;">COMMIT;</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>能不能在两个事务中交叉更新同一条记录呢？不能！这不就是一个事务修改了另一个未提交事务修改过的数据，脏写。</li> <li>InnoDB 使用锁来保证不会有脏写情况的发生，也就是在第一个事务更新了某条记录后，就会给这条记录加锁，另一个事务再次更新时就需要等待第一个事务提交了，把锁释放之后才可以继续更新。</li></ul></div> <p>每次对记录进行改动，都会记录一条 undo 日志，每条 undo 日志也都有一个<code>roll_pointer</code>属性（<code>INSERT</code>操作对应的 undo 日志没有该属性，因为该记录并没有更早的版本），可以将这些<code>undo 日志</code>都连起来，串成一个链表：</p> <p><img src="/assets/img/MVCC_Undo_Log_Demo.e5855559.webp" alt="MVCC_Undo_Log_Demo"></p> <p>对该记录每次更新后，都会将旧值放到一条<code>undo 日志</code>中，就算是该记录的一个旧版本，随着更新次数的增多，所有的版本都会被<code>roll_pointer</code>属性连接成一个链表，我们把这个链表称之为<code>版本链</code>，版本链的头节点就是当前记录最新的值。</p> <p>每个版本中还包含生成该版本时对应的<code>事务id</code>。</p> <h2 id="_4-mvcc-实现原理之-readview"><a href="#_4-mvcc-实现原理之-readview" class="header-anchor">#</a> 4. MVCC 实现原理之 ReadView</h2> <p>MVCC 的实现依赖于：<strong>隐藏字段、Undo Log、Read View</strong>。</p> <h3 id="_4-1-什么是-readview"><a href="#_4-1-什么是-readview" class="header-anchor">#</a> 4.1 什么是 ReadView</h3> <p>在 MVCC 机制中，多个事务对同一个行记录进行更新会产生多个历史快照，这些历史快照保存在 Undo Log 里。如果一个事务想要查询这个行记录，需要读取哪个版本的行记录呢?这时就需要用到 ReadView 了，它帮我们解决了行的可见性问题。</p> <p>ReadView 就是事务在使用 MVCC 机制进行快照读操作时产生的读视图。当事务启动时，会生成数据库系统当前的一个快照，InnoDB 为每个事务构造了一个数组，用来记录并维护系统当前<code>活跃事务</code>的 ID（“活跃”指的就是，启动了但还没提交）。</p> <h3 id="_4-2-设计思路"><a href="#_4-2-设计思路" class="header-anchor">#</a> 4.2 设计思路</h3> <p>使用<code>READ UNCOMMITTED</code>隔离级别的事务，由于可以读到未提交事务修改过的记录，所以直接读取记录的最新版本就好了。</p> <p>使用<code>SERIALIZABLE</code>隔离级别的事务，InnoDB 规定使用加锁的方式来访问记录。</p> <p>使用<code>READ COMMITTED</code>和<code>REPEATABLE READ</code>隔离级别的事务，都必须保证读到<code>已经提交了的</code>事务修改过的记录。假如另一个事务已经修改了记录但是尚未提交，是不能直接读取最新版本的记录的，核心问题就是需要判断一下版本链中的哪个版本是当前事务可见的，这是 ReadView 要解决的主要问题。</p> <p>这个 ReadView 中主要包含 4 个比较重要的内容，分别如下：</p> <ul><li><code>creator_trx_id</code>，创建这个 Read View 的事务 ID。</li></ul> <div class="custom-block tip"><p class="custom-block-title">说明</p> <p>只有在对表中的记录做改动时（执行 INSERT、DELETE、UPDATE 这些语句时）才会为事务分配事务 id，否则在一个只读事务中的事务 id 值都默认为 0。</p></div> <ul><li><p><code>trx_ids</code>，表示在生成 ReadView 时当前系统中活跃的读写事务的<code>事务 id 列表</code>。</p></li> <li><p><code>up_limit_id</code>，活跃的事务中最小的事务 ID。</p></li> <li><p><code>low_limit_id</code>，表示生成 ReadView 时系统中应该分配给下一个事务的<code>id</code>值。low_limit_id 是系统最大的事务 id 值，这里要注意是系统中的事务 id，需要区别于正在活跃的事务 ID。</p></li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>low_limit_id 并不是 trx_ids 中的最大值，事务 id 是递增分配的。比如，现在有 id 为 1，2，3 这三个事务，之后 id 为 3 的事务提交了。那么一个新的读事务在生成 ReadView 时，trx_ids 就包括 1 和 2，up_limit_id 的值就是 1，low_limit_id 的值就是 4。</p></div> <p><strong>举例:</strong></p> <p>trx_ids 为 tr2、tr3、tr5 和 trx8 的集合，系统的最大事务 ID (low_limit_id)为 trx8+1（如果之前没有其他的新增事务），活跃的最小事务 ID (up_limit_id)为 trx2。</p> <p><img src="data:image/webp;base64,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" alt="trx_ids.webp"></p> <h3 id="_4-3-readview-的规则"><a href="#_4-3-readview-的规则" class="header-anchor">#</a> 4.3 ReadView 的规则</h3> <p>有了这个 ReadView，这样在访问某条记录时，只需要按照下边的步骤判断记录的某个版本是否可见。</p> <ul><li>如果被访问版本的 trx_id 属性值与 ReadView 中的<code>creator_trx_id</code>值相同，意味着当前事务在访问它自己修改过的记录，所以该版本可以被当前事务访问。</li> <li>如果被访问版本的 trx_id 属性值小于 ReadView 中的<code>up_limit_id</code>值，表明生成该版本的事务在当前事务生成 ReadView 前已经提交，所以该版本可以被当前事务访问。</li> <li>如果被访问版本的 trx_id 属性值大于或等于 ReadView 中的<code>low_limit_id</code>值，表明生成该版本的事务在当前事务生成 ReadView 后才开启，所以该版本不可以被当前事务访问。</li> <li>如果被访问版本的 trx_id 属性值在 ReadView 的<code>up_limit_id</code>和<code>low_limit_id</code>之间，那就需要判断一下 trx_id 属性值是不是在 trx_ids 列表中。
<ul><li>如果在，说明创建 ReadView 时生成该版本的事务还是活跃的，该版本不可以被访问。</li> <li>如果不在，说明创建 ReadView 时生成该版本的事务已经被提交，该版本可以被访问。</li></ul></li></ul> <h3 id="_4-4-mvcc-整体操作流程"><a href="#_4-4-mvcc-整体操作流程" class="header-anchor">#</a> 4.4 MVCC 整体操作流程</h3> <p>了解了这些概念之后，我们来看下当查询一条记录的时候，系统如何通过 MVCC 找到它：</p> <ol><li>首先获取事务自己的版本号，也就是事务 ID；</li> <li>获取 ReadView；</li> <li>查询得到的数据，然后与 ReadView 中的事务版本号进行比较；</li> <li>如果不符合 ReadView 规则，就需要从 Undo Log 中获取历史快照；</li> <li>最后返回符合规则的数据。</li></ol> <p>如果某个版本的数据对当前事务不可见的话，那就顺着版本链找到下一个版本的数据，继续按照上边的步骤判断可见性，依此类推，直到版本链中的最后一个版本。如果最后一个版本也不可见的话，那么就意味着该条记录对该事务完全不可见，查询结果就不包含该记录。</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>InnoDB 中，MVCC 是通过 Undo Log + Read View 进行数据读取，Undo Log 保存了历史快照，而 Read View 规则帮我们判断当前版本的数据是否可见。</p></div> <p>在隔离级别为读已提交(Read Committed)时，一个事务中的每一次 SELECT 查询都会重新获取一次 Read View。</p> <p>如表所示：</p> <table><thead><tr><th style="text-align:center;">事务</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">begin;</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">select * from student where id &gt;2;</td> <td style="text-align:left;">获取一次 Read View</td></tr> <tr><td style="text-align:center;">.........</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">select * from student where id &gt;2;</td> <td style="text-align:left;">获取一次 Read View</td></tr> <tr><td style="text-align:center;">commit;</td> <td style="text-align:left;"></td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>此时同样的查询语句都会重新获取一次 Read View，这时如果 Read View 不同，就可能产生不可重复读或者幻读的情况。</p></div> <p>当隔离级别为可重复读的时候，就避免了不可重复读，这是因为一个事务只在第一次 SELECT 的时候会获取一次 Read View，而后面所有的 SELECT 都会复用这个 Read View，如下表所示：</p> <table><thead><tr><th style="text-align:center;">事务</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">begin;</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">select * from student where id &gt;2;</td> <td style="text-align:left;">只在第一次 SELECT 的时候<br>获取一次 Read View</td></tr> <tr><td style="text-align:center;">.........</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">select * from student where id &gt;2;</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">commit;</td> <td style="text-align:left;"></td></tr></tbody></table> <h2 id="_5-举例说明"><a href="#_5-举例说明" class="header-anchor">#</a> 5. 举例说明</h2> <p>假设现在 student 表中只有一条由事务 id 为 8 的事务插入的一条记录:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span><span class="token keyword">from</span> student<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name   <span class="token operator">|</span> class  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 张三   <span class="token operator">|</span> 一班    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>MVCC 只能在 READ COMMITTED 和 REPEATABLE READ 两个隔离级别下工作。接下来看一下<code>READ COMMITTED</code>和<code>REPEATABLE READ</code>所谓的生成 ReadView 的时机不同到底不同在哪里。</p> <h3 id="_5-1-read-committed-隔离级别下"><a href="#_5-1-read-committed-隔离级别下" class="header-anchor">#</a> 5.1 READ COMMITTED 隔离级别下</h3> <p><strong>READ COMMITTED</strong> <strong>：每次读取数据前都生成一个 ReadView</strong>。</p> <p>现在有两个事务 id 分别为<code>10</code>、<code>20</code>的事务在执行：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># Transaction 10</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;王五&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>

<span class="token comment"># Transaction 20</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token comment"># 更新了一些别的表的记录</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">说明</p> <p>事务执行过程中，只有在第一次真正修改记录时（比如使用 INSERT、DELETE、UPDATE 语句），才会被分配一个单独的事务 id，这个事务 id 是递增的。所以我们才在事务 2 中更新些别的表的记录，目的是让它分配事务 id。</p></div> <p>此刻，表 student 中<code>id 为 1 的记录</code>得到的版本链表如下所示：</p> <p><img src="/assets/img/MVCC_Undo_Log_Demo2.b42f58d5.webp" alt="MVCC_Undo_Log_Demo2"></p> <p>假设现在有一个使用 READ COMMITTED 隔离级别的事务开始执行：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 使用READ COMMITTED隔离级别的事务</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token comment"># SELECT1：Transaction 10、 20 未提交</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment"># 得到的列name的值为'张三'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这个<code>SELECT1</code>的执行过程如下:</p> <p>步骤 1：在执行 SELECT 语句时会先生成一个<code>ReadView</code>，ReadView 的<code>trx_ids</code>列表的内容就是<code>[10，20]</code>，<code>up_limit_id</code>为 10，<code>low_limit_id</code>为 21，<code>creator_trx_id</code>为 0。</p> <p>步骤 2：从版本链中挑选可见的记录，从图中看出，最新版本的列<code>name</code>的内容是'<code>王五</code>'，该版本的<code>trx_id</code>值为<code>10</code>，在<code>trx_ids</code>列表内，所以不符合可见性要求，根据 roll_pointer 跳到下一个版本。</p> <p>步骤 3：下一个版本的列<code>name</code>的内容是'<code>李四</code>'，该版本的<code>trx_id</code>值也为<code>10</code>，也在<code>trx_ids</code>列表内，所以也不符合要求，继续跳到下一个版本。</p> <p>步骤 4：下一个版本的列<code>name</code>的内容是'<code>张三</code>'，该版本的<code>trx_id</code>值为 8，小于 ReadView 中的<code>up_limit_id</code>值<code>10</code>，所以这个版本是符合要求的，最后返回给用户的版本就是这条列<code>name</code>为‘<code>张三</code>'的记录。</p> <p>之后，我们把<code>事务id</code>为 <code>10</code> 的事务提交一下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># Transaction 10</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;王五&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>

<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后再到事务 id 为 20 的事务中更新一下表 student 中 id 为 1 的记录：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># Transaction 20</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token comment"># 更新了一些别的表的记录</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;钱七&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;宋八&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>此刻，表 student 中 id 为 1 的记录的版本链就长这样：</p> <p><img src="/assets/img/MVCC_Undo_Log_Demo.e5855559.webp" alt="MVCC_Undo_Log_Demo"></p> <p>然后再到刚才使用<code>READ COMMITTED</code>隔离级别的事务中继续查找这个 id 为 1 的记录，如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 使用READ COMMITTED隔离级别的事务</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token comment"># SELECT1：Transaction 10、 20 均未提交</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment"># 得到的列name的值为'张三'</span>

<span class="token comment"># SELECT2：Transaction 10提交，Transaction 20未提交</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment"># 得到的列name的值为'王五'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个<code>SELECT2</code>的执行过程如下:</p> <p>步骤 1：在执行<code>SELECT</code>语句时会又会单独生成一个<code>ReadView</code>，该 ReadView 的 trx_ids 列表的内容就是[<code>20</code>]，<code>up_limitid</code>为 20，<code>low_limit_id</code>为 21，<code>creator_trx_id</code>为<code>0</code>。</p> <p>步骤 2：从版本链中挑选可见的记录，从图中看出，最新版本的列<code>name</code>的内容是‘<code>宋八</code>‘，该版本的<code>trx_id</code>值为 20，在<code>trx_ids</code>列表内，所以不符合可见性要求，根据<code>roll_pointer</code>跳到下一个版本。</p> <p>步骤 3：下一个版本的列<code>name</code>的内容是‘<code>钱七</code>'，该版本的<code>trx_id</code>值为<code>20</code>，也在<code>trx_ids</code>列表内，所以也不符合要求，继续跳到下一个版本。</p> <p>步骤 4：下一个版本的列<code>name</code>的内容是'<code>王五</code>'，该版本的<code>trx_id</code>值为 10，小于<code>ReadView</code>中的<code>up_limit_id</code>值 20，所以这个版本是符合要求的，最后返回给用户的版本就是这条列<code>name</code>为‘<code>王五</code>‘的记录。</p> <p>以此类推，如果之后事务 id 为 20 的记录也提交了，再次在使用 READ COMMITTED 隔离级别的事务中查询表 student 中 id 值为 1 的记录时，得到的结果就是‘宋八'了，具体流程我们就不分析了。</p> <div class="custom-block tip"><p class="custom-block-title">强调</p> <p>使用 READ COMMITTED 隔离级别的事务在每次查询开始时都会生成一个独立的 ReadView。</p></div> <h3 id="_5-2-repeatable-read-隔离级别下"><a href="#_5-2-repeatable-read-隔离级别下" class="header-anchor">#</a> 5.2 REPEATABLE READ 隔离级别下</h3> <p>使用<code>REPEATABLE READ</code>隔离级别的事务来说，只会在第一次执行查询语句时生成一个 <code>ReadView</code> ，之后的查询就不会重复生成了。</p> <p>比如，系统里有两个事务 id 分别为 10 、 20 的事务在执行：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 开始记录</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span><span class="token keyword">from</span> student<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name   <span class="token operator">|</span> class  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 张三    <span class="token operator">|</span> 一班   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+--------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># Transaction 10</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;王五&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>

<span class="token comment"># Transaction 20</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token comment"># 更新了一些别的表的记录</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>此刻，表 student 中 id 为 1 的记录得到的版本链表如下所示：</p> <p><img src="/assets/img/MVCC_Undo_Log_Demo2.b42f58d5.webp" alt="MVCC_Undo_Log_Demo2"></p> <p>假设现在有一个使用<code>REPEATABLE READ</code>隔离级别的事务开始执行：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 使用REPEATABLE READ隔离级别的事务</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token comment"># SELECT1：Transaction 10、 20 未提交</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment"># 得到的列name的值为'张三'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这个 SELECT1 的执行过程如下（<code>第一个 ReadView 和读已提交是一样的</code>）:</p> <p>步骤 1：在执行 SELECT 语句时会先生成一个<code>ReadView</code>，ReadView 的 <code>trx_ids</code>列表的内容就是<code>[10，20]</code>，<code>up_limit_id</code>为 10, <code>low_limit_id</code>为 21，<code>creator_trx_id</code>为 0。</p> <p>步骤 2：从版本链中挑选可见的记录，从图中看出，最新版本的列<code>name</code>的内容是'<code>王五</code>'，该版本的<code>trx_id</code>值为<code>10</code>，在<code>trx_ids</code>列表内，所以不符合可见性要求，根据 roll_pointer 跳到下一个版本。</p> <p>步骤 3：下一个版本的列<code>name</code>的内容是'<code>李四</code>'，该版本的<code>trx_id</code>值也为<code>10</code>，也在<code>trx_ids</code>列表内，所以也不符合要求，继续跳到下一个版本。</p> <p>步骤 4：下一个版本的列<code>name</code>的内容是'<code>张三</code>'，该版本的<code>trx_id</code>值为 8，小于 ReadView 中的<code>up_limit_id</code>值<code>10</code>，所以这个版本是符合要求的，最后返回给用户的版本就是这条列<code>name</code>为‘<code>张三</code>'的记录。</p> <p>之后，我们把<code>事务id</code>为<code>10</code>的事务提交一下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># Transaction 10</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;王五&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>

<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后再到事务 id 为 20 的事务中更新一下表 student 中 id 为 1 的记录：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># Transaction 20</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token comment"># 更新了一些别的表的记录</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;钱七&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;宋八&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>此刻，表 student 中 id 为 1 的记录的版本链长这样：</p> <p><img src="/assets/img/MVCC_Undo_Log_Demo.e5855559.webp" alt="MVCC_Undo_Log_Demo"></p> <p>然后再到刚才使用<code>REPEATABLE READ</code>隔离级别的事务中继续查找这个 id 为 1 的记录，如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 使用REPEATABLE READ隔离级别的事务</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token comment"># SELECT1：Transaction 10、 20 均未提交</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment"># 得到的列name的值为'张三'</span>

<span class="token comment"># SELECT2：Transaction 10提交，Transaction 20未提交</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment"># 得到的列name的值仍为'张三'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个<code>SELECT2</code>的执行过程如下:</p> <p>步骤 1：因为当前事务的隔离级别是<code>REPEATABLE READ</code>，而之前在执行<code>SELECT1</code>时已经生成过 ReadView 了，所以此时会直接复用之前的<code>ReadView</code>，之前的 ReadView 的 trx_ids 列表的内容是[10，20]，<code>up_limit_id</code>为 10, <code>low_limit_id</code>为 21, <code>creator_trx_id</code>为 0。</p> <p>步骤 2：然后从版本链中挑选可见的记录，从图中可以看出，最新版本的列 name 的内容是'宋八'，该版本的 trx_id 值为 20，在 trx_ids 列表内，所以不符合可见性要求，根据 roll_pointer 跳到下一个版本。</p> <p>步骤 3：下一个版本的列 name 的内容是'钱七'，该版本的 trx_id 值为 20，也在 trx_ids 列表内，所以也不符合要求，继续跳到下一个版本。</p> <p>步骤 4：下一个版本的列 name 的内容是'王五'，该版本的 trx_id 值为 10，而 trx_ids 列表中是包含值为 10 的事务 id 的，所以该版本也不符合要求，同理下一个列 name 的内容是'李四’的版本也不符合要求。继续跳到下一个版本。</p> <p>步骤 5：下一个版本的列 name 的内容是‘张三'，该版本的 trx_id 值为 80，小于 ReadView 中的 up_limit_id 值 10，所以这个版本是符合要求的，最后返回给用户的版本就是这条列 c 为'张三'的记录。</p> <p>两次 SELECT 查询得到的结果是重复的，记录的列 c 值都是'张三'，这就是可重复读的含义。如果我们之后再把事务 id 为 20 的记录提交了，然后再到刚才使用 REPEATABLE READ 隔离级别的事务中继续查找这个 id 为 1 的记录，得到的结果还是‘张三'，具体执行过程大家可以自己分析一下。</p> <h3 id="_5-3-如何解决幻读"><a href="#_5-3-如何解决幻读" class="header-anchor">#</a> 5.3 如何解决幻读</h3> <p>接下来说明 InnoDB 是如何解决幻读的。</p> <p>假设现在表 student 中只有一条数据，数据内容中，主键 id=1，隐藏的 trx_id=10，它的 undo log 如下图所示。</p> <p><img src="data:image/webp;base64,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" alt="MVCC_Phantom_Read_Demo"></p> <p>假设现在有事务 A 和事务 B 并发执行，<code>事务 A</code>的事务 id 为<code>20</code>，<code>事务 B</code>的事务 id 为<code>30</code>。</p> <p>步骤 1：事务 A 开始第一次查询数据，查询的 SQL 语句如下。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> id <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在开始查询之前，MySQL 会为事务 A 产生一个 ReadView，此时 ReadView 的内容如下：<code>trx_ids= [20,30]</code>，<code>up_limit_id=20</code>，<code>low_limit_id=31</code>，<code>creator_trx_id=20</code>。</p> <p>由于此时表 student 中只有一条数据，且符合 where id&gt;=1 条件，因此会查询出来。然后根据 ReadView 机制，发现该行数据的 trx_id=10，小于事务 A 的 ReadView 里 up_limit_id，这表示这条数据是事务 A 开启之前，其他事务就已经提交了的数据，因此事务 A 可以读取到。</p> <p>结论：事务 A 的第一次查询，能读取到一条数据，id=1。</p> <p>步骤 2：接着事务 B(trx_id=30)，往表 student 中新插入两条数据，并提交事务。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> student<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> student<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'王五'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时表 student 中就有三条数据了，对应的 undo 如下图所示：</p> <p><img src="/assets/img/MVCC_Phantom_Read_Demo2.fa525762.webp" alt="MVCC_Phantom_Read_Demo2"></p> <p>步骤 3：接着事务 A 开启第二次查询，根据可重复读隔离级别的规则，此时事务 A 并不会再重新生成 ReadView。此时表 student 中的 3 条数据都满足 where id&gt;=1 的条件，因此会先查出来。然后根据 ReadView 机制，判断每条数据是不是都可以被事务 A 看到。</p> <p>1）首先 id=1 的这条数据，前面已经说过了，可以被事务 A 看到。</p> <p>2）然后是 id=2 的数据，它的 trx_id=30，此时事务 A 发现，这个值处于 up_limit_id 和 low_limit_id 之间，因此还需要再判断 30 是否处于 trx_ids 数组内。由于事务 A 的 trx_ids=[20,30]，因此在数组内，这表示 id=2 的这条数据是与事务 A 在同一时刻启动的其他事务提交的，所以这条数据不能让事务 A 看到。</p> <p>3）同理，id=3 的这条数据，trx_id 也为 30，因此也不能被事务 A 看见。</p> <p><img src="/assets/img/MVCC_Phantom_Read_Demo3.900fc2a3.webp" alt="MVCC_Phantom_Read_Demo3"></p> <p>结论：最终事务 A 的第二次查询，只能查询出 id=1 的这条数据。这和事务 A 的第一次查询的结果是一样的，因此没有出现幻读现象，所以说在 MySQL 的可重复读隔离级别下，不存在幻读问题。</p> <h2 id="_6-总结"><a href="#_6-总结" class="header-anchor">#</a> 6. 总结</h2> <p>这里介绍了<code>MVCC</code>在<code>READ COMMITTD</code>、<code>REPEATABLE READ</code>这两种隔离级别的事务在执行快照读操作时访问记录的版本链的过程。这样使不同事务的<code>读-写</code>、<code>写-读</code>操作并发执行，从而提升系统性能。</p> <p>核心点在于 ReadView 的原理，<code>READ COMMITTD</code>、<code>REPEATABLE READ</code>这两个隔离级别的一个很大不同就是生成 ReadView 的时机不同：</p> <ul><li><code>READ COMMITTD</code>在每一次进行普通 SELECT 操作前都会生成一个 ReadView</li> <li><code>REPEATABLE READ</code>只在第一次进行普通 SELECT 操作前生成一个 ReadView，之后的查询操作都重复使用这个 ReadView。</li></ul> <div class="custom-block tip"><p class="custom-block-title">说明</p> <p>我们之前说执行 DELETE 语句或者更新主键的 UPDATE 语句并不会立即把对应的记录完全从页面中删除,而是执行一个所谓的 delete mark 操作，相当于只是对记录打上了一个删除标志位，这主要就是为 MVCC 服务的。</p></div> <p>通过 MVCC 我们可以解决:</p> <ol><li><code>读写之间阻塞的问题</code>。通过 MVCC 可以让读写互相不阻塞，即读不阻塞写，写不阻塞读，这样就可以提升事务并发处理能力。</li> <li><code>降低了死锁的概率</code>。这是因为 MVCC 采用了乐观锁的方式，读取数据时并不需要加锁，对于写操作，也只锁定必要的行。</li> <li><code>解决快照读的问题</code>。当我们查询数据库在某个时间点的快照时，只能看到这个时间点之前事务提交更新的结果，而不能看到这个时间点之后事务提交的更新结果。</li></ol></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/09/14, 18:13:52</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-15/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第15章_锁</div></a> <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第17章_其它数据库日志</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-15/" class="prev">第15章_锁</a></span> <span class="next"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/">第17章_其它数据库日志</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/java-web/chapter-9/"><div>
            第九章 前端工程化-下
            <!----></div></a> <span class="date">12-11</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/java-web/chapter-8/"><div>
            第八章 前端工程化-中
            <!----></div></a> <span class="date">12-11</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/java-web/chapter-7/"><div>
            第七章 前端工程化-上
            <!----></div></a> <span class="date">12-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2026
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1f9bc03c.js" defer></script><script src="/assets/js/3.be9e7e99.js" defer></script><script src="/assets/js/2.c36d0987.js" defer></script><script src="/assets/js/61.ed48312b.js" defer></script>
  </body>
</html>
