<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第17章_其它数据库日志 | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.ca5c989c.js" as="script"><link rel="preload" href="/assets/js/3.f2884e99.js" as="script"><link rel="preload" href="/assets/js/2.81e8b964.js" as="script"><link rel="preload" href="/assets/js/55.b6fc3e0a.js" as="script"><link rel="prefetch" href="/assets/js/1.f754fd0b.js"><link rel="prefetch" href="/assets/js/10.bde6e567.js"><link rel="prefetch" href="/assets/js/100.000718ad.js"><link rel="prefetch" href="/assets/js/101.863f022a.js"><link rel="prefetch" href="/assets/js/102.7b45f43b.js"><link rel="prefetch" href="/assets/js/103.ba5681a8.js"><link rel="prefetch" href="/assets/js/104.e35b7e87.js"><link rel="prefetch" href="/assets/js/105.15a150cd.js"><link rel="prefetch" href="/assets/js/106.aea81b3b.js"><link rel="prefetch" href="/assets/js/107.4f4dec09.js"><link rel="prefetch" href="/assets/js/108.0079fda6.js"><link rel="prefetch" href="/assets/js/109.7a5059de.js"><link rel="prefetch" href="/assets/js/11.fa1b0bc7.js"><link rel="prefetch" href="/assets/js/110.85007649.js"><link rel="prefetch" href="/assets/js/111.dbec93e3.js"><link rel="prefetch" href="/assets/js/112.f17a38c0.js"><link rel="prefetch" href="/assets/js/113.6478506e.js"><link rel="prefetch" href="/assets/js/114.6031c0db.js"><link rel="prefetch" href="/assets/js/115.d7094af2.js"><link rel="prefetch" href="/assets/js/116.316a6234.js"><link rel="prefetch" href="/assets/js/117.1336f5e0.js"><link rel="prefetch" href="/assets/js/118.4b882789.js"><link rel="prefetch" href="/assets/js/119.503f83be.js"><link rel="prefetch" href="/assets/js/12.04b9b957.js"><link rel="prefetch" href="/assets/js/120.af7d94d8.js"><link rel="prefetch" href="/assets/js/121.5cd3597d.js"><link rel="prefetch" href="/assets/js/122.82f45642.js"><link rel="prefetch" href="/assets/js/123.f2ba0b19.js"><link rel="prefetch" href="/assets/js/13.680e50fd.js"><link rel="prefetch" href="/assets/js/14.dfca4100.js"><link rel="prefetch" href="/assets/js/15.01784967.js"><link rel="prefetch" href="/assets/js/16.81c1d5ab.js"><link rel="prefetch" href="/assets/js/17.9a472859.js"><link rel="prefetch" href="/assets/js/18.5366cb68.js"><link rel="prefetch" href="/assets/js/19.b1b74ef9.js"><link rel="prefetch" href="/assets/js/20.e938fa21.js"><link rel="prefetch" href="/assets/js/21.3e38db33.js"><link rel="prefetch" href="/assets/js/22.f9d18654.js"><link rel="prefetch" href="/assets/js/23.8eea4b67.js"><link rel="prefetch" href="/assets/js/24.6fe732dc.js"><link rel="prefetch" href="/assets/js/25.b1885cb6.js"><link rel="prefetch" href="/assets/js/26.936ee89a.js"><link rel="prefetch" href="/assets/js/27.fb3beb63.js"><link rel="prefetch" href="/assets/js/28.af721a74.js"><link rel="prefetch" href="/assets/js/29.427b7eae.js"><link rel="prefetch" href="/assets/js/30.2af5e34e.js"><link rel="prefetch" href="/assets/js/31.60102330.js"><link rel="prefetch" href="/assets/js/32.746872da.js"><link rel="prefetch" href="/assets/js/33.9466d03b.js"><link rel="prefetch" href="/assets/js/34.c7f7b0ef.js"><link rel="prefetch" href="/assets/js/35.53799eb8.js"><link rel="prefetch" href="/assets/js/36.e8875fc1.js"><link rel="prefetch" href="/assets/js/37.c386b2c5.js"><link rel="prefetch" href="/assets/js/38.ee46082f.js"><link rel="prefetch" href="/assets/js/39.11d092ff.js"><link rel="prefetch" href="/assets/js/4.920d0610.js"><link rel="prefetch" href="/assets/js/40.4ee40bcf.js"><link rel="prefetch" href="/assets/js/41.81c3174c.js"><link rel="prefetch" href="/assets/js/42.18f42b9d.js"><link rel="prefetch" href="/assets/js/43.7426d1ac.js"><link rel="prefetch" href="/assets/js/44.d5baff75.js"><link rel="prefetch" href="/assets/js/45.7b25c5ca.js"><link rel="prefetch" href="/assets/js/46.dff72ed3.js"><link rel="prefetch" href="/assets/js/47.15531a4f.js"><link rel="prefetch" href="/assets/js/48.48bbc098.js"><link rel="prefetch" href="/assets/js/49.49acd468.js"><link rel="prefetch" href="/assets/js/5.847584a2.js"><link rel="prefetch" href="/assets/js/50.e26ee1bf.js"><link rel="prefetch" href="/assets/js/51.6728bddb.js"><link rel="prefetch" href="/assets/js/52.c238e7bf.js"><link rel="prefetch" href="/assets/js/53.025903f6.js"><link rel="prefetch" href="/assets/js/54.05baf03a.js"><link rel="prefetch" href="/assets/js/56.8e5ef1fc.js"><link rel="prefetch" href="/assets/js/57.db41b6fb.js"><link rel="prefetch" href="/assets/js/58.b4cb51f8.js"><link rel="prefetch" href="/assets/js/59.423b27e1.js"><link rel="prefetch" href="/assets/js/6.b384c550.js"><link rel="prefetch" href="/assets/js/60.57eff889.js"><link rel="prefetch" href="/assets/js/61.387a5103.js"><link rel="prefetch" href="/assets/js/62.23ba2982.js"><link rel="prefetch" href="/assets/js/63.2d69780b.js"><link rel="prefetch" href="/assets/js/64.d3f669fb.js"><link rel="prefetch" href="/assets/js/65.f5410640.js"><link rel="prefetch" href="/assets/js/66.59887fb2.js"><link rel="prefetch" href="/assets/js/67.01fba30e.js"><link rel="prefetch" href="/assets/js/68.8a6bbb81.js"><link rel="prefetch" href="/assets/js/69.12e673c4.js"><link rel="prefetch" href="/assets/js/70.a227d4b3.js"><link rel="prefetch" href="/assets/js/71.bd6a3bd7.js"><link rel="prefetch" href="/assets/js/72.4f2efca4.js"><link rel="prefetch" href="/assets/js/73.7dbf57a8.js"><link rel="prefetch" href="/assets/js/74.28c26d0a.js"><link rel="prefetch" href="/assets/js/75.d36a4feb.js"><link rel="prefetch" href="/assets/js/76.9123efc1.js"><link rel="prefetch" href="/assets/js/77.cbe2020d.js"><link rel="prefetch" href="/assets/js/78.7ab3eb40.js"><link rel="prefetch" href="/assets/js/79.bc69c4a8.js"><link rel="prefetch" href="/assets/js/80.da17de0b.js"><link rel="prefetch" href="/assets/js/81.1d16813f.js"><link rel="prefetch" href="/assets/js/82.586f2e97.js"><link rel="prefetch" href="/assets/js/83.129cc5fa.js"><link rel="prefetch" href="/assets/js/84.83d65ed9.js"><link rel="prefetch" href="/assets/js/85.f4327096.js"><link rel="prefetch" href="/assets/js/86.866a7d4f.js"><link rel="prefetch" href="/assets/js/87.f8aba274.js"><link rel="prefetch" href="/assets/js/88.43c5a138.js"><link rel="prefetch" href="/assets/js/89.b47b6d86.js"><link rel="prefetch" href="/assets/js/9.ef15744b.js"><link rel="prefetch" href="/assets/js/90.4950712a.js"><link rel="prefetch" href="/assets/js/91.80bbaffe.js"><link rel="prefetch" href="/assets/js/92.0d03ce50.js"><link rel="prefetch" href="/assets/js/93.fff94cff.js"><link rel="prefetch" href="/assets/js/94.91d0e36d.js"><link rel="prefetch" href="/assets/js/95.15227fb3.js"><link rel="prefetch" href="/assets/js/96.b3ef20b0.js"><link rel="prefetch" href="/assets/js/97.9e5e1675.js"><link rel="prefetch" href="/assets/js/98.b213b526.js"><link rel="prefetch" href="/assets/js/99.1ec76897.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b448e12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>核心</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java从入门到精通(JDK17版)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>MySQL从入门到高级-基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>MySQL从入门到高级-高级篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/" class="sidebar-link">第00章_写在前面</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/" class="sidebar-link">第01章_Linux 下 MySQL 的安装与使用</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-2/" class="sidebar-link">第02章_MySQL 的数据目录</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-3/" class="sidebar-link">第03章_用户与权限管理</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/" class="sidebar-link">第04章_逻辑架构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-5/" class="sidebar-link">第05章_存储引擎</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-6/" class="sidebar-link">第06章_索引的数据结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-7/" class="sidebar-link">第07章_InnoDB 数据存储结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-8/" class="sidebar-link">第08章_索引的创建与设计原则</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/" class="sidebar-link">第09章_性能分析工具的使用</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-10/" class="sidebar-link">第10章_索引优化与查询优化</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-11/" class="sidebar-link">第11章_数据库的设计规范</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-12/" class="sidebar-link">第12章_数据库其它调优策略</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-13/" class="sidebar-link">第13章_事务基础知识</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-14/" class="sidebar-link">第14章_MySQL 事务日志</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-15/" class="sidebar-link">第15章_锁</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/" class="sidebar-link">第16章_多版本并发控制</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/" aria-current="page" class="active sidebar-link">第17章_其它数据库日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_1-mysql-支持的日志" class="sidebar-link">1. MySQL 支持的日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_1-1-日志类型" class="sidebar-link">1.1 日志类型</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_1-2-日志的弊端" class="sidebar-link">1.2 日志的弊端</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_2-慢查询日志-slow-query-log" class="sidebar-link">2. 慢查询日志(slow query log)</a></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_3-通用查询日志-general-query-log" class="sidebar-link">3. 通用查询日志(general query log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_3-0-问题场景" class="sidebar-link">3.0 问题场景</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_3-1-查看当前状态" class="sidebar-link">3.1 查看当前状态</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_3-2-启动日志" class="sidebar-link">3.2 启动日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_3-3-停止日志" class="sidebar-link">3.3 停止日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_3-4-查看通用日志" class="sidebar-link">3.4 查看通用日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_3-5-删除-刷新日志" class="sidebar-link">3.5 删除\刷新日志</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_4-错误日志-error-log" class="sidebar-link">4. 错误日志(error log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_4-1-启动日志" class="sidebar-link">4.1 启动日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_4-2-查看日志" class="sidebar-link">4.2 查看日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_4-3-删除-刷新日志" class="sidebar-link">4.3 删除\刷新日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_4-4-mysql8-0-新特性" class="sidebar-link">4.4 MySQL8.0 新特性</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-二进制日志-bin-log" class="sidebar-link">5. 二进制日志(bin log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-1-查看默认情况" class="sidebar-link">5.1 查看默认情况</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-2-日志参数设置" class="sidebar-link">5.2 日志参数设置</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-3-查看日志" class="sidebar-link">5.3 查看日志</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-3-1-mysqlbinlog-命令" class="sidebar-link">5.3.1 mysqlbinlog 命令</a></li><li class="sidebar-sub-header level5"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-3-1-1-一条-insert-语句包含的事件分析" class="sidebar-link">5.3.1.1 一条 Insert 语句包含的事件分析</a></li><li class="sidebar-sub-header level5"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-3-1-2-查看行事件伪-sql-语句" class="sidebar-link">5.3.1.2 查看行事件伪 SQL 语句</a></li><li class="sidebar-sub-header level5"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-3-1-3-常用的语句参考" class="sidebar-link">5.3.1.3 常用的语句参考</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-3-2-show-binlog-events" class="sidebar-link">5.3.2 show binlog events</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-4-删除二进制日志" class="sidebar-link">5.4 删除二进制日志</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-4-1-purge-master-logs-删除指定日志文件" class="sidebar-link">5.4.1 PURGE MASTER LOGS：删除指定日志文件</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-4-2-reset-master-删除所有二进制日志文件" class="sidebar-link">5.4.2 RESET MASTER：删除所有二进制日志文件</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-5-使用日志恢复数据" class="sidebar-link">5.5 使用日志恢复数据</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-5-1-恢复数据前的操作" class="sidebar-link">5.5.1 恢复数据前的操作</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-5-2-通过-position-恢复数据" class="sidebar-link">5.5.2 通过 position 恢复数据</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-5-3-根据时间恢复数据" class="sidebar-link">5.5.3 根据时间恢复数据</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-5-4-时间恢复-vs-position-恢复" class="sidebar-link">5.5.4 时间恢复 VS Position 恢复</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-5-5-模拟案例" class="sidebar-link">5.5.5 模拟案例</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-5-6-第三方-binlog-恢复工具" class="sidebar-link">5.5.6 第三方 binlog 恢复工具</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_5-6-其他场景" class="sidebar-link">5.6 其他场景</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_6-再谈二进制日志-binlog" class="sidebar-link">6. 再谈二进制日志(binlog)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_6-1-写入机制" class="sidebar-link">6.1 写入机制</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_6-2-binlog-与-redolog-对比" class="sidebar-link">6.2 binlog 与 redolog 对比</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_6-3-两阶段提交" class="sidebar-link">6.3 两阶段提交</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_7-中继日志-relay-log" class="sidebar-link">7. 中继日志(relay log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_7-1-介绍" class="sidebar-link">7.1 介绍</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_7-2-查看中继日志" class="sidebar-link">7.2 查看中继日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/#_7-3-恢复的典型错误" class="sidebar-link">7.3 恢复的典型错误</a></li></ul></li></ul></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-18/" class="sidebar-link">第18章_主从复制</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-19/" class="sidebar-link">第19章_数据库备份与恢复</a></li></ul></section></li><li><a href="/java-basic/jdbc-core/" class="sidebar-link">JDBC 核心技术(JDK21版)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=Java%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>Java基础</a></li><li data-v-06225672><a href="/categories/?category=%E6%A0%B8%E5%BF%83" title="分类" data-v-06225672>核心</a></li><li data-v-06225672><a href="/categories/?category=MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7-%E9%AB%98%E7%BA%A7%E7%AF%87" title="分类" data-v-06225672>MySQL从入门到高级-高级篇</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-05-14</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">第17章_其它数据库日志<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="第-17-章-其它数据库日志"><a href="#第-17-章-其它数据库日志" class="header-anchor">#</a> 第 17 章 其它数据库日志</h1> <p>在数据库事务篇，讲过两种日志：重做日志、回滚日志。</p> <p>对于线上数据库应用系统，突然遭遇<code>数据库宕机</code>怎么办？在这种情况下，定位宕机的原因就非常关键。我们可以查看数据库的<code>错误日志</code>。因为日志中记录了数据库运行中的诊断信息，包括了错误、警告和注释等信息。比如:从日志中发现某个连接中的 SQL 操作发生了死循环，导致内存不足，被系统强行终止了。明确了原因，处理起来也就轻松了，系统很快就恢复了运行。</p> <p>除了发现错误，日志在数据复制、数据恢复、操作审计，以及确保数据的永久性和一致性等方面，都有着不可替代的作用。</p> <p>千万不要小看日志 。很多看似奇怪的问题，答案往往就藏在日志里。很多情况下，只有通过查看日志才能发现问题的原因，真正解决问题。所以，一定要学会查看日志，养成检查日志的习惯，对提升你的数据库应用开发能力至关重要。</p> <p><a href="https://dev.mysql.com/doc/refman/8.0/en/server-logs.html" target="_blank" rel="noopener noreferrer">MySQL8.0 官网日志地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_1-mysql-支持的日志"><a href="#_1-mysql-支持的日志" class="header-anchor">#</a> 1. MySQL 支持的日志</h2> <h3 id="_1-1-日志类型"><a href="#_1-1-日志类型" class="header-anchor">#</a> 1.1 日志类型</h3> <p>MySQL 有不同类型的日志文件，用来存储不同类型的日志，分为<code>二进制日志</code>、<code>错误日志</code>、<code>通用查询日志</code>和<code>慢查询日志</code>，这也是常用的 4 种。MySQL8 又新增两种支持的日志：<code>中继日志</code>和<code>数据定义语句日志</code>。使用这些日志文件，可以查看 MySQL 内部发生的事情。</p> <ul><li><strong>慢查询日志</strong>：记录所有执行时间超过 long_query_time 的所有查询，方便我们对查询进行优化。</li> <li><strong>通用查询日志</strong>：记录所有连接的起始时间和终止时间，以及连接发送给数据库服务器的所有指令，对我们复原操作的实际场景、发现问题，甚至是对数据库操作的审计都有很大的帮助。</li> <li><strong>错误日志</strong>：记录 MySQL 服务的启动、运行或停止 MySQL 服务时出现的问题，方便我们了解服务器的状态，从而对服务器进行维护。</li> <li><strong>二进制日志</strong>：记录所有更改数据的语句，可以用于主从服务器之间的数据同步，以及服务器遇到故障时数据的无损失恢复。</li> <li><strong>中继日志</strong>：用于主从服务器架构中，从服务器用来存放主服务器二进制日志内容的一个中间文件。从服务器通过读取中继日志的内容，来同步主服务器上的操作。</li> <li><strong>数据定义语句日志</strong>：记录数据定义语句执行的元数据操作。</li></ul> <p>除二进制日志外，其他日志都是<code>文本文件</code>。默认情况下，所有日志创建于<code>MySQL 数据目录</code>中。</p> <h3 id="_1-2-日志的弊端"><a href="#_1-2-日志的弊端" class="header-anchor">#</a> 1.2 日志的弊端</h3> <ul><li>日志功能会<code>降低 MySQL 数据库的性能</code>。例如，在查询非常频繁的 MySQL 数据库系统中，如果开启了通用查询日志和慢查询日志，MySQL 数据库会花费很多时间记录日志。</li> <li>日志会<code>占用大量的磁盘空间</code>。对于用户量非常大、操作非常频繁的数据库，日志文件需要的存储空 间设置比数据库文件需要的存储空间还要大。</li></ul> <h2 id="_2-慢查询日志-slow-query-log"><a href="#_2-慢查询日志-slow-query-log" class="header-anchor">#</a> 2. 慢查询日志(slow query log)</h2> <p>前面章节《第 09 章_性能分析工具的使用》已经详细讲述。</p> <h2 id="_3-通用查询日志-general-query-log"><a href="#_3-通用查询日志-general-query-log" class="header-anchor">#</a> 3. 通用查询日志(general query log)</h2> <p>通用查询日志用来<code>记录用户的所有操作</code>，包括启动和关闭 MySQL 服务、所有用户的连接开始时间和截止时间、发给 MySQL 数据库服务器的所有 SQL 指令等。当我们的数据发生异常时，<strong>查看通用查询日志，还原操作时的具体场景</strong>，可以帮助我们准确定位问题。</p> <h3 id="_3-0-问题场景"><a href="#_3-0-问题场景" class="header-anchor">#</a> 3.0 问题场景</h3> <p>在电商系统中，购买商品并且使用微信支付完成以后，却发现支付中心的记录并没有新增，此时用户再次使用支付宝支付，就会出现<code>重复支付</code>的问题。但是当去数据库中查询数据的时候，会发现只有一条记录存在。那么此时给到的现象就是只有一条支付记录，但是用户却支付了两次。</p> <p>对系统进行了仔细检查，没有发现数据问题，因为用户编号和订单编号以及第三方流水号都是对的。可是用户确实支付了两次，这个时候，我们想到了检查通用查询日志，看看当天到底发生了什么。</p> <p>查看之后，发现：1 月 1 日下午 2 点，用户使用微信支付完以后，但是由于网络故障，支付中心没有及时收到微信支付的回调通知，导致当时没有写入数据。1 月 1 日下午 2 点 30，用户又使用支付宝支付，此时记录更新到支付中心。1 月 1 日晚上 9 点，微信的回调通知过来了，但是支付中心已经存在了支付宝的记录，所以只能覆盖记录了。</p> <p>由于网络的原因导致了重复支付。至于解决问题的方案就很多了，这里省略。</p> <p>可以看到通用查询日志可以帮助我们了解操作发生的具体时间和操作的细节，对找出异常发生的原因极其关键。</p> <h3 id="_3-1-查看当前状态"><a href="#_3-1-查看当前状态" class="header-anchor">#</a> 3.1 查看当前状态</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%general%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+---------------------------+</span>
<span class="token operator">|</span> Variable_name    <span class="token operator">|</span> <span class="token keyword">Value</span>                     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+---------------------------+</span>
<span class="token operator">|</span> general_log      <span class="token operator">|</span> <span class="token keyword">OFF</span>                       <span class="token operator">|</span> <span class="token comment">#通用查询日志处于关闭状态</span>
<span class="token operator">|</span> general_log_file <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>host91<span class="token punctuation">.</span>log <span class="token operator">|</span> <span class="token comment">#通用查询日志文件的名称</span>
<span class="token operator">+</span><span class="token comment">------------------+---------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>说明 1∶ 系统变量 general_log 的值是 OFF，即通用查询日志处于关闭状态。在 MySQL 中，这个参数的<code>默认值是关闭的</code>。因为一旦开启记录通用查询日志，MySQL 会记录所有的连接起止和相关的 SQL 操作，这样会消耗系统资源并且占用磁盘空间。我们可以通过手动修改变量的值，在<code>需要的时候开启日志</code>。</p> <p>说明 2: 通用查询日志文件的名称是<code>主机.log</code>。存储路径是<code>/var/lib/mysql/</code>，也是默认的数据路径。</p> <h3 id="_3-2-启动日志"><a href="#_3-2-启动日志" class="header-anchor">#</a> 3.2 启动日志</h3> <p><strong>方式 1：永久性方式</strong></p> <p>修改 <code>my.cnf</code> 或者 <code>my.ini</code> 配置文件来设置。在<code>[mysqld]</code>组下加入 log 选项，并重启 MySQL 服务。格式如下：</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">general_log</span><span class="token punctuation">=</span><span class="token value attr-value">ON</span> 
<span class="token key attr-name">general_log_file</span><span class="token punctuation">=</span><span class="token value attr-value">[path[filename]] #日志文件所在目录路径，filename为日志文件名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果不指定目录和文件名，通用查询日志将默认存储在 MySQL 数据目录中的 hostname.log 文件中，hostname 表示主机名。</p> <p><strong>方式 2：临时性方式</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log<span class="token operator">=</span><span class="token keyword">on</span><span class="token punctuation">;</span> <span class="token comment"># 开启通用查询日志</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log_file<span class="token operator">=</span><span class="token string">'path/filename'</span><span class="token punctuation">;</span> <span class="token comment"># 设置日志文件保存位置</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log<span class="token operator">=</span><span class="token keyword">off</span><span class="token punctuation">;</span> <span class="token comment"># 关闭通用查询日志</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'general_log%'</span><span class="token punctuation">;</span> <span class="token comment"># 查看设置后情况</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-3-停止日志"><a href="#_3-3-停止日志" class="header-anchor">#</a> 3.3 停止日志</h3> <p><strong>方式 1：永久性方式</strong></p> <p>修改<code>my.cnf</code>或者<code>my.ini</code>文件，把<code>[mysqld]</code>组下的<code>general_log</code>值设置为<code>OFF</code>或者把 general_log 一项注释掉。修改保存后，再<code>重启 MySQL 服务</code>，即可生效。</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">general_log</span><span class="token punctuation">=</span><span class="token value attr-value">OFF</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>方式 2：临时性方式</strong></p> <p>使用 SET 语句停止 MySQL 通用查询日志功能：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log<span class="token operator">=</span><span class="token keyword">off</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'general_log%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-4-查看通用日志"><a href="#_3-4-查看通用日志" class="header-anchor">#</a> 3.4 查看通用日志</h3> <p>通用查询日志是以文本文件的形式存储在文件系统中的，可以使用文本编辑器直接打开日志文件。每台 MySQL 服务器的通用查询日志内容是不同的。</p> <p>从<code>SHOW VARIABLES LIKE 'general_log%';</code>结果中可以看到通用查询日志的位置。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># more /var/lib/mysql/主机名.log</span>
/usr/sbin/mysqld, Version: <span class="token number">8.0</span>.25 <span class="token punctuation">(</span>MySQL Community Server - GPL<span class="token punctuation">)</span>. started with:
Tcp port: <span class="token number">3306</span>  Unix socket: /var/lib/mysql/mysql.sock
Time                 Id Command    Argument
<span class="token number">2024</span>-11-10T12:33:16.707405Z	   <span class="token number">27</span> Query	SELECT DATABASE<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2024</span>-11-10T12:33:16.707717Z	   <span class="token number">27</span> Init DB	dbtest_lock
<span class="token number">2024</span>-11-10T12:33:16.708301Z	   <span class="token number">27</span> Query	show databases
<span class="token number">2024</span>-11-10T12:33:16.708859Z	   <span class="token number">27</span> Query	show tables
<span class="token number">2024</span>-11-10T12:33:16.709361Z	   <span class="token number">27</span> Field List	student 
<span class="token number">2024</span>-11-10T12:33:16.709509Z	   <span class="token number">27</span> Field List	teacher 
<span class="token number">2024</span>-11-10T12:33:16.709608Z	   <span class="token number">27</span> Field List	<span class="token builtin class-name">test</span> 
<span class="token number">2024</span>-11-10T12:33:23.442695Z	   <span class="token number">27</span> Query	<span class="token keyword">select</span> * from <span class="token builtin class-name">test</span>
<span class="token number">2024</span>-11-10T12:33:25.621471Z	   <span class="token number">27</span> Quit	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>在通用查询日志里面，我们可以清楚地看到，什么时候开启了新的客户端登陆数据库，登录之后做了什么 SQL 操作，针对的是哪个数据表等信息。</p> <h3 id="_3-5-删除-刷新日志"><a href="#_3-5-删除-刷新日志" class="header-anchor">#</a> 3.5 删除\刷新日志</h3> <p>如果数据的使用非常频繁，那么通用查询日志会占用服务器非常大的磁盘空间。数据管理员可以删除很长时间之前的查询日志，以保证 MySQL 服务器上的硬盘空间。</p> <p><strong>手动删除文件</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'general_log%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以看出，通用查询日志的目录默认为 MySQL 数据目录。在该目录下手动删除通用查询日志<code>主机名.log</code>。</p> <p><strong>重新生成查询日志文件</strong></p> <p>手动删除通用查询日志之后，可以使用此命令重新生成通用查询日志</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqladmin <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> flush-logs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>刷新 MySQL 数据目录，发现创建了新的日志文件。前提一定要开启通用日志。</p> <h2 id="_4-错误日志-error-log"><a href="#_4-错误日志-error-log" class="header-anchor">#</a> 4. 错误日志(error log)</h2> <p>错误日志记录了 MySQL 服务器启动、停止运行的时间，以及系统启动、运行和停止过程中的诊断信息，包括<code>错误</code> 、<code>警告</code>和<code>提示</code>等。</p> <p>通过错误日志可以查看系统的运行状态，便于即时发现故障、修复故障。如果 MysQL 服务<code>出现异常</code>，错误日志是发现问题、解决故障的<code>首选</code>。</p> <h3 id="_4-1-启动日志"><a href="#_4-1-启动日志" class="header-anchor">#</a> 4.1 启动日志</h3> <p>在 MySQL 数据库中，错误日志功能是<code>默认开启</code>的。而且，错误日志<code>无法被禁止</code>。</p> <p>默认情况下，错误日志存储在 MySQL 数据库的数据文件夹下，名称默认为<code>mysqld.log</code>（Linux 系统）或<code>hostname.err</code>（mac 系统）。如果需要制定文件名，则需要在 <code>my.cnf</code> 或者 <code>my.ini</code> 中做如下配置：</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">log-error</span><span class="token punctuation">=</span><span class="token value attr-value">[path/[filename]] # path为日志文件所在的目录路径，filename为日志文件名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改配置项后，需要重启 MySQL 服务以生效。</p> <h3 id="_4-2-查看日志"><a href="#_4-2-查看日志" class="header-anchor">#</a> 4.2 查看日志</h3> <p>MySQL 错误日志是以文本文件形式存储的，可以使用文本编辑器直接查看。</p> <p>查询错误日志的存储路径：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'log_err%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------+----------------------------------------+</span>
<span class="token operator">|</span> Variable_name              <span class="token operator">|</span> <span class="token keyword">Value</span>                                  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------+----------------------------------------+</span>
<span class="token operator">|</span> log_error                  <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>log                    <span class="token operator">|</span>
<span class="token operator">|</span> log_error_services         <span class="token operator">|</span> log_filter_internal<span class="token punctuation">;</span> log_sink_internal <span class="token operator">|</span>
<span class="token operator">|</span> log_error_suppression_list <span class="token operator">|</span>                                        <span class="token operator">|</span>
<span class="token operator">|</span> log_error_verbosity        <span class="token operator">|</span> <span class="token number">2</span>                                      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------+----------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>执行结果中可以看到错误日志文件是 mysqld.log ，位于 MySQL 默认的数据目录下。</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>错误日志文件中记录了服务器启动的时间，以及存储引擎 InnoDB 启动和停止等，我们在做初始化时候生成的数据库初始密码也是记录在 error.log 中。</p></div> <p><code>log_error_verbosity</code> 的取值范围：</p> <ul><li><code>1</code>：错误(ERROR)级别</li> <li><code>2</code>：错误和警告(ERROR, WARNING)</li> <li><code>3</code>：错误、警告和通知(ERROR, WARNING, NOTE)</li></ul> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>[mysqld]
<span class="token key attr-name">log_error_verbosity</span> <span class="token punctuation">=</span> <span class="token value attr-value">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-3-删除-刷新日志"><a href="#_4-3-删除-刷新日志" class="header-anchor">#</a> 4.3 删除\刷新日志</h3> <p>对于很久以前的错误日志，数据库管理员查看这些错误日志的可能性不大，可以将这些错误日志删除，以保证 MySQL 服务器上的<code>硬盘空</code>间。MySQL 的错误日志是以文本文件的形式存储在文件系统中的，可以<code>直接删除</code>。</p> <ul><li>第 1 步（方式 1）：删除操作</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-f</span> /var/log/mysqld.log  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在运行状态下删除错误日志文件后，MySQL 并不会自动创建日志文件</p> <ul><li>第 1 步（方式 2）︰重命名文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mv</span> /var/lib/mysql/mysql.log /var/lib/mysql/mysql.log.old
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>第 2 步：重建日志</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqladmin <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> flush-logs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可能报错</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># mysqladmin -uroot -p flush-logs</span>
Enter password:
mysqladmin: refresh failed<span class="token punctuation">;</span> error: <span class="token string">'Could not open file '</span>/var/log/mysqld.log<span class="token string">' for error logging.'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>补充操作</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">install</span> <span class="token parameter variable">-omysql</span> <span class="token parameter variable">-gmysql</span> <span class="token parameter variable">-m0644</span> /dev/null /var/log/mysqld.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block note"><p class="custom-block-title">flush-logs 指令操作</p> <ul><li>MySQL 5.5.7 以前的版本，flush-logs 将错误日志文件重命名为 filename.err_old，并创建新的日志文件。</li> <li>从 MySQL 5.5.7 开始，flush-logs 只是重新打开日志文件，并不做日志备份和创建的操作。</li> <li>如果日志文件不存在，MySQL 启动或者执行 flush-logs 时会自动创建新的日志文件。重新创建错误日志，大小为 0 字节。</li></ul></div> <h3 id="_4-4-mysql8-0-新特性"><a href="#_4-4-mysql8-0-新特性" class="header-anchor">#</a> 4.4 MySQL8.0 新特性</h3> <p>MySQL8.0 里对错误日志的改进。</p> <p>MySQL8.0 的错误日志可以理解为一个全新的日志，在这个版本里，接受了来自社区的广泛批评意见，在这些意见和建议的基础上生成了新的日志。</p> <p>下面这些是来自社区的意见:</p> <ul><li>默认情况下内容过于冗长</li> <li>遗漏了有用的信息</li> <li>难以过滤某些信息</li> <li>没有标识错误信息的子系统源</li> <li>没有错误代码，解析消息需要识别错误</li> <li>引导消息可能会丢失</li> <li>固定格式</li></ul> <p>针对这些意见，MySQL 做了如下改变:</p> <ul><li>采用组件架构，通过不同的组件执行日志的写入和过滤功能</li> <li>写入错误日志的全部信息都具有唯一的错误代码从 10000 开始</li> <li>增加了一个新的消息分类《system》用于在错误日志中始终可见的非错误但服务器状态更改事件的消息。</li> <li>增加了额外的附加信息，例如关机时的版本信息，谁发起的关机等等</li> <li>两种过滤方式，Internal 和 Dragnet</li> <li>三种写入形式，经典、JSON 和 syseventlog</li></ul> <div class="custom-block note"><p class="custom-block-title">小结</p> <p>通常情况下，管理员不需要查看错误日志。但是，MySQL 服务器发生异常时，管理员可以从错误日志中找到发生异常的时间、原因，然后根据这些信息来解决异常。</p></div> <h2 id="_5-二进制日志-bin-log"><a href="#_5-二进制日志-bin-log" class="header-anchor">#</a> 5. 二进制日志(bin log)</h2> <p>binlog 可以说是 MySQL 中比较<code>重要</code>的日志了，在日常开发及运维过程中，经常会遇到。</p> <p>binlog 即 binary log，二进制日志文件，也叫作变更日志(update log)。它记录了数据库所有执行的<code>DDL</code>和<code>DML</code>等数据库更新事件的语句，但是不包含没有修改任何数据的语句（如数据查询语句 select、show 等）。</p> <p>它以<code>事件形式</code>记录并保存在<code>二进制文件</code>中。通过这些信息，我们可以再现数据更新操作的全过程。</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>如果想要记录所有语句（例如，为了识别有问题的查询），需要使用通用查询日志。</p></div> <p>binlog 主要应用场景：</p> <ul><li>一是用于<code>数据恢复</code>，如果 MySQL 数据库意外停止，可以通过二进制日志文件来查看用户执行了哪些操作，对数据库服务器文件做了哪些修改，然后根据二进制日志文件中的记录来恢复数据库服务器。</li> <li>二是用于<code>数据复制</code>，由于日志的延续性和时效性，master 把它的二进制日志传递给 slaves 来达到 master-slave 数据一致的目的。</li></ul> <p>可以说 MySQL<strong>数据库的数据备份、主备、主主、主从</strong>都离不开 binlog,需要依靠 binlog 来同步数据，保证数据一致性。</p> <p><img src="/assets/img/bin_log1.ac3d4cb5.webp" alt="bin_log1"></p> <h3 id="_5-1-查看默认情况"><a href="#_5-1-查看默认情况" class="header-anchor">#</a> 5.1 查看默认情况</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%log_bin%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------+-----------------------------+</span>
<span class="token operator">|</span> Variable_name                   <span class="token operator">|</span> <span class="token keyword">Value</span>                       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------+-----------------------------+</span>
<span class="token operator">|</span> log_bin                         <span class="token operator">|</span> <span class="token keyword">ON</span>                          <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_basename                <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>binlog       <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_index                   <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>binlog<span class="token punctuation">.</span><span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_trust_function_creators <span class="token operator">|</span> <span class="token keyword">OFF</span>                         <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_use_v1_row_events       <span class="token operator">|</span> <span class="token keyword">OFF</span>                         <span class="token operator">|</span>
<span class="token operator">|</span> sql_log_bin                     <span class="token operator">|</span> <span class="token keyword">ON</span>                          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------+-----------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>log_bin_basename</code>：是 binlog 日志的基本文件名，后面会追加标识来表示每一个文件</li> <li><code>log_bin_index</code>：是 binlog 文件的索引文件，这个文件管理了所有的 binlog 文件的目录</li> <li><code>log_bin_trust_function_creators</code>：限制存储过程，前面我们已经讲过了，这是因为二进制日志的一个重要功能是用于主从复制，而存储函数有可能导致主从的数据不一致。所以当开启二进制日志后，需要限制存储函数的创建、修改、调用</li> <li><code>log_bin_use_v1_row_events</code>：此只读系统变量已弃用。ON 表示使用版本 1 二进制日志行，OFF 表示使用版本 2 二进制日志行（MySQL5.6 的默认值为 2）。</li></ul> <p>每次 mysql 重启都会创建一个新的 binlog 文件</p> <h3 id="_5-2-日志参数设置"><a href="#_5-2-日志参数设置" class="header-anchor">#</a> 5.2 日志参数设置</h3> <p><strong>方式 1：永久性方式</strong></p> <p>修改 MySQL 的<code>my.cnf</code>或<code>my.ini</code>文件可以设置二进制日志的相关参数：</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token comment"># 启用二进制日志</span>
<span class="token key attr-name">log-bin</span><span class="token punctuation">=</span><span class="token value attr-value">atguigu-bin</span> 
<span class="token key attr-name">binlog_expire_logs_seconds</span><span class="token punctuation">=</span><span class="token value attr-value">600</span>
<span class="token key attr-name">max_binlog_size</span><span class="token punctuation">=</span><span class="token value attr-value">100M</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <ol><li>log-bin=mysql-bin #打开日志（主机需要打开），这个 mysql-bin 也可以自定义，这里也可以加上路径，如:<code>/home/www/mysql_bin_log/mysql-bin</code></li> <li><code>binlog_expire_logs_seconds</code>：此参数控制二进制日志文件保留的时长，单位是<code>秒</code>，默认 2592000 30 天，--14400 4 小时；86400 1 天；259200 3 天。</li> <li>max_binlog_size：控制单个二进制日志大小，当前日志文件大小超过此变量时，执行切换动作。此参数的<code>最大和默认值是 1GB</code>，该设置并<code>不能严格控制 Binlog 的大小</code>，尤其是 Binlog 比较靠近最大值而又遇到一个比较大事务时，为了保证事务的完整性，可能不做切换日志的动作，只能将该事务的所有 SQL 都记录进当前日志，直到事务结束。一般情况下可采取默认值。</li></ol></div> <p>重新启动 MySQL 服务，查询二进制日志的信息，执行结果：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%log_bin%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------+----------------------------------+</span>
<span class="token operator">|</span> Variable_name                   <span class="token operator">|</span> <span class="token keyword">Value</span>                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------+----------------------------------+</span>
<span class="token operator">|</span> log_bin                         <span class="token operator">|</span> <span class="token keyword">ON</span>                               <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_basename                <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>bin       <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_index                   <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_trust_function_creators <span class="token operator">|</span> <span class="token keyword">OFF</span>                              <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_use_v1_row_events       <span class="token operator">|</span> <span class="token keyword">OFF</span>                              <span class="token operator">|</span>
<span class="token operator">|</span> sql_log_bin                     <span class="token operator">|</span> <span class="token keyword">ON</span>                               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------+----------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>设置带文件夹的 bin-log 日志存放目录</strong></p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">log-bin</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">/var/lib/mysql/binlog/atguigu-bin</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：新建的文件夹需要使用 mysql 用户，使用下面的命令即可。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token parameter variable">-v</span> mysql:mysql binlog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>数据库文件最好不要与日志文件放在同一个磁盘上!</li> <li>这样，当数据库文件所在的磁盘发生故障时，可以使用日志文件恢复数据。</li></ul></div> <p><strong>方式 2：临时性方式</strong></p> <p>如果不希望通过修改配置文件并重启的方式设置二进制日志的话，还可以使用如下指令，需要注意的是在 mysql 8 中只有<code>会话级别</code>的设置，没有了 global 级别的设置。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># global 级别 </span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> sql_log_bin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
ERROR <span class="token number">1228</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Variable <span class="token string">'sql_log_bin'</span> <span class="token operator">is</span> a <span class="token keyword">SESSION</span> variable <span class="token operator">and</span> can<span class="token punctuation">`</span>t be used <span class="token keyword">with</span> <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> 

<span class="token comment"># session级别 </span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> sql_log_bin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> 秒<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-3-查看日志"><a href="#_5-3-查看日志" class="header-anchor">#</a> 5.3 查看日志</h3> <p>当 MySQL 创建二进制日志文件时，先创建一个以 filename 为名称、以 .index 为后缀的文件，再创建一个以 filename 为名称、以 &quot;.000001&quot; 为后缀的文件。</p> <p>MySQL 服务<code>重新启动一次</code>，以数字为后缀的文件就会增加一个，并且后缀名按 1 递增。即日志文件的个数与 MySQL 服务启动的次数相同；如果日志长度超过了<code>max_binlog_size</code>的上限（默认是 1GB），就会创建一个新的日志文件。</p> <p>查看当前的二进制日志文件列表及大小。指令如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">BINARY</span> LOGS<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+-----------+</span>
<span class="token operator">|</span> Log_name      <span class="token operator">|</span> File_size <span class="token operator">|</span> Encrypted <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+-----------+</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000036</span> <span class="token operator">|</span>  <span class="token number">35598813</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000037</span> <span class="token operator">|</span>      <span class="token number">3328</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000038</span> <span class="token operator">|</span>       <span class="token number">200</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000039</span> <span class="token operator">|</span>       <span class="token number">200</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000040</span> <span class="token operator">|</span>       <span class="token number">156</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+-----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>所有对数据库的修改都会记录在 binglog 中。但 binlog 是二进制文件，无法直接查看，需要借助<code>mysqlbinlog</code>命令。</p> <h4 id="_5-3-1-mysqlbinlog-命令"><a href="#_5-3-1-mysqlbinlog-命令" class="header-anchor">#</a> 5.3.1 mysqlbinlog 命令</h4> <p>先执行一条 SQL 语句</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看 binlog</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog <span class="token string">&quot;/var/lib/mysql/binlog.000001&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># at 235</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 316 CRC32 0x2fb7703c 	Query	thread_id=23	exec_time=0	error_code=0</span>
SET <span class="token assign-left variable">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1732016517</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.pseudo_thread_id<span class="token operator">=</span><span class="token number">23</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.foreign_key_checks<span class="token operator">=</span><span class="token number">1</span>, @@session.sql_auto_is_null<span class="token operator">=</span><span class="token number">0</span>, @@session.unique_checks<span class="token operator">=</span><span class="token number">1</span>, @@session.autocommit<span class="token operator">=</span><span class="token number">1</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.sql_mode<span class="token operator">=</span><span class="token number">1168113696</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.auto_increment_increment<span class="token operator">=</span><span class="token number">1</span>, @@session.auto_increment_offset<span class="token operator">=</span><span class="token number">1</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
/*<span class="token operator">!</span><span class="token punctuation">\</span>C utf8mb4 *//*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.character_set_client<span class="token operator">=</span><span class="token number">255</span>,@@session.collation_connection<span class="token operator">=</span><span class="token number">255</span>,@@session.collation_server<span class="token operator">=</span><span class="token number">255</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.lc_time_names<span class="token operator">=</span><span class="token number">0</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.collation_database<span class="token operator">=</span>DEFAULT/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
/*<span class="token operator">!</span><span class="token number">80011</span> SET @@session.default_collation_for_utf8mb4<span class="token operator">=</span><span class="token number">255</span>*//*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
BEGIN
/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 316</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 372 CRC32 0x88776391 	Table_map: `dbtest_log`.`test` mapped to number 118</span>
<span class="token comment"># at 372</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 412 CRC32 0xa702163e 	Write_rows: table id 118 flags: STMT_END_F</span>

BINLOG <span class="token string">'
hXk8ZxMBAAAAOAAAAHQBAAAAAHYAAAAAAAEACmRidGVzdF9sb2cABHRlc3QAAQMAAAEBAJFjd4g=
hXk8Zx4BAAAAKAAAAJwBAAAAAHYAAAAAAAEAAgAB/wABAAAAPhYCpw==
'</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 412</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 443 CRC32 0x22c30f20 	Xid = 617</span>
COMMIT/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 443</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>执行结果可以看到，这是一个简单的日志文件，日志中记录了用户的一些操作，这里并没有出现具体的 SQL 语句，这是因为 binlog 关键字后面的内容是经过编码后的<code>二进制日志</code>。</p> <h5 id="_5-3-1-1-一条-insert-语句包含的事件分析"><a href="#_5-3-1-1-一条-insert-语句包含的事件分析" class="header-anchor">#</a> 5.3.1.1 一条 Insert 语句包含的事件分析</h5> <p>一条 Insert 语句包含如下事件</p> <ul><li>Query 事件负责开始一个事务(BEGIN)</li> <li>Table_map 事件负责映射需要的表</li> <li>Write_rows 事件负责写入数据 <strong>（行事件）</strong></li> <li>Xid 事件负责结束事务</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog <span class="token parameter variable">-v</span> <span class="token string">&quot;/var/lib/mysql/binlog.000001&quot;</span><span class="token punctuation">;</span>

<span class="token comment"># at 235</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 316 CRC32 0x2fb7703c</span>
<span class="token comment"># Query	thread_id=23	exec_time=0	error_code=0</span>
BEGIN

<span class="token comment"># at 316</span>
<span class="token comment"># 241119  6:41:57 server id 1  end_log_pos 372 CRC32 0x88776391 	</span>
<span class="token comment"># Table_map: `dbtest_log`.`test` mapped to number 118</span>

<span class="token comment"># at 372</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 412 CRC32 0xa702163e 	</span>
<span class="token comment"># Write_rows: table id 118 flags: STMT_END_F</span>

BINLOG <span class="token string">'
hXk8ZxMBAAAAOAAAAHQBAAAAAHYAAAAAAAEACmRidGVzdF9sb2cABHRlc3QAAQMAAAEBAJFjd4g=
hXk8Zx4BAAAAKAAAAJwBAAAAAHYAAAAAAAEAAgAB/wABAAAAPhYCpw==
'</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment">### INSERT INTO `dbtest_log`.`test`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=1</span>

<span class="token comment"># at 412</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 443 CRC32 0x22c30f20 	Xid = 617</span>
COMMIT/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>

<span class="token comment"># at 443</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h5 id="_5-3-1-2-查看行事件伪-sql-语句"><a href="#_5-3-1-2-查看行事件伪-sql-语句" class="header-anchor">#</a> 5.3.1.2 查看行事件伪 SQL 语句</h5> <p>下面命令将行事件以<code>伪 SQL 的形式</code>表现出来</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog <span class="token parameter variable">-v</span> <span class="token string">&quot;/var/lib/mysql/binlog.000001&quot;</span><span class="token punctuation">;</span>
<span class="token comment"># 不显示binlog格式的语句</span>
mysqlbinlog <span class="token parameter variable">-v</span> --base64-output<span class="token operator">=</span>DECODE-ROWS <span class="token string">&quot;/var/lib/mysql/binlog.000001&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>--base64-output</code>：指定如何处理事件行的 Base64 编码输出。</li> <li><code>DECODE-ROWS</code>：告诉 <code>mysqlbinlog</code> 对 Base64 编码的行事件（如 <code>Write_rows</code>、<code>Update_rows</code> 和 <code>Delete_rows</code>）进行解码，并以可读的<strong>伪 SQL 格式</strong>输出。</li></ul> <div class="custom-block note"><p class="custom-block-title">笔记</p> <ul><li>仅使用 -v 会同时输出行时间 BINLOG 语句 和 伪 SQL 语句</li> <li>同时使用 -v --base64-output=DECODE-ROWS 则只输出伪 SQL 语句</li></ul></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog <span class="token parameter variable">-v</span> <span class="token string">&quot;/var/lib/mysql/binlog.000001&quot;</span><span class="token punctuation">;</span>

<span class="token comment"># at 372</span>
<span class="token comment">#241119  6:41:57 server id 1  end_log_pos 412 CRC32 0xa702163e 	</span>
<span class="token comment"># Write_rows: table id 118 flags: STMT_END_F</span>

BINLOG <span class="token string">'
hXk8ZxMBAAAAOAAAAHQBAAAAAHYAAAAAAAEACmRidGVzdF9sb2cABHRlc3QAAQMAAAEBAJFjd4g=
hXk8Zx4BAAAAKAAAAJwBAAAAAHYAAAAAAAEAAgAB/wABAAAAPhYCpw==
'</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment">### INSERT INTO `dbtest_log`.`test`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=1</span>

<span class="token comment"># at 412</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>可以看到，之前插入语句的伪码形式</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">### INSERT INTO `dbtest_log`.`test`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用 <code>-v --base64-output=DECODE-ROWS</code> 以下部分会消失</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>BINLOG <span class="token string">'
hXk8ZxMBAAAAOAAAAHQBAAAAAHYAAAAAAAEACmRidGVzdF9sb2cABHRlc3QAAQMAAAEBAJFjd4g=
hXk8Zx4BAAAAKAAAAJwBAAAAAHYAAAAAAAEAAgAB/wABAAAAPhYCpw==
'</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>BINLOG 语句，虽然人不可读，但是可以在 mysql 中执行。可以用于数据的恢复。</li> <li>所以恢复数据时，切记不要加<code>--base64-output=DECODE-ROWS</code>选项</li></ul></div> <h5 id="_5-3-1-3-常用的语句参考"><a href="#_5-3-1-3-常用的语句参考" class="header-anchor">#</a> 5.3.1.3 常用的语句参考</h5> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 可查看参数帮助 </span>
mysqlbinlog <span class="token comment">--no-defaults --help </span>

<span class="token comment"># 查看最后100行 </span>
mysqlbinlog <span class="token comment">--no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |tail -100 </span>

<span class="token comment"># 根据position查找 </span>
mysqlbinlog <span class="token comment">--no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |grep -A20 '4939002'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-3-2-show-binlog-events"><a href="#_5-3-2-show-binlog-events" class="header-anchor">#</a> 5.3.2 show binlog events</h4> <p>上面这种办法读取出 binlog 日志的全文内容比较多，不容易分辨查看到 pos 点信息，下面介绍一种更为方便的查询命令：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> binlog events <span class="token punctuation">[</span><span class="token operator">IN</span> <span class="token string">'log_name'</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">FROM</span> pos<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">LIMIT</span> <span class="token punctuation">[</span><span class="token keyword">offset</span><span class="token punctuation">,</span><span class="token punctuation">]</span> row_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>IN 'log_name'</code>：指定要查询的 binlog 文件名（不指定就是第一个 binlog 文件）</li> <li><code>FROM pos</code>：指定从哪个 pos 起始点开始查起（不指定就是从整个文件首个 pos 点开始算）</li> <li><code>LIMIT [offset]</code>：偏移量（不指定就是 0）</li> <li><code>row_count</code>:查询总条数（不指定就是所有行）</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'binlog.000001'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/bin_log2.98e1d858.webp" alt="bin_log2"></p> <p>这里一个 Insert 语句包含如下事件</p> <ul><li>Query 事件负责开始一个事务(BEGIN)</li> <li>Table_map 事件负责映射需要的表</li> <li>Write_rows 事件负责写入数据</li> <li>Xid 事件负责结束事务</li></ul> <p>上面这条语句可以将指定的 binlog 日志文件，分成有效事件行的方式返回，并可使用 limit 指定 pos 点的起始偏移，查询条数。其它举例:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#a、查询第一个最早的binlog日志:</span>
<span class="token keyword">show</span> binlog events\G <span class="token punctuation">;</span>

<span class="token comment">#b、指定查询mysql-bin.088802这个文件</span>
<span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'atguigu-bin.008002'</span>\G<span class="token punctuation">;</span>

<span class="token comment">#c、指定查询mysql-bin. 080802这个文件，从pos点:391开始查起:</span>
<span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'atguigu-bin.008802'</span> <span class="token keyword">from</span> <span class="token number">391</span>\G<span class="token punctuation">;</span>

<span class="token comment">#d、指定查询mysql-bin.000802这个文件，从pos点:391开始查起，查询5条（即5条语句）</span>
<span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'atguigu-bin.000882'</span> <span class="token keyword">from</span> <span class="token number">391</span> <span class="token keyword">limit</span> <span class="token number">5</span>\G

<span class="token comment">#e、指定查询 mysql-bin.880002这个文件，从pos点:391开始查起，偏移2行〈即中间跳过2个）查询5条（即5条语句）。</span>
<span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'atguigu-bin.088882'</span> <span class="token keyword">from</span> <span class="token number">391</span> <span class="token keyword">limit</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span>\G<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>上面我们讲了这么多都是基于 binlog 的默认格式，binlog 格式查看</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'binlog_format'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> binlog_format <span class="token operator">|</span> <span class="token keyword">ROW</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>除此之外，binlog 还有 2 种格式，分别是 <strong>Statement</strong> 和 <strong>Mixed</strong></p> <ul><li><p><code>Statement</code></p> <p>每一条会修改数据的 sql 都会记录在 binlog 中。</p> <p>优点：不需要记录每一行的变化，减少了 binlog 日志量，节约了 IO，提高性能。</p></li> <li><p><code>Row</code></p> <p>5.1.5 版本的 MySQL 才开始支持 row level 的复制，它不记录 sql 语句上下文相关信息，仅保存哪条记录被修改。</p> <p>优点：row level 的日志内容会非常清楚的记录下每一行数据修改的细节。而且不会出现某些特定情况下的存储过程，或 function，以及 trigger 的调用和触发无法被正确复制的问题。</p></li> <li><p><code>Mixed</code></p> <p>从 5.1.8 版本开始，MySQL 提供了 Mixed 格式，实际上就是 Statement 与 Row 的结合。</p> <p>详细情况，下章讲解。</p></li></ul> <p>比如：一条 SQL 语句修改了 10 行数据，<code>Statement</code> 只记录这条 SQL 语句。<code>Row</code>不记录 SQL 语句，但会记录每一行数据的变化。</p> <h3 id="_5-4-删除二进制日志"><a href="#_5-4-删除二进制日志" class="header-anchor">#</a> 5.4 删除二进制日志</h3> <p>MySQL 的二进制文件可以配置自动删除，同时 MySQL 也提供了安全的手动删除二进制文件的方法。<code>PURGE MASTER LOGS</code>只删除指定部分的二进制日志文件，<code>RESET MASTER</code>删除所有的二进制日志文件。具体如下：</p> <h4 id="_5-4-1-purge-master-logs-删除指定日志文件"><a href="#_5-4-1-purge-master-logs-删除指定日志文件" class="header-anchor">#</a> 5.4.1 PURGE MASTER LOGS：删除指定日志文件</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 删除指定文件之前的所有日志</span>
<span class="token keyword">PURGE</span> {MASTER <span class="token operator">|</span> <span class="token keyword">BINARY</span>} LOGS <span class="token keyword">TO</span> <span class="token string">'指定日志文件名'</span>
<span class="token comment">-- 删除指定日期之前的日志</span>
<span class="token keyword">PURGE</span> {MASTER <span class="token operator">|</span> <span class="token keyword">BINARY</span>} LOGS BEFORE <span class="token string">'指定日期'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>cron</code> 计划任务每天执行一次删除任务，只保留一天的 binlog 日志</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;PURGE BINARY LOGS BEFORE NOW() - INTERVAL 1 DAY;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>举例</strong></p> <p>SHOW 语句显示二进制日志文件列表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">BINARY</span> LOGS<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行 PURGE MASTER LOGS 语句删除创建时间比 binlog.000005 早的所有日志</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">PURGE</span> MASTER LoGS <span class="token keyword">TO</span> <span class="token string">&quot;binlog.000005&quot;</span><span class="token punctuation">;</span> <span class="token comment"># 不会删除005</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 PURGE MASTER LOGs 语句删除 2022 年 1 月 05 日前创建的所有日志文件</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">PURGE</span> MASTER LOGS before <span class="token string">&quot;20220105&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-4-2-reset-master-删除所有二进制日志文件"><a href="#_5-4-2-reset-master-删除所有二进制日志文件" class="header-anchor">#</a> 5.4.2 RESET MASTER：删除所有二进制日志文件</h4> <p>使用 <code>RESET MASTER</code> 语句，清空所有的 binlog 日志。MySQL 会重新创建二进制文件，新的日志文件扩展名将重新从 000001 开始编号。<strong>慎用!</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>RESET MASTER
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-5-使用日志恢复数据"><a href="#_5-5-使用日志恢复数据" class="header-anchor">#</a> 5.5 使用日志恢复数据</h3> <p>如果 MySQL 服务器启用了二进制日志，在数据库出现意外丢失数据时，可以使用 MySQLbinlog 工具从指定的时间点开始（<strong>例如，最后一次备份</strong>）直到现在或另一个指定的时间点的日志中恢复数据。</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <ul><li>不是从无到有恢复数据，是从备份点开始恢复数据，比如每日备份数据库</li> <li>当天的数据库数据丢失，就从昨天的备份点开始，</li> <li>从 binlog 中提取今天所有执行过的更新操作，然后执行在昨天的备份的基础上。</li></ul></div> <p>mysqlbinlog 恢复数据的语法如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog <span class="token punctuation">[</span>option<span class="token punctuation">]</span> filename<span class="token operator">|</span>mysql –uuser -ppass<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>filename</code>：是日志文件名。</li> <li><code>option</code>：可选项，比较重要的两对 option 参数是--start-date、--stop-date 和 --start-position、-- stop-position。
<ul><li><code>--start-date 和 --stop-date</code>：可以指定恢复数据库的起始时间点和结束时间点。</li> <li><code>--start-position 和 --stop-position</code>：可以指定恢复数据的开始位置和结束位置。</li></ul></li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>使用 mysqlbinlog 命令进行恢复操作时，必须是编号小的先恢复，例如 atguigu-bin.000001 必须在 atguigu-bin.000002 之前恢复。</p></div> <h4 id="_5-5-1-恢复数据前的操作"><a href="#_5-5-1-恢复数据前的操作" class="header-anchor">#</a> 5.5.1 恢复数据前的操作</h4> <p>在恢复数据前，先刷新日志，生成新的二进制日志文件</p> <p>执行 <code>FLUSH LOGS</code> 关闭当前的 binlog 文件并创建一个新的 binlog 文件。</p> <p>目的是为了和之前的二进制日志文件分隔，因为恢复操作，也会写入到二进制日志中</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> flush logs<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">binary</span> logs<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+-----------+</span>
<span class="token operator">|</span> Log_name      <span class="token operator">|</span> File_size <span class="token operator">|</span> Encrypted <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+-----------+</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000040</span> <span class="token operator">|</span>       <span class="token number">455</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000041</span> <span class="token operator">|</span>       <span class="token number">179</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">|</span> binlog<span class="token punctuation">.</span><span class="token number">000042</span> <span class="token operator">|</span>       <span class="token number">156</span> <span class="token operator">|</span> <span class="token keyword">No</span>        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+-----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-5-2-通过-position-恢复数据"><a href="#_5-5-2-通过-position-恢复数据" class="header-anchor">#</a> 5.5.2 通过 position 恢复数据</h4> <p>通过 <code>show binlog events</code> 查看 SQL 的 position</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span><span class="token keyword">show</span> binlog events <span class="token operator">IN</span> <span class="token string">'log_name'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-----+----------------+-----------+-------------+-----+</span>
<span class="token operator">|</span> Log_name      <span class="token operator">|</span> Pos <span class="token operator">|</span> Event_type     <span class="token operator">|</span> Server_id <span class="token operator">|</span> End_log_pos <span class="token operator">|</span> Info<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----+----------------+-----------+-------------+-----+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>连续的语句，XID 是挨着的，可以根据 <code>XID</code> 去查找事务开始的 <code>BEGIN</code>的 <code>POSITION</code></p> <p>XID 代表一个事务的编号，XID 的 BEGIN，代表事务的开始。XID 的 End_lod_pos 是事务结束的位置。</p> <p>一个事务结束的位置<code>End_log_pos</code>也是下一个事务的 BEGIN 位置。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/usr/bin/mysqlbinlog 
--start-position<span class="token operator">=</span>Pos --stop-position<span class="token operator">=</span>End_log_pos
<span class="token parameter variable">--database</span><span class="token operator">=</span>数据库名 /var/lib/mysql/日志文件 <span class="token operator">|</span> /usr/bin/mysql <span class="token parameter variable">-uroot</span> -p密码 <span class="token parameter variable">-v</span> 数据库名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <ul><li>恢复数据时，切记不要加此选项<code>--base64-output=DECODE-ROWS</code></li> <li>此选项会导致 Insert 语句恢复失效。</li> <li>因为此参数为了方便人为查看，将人不可读但 mysql 可以执行的 SQL 语句，转换成了伪 SQL 语句，伪 SQL 语句不可执行，显示在注释部分，仅方便查看。</li> <li>可以使用 <code>-v</code> 参数，此参数会同时保留 SQL 和可以查看的伪 SQL 语句</li></ul></div> <h4 id="_5-5-3-根据时间恢复数据"><a href="#_5-5-3-根据时间恢复数据" class="header-anchor">#</a> 5.5.3 根据时间恢复数据</h4> <p>从指定的二进制日志文件中提取在特定时间范围内的 SQL 语句，并将这些语句保存到<code>binlog.sql</code>文件中</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog --no-defaults <span class="token punctuation">\</span>
--start-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> --stop-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--database</span><span class="token operator">=</span>your_database <span class="token punctuation">\</span>
/path/to/binlog.00000X<span class="token operator">&gt;</span> binlog.sql 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>从多个二进制日志(binlog)文件中批量提取 SQL 语句</strong></p> <ul><li>可以在<code>mysqlbinlog</code>命令中直接列出所有需要处理的 binlog 文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog --no-defaults <span class="token punctuation">\</span>
--start-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> --stop-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--database</span><span class="token operator">=</span>your_database <span class="token punctuation">\</span>
/path/to/binlog.00000X /path/to/binlog.00000X /path/to/binlog.00000X<span class="token operator">&gt;</span> binlog.sql 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>使用通配符匹配多个 binlog 文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog --no-defaults <span class="token punctuation">\</span>
--start-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> --stop-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--database</span><span class="token operator">=</span>your_database <span class="token punctuation">\</span>
/path/to/binlog.0* <span class="token operator">&gt;</span> binlog.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>注意<code>binlog.0*</code>，避免将<code>binlog.index</code>匹配进去</li> <li>注意<code>binlog.00000[0-8]</code> 可以指定具体的范围</li></ul></div> <ul><li>使用循环批量处理</li></ul> <p>通过 Shell 脚本或命令行循环处理多个文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">binlog</span> <span class="token keyword">in</span> /path/to/binlog.*<span class="token punctuation">;</span> <span class="token keyword">do</span>
    mysqlbinlog --no-defaults <span class="token punctuation">\</span>
    --start-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> --stop-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--database</span><span class="token operator">=</span>your_database <span class="token punctuation">\</span>
    <span class="token string">&quot;<span class="token variable">$binlog</span>&quot;</span> <span class="token operator">&gt;&gt;</span> binlog.sql
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>使用 binlog 索引文件</li></ul> <p>MySQL 会维护一个二进制日志索引文件（默认为<code>/var/lib/mysql/binlog.index</code>）</p> <p>可以利用它来读取所有 binlog 文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog --no-defaults <span class="token punctuation">\</span>
--start-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> --stop-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--database</span><span class="token operator">=</span>your_database --result-file<span class="token operator">=</span>binlog.sql <span class="token punctuation">\</span>
--read-from-remote-server <span class="token parameter variable">--host</span><span class="token operator">=</span>your_host <span class="token parameter variable">--user</span><span class="token operator">=</span>your_user <span class="token parameter variable">--password</span><span class="token operator">=</span>your_password <span class="token punctuation">\</span>
<span class="token parameter variable">--raw</span> <span class="token operator">&lt;</span> /path/to/mysql-bin.index
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>执行 SQL 脚本</strong></p> <p>使用 <code>source</code> 命令执行 SQL 文件</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql <span class="token operator">-</span>u <span class="token keyword">user</span> <span class="token operator">-</span>p
mysql<span class="token operator">&gt;</span> source <span class="token operator">/</span>path<span class="token operator">/</span><span class="token keyword">to</span><span class="token operator">/</span>your_file<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输入重定向</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql <span class="token parameter variable">-u</span> 用户名 <span class="token parameter variable">-p</span> 数据库名 <span class="token operator">&lt;</span> /path/to/your_file.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>管道符</p> <p>可以通过管道符（<code>|</code>）将提取 SQL 语句的命令和执行 SQL 脚本的命令连接起来</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>usr/bin/mysqlbinlog
--start-datetime<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD HH:MM:SS” --stop-datetime=&quot;</span>YYYY-MM-DD HH:MM:SS&quot; 
<span class="token parameter variable">--database</span><span class="token operator">=</span>your_database /var/lib/mysql/日志文件 <span class="token operator">|</span> /usr/bin/mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-ppassord</span> <span class="token parameter variable">-v</span> your_database
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_5-5-4-时间恢复-vs-position-恢复"><a href="#_5-5-4-时间恢复-vs-position-恢复" class="header-anchor">#</a> 5.5.4 时间恢复 VS Position 恢复</h4> <p><strong>精确性</strong>：时间点恢复包含时间范围内的多个事务，而某些情况下只需要恢复部分事务。使用 <code>POS</code> 能更精确地控制恢复范围。</p> <p><strong>主从复制场景</strong>：在主从复制的修复中，时间点无法直接用作 <code>CHANGE MASTER TO</code> 的参数，必须使用日志文件名和 <code>POS</code>。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span>
    MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">'mysql-bin.000001'</span><span class="token punctuation">,</span>
    MASTER_LOG_POS<span class="token operator">=</span><span class="token number">12345</span><span class="token punctuation">;</span>
<span class="token keyword">START</span> SLAVE<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>事务一致性</strong>：使用时间点恢复时，可能会不小心跨越事务边界。通过 <code>POS</code> 可以确保完整的事务被恢复。</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>可以先根据时间点提取日志，确定大致 POS 范围。再根据 POS 精准恢复。</p></div> <h4 id="_5-5-5-模拟案例"><a href="#_5-5-5-模拟案例" class="header-anchor">#</a> 5.5.5 模拟案例</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 建库建表</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> dbtest_log<span class="token punctuation">;</span>
<span class="token keyword">use</span> dbtest_log<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 插入数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>模拟删除表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">table</span> test<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>通过 position 恢复</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>flush logs<span class="token punctuation">;</span>
<span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'binlog.000001'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/binlog_demo1.d1f81932.webp" alt="binlog_demo1"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/usr/bin/mysqlbinlog <span class="token punctuation">\</span>
--start-position<span class="token operator">=</span><span class="token number">436</span> --stop-position<span class="token operator">=</span><span class="token number">893</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--database</span><span class="token operator">=</span>dbtest_log /var/lib/mysql/binlog.000001 <span class="token operator">|</span> /usr/bin/mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-ppassword</span> <span class="token parameter variable">-v</span> dbtest_log<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>分两步也是可以的</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/usr/bin/mysqlbinlog <span class="token punctuation">\</span>
--start-position<span class="token operator">=</span><span class="token number">436</span> --stop-position<span class="token operator">=</span><span class="token number">893</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--database</span><span class="token operator">=</span>dbtest_log /var/lib/mysql/binlog.000001 <span class="token operator">&gt;</span> binlog.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> source <span class="token operator">/</span>root<span class="token operator">/</span>binlog<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>通过时间恢复</strong></p> <p>根据大致的时间点，提取 sql 语句</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog --no-defaults <span class="token punctuation">\</span>
--start-datetime<span class="token operator">=</span><span class="token string">&quot;2024-11-18 00:00:00&quot;</span> --stop-datetime<span class="token operator">=</span><span class="token string">&quot;2024-11-19 00:00:00&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--database</span><span class="token operator">=</span>dbtest_log <span class="token punctuation">\</span>
/var/lib/mysql/binlog.000001 <span class="token operator">&gt;</span> binlog.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>查看 binlog.sql，确定更加精确的时间范围，或者手动删除不需要的 sql 语句。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql&gt; source /root/binlog.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-5-6-第三方-binlog-恢复工具"><a href="#_5-5-6-第三方-binlog-恢复工具" class="header-anchor">#</a> 5.5.6 第三方 binlog 恢复工具</h4> <p>原生的 mysqlbinlog 无法根据某张表去筛选</p> <p><code>binlog2sql</code> <code>MyFlash</code></p> <h3 id="_5-6-其他场景"><a href="#_5-6-其他场景" class="header-anchor">#</a> 5.6 其他场景</h3> <p>二进制日志可以通过数据库的<code>全量备份</code>和二进制日志中保存的<code>增量信息</code>，完成数据库的<code>无损失恢复</code>。但是，如果遇到数据量大、数据库和数据表很多（比如分库分表的应用）的场景，用二进制日志进行数据恢复，是很有挑战性的，因为起止位置不容易管理。</p> <p>在这种情况下，一个有效的解决办法是<code>配置主从数据库服务器</code>，甚至是<code>一主多从</code>的架构，把二进制日志文件的内容通过中继日志，同步到从数据库服务器中，这样就可以有效避免数据库故障导致的数据异常等问题。</p> <h2 id="_6-再谈二进制日志-binlog"><a href="#_6-再谈二进制日志-binlog" class="header-anchor">#</a> 6. 再谈二进制日志(binlog)</h2> <h3 id="_6-1-写入机制"><a href="#_6-1-写入机制" class="header-anchor">#</a> 6.1 写入机制</h3> <p>binlog 的写入时机也非常简单，事务执行过程中，先把日志写到<code>binlog cache</code>，事务提交的时候，再把 binlog cache 写到 binlog 文件中。因为一个事务的 binlog 不能被拆开，无论这个事务多大，也要确保一次性写入，所以系统会给每个线程分配一个块内存作为 binlog cache。</p> <p>我们可以通过<code>binlog_cache_size</code>参数控制单个线程 binlog cache 大小，如果存储内容超过了这个参数，就要暂存到磁盘(Swap)。binlog 日志刷盘流程如下:</p> <p><img src="/assets/img/binlog3.232de099.webp" alt="binlog3"></p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <ul><li>上图的 write，是指把日志写入到文件系统的 page cache，并没有把数据持久化到磁盘，所以速度比较快</li> <li>上图的 fsync，才是将数据持久化到磁盘的操作</li></ul></div> <p>write 和 fsync 的时机，可以由参数<code>sync_binlog</code>控制，默认是<code>0</code>。为 0 的时候，表示每次提交事务都只 write，由系统自行判断什么时候执行 fsync。虽然性能得到提升，但是机器宕机，page cache 里面的 binglog 会丢失。如下图：</p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>目前 MySQL8.x 中参数<code>sync_binlog</code>默认值为 <code>1</code>。</p></div> <p><img src="/assets/img/binlog4.7fa84c82.webp" alt="binlog4"></p> <p>为了安全起见，可以设置为<code>1</code>，表示每次提交事务都会执行 fsync，就如同 <strong>redo log</strong> <strong>刷盘流程</strong>一样。</p> <p>最后还有一种折中方式，可以设置为 N(N&gt;1)，表示每次提交事务都 write，但累积 N 个事务后才 fsync。</p> <p><img src="/assets/img/binlog5.4368b9ee.webp" alt="binlog5"></p> <p>在出现 IO 瓶颈的场景里，将 sync_binlog 设置成一个比较大的值，可以提升性能。同样的，如果机器宕机，会丢失最近 N 个事务的 binlog 日志。</p> <h3 id="_6-2-binlog-与-redolog-对比"><a href="#_6-2-binlog-与-redolog-对比" class="header-anchor">#</a> 6.2 binlog 与 redolog 对比</h3> <ul><li>redo log 它是<code>物理日志</code>，记录内容是“在某个数据页上做了什么修改”，属于 InnoDB 存储引擎层产生的。</li> <li>而 binlog 是<code>逻辑日志</code>，记录内容是语句的原始逻辑，类似于“给 ID=2 这一行的 c 字段加 1”，属于 MySQL Server 层。</li> <li>虽然它们都属于持久化的保证，但是侧重点不同。
<ul><li>redo log 让 InnoDB 存储引擎拥有了崩溃恢复能力。</li> <li>binlog 保证了 MySQL 集群架构的数据一致性</li></ul></li></ul> <h3 id="_6-3-两阶段提交"><a href="#_6-3-两阶段提交" class="header-anchor">#</a> 6.3 两阶段提交</h3> <p>在执行更新语句过程，会记录 redo log 与 binlog 两块日志，以基本的事务为单位，redo log 在事务执行过程中可以不断写入，而 binlog 只有在提交事务时才写入，所以 redo log 与 binlog 的<code>写入时机</code>不一样。</p> <p><img src="/assets/img/binlog6.4f560138.webp" alt="binlog6"></p> <p><strong>redo log 与 binlog 两份日志之间的逻辑不一致，会出现什么问题？</strong></p> <p>以 update 语句为例，假设 id=2 的记录，字段 c 值是 0，把字段 c 值更新成 1，SQL 语句为 update T set c=1 where id=2。</p> <p>假设执行过程中写完 redo log 日志后，binlog 日志写期间发生了异常，会出现什么情况呢?</p> <p><img src="/assets/img/binlog7.634107d2.webp" alt="binlog7"></p> <p>由于 binlog 没写完就异常，这时候 binlog 里面没有对应的修改记录。因此，之后用 binlog 日志恢复数据时，就会少这一次更新，恢复出来的这一行 c 值是 0，而原库因为 redo log 日志恢复，这一行 c 值是 1，最终数据不一致。</p> <p><img src="/assets/img/binlog8.b7d4eccd.webp" alt="binlog8"></p> <p>为了解决两份日志之间的逻辑一致问题，InnoDB 存储引擎使用<strong>两阶段提交</strong>方案。原理很简单，将 redo log 的写入拆成了两个步骤 prepare 和 commit，这就是<strong>两阶段提交</strong>。</p> <p><img src="/assets/img/binlog9.37c896bd.webp" alt="binlog9"></p> <p>使用<strong>两阶段提交</strong>后，写入 binlog 时发生异常也不会有影响，因为 MySQL 根据 redo log 日志恢复数据时， 发现 redolog 还处于 prepare 阶段，并且没有对应 binlog 日志，就会回滚该事务。</p> <p><img src="/assets/img/binlog10.f18981cc.webp" alt="binlog10"></p> <p>另一个场景，redo log 设置 commit 阶段发生异常，那会不会回滚事务呢？</p> <p><img src="/assets/img/binlog11.57e6ad3f.webp" alt="binlog11"></p> <p>并不会回滚事务，它会执行上图框住的逻辑，虽然 redo log 是处于 prepare 阶段，但是能通过事务 id 找到对应的 binlog 日志，所以 MySQL 认为是完整的，就会提交事务恢复数据。</p> <h2 id="_7-中继日志-relay-log"><a href="#_7-中继日志-relay-log" class="header-anchor">#</a> 7. 中继日志(relay log)</h2> <h3 id="_7-1-介绍"><a href="#_7-1-介绍" class="header-anchor">#</a> 7.1 介绍</h3> <p><strong>中继日志只在主从服务器架构的从服务器上存在</strong>。从服务器为了与主服务器保持一致，要从主服务器读取二进制日志的内容，并且把读取到的信息写入<code>本地的日志文件</code>中，这个从服务器本地的日志文件就叫<code>中继日志</code>。然后，从服务器读取中继日志，并根据中继日志的内容对从服务器的数据进行更新，完成主从服务器的<code>数据同步</code>。</p> <p>搭建好主从服务器之后，中继日志默认会保存在从服务器的数据目录下。</p> <p>文件名的格式是：<code>从服务器名-relay-bin.序号</code>。</p> <p>中继日志还有一个索引文件：<code>从服务器名-relaybin.index</code>，用来定位当前正在使用的中继日志。</p> <h3 id="_7-2-查看中继日志"><a href="#_7-2-查看中继日志" class="header-anchor">#</a> 7.2 查看中继日志</h3> <p>中继日志与二进制日志的格式相同，可以用<code>mysqlbinlog</code>工具进行查看。下面是中继日志的一个片段：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">SET</span> <span class="token value attr-value">TIMESTAMP=1618558728/*!*/;</span>
BEGIN
/*!*/;
<span class="token comment"># at 950</span>
<span class="token comment">#210416 15:38:48 server id 1 end_log_pos 832 CRC32 0xcc16d651 Table_map:</span>
<span class="token key attr-name">`atguigu`.`test`</span> <span class="token value attr-value">mapped to number 91</span>
<span class="token comment"># at 1000</span>
<span class="token comment">#210416 15:38:48 server id 1 end_log_pos 872 CRC32 0x07e4047c Delete_rows: table id</span>
<span class="token key attr-name">91</span> <span class="token value attr-value">flags: STMT_END_F -- server id 1 是主服务器，意思是主服务器删了一行数据</span>
<span class="token key attr-name">BINLOG</span> <span class="token value attr-value">'</span>
<span class="token key attr-name">CD95YBMBAAAAMgAAAEADAAAAAFsAAAAAAAEABGRlbW8ABHRlc3QAAQMAAQEBAFHWFsw</span><span class="token punctuation">=</span>
<span class="token key attr-name">CD95YCABAAAAKAAAAGgDAAAAAFsAAAAAAAEAAgAB/wABAAAAfATkBw</span><span class="token punctuation">=</span><span class="token value attr-value">=</span>
'/*!*/;
<span class="token comment"># at 1040</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这一段的意思是，主服务器(“server id 1”)对表 atguigu.test 进行了 2 步操作：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>定位到表 atguigu.test 编号是 91 的记录，日志位置是 832；
删除编号是 91 的记录，日志位置是 872。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_7-3-恢复的典型错误"><a href="#_7-3-恢复的典型错误" class="header-anchor">#</a> 7.3 恢复的典型错误</h3> <p>如果从服务器宕机，有的时候为了系统恢复，要重装操作系统，这样就可能会导致你的<code>服务器名称</code>与之前<code>不同</code>。而中继日志里是<code>包含从服务器名</code>的。在这种情况下，就可能导致你恢复从服务器的时候，无法从宕机前的中继日志里读取数据，以为是日志文件损坏了，其实是名称不对了。</p> <p>解决的方法也很简单，把从服务器的名称改回之前的名称。</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/09/14, 20:37:44</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第16章_多版本并发控制</div></a> <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-18/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第18章_主从复制</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/" class="prev">第16章_多版本并发控制</a></span> <span class="next"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-18/">第18章_主从复制</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/jdbc-core/"><div>
            JDBC 核心技术(JDK21版)
            <!----></div></a> <span class="date">09-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/"><div>
            第00章_写在前面
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/"><div>
            第01章_Linux 下 MySQL 的安装与使用
            <!----></div></a> <span class="date">05-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca5c989c.js" defer></script><script src="/assets/js/3.f2884e99.js" defer></script><script src="/assets/js/2.81e8b964.js" defer></script><script src="/assets/js/55.b6fc3e0a.js" defer></script>
  </body>
</html>
