<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第09章_性能分析工具的使用 | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.ca5c989c.js" as="script"><link rel="preload" href="/assets/js/3.f2884e99.js" as="script"><link rel="preload" href="/assets/js/2.81e8b964.js" as="script"><link rel="preload" href="/assets/js/22.f9d18654.js" as="script"><link rel="prefetch" href="/assets/js/1.f754fd0b.js"><link rel="prefetch" href="/assets/js/10.bde6e567.js"><link rel="prefetch" href="/assets/js/100.000718ad.js"><link rel="prefetch" href="/assets/js/101.863f022a.js"><link rel="prefetch" href="/assets/js/102.7b45f43b.js"><link rel="prefetch" href="/assets/js/103.ba5681a8.js"><link rel="prefetch" href="/assets/js/104.e35b7e87.js"><link rel="prefetch" href="/assets/js/105.15a150cd.js"><link rel="prefetch" href="/assets/js/106.aea81b3b.js"><link rel="prefetch" href="/assets/js/107.4f4dec09.js"><link rel="prefetch" href="/assets/js/108.0079fda6.js"><link rel="prefetch" href="/assets/js/109.7a5059de.js"><link rel="prefetch" href="/assets/js/11.fa1b0bc7.js"><link rel="prefetch" href="/assets/js/110.85007649.js"><link rel="prefetch" href="/assets/js/111.dbec93e3.js"><link rel="prefetch" href="/assets/js/112.f17a38c0.js"><link rel="prefetch" href="/assets/js/113.6478506e.js"><link rel="prefetch" href="/assets/js/114.6031c0db.js"><link rel="prefetch" href="/assets/js/115.d7094af2.js"><link rel="prefetch" href="/assets/js/116.316a6234.js"><link rel="prefetch" href="/assets/js/117.1336f5e0.js"><link rel="prefetch" href="/assets/js/118.4b882789.js"><link rel="prefetch" href="/assets/js/119.503f83be.js"><link rel="prefetch" href="/assets/js/12.04b9b957.js"><link rel="prefetch" href="/assets/js/120.af7d94d8.js"><link rel="prefetch" href="/assets/js/121.5cd3597d.js"><link rel="prefetch" href="/assets/js/122.82f45642.js"><link rel="prefetch" href="/assets/js/123.f2ba0b19.js"><link rel="prefetch" href="/assets/js/13.680e50fd.js"><link rel="prefetch" href="/assets/js/14.dfca4100.js"><link rel="prefetch" href="/assets/js/15.01784967.js"><link rel="prefetch" href="/assets/js/16.81c1d5ab.js"><link rel="prefetch" href="/assets/js/17.9a472859.js"><link rel="prefetch" href="/assets/js/18.5366cb68.js"><link rel="prefetch" href="/assets/js/19.b1b74ef9.js"><link rel="prefetch" href="/assets/js/20.e938fa21.js"><link rel="prefetch" href="/assets/js/21.3e38db33.js"><link rel="prefetch" href="/assets/js/23.8eea4b67.js"><link rel="prefetch" href="/assets/js/24.6fe732dc.js"><link rel="prefetch" href="/assets/js/25.b1885cb6.js"><link rel="prefetch" href="/assets/js/26.936ee89a.js"><link rel="prefetch" href="/assets/js/27.fb3beb63.js"><link rel="prefetch" href="/assets/js/28.af721a74.js"><link rel="prefetch" href="/assets/js/29.427b7eae.js"><link rel="prefetch" href="/assets/js/30.2af5e34e.js"><link rel="prefetch" href="/assets/js/31.60102330.js"><link rel="prefetch" href="/assets/js/32.746872da.js"><link rel="prefetch" href="/assets/js/33.9466d03b.js"><link rel="prefetch" href="/assets/js/34.c7f7b0ef.js"><link rel="prefetch" href="/assets/js/35.53799eb8.js"><link rel="prefetch" href="/assets/js/36.e8875fc1.js"><link rel="prefetch" href="/assets/js/37.c386b2c5.js"><link rel="prefetch" href="/assets/js/38.ee46082f.js"><link rel="prefetch" href="/assets/js/39.11d092ff.js"><link rel="prefetch" href="/assets/js/4.920d0610.js"><link rel="prefetch" href="/assets/js/40.4ee40bcf.js"><link rel="prefetch" href="/assets/js/41.81c3174c.js"><link rel="prefetch" href="/assets/js/42.18f42b9d.js"><link rel="prefetch" href="/assets/js/43.7426d1ac.js"><link rel="prefetch" href="/assets/js/44.d5baff75.js"><link rel="prefetch" href="/assets/js/45.7b25c5ca.js"><link rel="prefetch" href="/assets/js/46.dff72ed3.js"><link rel="prefetch" href="/assets/js/47.15531a4f.js"><link rel="prefetch" href="/assets/js/48.48bbc098.js"><link rel="prefetch" href="/assets/js/49.49acd468.js"><link rel="prefetch" href="/assets/js/5.847584a2.js"><link rel="prefetch" href="/assets/js/50.e26ee1bf.js"><link rel="prefetch" href="/assets/js/51.6728bddb.js"><link rel="prefetch" href="/assets/js/52.c238e7bf.js"><link rel="prefetch" href="/assets/js/53.025903f6.js"><link rel="prefetch" href="/assets/js/54.05baf03a.js"><link rel="prefetch" href="/assets/js/55.b6fc3e0a.js"><link rel="prefetch" href="/assets/js/56.8e5ef1fc.js"><link rel="prefetch" href="/assets/js/57.db41b6fb.js"><link rel="prefetch" href="/assets/js/58.b4cb51f8.js"><link rel="prefetch" href="/assets/js/59.423b27e1.js"><link rel="prefetch" href="/assets/js/6.b384c550.js"><link rel="prefetch" href="/assets/js/60.57eff889.js"><link rel="prefetch" href="/assets/js/61.387a5103.js"><link rel="prefetch" href="/assets/js/62.23ba2982.js"><link rel="prefetch" href="/assets/js/63.2d69780b.js"><link rel="prefetch" href="/assets/js/64.d3f669fb.js"><link rel="prefetch" href="/assets/js/65.f5410640.js"><link rel="prefetch" href="/assets/js/66.59887fb2.js"><link rel="prefetch" href="/assets/js/67.01fba30e.js"><link rel="prefetch" href="/assets/js/68.8a6bbb81.js"><link rel="prefetch" href="/assets/js/69.12e673c4.js"><link rel="prefetch" href="/assets/js/70.a227d4b3.js"><link rel="prefetch" href="/assets/js/71.bd6a3bd7.js"><link rel="prefetch" href="/assets/js/72.4f2efca4.js"><link rel="prefetch" href="/assets/js/73.7dbf57a8.js"><link rel="prefetch" href="/assets/js/74.28c26d0a.js"><link rel="prefetch" href="/assets/js/75.d36a4feb.js"><link rel="prefetch" href="/assets/js/76.9123efc1.js"><link rel="prefetch" href="/assets/js/77.cbe2020d.js"><link rel="prefetch" href="/assets/js/78.7ab3eb40.js"><link rel="prefetch" href="/assets/js/79.bc69c4a8.js"><link rel="prefetch" href="/assets/js/80.da17de0b.js"><link rel="prefetch" href="/assets/js/81.1d16813f.js"><link rel="prefetch" href="/assets/js/82.586f2e97.js"><link rel="prefetch" href="/assets/js/83.129cc5fa.js"><link rel="prefetch" href="/assets/js/84.83d65ed9.js"><link rel="prefetch" href="/assets/js/85.f4327096.js"><link rel="prefetch" href="/assets/js/86.866a7d4f.js"><link rel="prefetch" href="/assets/js/87.f8aba274.js"><link rel="prefetch" href="/assets/js/88.43c5a138.js"><link rel="prefetch" href="/assets/js/89.b47b6d86.js"><link rel="prefetch" href="/assets/js/9.ef15744b.js"><link rel="prefetch" href="/assets/js/90.4950712a.js"><link rel="prefetch" href="/assets/js/91.80bbaffe.js"><link rel="prefetch" href="/assets/js/92.0d03ce50.js"><link rel="prefetch" href="/assets/js/93.fff94cff.js"><link rel="prefetch" href="/assets/js/94.91d0e36d.js"><link rel="prefetch" href="/assets/js/95.15227fb3.js"><link rel="prefetch" href="/assets/js/96.b3ef20b0.js"><link rel="prefetch" href="/assets/js/97.9e5e1675.js"><link rel="prefetch" href="/assets/js/98.b213b526.js"><link rel="prefetch" href="/assets/js/99.1ec76897.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b448e12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>核心</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java从入门到精通(JDK17版)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>MySQL从入门到高级-基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>MySQL从入门到高级-高级篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/" class="sidebar-link">第00章_写在前面</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/" class="sidebar-link">第01章_Linux 下 MySQL 的安装与使用</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-2/" class="sidebar-link">第02章_MySQL 的数据目录</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-3/" class="sidebar-link">第03章_用户与权限管理</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/" class="sidebar-link">第04章_逻辑架构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-5/" class="sidebar-link">第05章_存储引擎</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-6/" class="sidebar-link">第06章_索引的数据结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-7/" class="sidebar-link">第07章_InnoDB 数据存储结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-8/" class="sidebar-link">第08章_索引的创建与设计原则</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/" aria-current="page" class="active sidebar-link">第09章_性能分析工具的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_1-数据库服务器的优化步骤" class="sidebar-link">1. 数据库服务器的优化步骤</a></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_2-查看系统性能参数" class="sidebar-link">2. 查看系统性能参数</a></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_3-统计-sql-的查询成本-last-query-cost" class="sidebar-link">3. 统计 SQL 的查询成本：lastquerycost</a></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-定位执行慢的-sql-慢查询日志" class="sidebar-link">4. 定位执行慢的 SQL：慢查询日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-1-开启慢查询日志参数" class="sidebar-link">4.1 开启慢查询日志参数</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-2-查看慢查询数目" class="sidebar-link">4.2 查看慢查询数目</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-3-慢查询日志分析工具-mysqldumpslow" class="sidebar-link">4.3 慢查询日志分析工具：mysqldumpslow</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-4-关闭慢查询日志" class="sidebar-link">4.4 关闭慢查询日志</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-5-删除慢查询日志" class="sidebar-link">4.5 删除慢查询日志</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_5-查看-sql-执行成本-show-profile" class="sidebar-link">5.查看 SQL 执行成本：SHOW PROFILE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#sending-data-时间说明" class="sidebar-link">sending data 时间说明</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_6-分析查询语句-explain" class="sidebar-link">6. 分析查询语句：EXPLAIN</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_6-1-概述" class="sidebar-link">6.1 概述</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_6-2-基本语法" class="sidebar-link">6.2 基本语法</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_6-3-数据准备" class="sidebar-link">6.3 数据准备</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_6-4-explain-各列作用" class="sidebar-link">6.4 EXPLAIN 各列作用</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_1-table" class="sidebar-link">1）table</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_2-id" class="sidebar-link">2）id</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_3-select-type" class="sidebar-link">3）select_type</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-partitions" class="sidebar-link">4）partitions</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_5-type-重点" class="sidebar-link">5）type（重点）</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_6-possible-keys-和-key" class="sidebar-link">6）possible_keys 和 key</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_7-key-len-重点" class="sidebar-link">7）key_len（重点）</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_8-ref" class="sidebar-link">8）ref</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_9-rows-重点" class="sidebar-link">9）rows（重点）</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_10-filtered" class="sidebar-link">10）filtered</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_11-extra" class="sidebar-link">11）Extra</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_12-小结" class="sidebar-link">12）小结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_7-explain-的进一步使用" class="sidebar-link">7. EXPLAIN 的进一步使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_7-1-explain-四种输出格式" class="sidebar-link">7.1 EXPLAIN 四种输出格式</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_1-传统格式" class="sidebar-link">1）传统格式</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_2-json-格式" class="sidebar-link">2）JSON 格式</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_3-tree-格式" class="sidebar-link">3）TREE 格式</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_4-可视化输出" class="sidebar-link">4）可视化输出</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_7-2-show-warnings-的使用" class="sidebar-link">7.2 SHOW WARNINGS 的使用</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_8-分析优化器执行计划-trace" class="sidebar-link">8. 分析优化器执行计划：trace</a></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_9-mysql-监控分析视图-sys-schema" class="sidebar-link">9. MySQL 监控分析视图-sys schema</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_9-1-sys-schema-视图使用场景" class="sidebar-link">9.1 Sys schema 视图使用场景</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/#_10-小结" class="sidebar-link">10. 小结</a></li></ul></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-10/" class="sidebar-link">第10章_索引优化与查询优化</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-11/" class="sidebar-link">第11章_数据库的设计规范</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-12/" class="sidebar-link">第12章_数据库其它调优策略</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-13/" class="sidebar-link">第13章_事务基础知识</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-14/" class="sidebar-link">第14章_MySQL 事务日志</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-15/" class="sidebar-link">第15章_锁</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/" class="sidebar-link">第16章_多版本并发控制</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/" class="sidebar-link">第17章_其它数据库日志</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-18/" class="sidebar-link">第18章_主从复制</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-19/" class="sidebar-link">第19章_数据库备份与恢复</a></li></ul></section></li><li><a href="/java-basic/jdbc-core/" class="sidebar-link">JDBC 核心技术(JDK21版)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=Java%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>Java基础</a></li><li data-v-06225672><a href="/categories/?category=%E6%A0%B8%E5%BF%83" title="分类" data-v-06225672>核心</a></li><li data-v-06225672><a href="/categories/?category=MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7-%E9%AB%98%E7%BA%A7%E7%AF%87" title="分类" data-v-06225672>MySQL从入门到高级-高级篇</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-05-14</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">第09章_性能分析工具的使用<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="第-09-章-性能分析工具的使用"><a href="#第-09-章-性能分析工具的使用" class="header-anchor">#</a> 第 09 章 性能分析工具的使用</h1> <p>数据库调优的目标 <code>响应时间更快, 吞吐量更大</code> 。</p> <p>利用宏观的监控工具和微观的日志分析可以帮我们快速找到调优的思路和方式。</p> <h2 id="_1-数据库服务器的优化步骤"><a href="#_1-数据库服务器的优化步骤" class="header-anchor">#</a> 1. 数据库服务器的优化步骤</h2> <p>当我们遇到数据库调优问题的时候，该如何思考呢？这里把思考的流程整理成下面这张图。</p> <p>整个流程划分成了 <code>观察（Show status）</code> 和 <code>行动（Action）</code> 两个部分。字母 S 的部分代表观察（会使用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。</p> <p><img src="/assets/img/Database_Server_Optimization_Steps.17dfe98b.webp" alt="Database_Server_Optimization_Steps"></p> <p>通过观察了解数据库整体的运行状态，通过性能分析工具查询执行慢的 SQL 语句，查看具体的 SQL 执行计划，甚至是 SQL 执行中的每一步的成本代价，这样才能定位问题所在，找到了问题，再采取相应的行动。</p> <p><strong>详细解释一下这张图</strong></p> <p>首先在 S1 部分，我们需要观察服务器的状态是否存在周期性的波动。如果<code>存在周期性波动</code>，有可能是周期性节日的原因，比如双十一，促销活动等。这种情况下，我们可以通过 A1 这一步骤解决，也就是加缓存，或者更改缓存失效策略。</p> <p>如果缓存策略没有解决，或者不是周期性波动的原因，我们就需要进一步<code>分析查询延迟和卡顿的原因</code>。接下来进入 S2 这一步骤，开启慢查询。慢查询可以定位执行慢的 SQL 语句。通过设置<code>long_query_time</code>参数定义慢的阈值，如果 SQL 执行时间超过了 long_query_time，则认为是慢查询。当收集到这些慢查询之后，就可以通过分析工具对慢查询日志进行分析。</p> <p>在 S3 这一步骤中，知道了执行慢的 SQL 语句，可以对此针对性地用<code>EXPLAIN</code>查看对应 SQL 语句的执行计划，或者使用<code>show profile</code>查看 SQL 每一个步骤的时间成本。从而分析 SQL 查询慢的原因，是因为执行计划不好，还是等待的时间长。</p> <p>如果是 SQL 等待时间长，进入 A2 步骤。调优服务器的参数，比如适当增加数据库缓存池等。如果是 SQL 执行时间长，就进入 A3 步骤，考虑索引设计的问题？还是查询关联的数据表过多？还是因为数据表的字段设计问题。然后在这些维度上进行对应的调整。</p> <p>如果 A2 和 A3 都不能解决问题，需要考虑数据库自身的 SQL 查询性能是否已经达到了瓶颈，如果确认没有达到性能瓶颈，就需要重新检查，重复以上的步骤。如果已经达到了<code>性能瓶颈</code>，进入 A4 阶段，需要考虑<code>增加服务器</code>，采用<code>读写分离</code>的架构，或者考虑对数据库进行<code>分库分表</code>，比如垂直分库，垂直分表和水平分表等。</p> <p><img src="/assets/img/DB_tuning_costs.67fc4bb5.webp" alt="DB_tuning_costs"></p> <h2 id="_2-查看系统性能参数"><a href="#_2-查看系统性能参数" class="header-anchor">#</a> 2. 查看系统性能参数</h2> <p>在 MySQL 中，可以使用<code>SHOW STATUS</code>语句查询一些 MySQL 数据库服务器的<code>性能参数</code>、<code>执行频率</code>。</p> <p>SHOW STATUS 语句语法如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token punctuation">[</span><span class="token keyword">GLOBAL</span><span class="token operator">|</span><span class="token keyword">SESSION</span><span class="token punctuation">]</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'参数'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>一些常用的性能参数如下：</p> <ul><li>Connections：连接 MySQL 服务器的次数。</li> <li>Uptime：MySQL 服务器的上线时间。</li> <li>Slow_queries：慢查询的次数。</li> <li>Innodb_rows_read：Select 查询返回的行数</li> <li>Innodb_rows_inserted：执行 INSERT 操作插入的行数</li> <li>Innodb_rows_updated：执行 UPDATE 操作更新的行数</li> <li>Innodb_rows_deleted：执行 DELETE 操作删除的行数</li> <li>Com_select：查询操作的次数。</li> <li>Com_insert：插入操作的次数。对于批量插入的 INSERT 操作，只累加一次。</li> <li>Com_update：更新操作的次数。</li> <li>Com_delete：删除操作的次数。</li></ul> <p>若查询 MySQL 服务器的连接次数，则可以执行如下语句:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Connections'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>若查询服务器工作时间，则可以执行如下语句:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Uptime'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>若查询 MySQL 服务器的慢查询次数，则可以执行如下语句:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Slow_queries'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>慢查询次数参数可以结合慢查询日志找出慢查询语句，然后针对慢查询语句进行<code>表结构优化</code>或者<code>查询语句优化</code>。</p> <p>再比如，如下的指令可以查看相关的指令情况：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Innodb_rows_%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_3-统计-sql-的查询成本-last-query-cost"><a href="#_3-统计-sql-的查询成本-last-query-cost" class="header-anchor">#</a> 3. 统计 SQL 的查询成本：last_query_cost</h2> <p>一条 SQL 查询语句在执行前需要查询执行计划，如果存在多种执行计划的话，MySQL 会计算每个执行计划所需要的成本，从中选择<code>成本最小</code>的一个作为最终执行的执行计划。</p> <p>如果想要查看某条 SQL 语句的查询成本，可以在执行完这条 SQL 语句之后，通过查看当前会话中的<code>last_query_cost</code>变量值来得到当前查询的成本。它通常也是我们<code>评价一个查询的执行效率</code>的一个常用指标。这个查询成本对应的是<code>SQL语句所需要读取的读页的数量</code>。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'last_query_cost'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以第 8 章的 student_info 表为例：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>student_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>student_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>course_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>class_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>查询 id=900001 的记录，查看查询成本，直接在聚簇索引上进行查找：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> student_id<span class="token punctuation">,</span> class_id<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> create_time <span class="token keyword">FROM</span> student_info <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">900001</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行结果（1 条记录，运行时间为 0.042s）</p> <p>然后再看下查询优化器的成本，实际上我们只需要检索一个页即可：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'last_query_cost'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span>   <span class="token keyword">Value</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> Last_query_cost <span class="token operator">|</span> <span class="token number">1.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>想要查询 id 在 900001 到 9000100 之间的学生记录</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> student_id<span class="token punctuation">,</span> class_id<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> create_time <span class="token keyword">FROM</span> student_info <span class="token keyword">WHERE</span> id <span class="token operator">BETWEEN</span> <span class="token number">900001</span> <span class="token operator">AND</span> <span class="token number">900100</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行结果（100 条记录，运行时间为 0.046s）</p> <p>然后再看下查询优化器的成本，这时我们大概需要进行 20 个页的查询。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'last_query_cost'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span>   <span class="token keyword">Value</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Last_query_cost <span class="token operator">|</span> <span class="token number">21.134453</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>页的数量是刚才的 20 倍，但是查询的效率并没有明显的变化，实际上这两个 SQL 查询的时间基本上一样，就是因为采用了顺序读取的方式将页面一次性加载到缓冲池中，然后再进行查找。虽然<code>页数量（last_query_cost）增加了不少</code>，但是通过缓冲池的机制，并<code>没有增加多少查询时间</code>。</p> <p><strong>使用场景</strong>：它对于比较开销是非常有用的，特别是我们有好几种查询方式可选的时候。</p> <div class="custom-block note"><p class="custom-block-title">SQL 查询是一个动态的过程，从页加载的角度来看，我们可以得到以下两点结论</p> <ul><li><p><code>位置决定效率</code>。如果页就在数据库<code>缓冲池</code>中，那么效率是最高的，否则还需要从<code>内存</code>或者<code>磁盘</code>中进行读取，当然针对单个页的读取来说，如果页存在于内存中，会比在磁盘中读取效率高很多。</p></li> <li><p><code>批量决定效率</code>。如果我们从磁盘中对单一页进行随机读，那么效率是很低的（差不多 10ms），而采用顺序读取的方式，批量对页进行读取，平均一页的读取效率就会提升很多，甚至要快于单个页面在内存中的随机读取。</p></li> <li><p>所以说，遇到 I/O 并不用担心，方法找对了，效率还是很高的。我们首先要考虑数据存放的位置，如果是经常使用的数据就要尽量放到<code>缓冲池</code>中，其次我们可以充分利用磁盘的吞吐能力，一次性批量读取数据，这样单个页的读取效率也就得到了提升。</p></li></ul></div> <h2 id="_4-定位执行慢的-sql-慢查询日志"><a href="#_4-定位执行慢的-sql-慢查询日志" class="header-anchor">#</a> 4. 定位执行慢的 SQL：慢查询日志</h2> <p>MySQL 的慢查询日志，用来记录在 MySQL 中<code>响应时间超过阈值</code>的语句，具体指运行时间超过<code>long_query_time</code>的值的 SQL，则会被记录到慢查询日志中。long_query_time 的默认值为<code>10</code>，意思是运行 10 秒以上（不含 10 秒）的语句，认为是超出了我们的最大忍耐时间值。</p> <p>它的主要作用是，帮助我们发现那些执行时间特别长的 SQL 查询，并且有针对性地进行优化，从而提高系统的整体效率。当我们的数据库服务器发生阻塞、运行变慢的时候，检查一下慢查询日志，找到那些慢查询，结合 explain 进行全面分析。</p> <p>默认情况下，MySQL 数据库<code>没有开启慢查询日志</code>，需要我们手动来设置这个参数。<strong>如果不是调优需要的话，一般不建议启动该参数</strong>，因为开启慢查询日志会或多或少带来一定的性能影响。</p> <p>慢查询日志支持将日志记录写入文件。</p> <h3 id="_4-1-开启慢查询日志参数"><a href="#_4-1-开启慢查询日志参数" class="header-anchor">#</a> 4.1 开启慢查询日志参数</h3> <p><strong>1）开启 slow_query_log</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log<span class="token operator">=</span><span class="token string">'ON'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看慢查询日志开启状态，以及慢查询日志文件的位置：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%slow_query_log%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+-----------------------------------+</span>
<span class="token operator">|</span> Variable_name       <span class="token operator">|</span> <span class="token keyword">Value</span>                             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+-----------------------------------+</span>
<span class="token operator">|</span> slow_query_log      <span class="token operator">|</span> <span class="token keyword">ON</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> slow_query_log_file <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>localhost<span class="token operator">-</span>slow<span class="token punctuation">.</span>log <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+-----------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>2）修改 long_query_time 阈值</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span> <span class="token comment"># 默认值是10s</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 测试发现：设置global的方式对当前session的long_query_time失效。对新连接的客户端有效。</span>
<span class="token comment"># 所以同时设置session和global变量</span>
<span class="token comment"># global</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> long_query_time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span> 
<span class="token comment"># session</span>
<span class="token keyword">set</span> long_query_time<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>3）配置文件中持久化设置参数</strong></p> <p>修改 <code>my.cnf</code> 文件，<code>[mysqld]</code> 下增加或修改参数<code>long_query_time、slow_query_log</code>和 <code>slow_query_log_file</code>后，然后重启 MySQL 服务器。</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>[mysqld]
<span class="token key attr-name">slow_query_log</span><span class="token punctuation">=</span><span class="token value attr-value">ON  # 开启慢查询日志开关</span>
<span class="token key attr-name">slow_query_log_file</span><span class="token punctuation">=</span><span class="token value attr-value">/var/lib/mysql/atguigu-low.log  # 慢查询日志的目录和文件名信息</span>
<span class="token key attr-name">long_query_time</span><span class="token punctuation">=</span><span class="token value attr-value">3  # 设置慢查询的阈值为3秒，超出此设定值的SQL即被记录到慢查询日志</span>
<span class="token key attr-name">log_output</span><span class="token punctuation">=</span><span class="token value attr-value">FILE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果不指定存储路径，慢查询日志默认存储到 MySQL 数据库的数据文件夹下。如果不指定文件名，默认文件名为<code>hostname_slow.log</code>。</p> <h3 id="_4-2-查看慢查询数目"><a href="#_4-2-查看慢查询数目" class="header-anchor">#</a> 4.2 查看慢查询数目</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'%Slow_queries%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">补充说明</p> <p>除了上述变量，控制慢查询日志的还有一个系统变量：<code>min_examined_row_limit</code>。这个变量的意思是，<code>查询扫描过的最少记录数</code>。这个变量和查询执行时间，共同组成了判别一个查询是否是慢查询的条件。如果查询扫描过的记录数大于等于这个变量的值，并且查询执行时间超过 long_query_time 的值，那么，这个查询就被记录到慢查询日志中；反之，则不被记录到慢查询日志中。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'min%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
<span class="token operator">|</span> Variable_name          <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
<span class="token operator">|</span> min_examined_row_limit <span class="token operator">|</span> <span class="token number">0</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这个值默认为 0。与 long_query_time=10 合在一起，表示只要查询的执行时间超过 10 秒钟，哪怕一个记录也没有扫描过，都要被记录到慢查询日志中。可以根据需要，通过修改配置文件，来修改查询时长，或者通过 SET 指令，用 SQL 语句修改“min_examined_row_limit”的值。</p></div> <h3 id="_4-3-慢查询日志分析工具-mysqldumpslow"><a href="#_4-3-慢查询日志分析工具-mysqldumpslow" class="header-anchor">#</a> 4.3 慢查询日志分析工具：mysqldumpslow</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># mysqldumpslow --help</span>
  <span class="token parameter variable">-v</span> <span class="token parameter variable">--verbose</span>    verbose
  <span class="token parameter variable">-d</span> <span class="token parameter variable">--debug</span>      debug
  <span class="token parameter variable">-s</span> ORDER     what to <span class="token function">sort</span> by <span class="token punctuation">(</span>al, at, ar, c, l, r, t<span class="token punctuation">)</span>, <span class="token string">'at'</span> is default
                al: average lock <span class="token function">time</span>  l: lock <span class="token function">time</span>
                ar: average rows sent  r: rows sent
                at: average query <span class="token function">time</span> t: query <span class="token function">time</span>  
                c: count 
  <span class="token parameter variable">-r</span>           reverse the <span class="token function">sort</span> order <span class="token punctuation">(</span>largest last instead of first<span class="token punctuation">)</span>
  <span class="token parameter variable">-t</span> NUM       just show the <span class="token function">top</span> n queries
  <span class="token parameter variable">-a</span>           don<span class="token string">'t abstract all numbers to N and strings to '</span>S<span class="token string">'
  -n NUM       abstract numbers with at least n digits within names
  -g PATTERN   grep: only consider stmts that include this string
  -h HOSTNAME  hostname of db server for *-slow.log filename (can be wildcard),
               default is '</span>*<span class="token string">', i.e. match all
  -i NAME      name of server instance (if using mysql.server startup script)
  -l           don'</span>t subtract lock <span class="token function">time</span> from total <span class="token function">time</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><code>-a</code>: 不将数字抽象成 N，字符串抽象成 S</p> <p><code>-s</code>: 是表示按照何种方式排序：</p> <ul><li>at:平均查询时间（默认方式） t: 查询时间</li> <li>al:平均锁定时间 l: 锁定时间</li> <li>ar:平均返回记录数 r: 返回记录</li> <li>c: 访问次数</li></ul> <p><code>-g</code>: 后边搭配一个正则匹配模式，大小写不敏感的</p> <p><code>-r</code>: 默认结果排序从大到小，使用该参数后，从大到小排序</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p><code>-r</code> 参数在 <code>-s</code> 和 <code>-t</code> 之后影响查询结果的排序。</p> <p>具体来说，首先会根据 <code>-s ORDER</code> 指定的字段进行排序，然后会根据 <code>-t NUM</code> 显示前 <code>NUM</code> 个查询结果，最后 <code>-r</code> 参数会反转这些结果的排序顺序。</p> <p>所以，整个处理过程是先排序，再取前 <code>NUM</code> 个查询，然后反转排序顺序。</p></div> <p><strong>举例：按照查询时间排序，查看前五条 SQL 语句，这样写即可</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># mysqldumpslow -s t -t 5 /var/lib/mysql/localhost-slow.log</span>

Reading mysql slow query log from /var/lib/mysql/localhost-slow.log

Count: <span class="token number">1</span>  <span class="token assign-left variable">Time</span><span class="token operator">=</span><span class="token number">4</span>.53s <span class="token punctuation">(</span>4s<span class="token punctuation">)</span>  <span class="token assign-left variable">Lock</span><span class="token operator">=</span><span class="token number">0</span>.00s <span class="token punctuation">(</span>0s<span class="token punctuation">)</span>  <span class="token assign-left variable">Rows</span><span class="token operator">=</span><span class="token number">1.0</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, root<span class="token punctuation">[</span>root<span class="token punctuation">]</span>@<span class="token punctuation">[</span><span class="token number">192.168</span>.1.5<span class="token punctuation">]</span>
  SELECT * FROM <span class="token variable"><span class="token variable">`</span>table_name<span class="token variable">`</span></span> WHERE <span class="token assign-left variable">column_name</span><span class="token operator">=</span><span class="token string">'S'</span> LIMIT N, N
  
Died at /usr/bin/mysqldumpslow line <span class="token number">161</span>, <span class="token operator">&lt;&gt;</span> chunk <span class="token number">1</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>工作常用参考</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#得到返回记录集最多的10个SQL </span>
mysqldumpslow <span class="token parameter variable">-s</span> r <span class="token parameter variable">-t</span> <span class="token number">10</span> /var/lib/mysql/atguigu-slow.log

<span class="token comment">#得到访问次数最多的10个SQL </span>
mysqldumpslow <span class="token parameter variable">-s</span> c <span class="token parameter variable">-t</span> <span class="token number">10</span> /var/lib/mysql/atguigu-slow.log

<span class="token comment">#得到按照时间排序的前10条里面含有左连接的查询语句 </span>
mysqldumpslow <span class="token parameter variable">-s</span> t <span class="token parameter variable">-t</span> <span class="token number">10</span> <span class="token parameter variable">-g</span> <span class="token string">&quot;left join&quot;</span> /var/lib/mysql/atguigu-slow.log 

<span class="token comment">#另外建议在使用这些命令时结合 | 和 more 使用 ，否则有可能出现爆屏情况</span>
mysqldumpslow <span class="token parameter variable">-s</span> r <span class="token parameter variable">-t</span> <span class="token number">10</span> /var/lib/mysql/atguigu-slow.log <span class="token operator">|</span> <span class="token function">more</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-4-关闭慢查询日志"><a href="#_4-4-关闭慢查询日志" class="header-anchor">#</a> 4.4 关闭慢查询日志</h3> <p><strong>方式 1：永久性方式</strong></p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">slow_query_log</span><span class="token punctuation">=</span><span class="token value attr-value">OFF</span>
<span class="token comment"># 或者把slow_query_log一项注释掉或删除</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token comment"># slow_query_log =OFF</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>方式 2：临时性方式</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> slow_query_log<span class="token operator">=</span><span class="token keyword">off</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-5-删除慢查询日志"><a href="#_4-5-删除慢查询日志" class="header-anchor">#</a> 4.5 删除慢查询日志</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%slow_query_log%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+-----------------------------------+</span>
<span class="token operator">|</span> Variable_name       <span class="token operator">|</span> <span class="token keyword">Value</span>                             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+-----------------------------------+</span>
<span class="token operator">|</span> slow_query_log      <span class="token operator">|</span> <span class="token keyword">ON</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> slow_query_log_file <span class="token operator">|</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>localhost<span class="token operator">-</span>slow<span class="token punctuation">.</span>log <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+-----------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>慢查询日志的目录默认为 MySQL 的数据目录，在该目录下<code>手动删除慢查询日志文件</code>即可。</p> <p>使用命令<code>mysqladmin flush-logs</code>来重新生成查询日志文件，具体命令如下，执行完成会在数据目录下重新生成慢查询日志文件。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysqladmin <span class="token operator">-</span>uroot <span class="token operator">-</span>p flush<span class="token operator">-</span>logs slow
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>慢查询日志都是使用 mysqladmin flush-logs 命令来删除重建的。使用时一定要注意，一旦执行了这个命令，慢查询日志都只存在新的日志文件中，如果需要旧的查询日志，就必须事先备份</p></div> <h2 id="_5-查看-sql-执行成本-show-profile"><a href="#_5-查看-sql-执行成本-show-profile" class="header-anchor">#</a> 5.查看 SQL 执行成本：SHOW PROFILE</h2> <p>show profile 是 MySQL 提供的可以用来分析当前会话中 SQL 都做了什么、执行的资源消耗工具的情况，可用于 sql 调优的测量。<code>默认情况下处于关闭状态</code>，并保存最近 15 次的运行结果。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'profiling'</span><span class="token punctuation">;</span>
<span class="token comment">#开启</span>
<span class="token keyword">set</span> profiling <span class="token operator">=</span> <span class="token string">'ON'</span><span class="token punctuation">;</span>
<span class="token comment">#查看</span>
<span class="token keyword">show</span> profiles<span class="token punctuation">;</span>

<span class="token keyword">show</span> profile<span class="token punctuation">;</span>
<span class="token keyword">show</span> profile cpu<span class="token punctuation">,</span>block io <span class="token keyword">for</span> query <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">show</span> profile <span class="token keyword">all</span> <span class="token keyword">for</span> query <span class="token number">6</span>\G
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>show profile 的常用查询参数：</strong></p> <p>① ALL：显示所有的开销信息。</p> <p>② BLOCK IO：显示块 IO 开销。</p> <p>③ CONTEXT SWITCHES：上下文切换开销。</p> <p>④ CPU：显示 CPU 开销信息。</p> <p>⑤ IPC：显示发送和接收开销信息。</p> <p>⑥ MEMORY：显示内存开销信息。</p> <p>⑦ PAGE FAULTS：显示页面错误开销信息。</p> <p>⑧ SOURCE：显示和 Source_function，Source_file，Source_line 相关的开销信息。</p> <p>⑨ SWAPS：显示交换次数开销信息。</p> <p><strong>日常开发需注意的结论：</strong></p> <p>① <code>converting HEAP to MyISAM</code>: 查询结果太大，内存不够，数据往磁盘上搬了。</p> <p>② <code>Creating tmp table</code>：创建临时表。先拷贝数据到临时表，用完后再删除临时表。</p> <p>③ <code>Copying to tmp table on disk</code>：把内存中临时表复制到磁盘上，警惕！</p> <p>④ <code>locked</code>。</p> <p>如果在 show profile 诊断结果中出现了以上 4 条结果中的任何一条，则 sql 语句需要优化。</p> <p><strong>注意：</strong></p> <p>不过 SHOW PROFILE 命令将被启用，我们可以从 information_schema 中的 profiling 数据表进行查看。</p> <h3 id="sending-data-时间说明"><a href="#sending-data-时间说明" class="header-anchor">#</a> sending data 时间说明</h3> <p><strong>mysql5.7 文档解释</strong></p> <p><code>Sending data</code> 线程正在为 SELECT 语句读取和处理行，并将数据发送到客户端。由于在此状态下进行的操作往往涉及大量磁盘访问（读取），因此它通常是一个查询生命周期中运行时间最长的状态。</p> <p><code>executing</code> The thread has begun executing a statement.</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>没有建立索引的查询情况下，executing 很快，Sending data 很慢</p> <p>猜测：在 mysql5.7 中 executing 只代表开始执行，执行的时间在 Sending data 中</p></div> <p><strong>mysql8 文档解释</strong></p> <p>mysql8.0 中，<code>Sending data</code> 包含在 executing 中</p> <p><a href="https://dev.mysql.com/doc/refman/8.4/en/general-thread-states.html" target="_blank" rel="noopener noreferrer">MySQL 8.4 Reference Manual :: 10.14.3 General Thread States<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>经执行验证，mysql8.0 中没有 Sending data，执行时间在 executing 中。</p></div> <p><strong>总之，理解成执行时间一部分</strong></p> <h2 id="_6-分析查询语句-explain"><a href="#_6-分析查询语句-explain" class="header-anchor">#</a> 6. 分析查询语句：EXPLAIN</h2> <h3 id="_6-1-概述"><a href="#_6-1-概述" class="header-anchor">#</a> 6.1 概述</h3> <p><strong>定位了查询慢的 SQL 之后，就可以使用 EXPLAIN 或 DESCRIBE 工具针对性的分析查询语句。</strong> DESCRIBE 语句的使用方法与 EXPLAIN 语句是一样的, 并且分析结果也是一样的。</p> <p>MySQL 中有专门负责优化 SELECT 语句的优化器模块，主要功能: 通过计算分析系统中收集到的统计信息, 为客户端请求的 Query 提供它认为是最优的<code>执行计划</code>（他认为最优的数据检索方式,但不见得是 DBA 认为是最优的, 这部分最耗费时间） 。</p> <p>这个执行计划展示了接下来具体执行查询的方式, 比如多表连接的顺序是什么,对于每个表采用什么访问方法来具体执行查询等等。MySQL 为我们提供了<code>EXPLAIN</code>语句来帮我们查看某个查询语句的具体执行计划, 大家看懂<code>EXPLAIN</code>语句的各个输出项, 可以有针对性的提升我们查询语句的性能。</p> <p><strong>1. 能做什么？</strong></p> <ul><li>表的读取顺序</li> <li>数据读取操作的操作类型</li> <li>哪些索引可以使用</li> <li>哪些索引被实际使用</li> <li>表之间的引用</li> <li>每张表有多少行被优化器查询</li></ul> <p><strong>2. 官网介绍</strong></p> <p>https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</p> <p>https://dev.mysql.com/doc/refman/8.0/en/explain-output.html</p> <p><code>MySQL Reference Manual/optimization/Understanding the Query Execution Plan/EXPLAIN Output Format</code></p> <p><strong>3. 版本情况</strong></p> <ul><li>MySQL5.6.3 以前只能<code>EXPLAIN SELECT</code>；MYSQL5.6.3 以后就可以<code>EXPLAIN SELECT，UPDATE，DELETE</code></li> <li>在 5.7 以前的版本中，想要显示<code>partitions</code>需要使用<code>explain partitions</code>命令；想要显示<code>filtered</code> 需要使用<code>explain extended</code>命令。在 5.7 版本后，默认 explain 直接显示 partitions 和 filtered 中的信息。</li></ul> <h3 id="_6-2-基本语法"><a href="#_6-2-基本语法" class="header-anchor">#</a> 6.2 基本语法</h3> <p><strong>EXPLAN 可以查看语句的执行计划，执行 EXPLAN 时并没有真正的执行后面的语句。</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> select_options 
<span class="token comment">#或者</span>
<span class="token keyword">DESCRIBE</span> <span class="token keyword">SELECT</span> select_options
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>EXPLAIN</code>语句输出的各个列的作用如下：</p> <table><thead><tr><th style="text-align:left;">列名</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>id</code></td> <td style="text-align:left;">在一个大的查询语句中每个 SELECT 关键字都对应一个<code>唯一的id</code></td></tr> <tr><td style="text-align:left;"><code>select_type</code></td> <td style="text-align:left;">SELECT 关键字对应的那个查询的类型</td></tr> <tr><td style="text-align:left;"><code>table</code></td> <td style="text-align:left;">表名</td></tr> <tr><td style="text-align:left;"><code>partitions</code></td> <td style="text-align:left;">匹配的分区信息</td></tr> <tr><td style="text-align:left;"><code>type</code></td> <td style="text-align:left;">针对单表的访问方法</td></tr> <tr><td style="text-align:left;"><code>possible_keys</code></td> <td style="text-align:left;">可能用到的索引</td></tr> <tr><td style="text-align:left;"><code>key</code></td> <td style="text-align:left;">实际上使用的索引</td></tr> <tr><td style="text-align:left;"><code>key_len</code></td> <td style="text-align:left;">实际使用到的索引长度</td></tr> <tr><td style="text-align:left;"><code>ref</code></td> <td style="text-align:left;">当使用索引列等值查询时，与索引列进行等值匹配的对象信息</td></tr> <tr><td style="text-align:left;"><code>rows</code></td> <td style="text-align:left;">预估的需要读取的记录条数</td></tr> <tr><td style="text-align:left;"><code>filtered</code></td> <td style="text-align:left;">某个表经过搜索条件过滤后剩余记录条数的百分比</td></tr> <tr><td style="text-align:left;"><code>Extra</code></td> <td style="text-align:left;">一些额外的信息</td></tr></tbody></table> <h3 id="_6-3-数据准备"><a href="#_6-3-数据准备" class="header-anchor">#</a> 6.3 数据准备</h3> <p><strong>1）建表</strong></p> <p>建立两张相同的表 s1，s2</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> s1 <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    key1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key2 <span class="token keyword">INT</span><span class="token punctuation">,</span>
    key3 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key_part1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key_part2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key_part3 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    common_field <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">INDEX</span> idx_key1 <span class="token punctuation">(</span>key1<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> idx_key2 <span class="token punctuation">(</span>key2<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">INDEX</span> idx_key3 <span class="token punctuation">(</span>key3<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">INDEX</span> idx_key_part<span class="token punctuation">(</span>key_part1<span class="token punctuation">,</span> key_part2<span class="token punctuation">,</span> key_part3<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>2）设置参数 log_bin_trust_function_creators</strong></p> <p>创建函数，假如报错，需开启如下命令：允许创建函数设置：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> log_bin_trust_function_creators<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment"># 不加global只是当前窗口有效。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3）创建随机字符串函数</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> rand_string<span class="token punctuation">(</span>n <span class="token keyword">INT</span><span class="token punctuation">)</span>
	<span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token comment">#该函数会返回一个字符串</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> chars_str <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span>
<span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ'</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> return_str <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">WHILE</span> i <span class="token operator">&lt;</span> n <span class="token keyword">DO</span>
        <span class="token keyword">SET</span> return_str <span class="token operator">=</span>CONCAT<span class="token punctuation">(</span>return_str<span class="token punctuation">,</span>SUBSTRING<span class="token punctuation">(</span>chars_str<span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
    <span class="token keyword">RETURN</span> return_str<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>4）创建存储过程</strong></p> <p>创建两个存储过程，分别插入数据到 s1，s2</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> insert_s1 <span class="token punctuation">(</span><span class="token operator">IN</span> min_num <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">IN</span> max_num <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">REPEAT</span>
    <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> s1 <span class="token keyword">VALUES</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>min_num <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
        rand_string<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>min_num <span class="token operator">+</span> <span class="token number">30</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rand_string<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rand_string<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rand_string<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rand_string<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rand_string<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    UNTIL i <span class="token operator">=</span> max_num
    <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>5）调用存储过程</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CALL</span> insert_s1<span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> insert_s2<span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-4-explain-各列作用"><a href="#_6-4-explain-各列作用" class="header-anchor">#</a> 6.4 EXPLAIN 各列作用</h3> <h4 id="_1-table"><a href="#_1-table" class="header-anchor">#</a> 1）table</h4> <p>不论查询语句有多复杂，<code>包含了多少个表</code>，到最后也是需要对每个表进行<code>单表访问</code>的，所以 MySQL 规定 <strong>EXPLAIN 语句输出的每条记录都对应着某个单表的访问方法</strong>，该条记录的 table 列代表着该表的表名（有时不是真实的表名字，可能是简称）。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">JOIN</span> s2 <span class="token keyword">on</span> s1<span class="token punctuation">.</span>key1<span class="token operator">=</span>s2<span class="token punctuation">.</span>key1<span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">-----------------+-----------------+-------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Column</span> Name     <span class="token operator">|</span> Row1            <span class="token operator">|</span> Row2                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------------+-------------------------+</span>
<span class="token operator">|</span> id              <span class="token operator">|</span> <span class="token number">1</span>               <span class="token operator">|</span> <span class="token number">1</span>                       <span class="token operator">|</span>
<span class="token operator">|</span> select_type     <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>          <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">table</span>           <span class="token operator">|</span> s1              <span class="token operator">|</span> s2                      <span class="token operator">|</span>
<span class="token operator">|</span> partitions      <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span> <span class="token boolean">NULL</span>                    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">type</span>            <span class="token operator">|</span> <span class="token keyword">ALL</span>             <span class="token operator">|</span> ref                     <span class="token operator">|</span>
<span class="token operator">|</span> possible_keys   <span class="token operator">|</span> idx_key1        <span class="token operator">|</span> idx_key1                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">key</span>             <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span> idx_key1                <span class="token operator">|</span>
<span class="token operator">|</span> key_len         <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span> <span class="token number">303</span>                     <span class="token operator">|</span>
<span class="token operator">|</span> ref             <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span> dbtest_explain<span class="token punctuation">.</span>s1<span class="token punctuation">.</span>key1  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">rows</span>            <span class="token operator">|</span> <span class="token number">9895</span>            <span class="token operator">|</span> <span class="token number">1</span>                       <span class="token operator">|</span>
<span class="token operator">|</span> filtered        <span class="token operator">|</span> <span class="token number">100.0</span>           <span class="token operator">|</span> <span class="token number">100.0</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> Extra           <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>     <span class="token operator">|</span> None                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------------+-------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="custom-block note"><p class="custom-block-title">笔记</p> <p>临时表也有对应记录，比如 UNION 语句。UNION 需要对表进行去重，所以会产生临时表</p> <p>注意：UNION ALL 不需要去重，所以不会有临时表</p></div> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+--------------+------------+-----------------+</span>
<span class="token operator">|</span>  id  <span class="token operator">|</span> select_type  <span class="token operator">|</span>   <span class="token keyword">table</span>    <span class="token operator">|</span>      Extra      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--------------+------------+-----------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span>   <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>      <span class="token operator">|</span> s1         <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span>   <span class="token operator">|</span> <span class="token keyword">UNION</span>        <span class="token operator">|</span> s2         <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">UNION</span> RESULT <span class="token operator">|</span> <span class="token operator">&lt;</span>union1<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">temporary</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--------------+------------+-----------------+</span>

<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">UNION</span>       <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_2-id"><a href="#_2-id" class="header-anchor">#</a> 2）id</h4> <p>查询语句中每出现一个<code>SELECT</code>关键字，MySQL 就会为它分配一个唯一的<code>id</code>值。这个<code>id</code>值就是<code>EXPLAIN</code>语句的第一个列。</p> <ul><li><strong>id 如果相同，可以认为是一组，从上往下顺序执行</strong></li> <li><strong>在所有组中，id 值越大，优先级越高，越先执行</strong></li> <li><strong>关注点：id 号每个号码，表示一趟独立的查询,一个 sql 的查询趟数越少越好</strong></li></ul> <p><strong>2.1）连接查询</strong></p> <p>对于连接查询来说，一个 SELECT 关键字后边的 FROM 子句中可以跟随多个表，所以在连接查询的执行计划中，每个表都会对应一条记录，但是这些记录的 id 值都是相同的。出现在前边的表表示<code>驱动表</code>，出现在后边的表表示 <code>被驱动表</code></p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>在 join 连接查询中，驱动表在 SQL 语句执行的过程中总是先被读取。而被驱动表在 SQL 语句执行的过程中总是后被读取。在读取驱动表数据后，放入到 join_buffer 后，再去读取被驱动表中的数据来和驱动表中的数据进行匹配。如果匹配成功，就返回结果，否则该丢弃，继续匹配下一条</p></div> <p><strong>2.2）查询中包含子查询</strong></p> <p>包含子查询的查询语句来说，就可能涉及多个 SELECT 关键字，所以在包含子查询的查询语句的执行计划中，每个 SELECT 关键字都会对应一个唯一的 id 值</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> key1 <span class="token keyword">FROM</span> s2<span class="token punctuation">)</span> <span class="token operator">OR</span> key3<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">--------------+------------+-------------+</span>
<span class="token operator">|</span> <span class="token keyword">Column</span> Name  <span class="token operator">|</span> Row1       <span class="token operator">|</span> Row2        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+------------+-------------+</span>
<span class="token operator">|</span> id           <span class="token operator">|</span> <span class="token number">1</span>          <span class="token operator">|</span> <span class="token number">2</span>           <span class="token operator">|</span>
<span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>    <span class="token operator">|</span> SUBQUERY    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">table</span>        <span class="token operator">|</span> s1         <span class="token operator">|</span> s2          <span class="token operator">|</span>
<span class="token operator">|</span> partitions   <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span>        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">type</span>         <span class="token operator">|</span> <span class="token keyword">ALL</span>        <span class="token operator">|</span> <span class="token keyword">index</span>       <span class="token operator">|</span>
<span class="token operator">|</span> possible_keys<span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> idx_key1    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">key</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> idx_key1    <span class="token operator">|</span>
<span class="token operator">|</span> key_len      <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token number">303</span>         <span class="token operator">|</span>
<span class="token operator">|</span> ref          <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span>        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">rows</span>         <span class="token operator">|</span> <span class="token number">9895</span>       <span class="token operator">|</span> <span class="token number">9895</span>        <span class="token operator">|</span>
<span class="token operator">|</span> filtered     <span class="token operator">|</span> <span class="token number">100.00</span>     <span class="token operator">|</span> <span class="token number">100.00</span>      <span class="token operator">|</span>
<span class="token operator">|</span> Extra        <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+------------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="custom-block note"><p class="custom-block-title">笔记</p> <p><strong>查询优化器可能对涉及子查询的查询语句进行重写，从而转换为连接查询</strong></p> <p>在大多数现代数据库系统中，查询优化器会尝试将子查询重写为等价的连接操作(JOIN)，以提高执行效率。这种优化过程称为子查询去关联(Subquery Unnesting)或子查询扁平化(Subquery Flattening)。</p></div> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">######查询优化器可能对涉及子查询的查询语句进行重写######</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> key2 <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> common_field <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">---------------+----------+---------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Column</span> Name   <span class="token operator">|</span> <span class="token keyword">Row</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Row</span> <span class="token number">2</span>                                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+----------+---------------------------------------+</span>
<span class="token operator">|</span> id            <span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span> <span class="token number">1</span>                                     <span class="token operator">|</span>
<span class="token operator">|</span> select_type   <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>   <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">table</span>         <span class="token operator">|</span> s1       <span class="token operator">|</span> s2                                    <span class="token operator">|</span>
<span class="token operator">|</span> partitions    <span class="token operator">|</span> <span class="token boolean">NULL</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">type</span>          <span class="token operator">|</span> <span class="token keyword">ALL</span>      <span class="token operator">|</span> eq_ref                                <span class="token operator">|</span>
<span class="token operator">|</span> possible_keys <span class="token operator">|</span> idx_key1 <span class="token operator">|</span> idx_key2                              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">key</span>           <span class="token operator">|</span> <span class="token boolean">NULL</span>     <span class="token operator">|</span> idx_key2                              <span class="token operator">|</span>
<span class="token operator">|</span> key_len       <span class="token operator">|</span> <span class="token boolean">NULL</span>     <span class="token operator">|</span> <span class="token number">5</span>                                     <span class="token operator">|</span>
<span class="token operator">|</span> ref           <span class="token operator">|</span> <span class="token boolean">NULL</span>     <span class="token operator">|</span> dbtest_explain<span class="token punctuation">.</span>s1<span class="token punctuation">.</span>key1                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">rows</span>          <span class="token operator">|</span> <span class="token number">9895</span>     <span class="token operator">|</span> <span class="token number">1</span>                                     <span class="token operator">|</span>
<span class="token operator">|</span> filtered      <span class="token operator">|</span> <span class="token number">100.00</span>   <span class="token operator">|</span> <span class="token number">10.00</span>                                 <span class="token operator">|</span>
<span class="token operator">|</span> Extra         <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition<span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+----------+---------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span><span class="token operator">*</span> 
<span class="token keyword">FROM</span> s1 
<span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key2 
<span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>common_field <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>虽然查询语句是一个子查询，但是执行计划中 s1 和 s2 表对应的记录的 id 值全部是 1，这就表明了查询优化器将子查询转换为了连接查询</p> <p><strong>2.3）联合查询</strong></p> <p>联合查询也会涉及多个 SELECT 关键字，每个 SELECT 关键字都会对应一个唯一的 id 值</p> <h4 id="_3-select-type"><a href="#_3-select-type" class="header-anchor">#</a> 3）select_type</h4> <p><strong>SELECT 关键字对应的那个查询的类型，确定小查询在整个大查询中扮演了一个什么角色</strong></p> <p>一条大的查询语句里边可以包含若干个 SELECT 关键字，<code>每个SELECT关键字代表着一个小的查询语句</code>，而每个 SELECT 关键字的 FROM 子句中都可以包含若干张表（这些表用来做连接查询），<code>每一张表都对应着执行计划输出中的一条记录</code>，对于在同一个 SELECT 关键字中的表来说，它们的 id 值是相同的。</p> <p>MySQL 为每一个 SELECT 关键字代表的小查询都定义了一个称之为<code>select_type</code>的属性，意思是我们只要知道了某个小查询的<code>select_type 属性</code>，就知道了这个<code>小查询在整个大查询中扮演了一个什么角色</code></p> <p><strong>select_type 取值</strong></p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>SIMPLE</code></td> <td style="text-align:left;">Simple SELECT (not using UNION or subqueries)</td></tr> <tr><td style="text-align:left;"><code>PRIMARY</code></td> <td style="text-align:left;">Outermost SELECT 最外层的 SELECT<br>指包含子查询的 SELECT 语句最外层的 SELECT</td></tr> <tr><td style="text-align:left;"><code>UNION</code></td> <td style="text-align:left;">Second or later SELECT statement in a UNION</td></tr> <tr><td style="text-align:left;"><code>UNION RESULT</code></td> <td style="text-align:left;">Result of a UNION</td></tr> <tr><td style="text-align:left;"><code>SUBQUERY</code></td> <td style="text-align:left;">First SELECT in subquery</td></tr> <tr><td style="text-align:left;"><code>DEPENDENT SUBQUERY</code></td> <td style="text-align:left;">First SELECT in subquery, dependent on outer query</td></tr> <tr><td style="text-align:left;"><code>DEPENDENT UNION</code></td> <td style="text-align:left;">Second or later SELECT statement in a UNION, dependent on outer query</td></tr> <tr><td style="text-align:left;"><code>DERIVED</code></td> <td style="text-align:left;">Derived table</td></tr> <tr><td style="text-align:left;"><code>MATERIALIZED</code></td> <td style="text-align:left;">Materialized subquery</td></tr> <tr><td style="text-align:left;"><code>UNCACHEABLE SUBQUERY</code></td> <td style="text-align:left;">A subquery for which the result cannot be cached and must be re-evaluated for each row of the outer query</td></tr> <tr><td style="text-align:left;"><code>UNCACHEABLE UNION</code></td> <td style="text-align:left;">The second or later select in a UNION that belongs to an uncacheable subquery (see UNCACHEABLE SUBQUERY)</td></tr></tbody></table> <p><strong>3.1）SIMPLE</strong></p> <p>查询语句中不包含 UNION 或者子查询的查询都是<code>SIMPLE</code>类型。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1<span class="token punctuation">;</span> <span class="token comment"># 单表查询</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2<span class="token punctuation">;</span> <span class="token comment"># 连接查询</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>3.2）PRIMARY、UNION、UNION RESULT</strong></p> <p>UNION 联合查询其左边的查询是<code>PRIMARY</code>，右边的查询类型是<code>UNION</code>，去重的临时表查询类型是：<code>UNION RESULT</code></p> <ul><li>对于包含 UNION 或者 UNION ALL 的大查询来说，它是由几个小查询组成的，其中最左边的那个查询的 select_type 值就是 <code>PRIMARY</code>，其余的小查询的 select_type 值就是<code>UNION</code></li> <li>MySQL 选择使用临时表来完成 UNION 查询的去重工作，针对该临时表的查询的 select_type 就是 <code>UNION RESULT</code></li></ul> <p>对于包含子查询的大查询来说，其中最左边的那个查询的 select_type 值就是<code>PRIMARY</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------------+------------+-----------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> Extra           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+------------+-----------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>      <span class="token operator">|</span> s1         <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">UNION</span>        <span class="token operator">|</span> s2         <span class="token operator">|</span> <span class="token boolean">NULL</span>            <span class="token operator">|</span>
<span class="token operator">|</span><span class="token boolean">NULL</span><span class="token operator">|</span> <span class="token keyword">UNION</span> RESULT <span class="token operator">|</span> <span class="token operator">&lt;</span>union1<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">temporary</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+------------+-----------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>3.3）SUBQUERY、DEPENDENT SUBQUERY</strong></p> <ul><li><p>如果包含子查询的查询语句不能够转为对应的多表连接的形式（<code>semi-join</code>的形式）（也就是不会被优化器进行自动的优化），并且该子查询是不相关的子查询</p> <p>该子查询的第一个<code>SELECT</code>关键字代表的那个查询的 select_type 就是<code>SUBQUERY</code>。也就是外层查询是 Primary ，内层查询是 SUBQUERY</p></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> key1 <span class="token keyword">FROM</span> s2<span class="token punctuation">)</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> SUBQUERY    <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>如果子查询不能被转换为多表连接的形式，并且该子查询是相关子查询。</p> <p>比如下面的查询在内部子查询使用了外部的表。则该子查询的第一个 SELECT 关键字代表的那个查询的 select_type 就是<code>DEPENDENT SUBQUERY</code>。外层查询是 Primary ，内层查询是 DEPENDENT SUBQUERY</p></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> key1 <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>key2 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key2<span class="token punctuation">)</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type        <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>            <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> DEPENDENT SUBQUERY <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block note"><p class="custom-block-title">笔记</p> <p>select_type 为<code>DEPENDENT SUBQUERY</code> 的查询可能会被执行多次，</p> <p>相关子查询依赖于外部查询中的列值。这使得子查询在每次外部查询处理行时都需要重新执行</p> <p><strong>相关子查询和不相关子查询概念回顾</strong></p> <ul><li><strong>相关子查询</strong>(Correlated Subquery)是指子查询中引用了外部查询中的列，子查询的执行依赖于外部查询中的每一行。每次外部查询处理一行数据，子查询都会重新执行一次</li> <li><strong>不相关子查询</strong>(Non-Correlated Subquery)是指子查询独立于外部查询，可以独立执行。子查询的结果在外部查询执行之前就已经确定。</li></ul></div> <p><strong>3.4）DEPENDENT UNION</strong></p> <p>在包含 UNION 或者 UNION ALL 的大查询中，如果各个小查询都依赖于外查询的话，那么除了最左边的小查询外，其余各个小查询的 select_type 值都是<code>DEPENDENT UNION</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> key1 <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> key1 <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">------+--------------------+------------+--------------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type        <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> Extra                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--------------------+------------+--------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span>   <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>            <span class="token operator">|</span> s1         <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>              <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span>   <span class="token operator">|</span> DEPENDENT SUBQUERY <span class="token operator">|</span> s2         <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span>   <span class="token operator">|</span> DEPENDENT <span class="token keyword">UNION</span>    <span class="token operator">|</span> s1         <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">UNION</span> RESULT       <span class="token operator">|</span> <span class="token operator">&lt;</span>union2<span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">temporary</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--------------------+------------+--------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block note"><p class="custom-block-title">笔记</p> <p>优化器有时会把 IN 优化成 EXISTS 语句，使得上面的语句变成相关子查询</p></div> <p><strong>3.5）DERIVED</strong></p> <p>对于包含<code>派生表</code>的查询，该派生表对应的子查询的 select_type 就是<code>DERIVED</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> key1<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> c <span class="token keyword">FROM</span> s1 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> key1<span class="token punctuation">)</span> <span class="token keyword">AS</span> derived_s1 
<span class="token keyword">where</span> c <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> 
<span class="token operator">+</span><span class="token comment">----+-------------+------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> <span class="token operator">&lt;</span>derived2<span class="token operator">&gt;</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> DERIVED     <span class="token operator">|</span> s1         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>3.6）MATERIALIZED</strong></p> <p>当查询优化器在执行包含子查询的语句时，选择将子查询物化之后与外层查询进行连接查询时，</p> <p>该子查询对应的 select_type 属性就是<code>MATERIALIZED</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> key1 <span class="token keyword">FROM</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#子查询被转为了物化表</span>
<span class="token operator">+</span><span class="token comment">----+--------------+-------------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">table</span>       <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+-------------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> s1          <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> <span class="token operator">&lt;</span>subquery2<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>        <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> MATERIALIZED <span class="token operator">|</span> s2          <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+-------------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>select_type</code> 属性为 <code>MATERIALIZED</code> 代表查询类型为物化查询，这表示该查询是一个物化表的创建或刷新操作。</p> <p>外层查询，访问一张临时表（物化表）和一张普通表，查询的类型是简单查询 SIMPLE</p> <p><strong>UNCACHEABLE SUBQUERY</strong> <strong>UNCACHEABLE UNION</strong> 不常用，省略。</p> <h4 id="_4-partitions"><a href="#_4-partitions" class="header-anchor">#</a> 4）partitions</h4> <p>代表分区表中的命中情况，非分区表，该项为<code>NULL</code>。一般情况下查询语句的执行计划的<code>partitions</code>列的值都是 NULL</p> <p><a href="https://dev.mysql.com/doc/refman/8.0/en/alter-table-partition-operations.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 如果想详细了解，可以如下方式测试。创建分区表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建分区表，</span>
<span class="token comment">-- 按照id分区，id&lt;100 p0分区，其他p1分区</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_partitions <span class="token punctuation">(</span>id <span class="token keyword">INT</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> RANGE<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">(</span>
	<span class="token keyword">PARTITION</span> p0 <span class="token keyword">VALUES</span> less than<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">PARTITION</span> p1 <span class="token keyword">VALUES</span> less than MAXVALUE
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>查询 id 大于 200（200&gt;100，p1 分区）的记录，查看执行计划，partitions 是 p1，符合我们的分区规则</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DESC</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user_partitions <span class="token keyword">WHERE</span> id<span class="token operator">&gt;</span><span class="token number">200</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-----------------+------------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>           <span class="token operator">|</span> partitions <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-----------------+------------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> user_partitions <span class="token operator">|</span> p1         <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-----------------+------------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_5-type-重点"><a href="#_5-type-重点" class="header-anchor">#</a> 5）type（重点）</h4> <p>执行计划的一条记录就代表着 MySQL 对某个表的<code>执行查询时的访问方法</code>，又称&quot;访问类型”，其中的<code>type</code>列就表明了这个访问方法是啥，是较为重要的一个指标。比如，看到 type 列的值是 ref，表明 MySQL 即将使用 ref 访问方法来执行对 s1 表的查询</p> <p>完整的访问方法如下，<strong>结果值从最好到最坏依次是：</strong></p> <p><code>system</code> &gt; <code>const</code> &gt; <code>eq_ref</code> &gt; <code>ref</code> &gt; <code>fulltext</code> &gt; <code>ref_or_null</code> &gt; <code>index_merge</code> &gt; <code>unique_subquery</code> &gt; <code>index_subquery</code> &gt; <code>range</code> &gt; <code>index</code> &gt; <code>ALL</code></p> <p><strong>SQL 性能优化的目标：至少要达到 range 级别，要求是 ref 级别，最好是 consts 级别。（阿里巴巴开发手册要求）</strong></p> <ul><li><code>system</code></li></ul> <p>当表中<code>只有一条记录</code>并且该表使用的存储引擎的统计数据是精确的，比如 MyISAM、Memory，那么对该表的访问方法就是<code>system</code>。比方说我们新建一个<code>MyISAM</code>表，并为其插入一条记录：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t<span class="token punctuation">(</span>i <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">Engine</span><span class="token operator">=</span>MyISAM<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/explain_type_simple.1a06073b.webp" alt="explain_type_simple"></p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>把表改成使用 InnoDB 存储引擎，则执行计划的<code>type</code>列是 ALL</p></div> <ul><li><code>const</code></li></ul> <p>当我们根据主键或者唯一二级索引列与常数进行等值匹配时，对单表的访问方法就是<code>const</code>, 比如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">10005</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_type_const.58abfb80.webp" alt="image-explain_type_const"></p> <ul><li><code>eq_ref</code></li></ul> <p>在连接查询时，如果被驱动表是通过主键或者唯一二级索引列等值匹配的方式进行访问的（如果该主键或者唯一二级索引是联合索引的话，所有的索引列都必须进行等值比较）。则对该被驱动表的访问方法就是<code>eq_ref</code>，比方说：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>id <span class="token operator">=</span> s2<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_type_eqref.2136f64b.webp" alt="explain_type_eqref"></p> <p>从执行计划的结果中可以看出，MySQL 打算将 s2 作为驱动表，s1 作为被驱动表，重点关注 s1 的访问方法是 <code>eq_ref</code> ，表明在访问 s1 表的时候可以 <code>通过主键的等值匹配</code> 来进行访问。</p> <ul><li><code>ref</code></li></ul> <p>当通过普通的二级索引列与常量进行等值匹配时来查询某个表，那么对该表的访问方法就可能是<code>ref</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_type_ref.6ca3da2f.webp" alt="explain_type_ref"></p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>要求不存在隐式转换，存在隐式转换，索引失效，type 类型为 ALL</p></div> <ul><li><p><code>fulltext</code> 全文索引</p></li> <li><p><code>ref_or_null</code></p></li></ul> <p>当对普通二级索引进行等值匹配查询，该索引列的值也可以是<code>NULL</code>值时，那么对该表的访问方法就可能是<code>ref_or_null</code>，比如说：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">OR</span> key1 <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_type_refornull.ead859c7.webp" alt="explain_type_refornull"></p> <ul><li><code>index_merge</code></li></ul> <p>一般情况下对于某个表的查询只能使用到一个索引，但单表访问方法时在某些场景下可以使用<code>Interseation、union、Sort-Union</code>这三种索引合并的方式来执行查询。我们看一下执行计划中是怎么体现 MySQL 使用索引合并的方式来对某个表执行查询的：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_type_indexmerge.64e49e32.webp" alt="explain_type_indexmerge"></p> <p>从执行计划的<code>type</code>列的值是 <code>index_merge</code> 就可以看出，MySQL 打算使用索引合并的方式来执行对 s1 表的查询。</p> <ul><li><code>unique_subquery</code></li></ul> <p>类似于两表连接中被驱动表的<code>eq_ref</code>访问方法，<code>unique_subquery</code>是针对在一些包含<code>IN</code>子查询的查询语句中，如果查询优化器决定将<code>IN</code>子查询转换为<code>EXISTS</code>子查询，而且子查询可以使用到主键进行等值匹配的话，那么该子查询执行计划的<code>type</code>列的值就是<code>unique_subquery</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key2 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> s2 <span class="token keyword">where</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1<span class="token punctuation">)</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/explain_type_uniquesebquery.6d044ed0.webp" alt="explain_type_uniquesebquery"></p> <ul><li><code>index_subquery</code></li></ul> <p><code>index_subquery</code> 与 <code>unique_subquery</code> 类似，只不过访问子查询中的表时使用的是普通的索引，比如这样：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> common_field <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> key3 <span class="token keyword">FROM</span> s2 <span class="token keyword">where</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1<span class="token punctuation">)</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/explain_type_indexsebquery.4a9ff0c4.webp" alt="explain_type_indexsebquery"></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>存疑，这里的执行结果是 ref</p></div> <ul><li><code>range</code></li></ul> <p>如果使用索引获取某些范围区间的记录，那么就可能使用到 range 访问方法</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">'a'</span> <span class="token operator">AND</span> key1 <span class="token operator">&lt;</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/explain_type_range.1b6b3cdf.webp" alt="explain_type_range"></p> <ul><li><code>index</code></li></ul> <p>当我们可以使用索引覆盖，但需要扫描全部的索引记录时，该表的访问方法就是<code>index</code>，比如这样：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> key_part2 <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key_part3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_type_index.57e2188d.webp" alt="explain_type_index"></p> <p>上述查询中的所有列表中只有 key_part2 一个列，而且搜索条件中也只有 key_part3 一个列，这两个列又恰好包含在 idx_key_part 这个索引中，可是搜索条件 key_part3 不能直接使用该索引进行<code>ref</code>和<code>range</code>方式的访问，只能扫描整个<code>idx_key_part</code>索引的记录，所以查询计划的<code>type</code>列的值就是<code>index</code>。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>再一次强调，对于使用 InnoDB 存储引擎的表来说，二级索引的记录只包含索引列和主键列的值，而聚簇索引中包含用户定义的全部列以及一些隐藏列，所以扫描二级索引的代价比直接全表扫描，也就是扫描聚簇索引的代价更低一些。</p></div> <ul><li><code>ALL</code></li></ul> <p>全表扫描</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_type_all.16c97e33.webp" alt="explain_type_all"></p> <p>一般来说，这些访问方法中除了 All 这个访问方法外，其余的访问方法都能用到索引，除了 index_merge 访问方法外，其余的访问方法都最多只能用到一个索引。</p> <h4 id="_6-possible-keys-和-key"><a href="#_6-possible-keys-和-key" class="header-anchor">#</a> 6）possible_keys 和 key</h4> <p>在 EXPLAIN 语句输出的执行计划中，<code>possible_keys</code>列表示在某个查询语句中，对某个列执行<code>单表查询时可能用到的索引</code>有哪些。一般查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询使用。<code>key</code>列表示<code>实际用到的索引</code>有哪些，如果为 NULL，则没有使用索引。比方说下面这个查询：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">'z'</span> <span class="token operator">AND</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_key.de92cf45.webp" alt="explain_key"></p> <p>上述执行计划的<code>possible_keys</code>列的值是<code>idx_key1,idx_key3</code>，表示该查询可能使用到<code>idx_key1, idx_key3</code>两个索引，然后<code>key</code>列的值是<code>idx_key3</code>，表示经过查询优化器计算使用不同索引的成本后，最后决定采用<code>idx_key3</code>。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>key 并不一定是 possible_keys 的一个子集。有时候，<code>key</code>字段中显示的索引并不一定出现在<code>possible_keys</code>中。这通常是因为 MySQL 的优化器在特定情况下可能选择使用某些隐式索引或一些额外的索引优化策略，这些索引在<code>possible_keys</code>中未显示。</p></div> <h4 id="_7-key-len-重点"><a href="#_7-key-len-重点" class="header-anchor">#</a> 7）key_len（重点）</h4> <p>实际使用到的索引长度 （即：字节数）</p> <p>检查<code>是否充分的利用了索引</code>，<code>值越大越好（相对于自身）</code>，主要针对于联合索引，有一定的参考意义。</p> <p><strong>int 类型</strong></p> <p>如果 INT 列不允许 <code>NULL</code>，<code>key_len</code> 为 4</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">10005</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_key_len.e92bfa9c.webp" alt="explain_key_len"></p> <p>如果 <code>INT</code> 列允许 <code>NULL</code>，<code>key_len</code> 会增加 1 个字节，用于存储 <code>NULL</code> 标志，因此 <code>key_len</code> 为 5。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key2 <span class="token operator">=</span> <span class="token number">10126</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_key_len2.ec2105c8.webp" alt="explain_key_len2"></p> <p><strong>varchar 类型</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_key_len3.57b23044.webp" alt="explain_key_len2"></p> <p>key1 VARCHAR(100) 一个字符占 3 个字节，100*3，是否为 NULL 占用一个字节，varchar 的长度信息占两个字节。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key_part1 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">AND</span> key_part2 <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_key_len4.16a7befd.webp" alt="explain_key_len4"></p> <p><strong>key_len 的长度计算公式：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>varchar(10)变长字段且允许NULL = 10 * ( character set：utf8=3,gbk=2,latin1=1)+1(NULL)+2(变长字段) 

varchar(10)变长字段且不允许NULL = 10 * ( character set：utf8=3,gbk=2,latin1=1)+2(变长字段)

char(10)固定字段且允许NULL = 10 * ( character set：utf8=3,gbk=2,latin1=1)+1(NULL) 

char(10)固定字段且不允许NULL = 10 * ( character set：utf8=3,gbk=2,latin1=1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_8-ref"><a href="#_8-ref" class="header-anchor">#</a> 8）ref</h4> <p>当使用索引列等值查询时，与索引列进行等值匹配的对象信息。</p> <p>当使用索引列等值匹配的条件去执行查询时，也就是在访问方法是 <code>const 、 eq_ref 、 ref 、 ref_or_null 、 unique_subquery 、 index_subquery</code> 其中之一时， ref 列展示的就是与索引列作等值匹配的结构是什么，比如只是一个常数或者是某个列。</p> <ul><li><code>const</code> <strong>表示索引列与常量值进行匹配</strong></li></ul> <p>可以看到 ref 列的值是 const，表明在使用 idx_key1 索引执行查询时，与 key1 列作等值匹配的对象是一个常数</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_ref.42b60fc3.webp" alt="explain_ref"></p> <ul><li><code>column_name</code>：<strong>表示使用某个列的值与索引进行匹配。</strong></li></ul> <p>通常用于多表连接的情况下，表与表之间的连接条件会用到这个列。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>id <span class="token operator">=</span> s2<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_ref2.ed3c07b5.webp" alt="explain_ref"></p> <ul><li><code>func</code>：<strong>表示索引列与一个返回值为常量的函数进行匹配。</strong></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s2<span class="token punctuation">.</span>key1 <span class="token operator">=</span> UPPER<span class="token punctuation">(</span>s1<span class="token punctuation">.</span>key1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_ref3.403022f0.webp" alt="explain_ref"></p> <h4 id="_9-rows-重点"><a href="#_9-rows-重点" class="header-anchor">#</a> 9）rows（重点）</h4> <p>预估的需要读取的记录条数，条目数越小越好。这是因为值越小，加载 I/O 的页数就越少</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">'z'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_rows.73ebe284.webp" alt="explain_rows"></p> <h4 id="_10-filtered"><a href="#_10-filtered" class="header-anchor">#</a> 10）filtered</h4> <p>某个表经过搜索条件过滤后剩余记录条数的百分比</p> <p>如果进行单表扫描时使用了索引，那么在计算时需要估算出除了符合索引条件外，满足其他搜索条件的记录数量。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">'z'</span> <span class="token operator">AND</span> common_field <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_filtered1.f4cdadc6.webp" alt="explain_filtered1"></p> <p>对于单表查询来说，这个 filtered 的值没有什么意义，我们<code>更关注在连接查询中驱动表对应的执行计划记录的 filtered 值</code>，它决定了被驱动表要执行的次数 （即: rows * filtered）</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1 <span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>common_field <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_filtered2.bb692789.webp" alt="explain_filtered2"></p> <p>从执行计划中可以看出来，查询优化器打算把 s1 当作驱动表，s2 当作被驱动表。我们可以看到驱动表 s1 表的执行计划的 rows 列为 9895，filtered 列为 10.00，这意味着驱动表 s1 的扇出值就是 9895×10.00%=989.5，这说明还要对被驱动表执行大约 989 次查询。</p> <h4 id="_11-extra"><a href="#_11-extra" class="header-anchor">#</a> 11）Extra</h4> <p>Extra 列是用来说明一些额外信息的，包含不适合在其他列中显示但十分重要的额外信息。通过这些额外信息可以更准确的理解 MySQL 到底将如何执行给定的查询语句。MySQL 提供的额外信息有好几十个，仅介绍部分。</p> <ul><li><code>No tables used</code></li></ul> <p>当查询语句的没有 FROM 子句时将会提示该额外信息</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+----------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> Extra          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+----------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span> <span class="token keyword">No</span> <span class="token keyword">tables</span> used <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+----------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>Impossible WHERE</code></li></ul> <p>查询语句的<code>WHERE</code>子句永远为<code>FALSE</code>时将会提示该额外信息。即查询条件永远不可能满足，查不到数据。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>Using where</code></li></ul> <p>除了使用索引来过滤数据以外，还使用了其他过滤条件</p> <p><strong>情况一：没有使用索引，WHERE 子句中存在过滤条件</strong></p> <p>当使用全表扫描来执行对某个表的查询，并且该语句的<code>WHERE</code>子句中有针对该表的搜索条件时，在 Extra 列中会提示上述额外信息。比如下边这个查询：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> common_field <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_extra_usingwhere1.626f7057.webp" alt="explain_extra1"></p> <p><strong>情况二：使用了索引作为过滤条件，WHERE 子句中除了索引列，还存在其他过滤条件</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">AND</span> common_field <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当使用索引访问来执行对某个表的查询，并且该语句的 WHERE 子句中有除了该索引包含的列之外的其他搜索条件时，在 Extra 列中也会提示上述额外信息。</p> <p><img src="/assets/img/explain_extra_usingwhere2.2d58a3f4.webp" alt="explain_extra1"></p> <p><strong>如果只使用了索引作为过滤条件，则不存在额外信息</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_extra_usingwhere3.083b51f7.webp" alt="explain_extra1"></p> <ul><li><code>No matching min/max row</code></li></ul> <p>当查询列表处有<code>MIN</code>或者<code>MAX</code>聚合函数，但是并没有符合<code>WHERE</code>子句中的搜索条件的记录时。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'abcdefg'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_extra_nomatchingminmaxrow.060b162b.webp" alt="explain_extra_nomatchingminmaxrow"></p> <ul><li><code>Select tables optimized away</code></li></ul> <p>当查询列表处有<code>MIN</code>或者<code>MAX</code>聚合函数，存在符合<code>WHERE</code>子句中的搜索条件的记录时。</p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>存疑</p></div> <ul><li><code>Using index</code></li></ul> <p>当查询列表以及搜索条件中只包含属于某个索引的列，即使用覆盖索引的情况下</p> <p>覆盖索引，就是索引中覆盖了需要查询的所有字段，不需要再使用聚簇索引进行回表查找。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> key1<span class="token punctuation">,</span> id <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_extra_usingindex.613ab852.webp" alt="explain_extra"></p> <ul><li><code>Using index condition</code></li></ul> <p>MySQL 使用了<code>Index Condition Pushdown (ICP)</code> 技术，提前在索引层面上过滤数据行。</p> <p><strong>只出现在使用非主键索引的情况下，目的是减少回表的成本</strong>。即使用二级索引的时候，先筛选再回表。而不是回表后再筛选。要求过滤的列包含在二级索引中。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">'z'</span> <span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">'z'</span> <span class="token operator">AND</span> key1 <span class="token operator">LIKE</span> <span class="token string">'%a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/explain_extra_usingindexcondition.971e7c82.webp" alt="explain_extra"></p> <p>如果回表后，再进行筛选，则 extra 会出现<code>Using where</code>。即过滤条件的列，不在二级索引中。</p> <p>如果同时在索引层面以及回表之后都进行了数据过滤，则会 extra 会同时出现<code>Using index condition</code>和<code>Using where</code>。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">'z'</span> <span class="token operator">AND</span> common_field <span class="token operator">LIKE</span> <span class="token string">'%a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_extra_usingindexcondition2.5000fd74.webp" alt="explain_extra"></p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p><strong>Index Condition Pushdown (ICP)</strong> 是 MySQL 的一项查询优化技术，引入于 MySQL 5.6，用于提高通过索引查找数据的效率。ICP 允许 MySQL 在索引扫描的过程中，提前应用部分查询条件，从而减少不必要的行访问（即减少从存储引擎读取的行数），提高查询性能。</p> <p><strong>ICP 的工作原理：</strong></p> <p>在没有 ICP 的情况下，MySQL 在进行索引扫描时通常会读取索引并将匹配的行提取出来，然后再检查这些行是否符合查询的其他条件。这意味着即使有些行不符合查询条件，它们仍然会被读取，这增加了 I/O 开销。</p> <p>而在有 ICP 的情况下，MySQL 在读取索引时可以提前应用查询条件，即在索引层面就过滤掉不符合条件的行，从而减少需要从表中读取的行数。</p></div> <ul><li><code>Using join buffer (Block Nested Loop)</code></li></ul> <p>在连接查询执行过程中，当被驱动表不能有效的利用索引加快访问速度，MySQL 会使用缓存来提升性能。MySQL 一般会为其分配一块名叫<code>join buffer</code>的内存块来加快查询速度，也就是我们所讲的<code>基于块的嵌套循环算法</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>common_field <span class="token operator">=</span> s2<span class="token punctuation">.</span>common_field<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_extra_usingjoinbuffer.8358cf6a.webp" alt="explain_extra"></p> <ul><li><code>Not exists</code></li></ul> <p>当我们使用左外或者右外连接时，如果 WHERE 子句中包含要求被驱动表的某个列等于<code>NULL</code>值的搜索条件，而且那个列又是不允许存储<code>NULL</code>值的，那么在该表的执行计划的 Extra 列就会提示<code>Not exists</code>额外信息</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1 <span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/explain_extra_notexists.061f9dfd.webp" alt="explain_extra"></p> <ul><li><code>Using intersect(...) 、 Using union(...) 和 Using sort_union(...)</code></li></ul> <p>如果执行计划的<code>Extra</code>列出现以上内容，表示 MySQL 合并多个索引来执行查询，<code>Intersect</code>、<code>union</code>、<code>sort_union</code>是三种不同的索引合并方式。括号中的<code>...</code>表示需要进行索引合并的索引名称。</p> <ul><li><ul><li><code>Using intersect(...)</code>表示 MySQL 在查询执行时使用了多个索引的交集来满足查询条件。这意味着 MySQL 从多个索引扫描结果中取出公共部分（交集）以生成最终的结果集。通常用于查询条件是<code>AND</code>关系的情况</li></ul></li> <li><ul><li><code>Using union(...)</code>表示 MySQL 使用了多个索引扫描结果的并集来生成查询结果。MySQL 从多个索引的扫描结果中取出所有满足任一条件的记录，并将这些记录合并在一起。通常在查询条件之间是<code>OR</code>关系时使用</li></ul></li> <li><ul><li><code>Using sort_union(...)</code>表示 MySQL 在合并多个索引的扫描结果时，先对这些结果进行排序，然后再合并。与<code>Using union(...)</code>类似，它也用于处理多个索引的并集，但需要排序以确保正确的合并顺序。</li></ul></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span>  <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span>\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           id: <span class="token number">1</span>
  select_type: <span class="token keyword">SIMPLE</span>
        <span class="token keyword">table</span>: s1
   partitions: <span class="token boolean">NULL</span>
         <span class="token keyword">type</span>: index_merge
possible_keys: idx_key1<span class="token punctuation">,</span>idx_key3
          <span class="token keyword">key</span>: idx_key1<span class="token punctuation">,</span>idx_key3
      key_len: <span class="token number">303</span><span class="token punctuation">,</span><span class="token number">303</span>
          ref: <span class="token boolean">NULL</span>
         <span class="token keyword">rows</span>: <span class="token number">2</span>
     filtered: <span class="token number">100.00</span>
        Extra: <span class="token keyword">Using</span> <span class="token keyword">union</span><span class="token punctuation">(</span>idx_key1<span class="token punctuation">,</span>idx_key3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">OR</span> name <span class="token operator">=</span> <span class="token string">'Abel'</span>\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           id: <span class="token number">1</span>
  select_type: <span class="token keyword">SIMPLE</span>
        <span class="token keyword">table</span>: student
   partitions: <span class="token boolean">NULL</span>
         <span class="token keyword">type</span>: index_merge
possible_keys: idx_age_name_classid<span class="token punctuation">,</span>idx_name
          <span class="token keyword">key</span>: idx_age_name_classid<span class="token punctuation">,</span>idx_name
      key_len: <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">63</span>
          ref: <span class="token boolean">NULL</span>
         <span class="token keyword">rows</span>: <span class="token number">18867</span>
     filtered: <span class="token number">100.00</span>
        Extra: <span class="token keyword">Using</span> sort_union<span class="token punctuation">(</span>idx_age_name_classid<span class="token punctuation">,</span>idx_name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><code>Zero limit</code></li></ul> <p>当<code>LIMIT</code>子句的参数为 0 时，表示压根儿不打算从表中读出任何记录，将会提示该额外信息</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           id: <span class="token number">1</span>
  select_type: <span class="token keyword">SIMPLE</span>
        <span class="token keyword">table</span>: <span class="token boolean">NULL</span>
   partitions: <span class="token boolean">NULL</span>
         <span class="token keyword">type</span>: <span class="token boolean">NULL</span>
possible_keys: <span class="token boolean">NULL</span>
          <span class="token keyword">key</span>: <span class="token boolean">NULL</span>
      key_len: <span class="token boolean">NULL</span>
          ref: <span class="token boolean">NULL</span>
         <span class="token keyword">rows</span>: <span class="token boolean">NULL</span>
     filtered: <span class="token boolean">NULL</span>
        Extra: Zero <span class="token keyword">limit</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><code>Using filesort</code></li></ul> <p>有一些情况下对结果集中的记录进行排序是可以用到索引的。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> key1 <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>很多情况下排序操作无法使用到索引，只能在内存中（记录较少的时候）或者磁盘中（记录较多的时候）进行排序，MySQL 把这种在内存中或者磁盘上进行排序的方式统称为文件排序（英文名：<code>filesort</code>）。如果某个查询需要使用文件排序的方式执行查询，就会在执行计划的<code>Extra</code>列显示<code>Using filesort</code>提示。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> common_field <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           id: <span class="token number">1</span>
  select_type: <span class="token keyword">SIMPLE</span>
        <span class="token keyword">table</span>: s1
   partitions: <span class="token boolean">NULL</span>
         <span class="token keyword">type</span>: <span class="token keyword">ALL</span>
possible_keys: <span class="token boolean">NULL</span>
          <span class="token keyword">key</span>: <span class="token boolean">NULL</span>
      key_len: <span class="token boolean">NULL</span>
          ref: <span class="token boolean">NULL</span>
         <span class="token keyword">rows</span>: <span class="token number">9895</span>
     filtered: <span class="token number">100.00</span>
        Extra: <span class="token keyword">Using</span> filesort
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><code>Using temporary</code></li></ul> <p>在许多查询的执行过程中，MySQL 可能会借助临时表来完成一些功能，比如去重、排序之类的，比如我们在执行许多包含<code>DISTINCT</code>、<code>GROUP BY</code>、<code>UNION</code>等子句的查询过程中，如果不能有效利用索引来完成查询，MySQL 很有可能寻求通过建立内部的临时表来执行查询。如果查询中使用到了内部的临时表，在执行计划的<code>Extra</code>列将会显示<code>Using temporary</code>提示</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> common_field <span class="token keyword">FROM</span> s1<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           id: <span class="token number">1</span>
  select_type: <span class="token keyword">SIMPLE</span>
        <span class="token keyword">table</span>: s1
   partitions: <span class="token boolean">NULL</span>
         <span class="token keyword">type</span>: <span class="token keyword">ALL</span>
possible_keys: <span class="token boolean">NULL</span>
          <span class="token keyword">key</span>: <span class="token boolean">NULL</span>
      key_len: <span class="token boolean">NULL</span>
          ref: <span class="token boolean">NULL</span>
         <span class="token keyword">rows</span>: <span class="token number">9895</span>
     filtered: <span class="token number">100.00</span>
        Extra: <span class="token keyword">Using</span> <span class="token keyword">temporary</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> common_field<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> amount <span class="token keyword">FROM</span> s1 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> common_field\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           id: <span class="token number">1</span>
  select_type: <span class="token keyword">SIMPLE</span>
        <span class="token keyword">table</span>: s1
   partitions: <span class="token boolean">NULL</span>
         <span class="token keyword">type</span>: <span class="token keyword">ALL</span>
possible_keys: <span class="token boolean">NULL</span>
          <span class="token keyword">key</span>: <span class="token boolean">NULL</span>
      key_len: <span class="token boolean">NULL</span>
          ref: <span class="token boolean">NULL</span>
         <span class="token keyword">rows</span>: <span class="token number">9895</span>
     filtered: <span class="token number">100.00</span>
        Extra: <span class="token keyword">Using</span> <span class="token keyword">temporary</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>执行计划中出现<code>Using temporary</code>并不是一个好的征兆，因为建立与维护临时表要付出很大的成本的，所以我们<code>最好能使用索引来替代掉使用临时表</code>，比方说下边这个包含<code>GROUP BY</code>子句的查询就不需要使用临时表：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> key1<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> amount <span class="token keyword">FROM</span> s1 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> key1<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_12-小结"><a href="#_12-小结" class="header-anchor">#</a> 12）小结</h4> <ul><li>EXPLAIN 不考虑各种 Cache</li> <li>EXPLAIN 不能显示 MySQL 在执行查询时所作的优化工作</li> <li>EXPLAIN 不会告诉你关于触发器、存储过程的信息或用户自定义函数对查询的影响情况</li> <li>部分统计信息是估算的，并非精确值</li></ul> <h2 id="_7-explain-的进一步使用"><a href="#_7-explain-的进一步使用" class="header-anchor">#</a> 7. EXPLAIN 的进一步使用</h2> <h3 id="_7-1-explain-四种输出格式"><a href="#_7-1-explain-四种输出格式" class="header-anchor">#</a> 7.1 EXPLAIN 四种输出格式</h3> <p>EXPLAIN 可以输出四种格式：<code>传统格式</code>，<code>JSON格式</code>，<code>TREE格式</code>以及<code>可视化输出</code>。用户可以根据需要选择适用于自己的格式。</p> <h4 id="_1-传统格式"><a href="#_1-传统格式" class="header-anchor">#</a> 1）传统格式</h4> <p>传统格式简单明了，输出是一个表格形式，概要说明查询计划。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span>key1<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>key1 <span class="token keyword">FROM</span> s1 
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span>s2<span class="token punctuation">.</span>key1 
<span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>common_field <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-json-格式"><a href="#_2-json-格式" class="header-anchor">#</a> 2）JSON 格式</h4> <p>第 1 种格式中介绍的<code>EXPLAIN</code>语句输出中缺少了一个衡量执行好坏的重要属性 —— <code>成本</code>。而 JSON 格式是四种格式里面输出<code>信息最详尽</code>的格式，里面包含了执行的成本信息。</p> <ul><li>JSON 格式：在 EXPLAIN 单词和真正的查询语句中间加上<code>FORMAT=JSON</code>。主要关注执行成本<code>cost_info</code></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> FORMAT <span class="token operator">=</span> JSON <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>传统格式与 json 格式的各个字段存在如下表所示的对应关系（mysql5.7 官方文档）。</li></ul> <table><thead><tr><th style="text-align:left;">Column</th> <th style="text-align:left;">JSON Name</th> <th style="text-align:left;">Meaning</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>id</strong></td> <td style="text-align:left;">select_id</td> <td style="text-align:left;">The SELECT identifier</td></tr> <tr><td style="text-align:left;">select_type</td> <td style="text-align:left;">None</td> <td style="text-align:left;">The SELECT type</td></tr> <tr><td style="text-align:left;">table</td> <td style="text-align:left;">table_name</td> <td style="text-align:left;">The table for the output row</td></tr> <tr><td style="text-align:left;">partitions</td> <td style="text-align:left;">partitions</td> <td style="text-align:left;">The matching partitions</td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">access_type</td> <td style="text-align:left;">The join type</td></tr> <tr><td style="text-align:left;">possible_keys</td> <td style="text-align:left;">possible_keys</td> <td style="text-align:left;">The possible indexes to choose</td></tr> <tr><td style="text-align:left;">key</td> <td style="text-align:left;">key</td> <td style="text-align:left;">The index actually chosen</td></tr> <tr><td style="text-align:left;"><strong>key_len</strong></td> <td style="text-align:left;">key_length</td> <td style="text-align:left;">The length of the chosen key</td></tr> <tr><td style="text-align:left;">ref</td> <td style="text-align:left;">ref</td> <td style="text-align:left;">The columns compared to the index</td></tr> <tr><td style="text-align:left;">rows</td> <td style="text-align:left;">rows</td> <td style="text-align:left;">Estimate of rows to be examined</td></tr> <tr><td style="text-align:left;">filtered</td> <td style="text-align:left;">filtered</td> <td style="text-align:left;">Percentage of rows filtered by table condition</td></tr> <tr><td style="text-align:left;"><strong>Extra</strong></td> <td style="text-align:left;">None</td> <td style="text-align:left;">Additional information</td></tr></tbody></table> <p>这样我们就可以得到一个 json 格式的执行计划，里面包含该计划花费的成本。比如这样：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> FORMAT<span class="token operator">=</span>JSON
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span>s2<span class="token punctuation">.</span>key2 <span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>common_field <span class="token operator">=</span><span class="token string">'a'</span>\G<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token keyword">EXPLAIN</span>: {
  <span class="token string">&quot;query_block&quot;</span>: {
    <span class="token string">&quot;select_id&quot;</span>: <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># 整个查询语句只有1个SELECT关键字，该关键字对应的id号为1</span>
    <span class="token string">&quot;cost_info&quot;</span>: {
      <span class="token string">&quot;query_cost&quot;</span>: <span class="token string">&quot;2160.13&quot;</span> <span class="token comment"># 整个查询的执行成本预计为2160.13</span>
    }<span class="token punctuation">,</span>
    <span class="token string">&quot;nested_loop&quot;</span>: <span class="token punctuation">[</span> <span class="token comment"># 几个表之间采用嵌套循环连接算法执行</span>
	  <span class="token comment"># 以下是参与嵌套循环连接算法的各个表的信息</span>
      {
        <span class="token string">&quot;table&quot;</span>: {
          <span class="token string">&quot;table_name&quot;</span>: <span class="token string">&quot;s1&quot;</span><span class="token punctuation">,</span> <span class="token comment"># s1表是驱动表</span>
          <span class="token string">&quot;access_type&quot;</span>: <span class="token string">&quot;ALL&quot;</span><span class="token punctuation">,</span> <span class="token comment"># 访问方法为ALL，意味着使用全表扫描访问</span>
          <span class="token string">&quot;possible_keys&quot;</span>: <span class="token punctuation">[</span> <span class="token comment"># 可能使用的索引</span>
            <span class="token string">&quot;idx_key1&quot;</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">&quot;rows_examined_per_scan&quot;</span>: <span class="token number">9895</span><span class="token punctuation">,</span>  <span class="token comment">#查询一次s1表大致需要扫描9895条记录</span>
          <span class="token string">&quot;rows_produced_per_join&quot;</span>: <span class="token number">989</span><span class="token punctuation">,</span> <span class="token comment">#驱动表s1的扇出是989</span>
          <span class="token string">&quot;filtered&quot;</span>: <span class="token string">&quot;10.00&quot;</span><span class="token punctuation">,</span> <span class="token comment">#condition filtering代表的百分比</span>
          <span class="token string">&quot;cost_info&quot;</span>: {
            <span class="token string">&quot;read_cost&quot;</span>: <span class="token string">&quot;972.73&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;eval_cost&quot;</span>: <span class="token string">&quot;98.95&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;prefix_cost&quot;</span>: <span class="token string">&quot;1071.68&quot;</span><span class="token punctuation">,</span> <span class="token comment">#单次查询s1表总共的成本</span>
            <span class="token string">&quot;data_read_per_join&quot;</span>: <span class="token string">&quot;1M&quot;</span> <span class="token comment">#读取的数据量</span>
          }<span class="token punctuation">,</span>
          <span class="token string">&quot;used_columns&quot;</span>: <span class="token punctuation">[</span> <span class="token comment">#执行查询中涉及到的列</span>
            <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key3&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key_part1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key_part2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key_part3&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;common_field&quot;</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token comment">#对s1表访问时针对单表查询的条件</span>
          <span class="token string">&quot;attached_condition&quot;</span>: <span class="token string">&quot;((`dbtest_explain`.`s1`.`common_field` = 'a') and (`dbtest_explain`.`s1`.`key1` is not null))&quot;</span>
        }
      }<span class="token punctuation">,</span>
      {
        <span class="token string">&quot;table&quot;</span>: {
          <span class="token string">&quot;table_name&quot;</span>: <span class="token string">&quot;s2&quot;</span><span class="token punctuation">,</span> <span class="token comment">#s2表是被驱动表</span>
          <span class="token string">&quot;access_type&quot;</span>: <span class="token string">&quot;eq_ref&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;possible_keys&quot;</span>: <span class="token punctuation">[</span> <span class="token comment">#可能使用的索引</span>
            <span class="token string">&quot;idx_key2&quot;</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">&quot;key&quot;</span>: <span class="token string">&quot;idx_key2&quot;</span><span class="token punctuation">,</span> <span class="token comment">#实际使用的索引</span>
          <span class="token string">&quot;used_key_parts&quot;</span>: <span class="token punctuation">[</span> <span class="token comment">#用到的索引列</span>
            <span class="token string">&quot;key2&quot;</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">&quot;key_length&quot;</span>: <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token comment">#key_len</span>
          <span class="token string">&quot;ref&quot;</span>: <span class="token punctuation">[</span> <span class="token comment">#与key2列进行等值匹配的对象</span>
            <span class="token string">&quot;dbtest_explain.s1.key1&quot;</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">&quot;rows_examined_per_scan&quot;</span>: <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">#查询一次s2表大致需要扫描1条记录</span>
          <span class="token string">&quot;rows_produced_per_join&quot;</span>: <span class="token number">989</span><span class="token punctuation">,</span>
          <span class="token string">&quot;filtered&quot;</span>: <span class="token string">&quot;100.00&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;index_condition&quot;</span>: <span class="token string">&quot;(cast(`dbtest_explain`.`s1`.`key1` as double) = cast(`dbtest_explain`.`s2`.`key2` as double))&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;cost_info&quot;</span>: {
            <span class="token string">&quot;read_cost&quot;</span>: <span class="token string">&quot;989.50&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;eval_cost&quot;</span>: <span class="token string">&quot;98.95&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;prefix_cost&quot;</span>: <span class="token string">&quot;2160.13&quot;</span><span class="token punctuation">,</span> <span class="token comment">#单次查询s1、多次查询s2表息共的成本</span>
            <span class="token string">&quot;data_read_per_join&quot;</span>: <span class="token string">&quot;1M&quot;</span>
          }<span class="token punctuation">,</span>
          <span class="token string">&quot;used_columns&quot;</span>: <span class="token punctuation">[</span>
            <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key3&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key_part1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key_part2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key_part3&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;common_field&quot;</span>
          <span class="token punctuation">]</span>
        }
      }
    <span class="token punctuation">]</span>
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p><strong><code>&quot;cost_info&quot;</code> 成本计算</strong></p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>// s1 表的 &quot;cost_info&quot; 部分
&quot;cost_info&quot;: {
    &quot;read_cost&quot;: &quot;972.73&quot;,
    &quot;eval_cost&quot;: &quot;98.95&quot;,
    &quot;prefix_cost&quot;: &quot;1071.68&quot;, 
    &quot;data_read_per_join&quot;: &quot;1M&quot; 
},
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>read_cost</code> 是由下边这两部分组成的：
<ul><li>IO 成本</li> <li>检测 <code>rows × (1 - filter)</code> 条记录的 CPU 成本</li></ul></li> <li><code>eval_cost</code> ： 检测 <code>rows × filter</code> 条记录的成本。 <strong>一般值为 0.1 × rows × filter</strong></li> <li><code>prefix_cost</code> 就是单独查询 s1 表的成本，也就是： <code>read_cost + eval_cost</code></li> <li><code>data_read_per_join</code> 表示在此次查询中需要读取的数据量。</li></ul> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>rows 和 filter 都是我们前边介绍执行计划的输出列</p> <p>在 JSON 格式的执行计划中，rows 相当于 rows_examined_per_scan，filtered 名称不变。</p></div> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#  s2 表的 &quot;cost_info&quot; 部分</span>
<span class="token string">&quot;cost_info&quot;</span>: {
    <span class="token string">&quot;read_cost&quot;</span>: <span class="token string">&quot;989.50&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;eval_cost&quot;</span>: <span class="token string">&quot;98.95&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;prefix_cost&quot;</span>: <span class="token string">&quot;2160.13&quot;</span><span class="token punctuation">,</span> <span class="token comment">#单次查询s1、多次查询s2表息共的成本</span>
    <span class="token string">&quot;data_read_per_join&quot;</span>: <span class="token string">&quot;1M&quot;</span>
}<span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>由于 s2 表是被驱动表，所以可能被读取多次，这里的<code>read_cost</code>和<code>eval_cost</code>是访问多次 s2 表后累加起来的值，这里的<code>prefix_cost</code>的值代表的是整个连接查询预计的成本，也就是单次查询 s1 表和多次查询 s2 表后的成本的和，也就是：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1071.68 + 989.50 + 98.95 = 2160.13
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3-tree-格式"><a href="#_3-tree-格式" class="header-anchor">#</a> 3）TREE 格式</h4> <p>TREE 格式是 8.0.16 版本之后引入的新格式，主要根据查询的<code>各个部分之间的关系</code>和<code>各部分的执行顺序</code>来描述如何查询。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> FORMAT<span class="token operator">=</span>tree 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span>s2<span class="token punctuation">.</span>key2 <span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>common_field <span class="token operator">=</span> <span class="token string">'a'</span>\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token keyword">EXPLAIN</span>: <span class="token operator">-</span><span class="token operator">&gt;</span> Nested <span class="token keyword">loop</span> <span class="token keyword">inner</span> <span class="token keyword">join</span>  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">2160.13</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">990</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> Filter: <span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>common_field <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>s1<span class="token punctuation">.</span>key1 <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">1071.68</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">990</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">Table</span> scan <span class="token keyword">on</span> s1  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">1071.68</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">9895</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> Single<span class="token operator">-</span><span class="token keyword">row</span> <span class="token keyword">index</span> lookup <span class="token keyword">on</span> s2 <span class="token keyword">using</span> idx_key2 <span class="token punctuation">(</span>key2<span class="token operator">=</span>s1<span class="token punctuation">.</span>key1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">with</span> <span class="token keyword">index</span> condition: <span class="token punctuation">(</span>cast<span class="token punctuation">(</span>s1<span class="token punctuation">.</span>key1 <span class="token keyword">as</span> <span class="token keyword">double</span><span class="token punctuation">)</span> <span class="token operator">=</span> cast<span class="token punctuation">(</span>s2<span class="token punctuation">.</span>key2 <span class="token keyword">as</span> <span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">1.00</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_4-可视化输出"><a href="#_4-可视化输出" class="header-anchor">#</a> 4）可视化输出</h4> <p>可视化输出，可以通过 MySQL Workbench 可视化查看 MySQL 的执行计划。通过点击 Workbench 的放大镜图标，即可生成可视化的查询计划。</p> <p><img src="/assets/img/workbench_executingplan.8544df39.webp" alt="workbench_executingplan"></p> <p><img src="data:image/webp;base64,UklGRpwVAABXRUJQVlA4IJAVAAAwaQCdASpNAVMBPpFGnkulo6Kho/F5aLASCWVu4XPUImFdu56mufkmEnI03A3YUHfoD/4Ppi9CPnaf+f+4/uX/tnTW/9L2Hv8V/zvYQ/cD1sP/h7IX+c6QD/3+oB/9utn6Zf1r8YO/n+q/lV58+Bfy37lciHpbzK/kf25/Ff3H28/pf+Q/p3iT8Lv5n1Avxr+P/4zvRu4+rv/dfUC9O/mv+e/wX5X+fB/Jf1z1F+nn/G9wD+S/zD/aer/918GHyT2Av5T/aP+B/iv8F+6P0sfx//H/yH+T/an2j/mP+B/5X+L+AX+Uf1P/gf4j8rPmT9e37g///3Sf2I/6o2tl0V5jD27l6S+WVFeYw8b3xMcJ2bw9Hpqwx39fiPbuXpL5ZJ1M2+zsCCimEEKheUyYNQj8Bxrt3CsAMQWqruj1sMb0l8sqK8YG4tioN5HOpPxBp6VeK7On0sLdaDpIXW933X3EcQI0w9u5eHAuyYXN4yytlCgZcvvL5FQPAjTD27mBF34u9A6KqJXikwHbazWB+fLKivMYe0IOehdSzGMEamPiW8HlJhqJE+iGd7K0kjuX45WwI7VfSyorzGHt366rwieI8JNR96dhsljq8xh46NzW1/SKLgtxbDKTbfuzHK0zLS/UaqFthpuptQKDtZbREsh1sDus3L0l44TRXl9eLawdmd+WgShFeMmxQJbuNhzZIZekvHCaK8xZSCHsG9DsZoWmt9u5ejFUsqK8vr00JKF9GXpL5XG0EaYe1JgvMYT7za7M1vF/rEPcBufw9ZMqz3rbjlv+qcwp9NC4t+mxgP3jG3DRHe74aWu0+mi+C5Cfu18xxpZw1cYybw6hdAZqnn1jwcm6MjPWP4fK3YCpK7wg92qENpbc+dI+FU4PCA2DXUbmQc2uSf5J0h+d2AOQI83AaR3FDxIYk80sNzjM9zrlLijGkKbYex6AwjceBOWH4xQtuHBU11hnURbRzl3TFQ6l3v9mL7ZEf5A+8OlZ7PV8BWUJOQaTiuL/txzv5Ew1umPu5xpiwGwOypdGjWDyyorzGHtzlFDDQDTShbp4Y/gqQli8HmZpjAGMPbuXpL5dQmnsFMQeBGmHt3L0l8sqK8xh7dy9JfLKivMYe3cvSXyyorQAAP7/S8AAdOVuuI9eWXgE0lm59xM7wlDJ3/SpN77ibDfhhucOUagoiebwFfvMjFwZIf3P1SDnPiDFK0cWl19W5nrytW9T8OQXbvYwzV8GSo4/H6XBKw5ik3e54jb+cATx/tEZUm3khMc54kVwZSM8LWL2OgE6rJe2CgdB49AnrJpOW/2c/IbTvbZOioc4/s/XVPq/bGMXvw2y8jn1nxScMCw1Be8owxp6H89/roayrqlsEM7YWs7DqGbVT8kAZguV43bvPNH2uEKCSkqC8KJRz3ph0/lxVq+fManDX/LX22P2jDq1xdjLvmUIOobd9MyATfHAUikZu/eoGVPwZRIyFfmDcUUXxg1sHM0BuNIfZYTylUu+etQkhmZ4jhnB9stmdwz4NorAwBB4SaZT58xRSJufYhHfnhzA09epAxy5fPjSw8ZgiPkJMvjizuvCg9HWwZUrEn59aW1eRwEQPuTzQ+7x6GYh5OFx9foectykHgWGgF0FHZmksuQW+NOLsyIWUAoU9hB0FMMYACnQXGcbu/xe9LYRuI1KIafHsGz2BYC0lQKnsyvaUjWvGdUZOhWJ1aFh3Hc3h+5iZzuGV49F84tLLOqBgnYGUc1Hzd9jmnmkreUeKLA1s6NivNmd49TxPWsxuFCQxTP2GCwwrvOeBwWZmFNI+XqhLfJ0C8AycgQAffnU3lo4OP4gxU6LZSwVURjlKOZMjIf7QrPoDPvxgpde8WMeC3LCCa27Sc89Bkmvf1o7IQG9gsbkD2iRsHPs2PK4u8pvGILQKyE0x7+x0hZiIicuB2jU5nwF0n5xEVDsTCJHbXUk8FaP1n1w3IPc8nXm2fmNYnLFyznikOSLs/WvFtje+pNghDQ3tEVXLK8R9Ey9cys1+K6MatH8UB89OVeiBFg5HxeUICsC+DWiAbGec0jkQKdANsQykNymSkrZmIVwHvr020xS7IpgfKnLZ+kyRkDWNGZZSao6sr7yeJmlZfCr3aEaHsyC0yK3Oq+ZSQ5nx1XxNeNloeqVDAenGFncRQ6Q15wkAQUX6WAHMhpC0dsyoEflxE+yuGZL3lb4My9HVBy3Slowapg6aXrj3778PfYitxCz9ngTxG9mlpUbQTuhdlNLSexKbuKytJ3znY455ioUgzduCsS87vG57z6PXO8xyWtYPgiXqmtYgNeZcFFvPjJre9gjYsETaefo7PFGSxg/2ZT4zUfHypTaI+xVlvdPjgloqId2ikjsmUAY3bG5a0vRin8EowBgbo0Ue1scHD/AAO2/01V7r8NMvneqX399OrNAXxBWACK1rOyh0fZAA3/UeB+Nibjonxz0bL7Jk8uWlZ5W1m5L0apPmQTTXtbYJ9ZcOdRVCFYqwecqaeCOBQmZuvsgBHZkCwOxmGJMEwI5nKXUw0tFAcTU19BKsvOmiMJDaenP/hRcimp4kho14dQ+3XnADVoGhX/NYCsePBYqalh/bNsrs5A9MNoVWCEWabwAcrAXQJ11Ajpkurs0SON0fvHcLGlD9L6E5+ndF4w9n+F1I1xAlgKaiPte3VVNVI8WemEh1jc8J8Una8nR+sTrlbfWquNlniK9R066AGyzOq4NijlPFe+50k+jnuLL/5flIEJGYhoQr86iCvTWNxyEVVd98QuwuQfhxtLWW2w+SmLUADaOhSwQjm/a9L9d4kA9ghS3G7Gl2NdCckyjH3WidVWt4IRy5pnoJg+ruavzLs4wxgPptlQcT3R0tk08Nkkkg1bhvxEcdxPdqhAEu42+K2C6kEIa7EBNQBO5b6GCltas4DZ6qs/2cAiTUsRg8myhwMnkrXBdKLeUs/xUfeRhPlPsqq+pmcNbIqKwlyYAL6tMd2W6R708yJC15bUUUIGs66cbz4VImFmNqIz97t7Pp1jN7nw9qLoygtwO08NUmdVO8zUqiXSXOb9RLWVsCCAs5pJfpzEvf1j7kqphpIlFQftd6z9wKK62cpKwiclD2GeYtBfAFKGaqdYQUY8h2/lL85O42KK2Q/KTe+DJkEClnIotZ8gTYFafsmV1qkG0CXcglHXk0/O8JxFdugXqOqQHIFWaRGocPay1DSbTupdgxFWZA01W/IiLju+lQ+cGE8H4QrNZmpqNRhDk2eS2TgrmMKRfg5TeI+AXDA5qdLx2OAQGNLZySB/vZIvwFou75FWmeQlFe8McZJiaoxqKVHtPzCPlwa2CH2JHpfz53QEq2wSsrcglzLHyvxddxSMGqoi5Ojydi8IfP6LhD6OVKuqSGg6jlhpwlPcxaaiAF4A2S0xLbshOlRxrbhx5HQNI7f9cOYXbyYdtUdaqieOHwtSXF88T43q4qhIqjftuayz8SMyGl/6004BiP5kTm2wVqjz7JFRnPDYg/J/KwW0jofsDh2skuhHlILFR2uslq6AaKGQ4DHu5cn/eLoaBjqBuBhcD8EVSKubWtL407WP0aNUd4bIPg0fmjtSJ8M+lxTMeIw4BfX1NGn0+Fut/I4u0boJMCtNKrQxJsX22h68Vb6mpPmNCs2StKW6R4QXOHfpaa1ktBAUVxorxiYRuIPFAgWEwmJDkeiP+rmnXMOoLgJO8o42TaxfNzoa3VwFmQtwwAhMhgUPSiuTtSQWNmVqk99K6LDylRzVcg0Rc3l0hKvdOvTDXffPaZqMpZxI08xSSBBSJMCEOGGWppkEMMbClrSHwM6YGVsHNIArA1Gmthlxe3cksJMLjLrY8pvjPHs+YpNak7Rq4abWRqoxyLNPfwUX8ZWM8Nu9WWfVC1e0LQwJybzK+juJ3M4TNpwbuXYUpnvH6UaldGEKxByMPVdRdk4WapDDGeK5vkBxZqkHbODwB12EtokL0uGmPLT0z3WCSlYKuOyAAObk3I4Q46+7MI0pjUy0TeeGkDj0pjY9eAeEBDZeYgY7qj94Yxboi85e1+HmcQg8qPcxgUCQa5bM5AF0clxh/umbwP/4BUx62JJYDWzWTO3x1sNybdTvTMZhm0s6k2AAOIQ7g+O56fM3mPAOLi/9nuciyaiK3TQu1/xbYR8LnpWZDfEG1qOptd1Llhez5VgC66TQGxMC27ZGrHcv7FtqKl87xW8E/8aiyBmj/f/6ILZVGz0HzQ6qFqCVVA1uzYsMv2RdlJA68qC1SEJv0340cNAUp4XrvBgmJQsu6NCnAk9pFdczasmtRdLvZY0JsLlpeXf9G/Cue5lhUd+D3nkGWyPsH+3eylkNvk53jc/zkgbiVACzZkHHII8Bo5fhTVPiLxLRGaph33odz4YJ73GLleYRx/OGu5A1mDznBLUy/wm+i1GQ+Uo+Kwjnh4Uk+EdFpEUhLLdKh2UcbTApjnALjLJ4CluCr7yTUMC5f9DdTNjYgXCzeZodu/aoI3q9uqJ3zBvWH+u05ax4XVUkkgIDKVpO7oQVV43qs2jUCi8IH13nu5qyER5cuaz4AqS4tNzo/30lqpTmczt7B/pvmW6id6NibXNMRJ4LRt+o9A250cBJV8/Q5adH38Yqd7XitSeFP5h8+GxPzbrlfyNCFbTgmKYDTWbkoqQWqwM1ZeCd50M8E6FcYG95JwOCu5pMoxhyZZJ3swPQ2ikcaJoXFPk8YB5Z9VpZqQk0nnbiD40EYeL2iEHy0p/a3mxkikmeDTFIiJhijYiOkwGnjB8h9//wgs/CyiqDyoazYGvvEbkP1qaJ6qXSKpRfzRc7w+0jIMMdAmBLoNo8VN3Kxw67v5rARlrCRPDcUTr6SQ2yiJWhjFXSG/fl1y50ELe8UwxNp46SrKkUJUDBXut1esWh2fG14j8XwzYDLvtta0324XSmK0H8DEPMovhmbIMESAEuWwS94DUqUiifPmvebcUuTZET9LnNxoTPN1/1AEYHwOBE4g782/4RbS0hI6nE7OVVmONV3dURFSXCVv5ynCwsxnndNmvJtz5PmhotSxHvbuzWuZbfDnJDWexJlmdRbUAt13yt9ZkKchpYH63riSKEIqwSDOSWv5dt5N2OR7on49KZ7AeqSL4fyB6SElKC6DVZhGO6FW6dron4tyjSBv1ZMt8Vddrm1RkYLJfyzfnc3EawiBxQZSYYyV+uiAxNr0UikFgB2Y4zpNKVrb1BPUWvVrsBz8YRQwV95Iu4dYNm+4kafnMZ8zfc1J/zHX+4lDgdQZv/g5hlDxEW/54Ia42iKhdSWZ4N+lOWbstyhJktOSBcfcc7F4bOZNOfuuMdDeWPH2J5dDlG4hYP8a5qMa53sqlE11qD5FurPSBSiuSWhmPKJ/whs8RIQX0tPPW8Nv8rTsAvxxXFIdN9Qb9kXf3U8Ia363WjxlOe0rAHchr6MrOxQ3n8dg+N/VcDmFYsoDs3zZ9EZV5cWbzM3nK3vzG6gpmrI4hI7Mp/6OtM2LGiVHe8IwPigr0rbyPbrpH2Dh2f+OfvVo5VBmAZ8HeviMZt2qBipG/clPLfBoEdMu0e3fiYUdwhY74Mc0iSTNTEXftKaOlZ+gFYytblw7b/WtgUuFHlnZn37LHYiPDkBaXBCldFt3qu4/pYYiTR97PtRUm857q2fkONqs94tQ7BRD2mKbr/oEm+Flsrwnhprk47QI9HLrMHlzB4TEzB63R4tnLRXYmy0fn3gw9Ni/KUngWoEmGRoxxz0KYBydce8T7HygL32OAbxITUjMoQVYuC9lS4gfR3NM758rh1agBBHCTtUnfdBIDnwJ13NqLtVVY8Kjid1gORNesFW40FZqtm2SzsR4NTn5V3PjV1IEefUPSraXr3J01fAoZ3FhLDXb0slLmTawAkby+CdRfZtO+v1r1ndKLvzlhDcUfMsAqKeTOgEuZnhPIX3/7NtRsCvlH5x/e9oemu2vyzq/FNed9X9po92zz7YUgIiM139q3XJc8Y2av9ibHyHAkoAwjHixpbZ9RvmB09k8gyHsm6bPXk54HqvC4i82fK3aJCUF4Zuz5iADNx2Wv/cJKhp+a+Lm1U2SsBbkzPU/cX5Jz0143EG/e7+9uHUKUWjjgsvco9dRiqKPsN0eFtXrimgl+3xLqlfndiqqCxOlxjpYD534Gkfke+oovvtCjqI5F8l6EASD9uuNHjRvW6G9XLsgP8MiX9Fbzofy0IBUvmqwSnZQFbjFQDE+bEGtCGIROVZVdZcscab37L+wIBR9pXuuvq2wP5A6zHvStocGa92Xtwx4C/zxJnw4Zd5kEnvF/GKnYWoZ1HwuEAAkUCsGuoirIbmHdndXd5z3bNm2cLV79ealfyIuVo/fTXwlnc/tO7qNZAA++tn1ClEUj1xf/6avC4n0dzf5eS/1KjmEmp8M5FEdt/qSsyFau5hYgXDs5B+RY6AXXLNG0HB/+5gft+Th8j50z0zZfGYYGLgCqvdhVLD34ih0lCo4XL5vFcEabyfjYpWlvj2oI/t/C1yHtfch+m6F1QOZq1lvZPCbXKFEipDQcFIR659BY6mz74tidplvC80mX/OjnvawRt7HluHnh6yHlZr2imcfr9HYzD9+P18j8gY7AlzJvT9sY+i1/ADbkeznWKc2j8mrwuqVP/gDW3rpx75ewiw1hxAb+SqR6Z1ZhsWCP0tz7da3ktE4MOlhUctg57z6Ivzya4iaUpfvBa8byfe/HHjQNpH8x1qVkHGpSgtAbyaOTzf6kaBO3ZMzfr1LzFjmmJMoY3+cids0oLUtHNSbhoA0QPoV6VuDrElGts3WLSkkh6Zv46J0wgvHddeRrnd7F8pMrJhhwpwXjI5J+q4I+ytAA4wHpkMIfDpD5faAl6u3i8saMozak3xYja5th8/GEC33b98AUJoBmgLkrYz2tHNgsELf93RERr5qa92zV9lfRob/HBMlZ3Agbkyvz9G7oF8eMuDatYL1yIgdwyH8T0DWwTjw/4j8Dl+uoWcRXxlirXn6ofi7tjxgrO2vQmGKMzyCyFLt3ai6ry4cDARqdPhnIC5IIkoLJdqefmlLWN2AaqEgbFpc3iKCij+GVsACOQcth7usn8mV77bGrjHXxi/EBDXvuJw1EAkE6kjHP/DHT1acFWEwFrc5liwFuy9ofpDnf1PN9R0QLD92cWD5tgw57/q6fkmgPguP7WUMItqo1vh48Rcnk8cdZ1WRmeAXH8izX7bbsOKPaS3vnIxaDDq7372m3ccCg8ohNqW7cBgQftRLAc6XgSPfQMJvF3zRd8pUSco524LbuxCnjJLKApy+X7PQHLab9QdubExR4YSYXFL9Rn5cEfU3uWjO4z7zhJsHUUyKln2oAAAAAAAAAAAAAA=" alt="workbench_executingplan2"></p> <p>上图按从左到右的连接顺序显示表。红色框表示<code>全表扫描</code>，而绿色框表示使用<code>索引查找</code>。对于每个表，显示使用的索引。还要注意的是，每个表格的框上方是每个表访问所发现的行数的估计值以及访问该表的成本。</p> <h3 id="_7-2-show-warnings-的使用"><a href="#_7-2-show-warnings-的使用" class="header-anchor">#</a> 7.2 SHOW WARNINGS 的使用</h3> <p>使用<code>EXPLAIN</code>语句查看了某个查询的执行计划后，紧接着还可以使用<code>SHOW WARNINGS</code>语句查看与这个查询的执行计划有关的一些扩展信息，比如这样：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span>key1<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>key1 <span class="token keyword">FROM</span> s1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1 <span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>common_field <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/show_warnings.7fb70976.webp" alt="show_warnings"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">WARNINGS</span>\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
  <span class="token keyword">Level</span>: Note
   Code: <span class="token number">1003</span>
Message: <span class="token comment">/* select#1 */</span> <span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>dbtest_explain<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>s1<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>key1<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>key1<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>dbtest_explain<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>s2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>key1<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>key1<span class="token punctuation">`</span></span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">`</span>dbtest_explain<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>s1<span class="token punctuation">`</span></span> <span class="token keyword">join</span> <span class="token identifier"><span class="token punctuation">`</span>dbtest_explain<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>s2<span class="token punctuation">`</span></span> <span class="token keyword">where</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>dbtest_explain<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>s1<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>key1<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>dbtest_explain<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>s2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>key1<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>dbtest_explain<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>s2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>common_field<span class="token punctuation">`</span></span> <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>大家可以看到<code>SHOW WARNINGS</code>展示出来的信息有三个字段，分别是<code>Level、Code、Message</code>。我们最常见的就是 Code 为 1003 的信息，当 Code 值为 1003 时，<code>Message</code>字段展示的信息类似于查询优化器将我们的查询语句重写后的语句。比如我们上边的查询本来是一个左（外）连接查询，但是有一个 s2.common_field IS NOT NULL 的条件，这就会导致查询优化器把左（外）连接查询优化为内连接查询，从<code>SHOW WARNINGS</code>的<code>Message</code>字段也可以看出来，原本的 LEFE JOIN 已经变成了 JOIN。</p> <p>但是大家一定要注意，我们说<code>Message</code>字段展示的信息类似于查询优化器将我们的查询语句<code>重写后的语句</code>，并不是等价于，也就是说<code>Message</code>字段展示的信息并不是标准的查询语句，在很多情况下并不能直接拿到黑框框中运行，它只能作为帮助我们理解 MySQL 将如何执行查询语句的一个参考依据而已。</p> <h2 id="_8-分析优化器执行计划-trace"><a href="#_8-分析优化器执行计划-trace" class="header-anchor">#</a> 8. 分析优化器执行计划：trace</h2> <p><code>OPTIMIZE_TRACE</code>是 mysql5.6 中引入的一个跟踪功能，它可以跟踪优化器做出的各种决策，比如访问表的方法，各种开销计算，各种转换等，结果会被记录到<code>information_schema.optimizer_trace</code>表中。</p> <p>此功能默认关闭。开启 trace，并设置格式为 JSON，同时设置 trace 最大能够使用的内存大小，避免解析过程中因为默认内存过小而不能够完整展示。命令如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 开启</span>
<span class="token keyword">SET</span> optimizer_trace<span class="token operator">=</span><span class="token string">&quot;enabled=on&quot;</span><span class="token punctuation">,</span>end_markers_in_json<span class="token operator">=</span><span class="token keyword">on</span><span class="token punctuation">;</span> 
<span class="token comment"># 设置大小</span>
<span class="token keyword">SET</span> optimizer_trace_max_mem_size<span class="token operator">=</span><span class="token number">1000000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>开启后，可分析如下语句：</p> <ul><li>INSERT 、DELETE 、UPDATE、SELECT</li> <li>REPLACE</li> <li>EXPLAIN</li> <li>SET</li> <li>DECLARE</li> <li>CASE</li> <li>IF</li> <li>RETURN</li> <li>CALL</li></ul> <p>测试：执行如下 SQL 语句</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> id <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最后， 查询 information_schema.optimizer_trace 就可以知道 MySQL 是如何执行 SQL 的</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>optimizer_trace\G
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-text line-numbers-mode"><pre class="language-text"><code>*************************** 1. row ***************************
//第1部分：查询语句
QUERY: select * from student where id &amp;lt; 10
//第2部分：QUERY字段对应语句的跟踪信息
TRACE: {
&quot;steps&quot;: [
{
    &quot;join_preparation&quot;: { //预备工作
        &quot;select#&quot;: 1,
        &quot;steps&quot;: [
            {
            &quot;expanded_query&quot;: &quot;/* select#1 */ select `student`.`id` AS
            `id`,`student`.`stuno` AS `stuno`,`student`.`name` AS `name`,`student`.`age` AS
            `age`,`student`.`classId` AS `classId` from `student` where (`student`.`id` &amp;lt; 10)&quot;
            }
        ] /* steps */
    } /* join_preparation */
},
{
    &quot;join_optimization&quot;: { //进行优化
    &quot;select#&quot;: 1,
    &quot;steps&quot;: [
        {
        &quot;condition_processing&quot;: { //条件处理
        &quot;condition&quot;: &quot;WHERE&quot;,
        &quot;original_condition&quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;,
        &quot;steps&quot;: [
        {
            &quot;transformation&quot;: &quot;equality_propagation&quot;,
            &quot;resulting_condition&quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;
        },
        {
            &quot;transformation&quot;: &quot;constant_propagation&quot;,
            &quot;resulting_condition&quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;
        },
        {
            &quot;transformation&quot;: &quot;trivial_condition_removal&quot;,
            &quot;resulting_condition&quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;
        }
        ] /* steps */
    } /* condition_processing */
    },
    {
        &quot;substitute_generated_columns&quot;: { //替换生成的列
        } /* substitute_generated_columns */
    },
    {
        &quot;table_dependencies&quot;: [ //表的依赖关系
        {
            &quot;table&quot;: &quot;`student`&quot;,
            &quot;row_may_be_null&quot;: false,
            &quot;map_bit&quot;: 0,
            &quot;depends_on_map_bits&quot;: [
            ] /* depends_on_map_bits */
        }
    ] /* table_dependencies */
    },
    {
    &quot;ref_optimizer_key_uses&quot;: [ //使用键
        ] /* ref_optimizer_key_uses */
        },
    {
        &quot;rows_estimation&quot;: [ //行判断
        {
            &quot;table&quot;: &quot;`student`&quot;,
            &quot;range_analysis&quot;: {
                &quot;table_scan&quot;: {
                    &quot;rows&quot;: 3973767,
                    &quot;cost&quot;: 408558
            } /* table_scan */, //扫描表
            &quot;potential_range_indexes&quot;: [ //潜在的范围索引
                {
                    &quot;index&quot;: &quot;PRIMARY&quot;,
                    &quot;usable&quot;: true,
                    &quot;key_parts&quot;: [
                    &quot;id&quot;
                    ] /* key_parts */
                }
            ] /* potential_range_indexes */,
        &quot;setup_range_conditions&quot;: [ //设置范围条件
        ] /* setup_range_conditions */,
        &quot;group_index_range&quot;: {
            &quot;chosen&quot;: false,
            &quot;cause&quot;: &quot;not_group_by_or_distinct&quot;
        } /* group_index_range */,
            &quot;skip_scan_range&quot;: {
                &quot;potential_skip_scan_indexes&quot;: [
                    {
                        &quot;index&quot;: &quot;PRIMARY&quot;,
                        &quot;usable&quot;: false,
                        &quot;cause&quot;: &quot;query_references_nonkey_column&quot;
                    }
                ] /* potential_skip_scan_indexes */
            } /* skip_scan_range */,
        &quot;analyzing_range_alternatives&quot;: { //分析范围选项
            &quot;range_scan_alternatives&quot;: [
                {
                &quot;index&quot;: &quot;PRIMARY&quot;,
                    &quot;ranges&quot;: [
                        &quot;id &amp;lt; 10&quot;
                    ] /* ranges */,
                &quot;index_dives_for_eq_ranges&quot;: true,
                &quot;rowid_ordered&quot;: true,
                &quot;using_mrr&quot;: false,
                &quot;index_only&quot;: false,
                &quot;rows&quot;: 9,
                &quot;cost&quot;: 1.91986,
                &quot;chosen&quot;: true
                }
            ] /* range_scan_alternatives */,
        &quot;analyzing_roworder_intersect&quot;: {
            &quot;usable&quot;: false,
            &quot;cause&quot;: &quot;too_few_roworder_scans&quot;
        	} /* analyzing_roworder_intersect */
        } /* analyzing_range_alternatives */,
        &quot;chosen_range_access_summary&quot;: { //选择范围访问摘要
            &quot;range_access_plan&quot;: {
                &quot;type&quot;: &quot;range_scan&quot;,
                &quot;index&quot;: &quot;PRIMARY&quot;,
                &quot;rows&quot;: 9,
                &quot;ranges&quot;: [
                &quot;id &amp;lt; 10&quot;
                ] /* ranges */
                } /* range_access_plan */,
                &quot;rows_for_plan&quot;: 9,
                &quot;cost_for_plan&quot;: 1.91986,
                &quot;chosen&quot;: true
                } /* chosen_range_access_summary */
                } /* range_analysis */
            }
        ] /* rows_estimation */
    },
    {
    &quot;considered_execution_plans&quot;: [ //考虑执行计划
    {
    &quot;plan_prefix&quot;: [
    ] /* plan_prefix */,
        &quot;table&quot;: &quot;`student`&quot;,
        &quot;best_access_path&quot;: { //最佳访问路径
        &quot;considered_access_paths&quot;: [
        {
            &quot;rows_to_scan&quot;: 9,
            &quot;access_type&quot;: &quot;range&quot;,
            &quot;range_details&quot;: {
            &quot;used_index&quot;: &quot;PRIMARY&quot;
        } /* range_details */,
        &quot;resulting_rows&quot;: 9,
        &quot;cost&quot;: 2.81986,
        &quot;chosen&quot;: true
    }
    ] /* considered_access_paths */
    } /* best_access_path */,
        &quot;condition_filtering_pct&quot;: 100, //行过滤百分比
        &quot;rows_for_plan&quot;: 9,
        &quot;cost_for_plan&quot;: 2.81986,
        &quot;chosen&quot;: true
    }
    ] /* considered_execution_plans */
    },
    {
        &quot;attaching_conditions_to_tables&quot;: { //将条件附加到表上
        &quot;original_condition&quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;,
        &quot;attached_conditions_computation&quot;: [
        ] /* attached_conditions_computation */,
        &quot;attached_conditions_summary&quot;: [ //附加条件概要
    {
        &quot;table&quot;: &quot;`student`&quot;,
        &quot;attached&quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;
    }
    ] /* attached_conditions_summary */
    } /* attaching_conditions_to_tables */
    },
    {
    &quot;finalizing_table_conditions&quot;: [
    {
        &quot;table&quot;: &quot;`student`&quot;,
        &quot;original_table_condition&quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;,
        &quot;final_table_condition &quot;: &quot;(`student`.`id` &amp;lt; 10)&quot;
    }
    ] /* finalizing_table_conditions */
    },
    {
    &quot;refine_plan&quot;: [ //精简计划
    {
    	&quot;table&quot;: &quot;`student`&quot;
    }
    ] /* refine_plan */
    }
    ] /* steps */
    } /* join_optimization */
},
	{
        &quot;join_execution&quot;: { //执行
            &quot;select#&quot;: 1,
            &quot;steps&quot;: [
            ] /* steps */
        	} /* join_execution */
        }
    ] /* steps */
}
//第3部分：跟踪信息过长时，被截断的跟踪信息的字节数。
MISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0 //丢失的超出最大容量的字节
//第4部分：执行跟踪语句的用户是否有查看对象的权限。当不具有权限时，该列信息为1且TRACE字段为空，一般在调用带有SQL SECURITY DEFINER的视图或者是存储过程的情况下，会出现此问题。
INSUFFICIENT_PRIVILEGES: 0 //缺失权限
1 row in set (0.00 sec)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br></div></div><h2 id="_9-mysql-监控分析视图-sys-schema"><a href="#_9-mysql-监控分析视图-sys-schema" class="header-anchor">#</a> 9. MySQL 监控分析视图-sys schema</h2> <p>关于 MySQL 的性能监控和问题诊断，我们一般都从 performance_schema 中去获取想要的数据，在 MySQL5.7.7 版本中新增 sys schema，它将 performance_schema 和 information_schema 中的数据以更容易理解的方式总结归纳为&quot;视图”，其目的就是为了<code>降低查询 performance_schema 的复杂度</code>，让 DBA 能够快速的定位问题。下面看看这些库中都有哪些监控表和视图，掌握了这些，在我们开发和运维的过程中就起到了事半功倍的效果。</p> <h3 id="_9-1-sys-schema-视图使用场景"><a href="#_9-1-sys-schema-视图使用场景" class="header-anchor">#</a> 9.1 Sys schema 视图使用场景</h3> <p><strong>主机相关</strong>：以 host_summary 开头，主要汇总了 IO 延迟的信息。</p> <p><strong>Innodb 相关</strong>：以 innodb 开头，汇总了 innodb buffer 信息和事务等待 innodb 锁的信息。</p> <p><strong>I/O 相关</strong>：以 io 开头，汇总了等待 I/O、I/O 使用量情况。</p> <p><strong>内存使用情况</strong>：以 memory 开头，从主机、线程、事件等角度展示内存的使用情况</p> <p><strong>连接与会话信息</strong>：processlist 和 session 相关视图，总结了会话相关信息。</p> <p><strong>表相关</strong>：以 schema_table 开头的视图，展示了表的统计信息。</p> <p><strong>索引信息</strong>：统计了索引的使用情况，包含冗余索引和未使用的索引情况。</p> <p><strong>语句相关</strong>：以 statement 开头，包含执行全表扫描、使用临时表、排序等的语句信息。</p> <p><strong>用户相关</strong>：以 user 开头的视图，统计了用户使用的文件 I/O、执行语句统计信息。</p> <p><strong>等待事件相关信息</strong>：以 wait 开头，展示等待事件的延迟情况。</p> <p><strong>索引情况</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#1. 查询冗余索引 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>schema_redundant_indexes<span class="token punctuation">;</span> 

<span class="token comment">#2. 查询未使用过的索引 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>schema_unused_indexes<span class="token punctuation">;</span>

<span class="token comment">#3. 查询索引的使用情况 </span>
<span class="token keyword">select</span> index_name<span class="token punctuation">,</span>rows_selected<span class="token punctuation">,</span>rows_inserted<span class="token punctuation">,</span>rows_updated<span class="token punctuation">,</span>rows_deleted <span class="token keyword">from</span> sys<span class="token punctuation">.</span>schema_index_statistics
<span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token string">'dbname'</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>表相关</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 1. 查询表的访问量 </span>
<span class="token keyword">select</span> table_schema<span class="token punctuation">,</span>table_name<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>io_read_requests<span class="token operator">+</span>io_write_requests<span class="token punctuation">)</span> <span class="token keyword">as</span> io 
<span class="token keyword">from</span> sys<span class="token punctuation">.</span>schema_table_statistics 
<span class="token keyword">group</span> <span class="token keyword">by</span> table_schema<span class="token punctuation">,</span>table_name <span class="token keyword">order</span> <span class="token keyword">by</span> io <span class="token keyword">desc</span><span class="token punctuation">;</span>

<span class="token comment"># 2. 查询占用bufferpool较多的表 </span>
<span class="token keyword">select</span> object_schema<span class="token punctuation">,</span>object_name<span class="token punctuation">,</span>allocated<span class="token punctuation">,</span><span class="token keyword">data</span>
<span class="token keyword">from</span> sys<span class="token punctuation">.</span>innodb_buffer_stats_by_table <span class="token keyword">order</span> <span class="token keyword">by</span> allocated <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span> 

<span class="token comment"># 3. 查看表的全表扫描情况 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>statements_with_full_table_scans <span class="token keyword">where</span> db<span class="token operator">=</span><span class="token string">'dbname'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>语句相关</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#1. 监控SQL执行的频率 </span>
<span class="token keyword">select</span> db<span class="token punctuation">,</span>exec_count<span class="token punctuation">,</span>query <span class="token keyword">from</span> sys<span class="token punctuation">.</span>statement_analysis <span class="token keyword">order</span> <span class="token keyword">by</span> exec_count <span class="token keyword">desc</span><span class="token punctuation">;</span>

<span class="token comment">#2. 监控使用了排序的SQL </span>
<span class="token keyword">select</span> db<span class="token punctuation">,</span>exec_count<span class="token punctuation">,</span>first_seen<span class="token punctuation">,</span>last_seen<span class="token punctuation">,</span>query
<span class="token keyword">from</span> sys<span class="token punctuation">.</span>statements_with_sorting <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span> 

<span class="token comment">#3. 监控使用了临时表或者磁盘临时表的SQL </span>
<span class="token keyword">select</span> db<span class="token punctuation">,</span>exec_count<span class="token punctuation">,</span>tmp_tables<span class="token punctuation">,</span>tmp_disk_tables<span class="token punctuation">,</span>query
<span class="token keyword">from</span> sys<span class="token punctuation">.</span>statement_analysis <span class="token keyword">where</span> tmp_tables<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">or</span> tmp_disk_tables <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>tmp_tables<span class="token operator">+</span>tmp_disk_tables<span class="token punctuation">)</span> <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>IO 相关</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#1. 查看消耗磁盘IO的文件 </span>
<span class="token keyword">select</span> <span class="token keyword">file</span><span class="token punctuation">,</span>avg_read<span class="token punctuation">,</span>avg_write<span class="token punctuation">,</span>avg_read<span class="token operator">+</span>avg_write <span class="token keyword">as</span> avg_io
<span class="token keyword">from</span> sys<span class="token punctuation">.</span>io_global_by_file_by_bytes 
<span class="token keyword">order</span> <span class="token keyword">by</span> avg_read <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Innodb 相关</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#1. 行锁阻塞情况 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>innodb_lock_waits<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">风险提示</p> <p>通过 sys 库去查询时，MySQL 会<code>消耗大量资源</code>去收集相关信息，严重的可能会导致业务请求被阻塞，从而引起故障。建议生产上<code>不要频繁</code>的去查询 sys 或者 performance_schema、information_schema 来完成监控、巡检等工作。</p></div> <h2 id="_10-小结"><a href="#_10-小结" class="header-anchor">#</a> 10. 小结</h2> <p>查询时数据库中最频繁的操作，提高查询速度可以有效地提高 MySQL 数据库的性能。通过对查询语句的分析可以了解查询语句的执行情况，找出查询语句执行的瓶颈，从而优化查询语句！</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/08/03, 22:33:49</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-8/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第08章_索引的创建与设计原则</div></a> <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-10/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第10章_索引优化与查询优化</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-8/" class="prev">第08章_索引的创建与设计原则</a></span> <span class="next"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-10/">第10章_索引优化与查询优化</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/jdbc-core/"><div>
            JDBC 核心技术(JDK21版)
            <!----></div></a> <span class="date">09-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/"><div>
            第00章_写在前面
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/"><div>
            第01章_Linux 下 MySQL 的安装与使用
            <!----></div></a> <span class="date">05-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca5c989c.js" defer></script><script src="/assets/js/3.f2884e99.js" defer></script><script src="/assets/js/2.81e8b964.js" defer></script><script src="/assets/js/22.f9d18654.js" defer></script>
  </body>
</html>
