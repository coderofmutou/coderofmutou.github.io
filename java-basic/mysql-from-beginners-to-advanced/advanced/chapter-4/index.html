<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第04章_逻辑架构 | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.ca5c989c.js" as="script"><link rel="preload" href="/assets/js/3.f2884e99.js" as="script"><link rel="preload" href="/assets/js/2.81e8b964.js" as="script"><link rel="preload" href="/assets/js/46.dff72ed3.js" as="script"><link rel="prefetch" href="/assets/js/1.f754fd0b.js"><link rel="prefetch" href="/assets/js/10.bde6e567.js"><link rel="prefetch" href="/assets/js/100.000718ad.js"><link rel="prefetch" href="/assets/js/101.863f022a.js"><link rel="prefetch" href="/assets/js/102.7b45f43b.js"><link rel="prefetch" href="/assets/js/103.ba5681a8.js"><link rel="prefetch" href="/assets/js/104.e35b7e87.js"><link rel="prefetch" href="/assets/js/105.15a150cd.js"><link rel="prefetch" href="/assets/js/106.aea81b3b.js"><link rel="prefetch" href="/assets/js/107.4f4dec09.js"><link rel="prefetch" href="/assets/js/108.0079fda6.js"><link rel="prefetch" href="/assets/js/109.7a5059de.js"><link rel="prefetch" href="/assets/js/11.fa1b0bc7.js"><link rel="prefetch" href="/assets/js/110.85007649.js"><link rel="prefetch" href="/assets/js/111.dbec93e3.js"><link rel="prefetch" href="/assets/js/112.f17a38c0.js"><link rel="prefetch" href="/assets/js/113.6478506e.js"><link rel="prefetch" href="/assets/js/114.6031c0db.js"><link rel="prefetch" href="/assets/js/115.d7094af2.js"><link rel="prefetch" href="/assets/js/116.316a6234.js"><link rel="prefetch" href="/assets/js/117.1336f5e0.js"><link rel="prefetch" href="/assets/js/118.4b882789.js"><link rel="prefetch" href="/assets/js/119.503f83be.js"><link rel="prefetch" href="/assets/js/12.04b9b957.js"><link rel="prefetch" href="/assets/js/120.af7d94d8.js"><link rel="prefetch" href="/assets/js/121.5cd3597d.js"><link rel="prefetch" href="/assets/js/122.82f45642.js"><link rel="prefetch" href="/assets/js/123.f2ba0b19.js"><link rel="prefetch" href="/assets/js/13.680e50fd.js"><link rel="prefetch" href="/assets/js/14.dfca4100.js"><link rel="prefetch" href="/assets/js/15.01784967.js"><link rel="prefetch" href="/assets/js/16.81c1d5ab.js"><link rel="prefetch" href="/assets/js/17.9a472859.js"><link rel="prefetch" href="/assets/js/18.5366cb68.js"><link rel="prefetch" href="/assets/js/19.b1b74ef9.js"><link rel="prefetch" href="/assets/js/20.e938fa21.js"><link rel="prefetch" href="/assets/js/21.3e38db33.js"><link rel="prefetch" href="/assets/js/22.f9d18654.js"><link rel="prefetch" href="/assets/js/23.8eea4b67.js"><link rel="prefetch" href="/assets/js/24.6fe732dc.js"><link rel="prefetch" href="/assets/js/25.b1885cb6.js"><link rel="prefetch" href="/assets/js/26.936ee89a.js"><link rel="prefetch" href="/assets/js/27.fb3beb63.js"><link rel="prefetch" href="/assets/js/28.af721a74.js"><link rel="prefetch" href="/assets/js/29.427b7eae.js"><link rel="prefetch" href="/assets/js/30.2af5e34e.js"><link rel="prefetch" href="/assets/js/31.60102330.js"><link rel="prefetch" href="/assets/js/32.746872da.js"><link rel="prefetch" href="/assets/js/33.9466d03b.js"><link rel="prefetch" href="/assets/js/34.c7f7b0ef.js"><link rel="prefetch" href="/assets/js/35.53799eb8.js"><link rel="prefetch" href="/assets/js/36.e8875fc1.js"><link rel="prefetch" href="/assets/js/37.c386b2c5.js"><link rel="prefetch" href="/assets/js/38.ee46082f.js"><link rel="prefetch" href="/assets/js/39.11d092ff.js"><link rel="prefetch" href="/assets/js/4.920d0610.js"><link rel="prefetch" href="/assets/js/40.4ee40bcf.js"><link rel="prefetch" href="/assets/js/41.81c3174c.js"><link rel="prefetch" href="/assets/js/42.18f42b9d.js"><link rel="prefetch" href="/assets/js/43.7426d1ac.js"><link rel="prefetch" href="/assets/js/44.d5baff75.js"><link rel="prefetch" href="/assets/js/45.7b25c5ca.js"><link rel="prefetch" href="/assets/js/47.15531a4f.js"><link rel="prefetch" href="/assets/js/48.48bbc098.js"><link rel="prefetch" href="/assets/js/49.49acd468.js"><link rel="prefetch" href="/assets/js/5.847584a2.js"><link rel="prefetch" href="/assets/js/50.e26ee1bf.js"><link rel="prefetch" href="/assets/js/51.6728bddb.js"><link rel="prefetch" href="/assets/js/52.c238e7bf.js"><link rel="prefetch" href="/assets/js/53.025903f6.js"><link rel="prefetch" href="/assets/js/54.05baf03a.js"><link rel="prefetch" href="/assets/js/55.b6fc3e0a.js"><link rel="prefetch" href="/assets/js/56.8e5ef1fc.js"><link rel="prefetch" href="/assets/js/57.db41b6fb.js"><link rel="prefetch" href="/assets/js/58.b4cb51f8.js"><link rel="prefetch" href="/assets/js/59.423b27e1.js"><link rel="prefetch" href="/assets/js/6.b384c550.js"><link rel="prefetch" href="/assets/js/60.57eff889.js"><link rel="prefetch" href="/assets/js/61.387a5103.js"><link rel="prefetch" href="/assets/js/62.23ba2982.js"><link rel="prefetch" href="/assets/js/63.2d69780b.js"><link rel="prefetch" href="/assets/js/64.d3f669fb.js"><link rel="prefetch" href="/assets/js/65.f5410640.js"><link rel="prefetch" href="/assets/js/66.59887fb2.js"><link rel="prefetch" href="/assets/js/67.01fba30e.js"><link rel="prefetch" href="/assets/js/68.8a6bbb81.js"><link rel="prefetch" href="/assets/js/69.12e673c4.js"><link rel="prefetch" href="/assets/js/70.a227d4b3.js"><link rel="prefetch" href="/assets/js/71.bd6a3bd7.js"><link rel="prefetch" href="/assets/js/72.4f2efca4.js"><link rel="prefetch" href="/assets/js/73.7dbf57a8.js"><link rel="prefetch" href="/assets/js/74.28c26d0a.js"><link rel="prefetch" href="/assets/js/75.d36a4feb.js"><link rel="prefetch" href="/assets/js/76.9123efc1.js"><link rel="prefetch" href="/assets/js/77.cbe2020d.js"><link rel="prefetch" href="/assets/js/78.7ab3eb40.js"><link rel="prefetch" href="/assets/js/79.bc69c4a8.js"><link rel="prefetch" href="/assets/js/80.da17de0b.js"><link rel="prefetch" href="/assets/js/81.1d16813f.js"><link rel="prefetch" href="/assets/js/82.586f2e97.js"><link rel="prefetch" href="/assets/js/83.129cc5fa.js"><link rel="prefetch" href="/assets/js/84.83d65ed9.js"><link rel="prefetch" href="/assets/js/85.f4327096.js"><link rel="prefetch" href="/assets/js/86.866a7d4f.js"><link rel="prefetch" href="/assets/js/87.f8aba274.js"><link rel="prefetch" href="/assets/js/88.43c5a138.js"><link rel="prefetch" href="/assets/js/89.b47b6d86.js"><link rel="prefetch" href="/assets/js/9.ef15744b.js"><link rel="prefetch" href="/assets/js/90.4950712a.js"><link rel="prefetch" href="/assets/js/91.80bbaffe.js"><link rel="prefetch" href="/assets/js/92.0d03ce50.js"><link rel="prefetch" href="/assets/js/93.fff94cff.js"><link rel="prefetch" href="/assets/js/94.91d0e36d.js"><link rel="prefetch" href="/assets/js/95.15227fb3.js"><link rel="prefetch" href="/assets/js/96.b3ef20b0.js"><link rel="prefetch" href="/assets/js/97.9e5e1675.js"><link rel="prefetch" href="/assets/js/98.b213b526.js"><link rel="prefetch" href="/assets/js/99.1ec76897.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b448e12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title router-link-active">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link router-link-active">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>核心</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java从入门到精通(JDK17版)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>MySQL从入门到高级-基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>MySQL从入门到高级-高级篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/" class="sidebar-link">第00章_写在前面</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/" class="sidebar-link">第01章_Linux 下 MySQL 的安装与使用</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-2/" class="sidebar-link">第02章_MySQL 的数据目录</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-3/" class="sidebar-link">第03章_用户与权限管理</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/" aria-current="page" class="active sidebar-link">第04章_逻辑架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-逻辑架构剖析" class="sidebar-link">1. 逻辑架构剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-1-服务器处理客户端请求" class="sidebar-link">1.1 服务器处理客户端请求</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-2-connectors" class="sidebar-link">1.2 Connectors</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-3-第-1-层-连接层" class="sidebar-link">1.3 第 1 层：连接层</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-4-第-2-层-服务层" class="sidebar-link">1.4 第 2 层：服务层</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-5-第-3-层-引擎层" class="sidebar-link">1.5 第 3 层：引擎层</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-6-存储层" class="sidebar-link">1.6 存储层</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_1-7-小结" class="sidebar-link">1.7 小结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_2-sql-执行流程" class="sidebar-link">2. SQL 执行流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_2-1-mysql-中的-sql-执行流程" class="sidebar-link">2.1 MySQL 中的 SQL 执行流程</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#查询缓存" class="sidebar-link">查询缓存</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#解析器" class="sidebar-link">解析器</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#优化器" class="sidebar-link">优化器</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#执行器" class="sidebar-link">执行器</a></li><li class="sidebar-sub-header level4"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#小结" class="sidebar-link">小结</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_2-2-mysql8-中-sql-执行分析" class="sidebar-link">2.2 MySQL8 中 SQL 执行分析</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_2-3-mysql5-7-中-sql-执行分析" class="sidebar-link">2.3 MySQL5.7 中 SQL 执行分析</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_2-4-oracle-中的-sql-执行流程" class="sidebar-link">2.4 Oracle 中的 SQL 执行流程</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_3-数据库缓冲池-buffer-pool" class="sidebar-link">3. 数据库缓冲池(buffer pool)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_3-1-缓冲池-vs-查询缓存" class="sidebar-link">3.1 缓冲池 vs 查询缓存</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_3-2-缓冲池如何读取数据" class="sidebar-link">3.2 缓冲池如何读取数据</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_3-3-查看-设置缓冲池的大小" class="sidebar-link">3.3 查看/设置缓冲池的大小</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_3-4-多个-buffer-pool-实例" class="sidebar-link">3.4 多个 Buffer Pool 实例</a></li><li class="sidebar-sub-header level3"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-4/#_3-5-引申问题" class="sidebar-link">3.5 引申问题</a></li></ul></li></ul></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-5/" class="sidebar-link">第05章_存储引擎</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-6/" class="sidebar-link">第06章_索引的数据结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-7/" class="sidebar-link">第07章_InnoDB 数据存储结构</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-8/" class="sidebar-link">第08章_索引的创建与设计原则</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-9/" class="sidebar-link">第09章_性能分析工具的使用</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-10/" class="sidebar-link">第10章_索引优化与查询优化</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-11/" class="sidebar-link">第11章_数据库的设计规范</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-12/" class="sidebar-link">第12章_数据库其它调优策略</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-13/" class="sidebar-link">第13章_事务基础知识</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-14/" class="sidebar-link">第14章_MySQL 事务日志</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-15/" class="sidebar-link">第15章_锁</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-16/" class="sidebar-link">第16章_多版本并发控制</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-17/" class="sidebar-link">第17章_其它数据库日志</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-18/" class="sidebar-link">第18章_主从复制</a></li><li><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-19/" class="sidebar-link">第19章_数据库备份与恢复</a></li></ul></section></li><li><a href="/java-basic/jdbc-core/" class="sidebar-link">JDBC 核心技术(JDK21版)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=Java%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>Java基础</a></li><li data-v-06225672><a href="/categories/?category=%E6%A0%B8%E5%BF%83" title="分类" data-v-06225672>核心</a></li><li data-v-06225672><a href="/categories/?category=MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7-%E9%AB%98%E7%BA%A7%E7%AF%87" title="分类" data-v-06225672>MySQL从入门到高级-高级篇</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-05-14</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">第04章_逻辑架构<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="第-04-章-逻辑架构"><a href="#第-04-章-逻辑架构" class="header-anchor">#</a> 第 04 章 逻辑架构</h1> <h2 id="_1-逻辑架构剖析"><a href="#_1-逻辑架构剖析" class="header-anchor">#</a> 1. 逻辑架构剖析</h2> <p>首先 MySQL 是典型的 C/S 架构，即<code>Client/Server 架构</code>，服务器端程序使用的是 <code>mysqld</code>。</p> <p>不论客户端进程和服务器进程是采用哪种方式进行通信，最后实现的效果都是：<strong>客户端进程向服务器进程发送一段文本（SQL 语句），服务器进程处理后再向客户端进程发送一段文本（处理结果）</strong>。</p> <h3 id="_1-1-服务器处理客户端请求"><a href="#_1-1-服务器处理客户端请求" class="header-anchor">#</a> 1.1 服务器处理客户端请求</h3> <p>那么服务器进程对客户端进程发送的请求做了什么处理，才能产生最后的处理结果呢？这里以查询请求为例展示：</p> <p><img src="/assets/img/Logical_Architecture.37a3f13c.webp" alt="Logical_Architecture"></p> <p><img src="/assets/img/Logical_Architecture2.a1c95c6c.webp" alt="Logical_Architecture2"></p> <p><img src="/assets/img/Logical_Architecture3.131b4454.webp" alt="Logical_Architecture3"></p> <h3 id="_1-2-connectors"><a href="#_1-2-connectors" class="header-anchor">#</a> 1.2 Connectors</h3> <p>Connectors，指的是不同语言中与 SQL 的交互。MySQL 首先是一个网络程序，在 TCP 之上定义了自己的应用层协议。所以要使用 MySQL，我们可以编写代码，跟 MySQL Server<code>建立TCP连接</code>，之后按照其定义好的协议进行交互。或者比较方便的办法是调用 SDK，比如 Native C API、JDBC、PHP 等各语言 MySQL Connector，或者通过 ODBC。<strong>通过 SDK 来访问 MySQL，本质上还是在 TCP 连接上通过 MySQL 协议跟 MySQL 进行交互。</strong></p> <h3 id="_1-3-第-1-层-连接层"><a href="#_1-3-第-1-层-连接层" class="header-anchor">#</a> 1.3 第 1 层：连接层</h3> <p><strong>连接管理</strong>的职责是<strong>负责认证、管理连接、获取权限信息</strong>。</p> <p>系统（客户端）访问<code>MySQL</code>服务器前，做的第一件事就是建立<code>TCP</code>连接。</p> <p>经过三次握手建立连接成功后，<code>MySQL</code>服务器对<code>TCP</code>传输过来的账号密码做身份认证、权限获取。</p> <ul><li><strong>用户名或密码不对</strong>，会收到一个<code>Access denied for user</code>错误，客户端程序结束执行</li> <li><strong>用户名密码认证通过</strong>，会从权限表查出账号拥有的权限与连接关联，之后的权限判断逻辑，都将依赖于此时读到的权限</li></ul> <p><img src="data:image/webp;base64,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" alt="MySQLConnection"></p> <p><strong>TCP 连接池</strong></p> <p>多个系统都可以和 MySQL 服务器建立连接，每个系统建立的连接不止一个。所以，为了解决 TCP 无限创建与 TCP 频繁创建销毁带来的资源耗尽、性能下降问题。MySQL 服务器里有专门的<code>TCP连接池</code>限制连接数采用<code>长连接模式</code>复用 TCP 连接，来解决上述问题。</p> <p><strong>线程池</strong></p> <p><code>TCP</code>连接收到请求后，必须要分配给一个线程专门与这个客户端的交互。所以还会有个线程池，去走后面的流程。每一个连接从线程池中获取线程，省去了创建和销毁线程的开销。</p> <p>这些内容我们都归纳到<code>MySQL</code>的<strong>连接管理</strong>组件中。</p> <h3 id="_1-4-第-2-层-服务层"><a href="#_1-4-第-2-层-服务层" class="header-anchor">#</a> 1.4 第 2 层：服务层</h3> <p>第二层架构主要完成大多数的核心服务功能，如 SQL 接口，并完成<code>缓存的查询</code>，SQL 的分析和优化及部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。</p> <p>在该层，服务器会<code>解析查询</code>并创建相应的内部<code>解析树</code>，并对其完成相应的<code>优化</code>：如确定查询表的顺序，是否利用索引等，最后生成相应的执行操作。</p> <p>如果是 SELECT 语句，服务器还会<code>查询内部的缓存</code>。如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。</p> <table><thead><tr><th style="text-align:left;">组件名</th> <th style="text-align:left;">解释</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>Management Services &amp; Utilities</code></td> <td style="text-align:left;">系统管理和控制工具</td></tr> <tr><td style="text-align:left;"><code>SQL Interface</code></td> <td style="text-align:left;">SQL 接口。接受用户的 SQL 命令，并且返回用户需要查询的结果。比如 select from 就是调用 SQL Interface。</td></tr> <tr><td style="text-align:left;"><code>Parser</code></td> <td style="text-align:left;">SQL 解析器。SQL 命令传递到解析器的时候会被解析器验证和解析。</td></tr> <tr><td style="text-align:left;"><code>Optimizer</code></td> <td style="text-align:left;">SQL 查询优化器。SQL 语句在查询之前会使用查询优化器对查询进行优化，比如有 where 条件时，优化器来决定先投影还是先过滤。</td></tr> <tr><td style="text-align:left;"><code>Cache &amp; Buffer</code></td> <td style="text-align:left;">SQL 查询缓存。如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key 缓存，权限缓存等。</td></tr></tbody></table> <ul><li><p><strong>SQL Interface: SQL 接口</strong></p> <ul><li>接收用户的 SQL 命令，并且返回用户需要查询的结果。比如 SELECT ... FROM 就是调用 SQL Interface</li> <li>MySQL 支持 DML（数据操作语言）、DDL（数据定义语言）、存储过程、视图、触发器、自定义函数等多种 SQL 语言接口</li></ul></li> <li><p><strong>Parser: 解析器</strong></p> <ul><li>在解析器中对 SQL 语句进行语法分析、语义分析。将 SQL 语句分解成数据结构，并将这个结构传递到后续步骤，以后 SQL 语句的传递和处理就是基于这个结构的。如果在分解构成中遇到错误，那么就说明这个 SQL 语句是不合理的。</li> <li>在 SQL 命令传递到解析器的时候会被解析器验证和解析，并为其创建<code>语法树</code>，并根据数据字典丰富查询语法树，会<code>验证该客户端是否具有执行该查询的权限</code>。创建好语法树后，MySQL 还会对 SQL 查询进行语法上的优化，进行查询重写。</li></ul></li> <li><p><strong>Optimizer: 查询优化器</strong></p> <ul><li>SQL 语句在语法解析之后、查询之前会使用查询优化器确定 SQL 语句的执行路径，生成一个<code>执行计划</code>。</li> <li>这个执行计划表明应该<code>使用哪些索引</code>进行查询（全表检索还是使用索引检索），表之间的连接顺序如何，最后会按照执行计划中的步骤调用存储引擎提供的方法来真正的执行查询，并将查询结果返回给用户。</li> <li>它使用“<code>选取-投影-连接</code>”策略进行查询。例如：</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>name <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> gender <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个 SELECT 查询先根据 WHERE 语句进行<code>选取</code>，而不是将表全部查询出来以后再进行 gender 过滤。 这个 SELECT 查询先根据 id 和 name 进行属性<code>投影</code>，而不是将属性全部取出以后再进行过滤，将这两个查询条件<code>连接</code>起来生成最终查询结果。</p></li> <li><p><strong>Caches &amp; Buffers: 查询缓存组件</strong></p> <ul><li>MySQL 内部维持着一些 Cache 和 Buffer，比如 Query Cache 用来缓存一条 SELECT 语句的执行结果，如果能够在其中找到对应的查询结果，那么就不必再进行查询解析、优化和执行的整个过程了，直接将结果反馈给客户端。</li> <li>这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key 缓存，权限缓存等 。</li> <li>这个查询缓存可以在<code>不同客户端之间共享</code>。</li> <li>从 MySQL 5.7.20 开始，不推荐使用查询缓存，并在<code>MySQL 8.0中删除</code>。</li></ul></li></ul> <h3 id="_1-5-第-3-层-引擎层"><a href="#_1-5-第-3-层-引擎层" class="header-anchor">#</a> 1.5 第 3 层：引擎层</h3> <p>插件式存储引擎层(Storage Engines)<strong>真正的负责了 MySQL 中数据的存储和提取，对物理服务器级别维护的底层数据执行操作</strong>，服务层通过 API 与存储引擎进行通信。</p> <p><code>插件式的存储引擎</code>架构将查询处理和其它的系统任务以及数据的存储提取相分离。这种架构可以根据业务的需求和实际需要选择合适的存储引擎。同时开源的 MySQL 还允许<code>开发人员设置自己的存储引擎</code>。</p> <p><code>MySQL 8.0.25</code> 默认支持的存储引擎如下</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> engines<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/engines.15b5ee8c.webp" alt="engines"></p> <h3 id="_1-6-存储层"><a href="#_1-6-存储层" class="header-anchor">#</a> 1.6 存储层</h3> <p>所有的数据，数据库、表的定义，表的每一行的内容，索引，都是存在<code>文件系统</code>上，以<code>文件</code>的方式存在的，并完成与存储引擎的交互。当然有些存储引擎比如 InnoDB，也支持不使用文件系统直接管理裸设备，但现代文件系统的实现使得这样做没有必要了。在文件系统之下，可以使用本地磁盘，可以使用 DAS、NAS、SAN 等各种存储系统。</p> <h3 id="_1-7-小结"><a href="#_1-7-小结" class="header-anchor">#</a> 1.7 小结</h3> <p>简化为三层结构：</p> <ul><li><p>连接层：客户端和服务器端建立连接，客户端发送 SQL 至服务器端；</p></li> <li><p>SQL 层（服务层）：对 SQL 语句进行查询处理；与数据库文件的存储方式无关；</p></li> <li><p>存储引擎层：与数据库文件打交道，负责数据的存储和读取。</p></li></ul> <h2 id="_2-sql-执行流程"><a href="#_2-sql-执行流程" class="header-anchor">#</a> 2. SQL 执行流程</h2> <h3 id="_2-1-mysql-中的-sql-执行流程"><a href="#_2-1-mysql-中的-sql-执行流程" class="header-anchor">#</a> 2.1 MySQL 中的 SQL 执行流程</h3> <p><img src="/assets/img/SQL_Execution_Flow.30fbac0b.webp" alt="SQL_Execution_Flow"></p> <p><strong>MySQL 的查询流程：</strong></p> <h4 id="查询缓存"><a href="#查询缓存" class="header-anchor">#</a> 查询缓存</h4> <p>Server 如果在查询缓存中发现了这条 SQL 语句，就会直接将结果返回给客户端；如果没有，就进入到解析器阶段。需要说明的是，因为查询缓存往往效率不高，所以在 MySQL8.0 之后就抛弃了这个功能。</p> <p>MySQL 拿到一个查询请求后，会先到查询缓存看看，之前是不是执行过这条语句。<code>之前执行过的语句及其结果可能会以 key-value 对的形式，被直接缓存在内存中</code>。key 是查询的语句，value 是查询的结果。如果查询能够直接在这个缓存中找到 key,那么这个 value 就会被直接返回给客户端。如果语句不在查询缓存中，就会继续后面的执行阶段。<code>执行完成后，执行结果会被存入查询缓存中</code>。所以，如果查询命中缓存，MySQL 不需要执行后面的复杂操作，就可以直接返回结果，这个效率会很高。</p> <p><strong>大多数情况查询缓存就是个鸡肋，为什么呢？</strong></p> <p>查询缓存是提前把查询结果缓存起来，这样下次不需要执行就可以直接拿到结果。</p> <p>需要说明的是，在 MySQL 中的查询缓存，不是缓存查询计划，而是查询对应的结果。这就意味着查询匹配的<code>鲁棒性大大降低</code>，只有<code>相同的查询操作才会命中查询缓存</code>。两个查询请求在任何字符上的不同（例如：空格、注释、大小写），都会导致缓存不会命中。因此 MySQL 的<code>查询缓存命中率不高</code>。</p> <p>同时，如果查询请求中包含某些系统函数、用户自定义变量和函数、一些系统表，如 mysql、 information_schema、 performance_schema 数据库中的表，那这个请求就不会被缓存。以某些系统函数举例，可能同样的函数的两次调用会产生不一样的结果，比如函数<code>NOW</code>，每次调用都会产生最新的当前时间，如果在一个查询请求中调用了这个函数，那即使查询请求的文本信息都一样，那不同时间的两次查询也应该得到不同的结果，如果在第一次查询时就缓存了，那第二次查询的时候直接使用第一次查询的结果就是错误的！</p> <p>此外，既然是缓存，那就有它<code>缓存失效的时候</code>。MySQL 的缓存系统会监测涉及到的每张表，只要该表的结构或者数据被修改，如对该表使用了<code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>、<code>TRUNCATE TABLE</code>、<code>ALTER TABLE</code>、<code>DROP TABLE</code>或<code>DROP DATABASE</code>语句，那使用该表的所有高速缓存查询都将变为无效并从高速缓存中删除！对于<code>更新压力大的数据库</code>来说，查询缓存的命中率会非常低。</p> <p><strong>总之，因为查询缓存往往弊大于利，查询缓存的失效非常频繁。</strong></p> <p><strong>查询缓存的使用建议</strong></p> <p>一般建议在静态表里使用查询缓存，什么叫<code>静态表</code>呢？就是一般极少更新的表。比如，一个系统配置表、字典表，这张表上的查询才适合使用查询缓存。MySQL 也提供了这种“<code>按需使用</code>”的方式。可以将<code>my.cnf</code>参数<code>query_cache_type</code>设置成<code>DEMAND</code>，代表当 sql 语句中有<code>SQL_CACHE</code>关键词时才缓存。比如：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#query_cache_type有3个值 0代表关闭查询缓存OFF,1代表开启ON,2(DEMAND)</span>
<span class="token key attr-name">query_cache_type</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样对于默认的 SQL 语句都不使用查询缓存。而对于你确定要使用查询缓存的语句，可以用<code>SQL_CACHE</code>显式指定，像下面这个语句一样：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> SQL_CACHE column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果缓存处于开启，也可以使用<code>SQL_NO_CACHE</code>来显示指明不使用缓存</p> <p><strong>查看当前 mysql 实例是否开启缓存机制</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># MySQL5.7中</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'query_cache_type'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-------+</span>
<span class="token operator">|</span> Variable_name    <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-------+</span>
<span class="token operator">|</span> query_cache_type <span class="token operator">|</span> <span class="token keyword">OFF</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-------+</span>

<span class="token comment"># MySQL8.0中</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'query_cache_type'</span><span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>监控查询缓存的命中率</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'%Qcache%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------------+---------+</span>
<span class="token operator">|</span> Variable_name           <span class="token operator">|</span> <span class="token keyword">Value</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+---------+</span>
<span class="token operator">|</span> Qcache_free_blocks      <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Qcache_free_memory      <span class="token operator">|</span> <span class="token number">1031832</span> <span class="token operator">|</span>
<span class="token operator">|</span> Qcache_hits             <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Qcache_inserts          <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Qcache_lowmem_prunes    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Qcache_not_cached       <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Qcache_queries_in_cache <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Qcache_total_blocks     <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+---------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>运行结果解析：</p> <ul><li><code>Qcache_free_blocks</code> 表示查询缓存中还有多少剩余的 blocks，如果该值显示较大，则说明查询缓存中的<code>内存碎片</code>过多了，可能在一定的时间进行整理。</li> <li><code>Qcache_free_memory</code> 查询缓存的内存大小，通过这个参数可以很清晰的知道当前系统的查询内存是否够用，是多了，还是不够用，DBA 可以根据实际情况做出调整。</li> <li><code>Qcache_hits</code> 表示有<code>多少次命中缓存</code>。可以通过该值来验证查询缓存的效果。数字越大，缓存效果越理想。</li> <li><code>Qcache_inserts</code> 表示<code>多少次未命中然后插入</code>，意思是新来的 SQL 请求在缓存中未找到，不得不执行查询处理，执行查询处理后把结果 insert 到查询缓存中。这样的情况的次数越多，表示查询缓存应用到的比较少，效果也就不理想。当然系统刚启动后，查询缓存是空的，这很正常。</li> <li><code>Qcache_lowmem_prunes</code> 该参数记录<code>有多少条查询因为内存不足而被移除出查询缓存</code>。通过这个值，用户可以适
当的调整缓存大小。</li> <li><code>Qcache_not_cached</code> 表示因为<code>query_cache_type</code>的设置而没有被缓存的查询数量。</li> <li><code>Qcache_queries_in_cache</code> 当前缓存中<code>缓存的查询数量</code>。</li> <li><code>Qcache_total_blocks</code> 当前缓存的 block 数量。</li></ul> <h4 id="解析器"><a href="#解析器" class="header-anchor">#</a> 解析器</h4> <p><strong>在解析器中对 SQL 语句进行语法分析、语义分析。</strong></p> <p>如果没有命中查询缓存，就要开始真正执行语句了。首先，MySQL 需要知道你要做什么，因此需要对 SQL 语句做解析。SQL 语句的分析分为词法分析与语法分析。</p> <p>分析器先做<code>词法分析</code>。你输入的是由多个字符串和空格组成的一条 SQL 语句，MySQL 需要识别出里面的字符串分别是什么，代表什么。</p> <p>MySQL 从你输入的&quot;select&quot;这个关键字识别出来，这是一个查询语句。它也要把字符串“T”识别成“表名 T”，把字符串“ID”识别成“列 ID”。</p> <p>接着，要做“<code>语法分析</code>”。根据词法分析的结果，语法分析器（比如：Bison）会根据语法规则，判断你输入的这个 SQL 语句是否<code>满足 MySQL 语法</code>。</p> <p>如果语句不对，就会收到“You have an error in your SQL syntax”的错误提醒。</p> <p>如果 SQL 语句正确，则会生成一个语法树</p> <p><img src="/assets/img/syntax_tree.b8d10378.webp" alt="syntax_tree"></p> <p>下图是 SQL 词法分析的步骤过程</p> <p><img src="/assets/img/parser.78f3e2d0.webp" alt="parser"></p> <p>至此解析器的工作任务也基本圆满了。接下来进入到优化器。</p> <h4 id="优化器"><a href="#优化器" class="header-anchor">#</a> 优化器</h4> <p><strong>优化器的作用</strong></p> <p>在优化器中会确定 SQL 语句的执行路径，比如是根据<code>全表检索</code>，还是根据<code>索引检索</code>等。</p> <p>经过了解析器，MySQL 就知道你要做什么了。在开始执行之前，还要先经过优化器的处理。<strong>一条查询可以有很多种执行方式，最后都返回相同的结果。优化器的作用就是找到这其中最好的执行计划。</strong></p> <p>比如：优化器是在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联(join)的时候，决定各个表的连接顺序，还有表达式简化、子查询转为连接、外连接转为内连接等。</p> <p>举例：如下语句是执行两个表的 join:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">join</span> test2 <span class="token keyword">using</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span>
<span class="token keyword">where</span> test1<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'zhangsan'</span><span class="token operator">and</span> test2<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'mysql高级课程'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>方案1：可以先从表test1里面取出name=’zhangwei’的记录的ID值，再根据ID值关联到表test2,再判断test2里面name的值是否等于’mysql高级课程’。

方案2：可以先从表test2里面取出name=’mysq1高级课程’的记录的ID值，再根据ID值关联到test1,再判断test1里面name的值是否等于zhangwei。

这两种执行方法的逻辑结果是一样的，但是执行的效率会有不同，而优化器的作用就是决定选择使用哪一个方案。优化器阶段后，这个语句的执行方案就确定下来了，然后进入执行器阶段。

如果你还有一些疑问，比如优化器是怎么选择索引的，有没有可能选择错等。后面讲到索引我们再谈
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>逻辑查询优化和物理查询优化</strong></p> <p>在查询优化器中，可以分为<code>逻辑查询优化</code>阶段和<code>物理查询优化</code>阶段。</p> <p>逻辑查询优化就是通过改变 SQL 语句的内容来使得 SQL 查询更高效，同时为物理查询优化提供更多的候选执行计划。通常采用的方式是对 SQL 语句进行<code>等价变换</code>，对查询进行<code>重写</code>，而查询重写的数学基础就是关系代数。对条件表达式进行等价谓词重写、条件简化，对视图进行重写，对子查询进行优化，对连接语义进行了外连接消除、嵌套连接消除等。</p> <p>物理查询优化是基于关系代数进行的查询重写，而关系代数的每一步都对应着物理计算，这些物理计算往往存在多种算法，因此需要计算各种物理路径的代价，从中选择代价最小的作为执行计划。在这个阶段里，对于单表和多表连接的操作，需要高效地<code>使用索引</code>，提升查询效率。</p> <h4 id="执行器"><a href="#执行器" class="header-anchor">#</a> 执行器</h4> <p>在执行之前需要判断该用户是否<code>具备权限</code>。如果没有，就会返回权限错误。如果具备权限，就执行 SQL 查询并返回结果。在 MySQL8.0 以下的版本，如果设置了查询缓存，这时会将查询结果进行缓存。</p> <p>如果有权限，就打开表继续执行。打开表的时候，执行器就会根据表的引擎定义，调用存储引擎<code>API</code>对表进行的读写。存储引擎<code>API</code>只是抽象接口，下面还有个<strong>存储引擎层</strong>，具体实现还是要看表选择的存储引擎。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>比如：表 test 中，ID 字段没有索引，那么执行器的执行流程是这样的：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>调用 InnoDB 引擎接口取这个表的第一行，判断 ID 值是不是1，如果不是则跳过，如果是则将这行存在结果集中；
调用引擎接口取“下一行”，重复相同的判断逻辑，直到取到这个表的最后一行。
执行器将上述遍历过程中所有满足条件的行组成的记录集作为结果集返回给客户端。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h4> <p>SQL 语句在 MySQL 中的流程是：<code>SQL语句→查询缓存→解析器→优化器→执行器</code>。</p> <p><img src="data:image/webp;base64,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" alt="SQL_EXECUTION_FLOW2"></p> <h3 id="_2-2-mysql8-中-sql-执行分析"><a href="#_2-2-mysql8-中-sql-执行分析" class="header-anchor">#</a> 2.2 MySQL8 中 SQL 执行分析</h3> <p>一条 SQL 语句会经历不同的模块，在不同的模块中，SQL 执行所使用的资源（时间）不同。</p> <p>下面通过命令行分析 SQL 语句的执行经过的模块和占用的时间。</p> <p><strong>查看 profiling 是否开启</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@profiling</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> @<span class="token variable">@profiling</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>           <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>

<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'profiling'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> profiling     <span class="token operator">|</span> <span class="token keyword">OFF</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>profiling=0 代表关闭，需要把 profiling 打开，即设置为 1：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> profiling<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>多次执行相同 SQL 查询</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>查看 profiles</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> profiles<span class="token punctuation">;</span> <span class="token comment"># 显示最近的几次查询</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------+</span>
<span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0.00189200</span> <span class="token operator">|</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'profiling'</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.00020325</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">0.00064575</span> <span class="token operator">|</span> <span class="token keyword">show</span> <span class="token keyword">databases</span>                  <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">0.00051400</span> <span class="token operator">|</span> <span class="token keyword">show</span> <span class="token keyword">tables</span>                     <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">0.00125675</span> <span class="token operator">|</span> <span class="token keyword">show</span> <span class="token keyword">tables</span>                     <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">0.00047500</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees         <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> <span class="token number">0.00054475</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>查看 profile</strong></p> <p>显示执行计划，查看程序的执行步骤</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 默认查询最后一次的执行过程(show profiles返回的Query_ID为7)</span>
<span class="token keyword">show</span> profile<span class="token punctuation">;</span>
<span class="token comment"># 查询指定的 Query ID</span>
<span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">7</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>                         <span class="token operator">|</span> Duration <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000103</span> <span class="token operator">|</span>
<span class="token operator">|</span> Executing hook <span class="token keyword">on</span> <span class="token keyword">transaction</span>  <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions           <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000044</span> <span class="token operator">|</span> 
<span class="token operator">|</span> init                           <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span> 
<span class="token operator">|</span> System <span class="token keyword">lock</span>                    <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> optimizing                     <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">statistics</span>                     <span class="token operator">|</span> <span class="token number">0.000023</span> <span class="token operator">|</span>
<span class="token operator">|</span> preparing                      <span class="token operator">|</span> <span class="token number">0.000022</span> <span class="token operator">|</span>
<span class="token operator">|</span> executing                      <span class="token operator">|</span> <span class="token number">0.000238</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">end</span>                            <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>
<span class="token operator">|</span> query <span class="token keyword">end</span>                      <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>
<span class="token operator">|</span> waiting <span class="token keyword">for</span> <span class="token keyword">handler</span> <span class="token keyword">commit</span>     <span class="token operator">|</span> <span class="token number">0.000009</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items                  <span class="token operator">|</span> <span class="token number">0.000030</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up                    <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ul><li><code>checking permissions</code> 权限检查</li> <li><code>Opening tables</code> 打开表</li> <li><code>init</code> 初始化</li> <li><code>System lock</code> 锁系统</li> <li><code>optimizing</code> 优化查询</li> <li><code>preparing</code> 准备</li> <li><code>executing</code> 执行</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 查询更丰富的内容</span>
<span class="token keyword">show</span> profile cpu<span class="token punctuation">,</span>block io <span class="token keyword">for</span> query <span class="token number">6</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>除了查看 cpu、io 阻塞等参数情况，还可以查询下列参数的利用情况</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>Syntax:
<span class="token keyword">SHOW</span> PROFILE <span class="token punctuation">[</span><span class="token keyword">type</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span>
	<span class="token punctuation">[</span><span class="token keyword">FOR</span> QUERY n<span class="token punctuation">]</span>
	<span class="token punctuation">[</span><span class="token keyword">LIMIT</span> row_count <span class="token punctuation">[</span><span class="token keyword">OFFSET</span> <span class="token keyword">offset</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">type</span>: {
	<span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token comment">-- 显示所有参数的开销信息</span>
	<span class="token operator">|</span> BLOCK IO <span class="token comment">-- 显示IO的相关开销</span>
	<span class="token operator">|</span> CONTEXT SWITCHES <span class="token comment">-- 上下文切换相关开销</span>
	<span class="token operator">|</span> CPU <span class="token comment">-- 显示CPU相关开销信息</span>
	<span class="token operator">|</span> IPC <span class="token comment">-- 显示发送和接收相关开销信息</span>
	<span class="token operator">|</span> MEMORY <span class="token comment">-- 显示内存相关开销信息</span>
	<span class="token operator">|</span> PAGE FAULTS <span class="token comment">-- 显示页面错误相关开销信息</span>
	<span class="token operator">|</span> SOURCE <span class="token comment">-- 显示和Source_function,Source_file,Source_line 相关的开销信息</span>
	<span class="token operator">|</span> SWAPS <span class="token comment">-- 显示交换次数相关的开销信息</span>
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_2-3-mysql5-7-中-sql-执行分析"><a href="#_2-3-mysql5-7-中-sql-执行分析" class="header-anchor">#</a> 2.3 MySQL5.7 中 SQL 执行分析</h3> <p>在 MySQL5.7 中测试，<code>显式开启查询缓存模式</code>。</p> <p><strong>在<code>/etc/my.cnf</code>配置文件中开启查询缓存</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">query_cache_type</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>重启服务器</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl restart mysqld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>开启查询执行计划</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> profiling<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>执行语句两次</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>查看 profiles</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profiles<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------+-------------------------+</span>
<span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+-------------------------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0.00058175</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.00009325</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+-------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>查看 profile</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>                         <span class="token operator">|</span> Duration <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000037</span> <span class="token operator">|</span>
<span class="token operator">|</span> Waiting <span class="token keyword">for</span> query cache <span class="token keyword">lock</span>   <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking query cache <span class="token keyword">for</span> query <span class="token operator">|</span> <span class="token number">0.000087</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions           <span class="token operator">|</span> <span class="token number">0.000009</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000020</span> <span class="token operator">|</span>
<span class="token operator">|</span> init                           <span class="token operator">|</span> <span class="token number">0.000025</span> <span class="token operator">|</span>
<span class="token operator">|</span> System <span class="token keyword">lock</span>                    <span class="token operator">|</span> <span class="token number">0.000009</span> <span class="token operator">|</span>
<span class="token operator">|</span> Waiting <span class="token keyword">for</span> query cache <span class="token keyword">lock</span>   <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> System <span class="token keyword">lock</span>                    <span class="token operator">|</span> <span class="token number">0.000018</span> <span class="token operator">|</span>
<span class="token operator">|</span> optimizing                     <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">statistics</span>                     <span class="token operator">|</span> <span class="token number">0.000013</span> <span class="token operator">|</span>
<span class="token operator">|</span> preparing                      <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span>
<span class="token operator">|</span> executing                      <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> Sending <span class="token keyword">data</span>                   <span class="token operator">|</span> <span class="token number">0.000259</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">end</span>                            <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>
<span class="token operator">|</span> query <span class="token keyword">end</span>                      <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items                  <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span>
<span class="token operator">|</span> Waiting <span class="token keyword">for</span> query cache <span class="token keyword">lock</span>   <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items                  <span class="token operator">|</span> <span class="token number">0.000028</span> <span class="token operator">|</span>
<span class="token operator">|</span> Waiting <span class="token keyword">for</span> query cache <span class="token keyword">lock</span>   <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items                  <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> storing result <span class="token operator">in</span> query cache  <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up                    <span class="token operator">|</span> <span class="token number">0.000016</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>                         <span class="token operator">|</span> Duration <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000043</span> <span class="token operator">|</span>
<span class="token operator">|</span> Waiting <span class="token keyword">for</span> query cache <span class="token keyword">lock</span>   <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking query cache <span class="token keyword">for</span> query <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking <span class="token keyword">privileges</span> <span class="token keyword">on</span> cached  <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions           <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>
<span class="token operator">|</span> sending cached result <span class="token keyword">to</span> clien <span class="token operator">|</span> <span class="token number">0.000022</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up                    <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><strong>从结果中可以看出查询语句直接从缓存中获取数据。</strong></p> <h3 id="_2-4-oracle-中的-sql-执行流程"><a href="#_2-4-oracle-中的-sql-执行流程" class="header-anchor">#</a> 2.4 Oracle 中的 SQL 执行流程</h3> <p>Oracle 中采用了<code>共享池</code>来判断 SQL 语句是否存在缓存和执行计划，通过这一步骤我们可以知道应该采用硬解析还是软解析。</p> <p><img src="/assets/img/Oracle_SQL_EXECUTION.41a412ef.webp" alt="Oracle_SQL_EXECUTION"></p> <p>从上面这张图中可以看出，SQL 语句在 Oracle 中经历了以下的几个步骤。</p> <p><strong>1. 语法检查：</strong> 检查 SQL 拼写是否正确，如果不正确，Oracle 会报语法错误。</p> <p><strong>2. 语义检查：</strong> 检查 SQL 中的访问对象是否存在。比如我们在写 SELECT 语句的时候，列名写错了，系统就会提示错误。语法检查和语义检查的作用是保证 SQL 语句没有错误。</p> <p><strong>3. 权限检查：</strong> 看用户是否具备访问该数据的权限。</p> <p><strong>4.共享池检查：</strong> 共享池（Shared Pool）是一块内存池，<strong>最主要的作用是缓存 SQL 语句和该语句的执行计划</strong>。Oracle 通过检查共享池是否存在 SQL 语句的执行计划，来判断进行软解析，还是硬解析。</p> <ul><li>在共享池中，Oracle 首先对 SQL 语句进行<code>Hash运算</code>，然后根据 Hash 值在库缓存（Library Cache）中查找，如果<code>存在SQL语句的执行计划</code>，就直接拿来执行，直接进入“执行器”的环节，这就是<code>软解析</code>。</li> <li>如果没有找到 SQL 语句和执行计划，Oracle 就需要创建解析树进行解析，生成执行计划，进入“优化器”这个步骤，这就是<code>硬解析</code>。</li></ul> <p><strong>5. 优化器：</strong> 优化器中就是要进行硬解析，也就是决定怎么做，比如创建解析树，生成执行计划。</p> <p><strong>6. 执行器：</strong> 当有了解析树和执行计划之后，就知道了 SQL 该怎么被执行，这样就可以在执行器中执行语句了。</p> <h4>共享池</h4> <p>共享池是 Oracle 中的术语，包括了库缓存，数据字典缓冲区等。<code>库缓存区</code>，它主要缓存 SQL 语句和执行计划。<code>数据字典缓冲区</code>存储的是 Oracle 中的对象定义，比如表、视图、索引等对象。当对 SQL 语句进行解析的时候，如果需要相关的数据，会从数据字典缓冲区中提取。</p> <p><code>库缓存</code>这一个步骤，决定了 SQL 语句是否需要进行硬解析。为了提升 SQL 的执行效率，我们应该尽量避免硬解析，因为在 SQL 的执行过程中，创建解析树，生成执行计划是很消耗资源的。</p> <p>如何避免硬解析，尽量使用软解析呢？在 Oracle 中，<code>绑定变量</code>是它的一大特色。绑定变量就是在 SQL 语句中使用变量，通过不同的变量取值来改变 SQL 的执行结果。这样做的好处是能<code>提升软解析的可能性</code>，不足之处在于可能会导致生成的执行计划不够优化，因此是否需要绑定变量还需要视情况而定。</p> <p>举个例子，我们可以使用下面的查询语句：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> player <span class="token keyword">where</span> player_id <span class="token operator">=</span> <span class="token number">10001</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>也可以使用绑定变量，如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> player <span class="token keyword">where</span> player_id <span class="token operator">=</span> :player_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这两个查询语句的效率在 Oracle 中是完全不同的。如果你在查询 player_id = 10001 之后，还会查询 10002 、 10003 之类的数据，那么每一次查询都会创建一个新的查询解析。而第二种方式使用了绑定变量，那么在第一次查询之后，在共享池中就会存在这类查询的执行计划，也就是软解析。</p> <p>因此，<strong>我们可以通过使用绑定变量来减少硬解析，减少 Oracle 的解析工作量。</strong> 但是这种方式也有缺点，使用动态 SQL 的方式，因为参数不同，会导致 SQL 的执行效率不同，同时 SQL 优化也会比较困难。</p> <p>Oracle 的架构图：</p> <p><img src="/assets/img/Architecture_Diagram.138a3190.webp" alt="Architecture_Diagram"></p> <p>简图：</p> <p><img src="/assets/img/Architecture_Diagram_Simple.bf615320.webp" alt="Architecture_Diagram_Simple"></p> <h2 id="_3-数据库缓冲池-buffer-pool"><a href="#_3-数据库缓冲池-buffer-pool" class="header-anchor">#</a> 3. 数据库缓冲池(buffer pool)</h2> <p><code>InnoDB</code>存储引擎是以页为单位来管理存储空间的，增删改查操作其实本质上都是在访问页面（包括读页面、写页面、创建新页面等操作）。而磁盘 I/O 需要消耗的时间很多，而在内存中进行操作，效率则会高很多，为了能让数据表或者索引中的数据随时被我们所用，DBMS 会申请<code>占用内存来作为数据缓冲池</code>，在真正访问页面之前，需要把在磁盘上的页缓存到内存中的<code>Buffer Pool</code>之后才可以访问。</p> <p>这样做的好处是可以让磁盘活动最小化，从而<code>减少与磁盘直接进行 I/O 的时间</code>。这种策略对提升 SQL 语句的查询性能来说至关重要。如果索引的数据在缓冲池里，那么访问的成本就会降低很多。</p> <h3 id="_3-1-缓冲池-vs-查询缓存"><a href="#_3-1-缓冲池-vs-查询缓存" class="header-anchor">#</a> 3.1 缓冲池 vs 查询缓存</h3> <h4>缓冲池(Buffer Pool)</h4> <p>在 InnoDB 存储引擎中有一部分数据会放到内存中，缓冲池则占了这部分内存的大部分，它用来存储各种数据的缓存</p> <p>InnoDB 缓冲池包括了数据页、索引页、插入缓存、锁信息、自适应 Hash 和数据字典信息等。</p> <p><strong>缓存池的重要性</strong></p> <p>对于使用<code>InnoDB</code>作为存储引擎的表来说，不管是用于存储用户数据的索引（包括聚簇索引和二级索引），还是各种系统数据，都是以<code>页</code>的形式存放在<code>表空间</code>中的，而所谓的表空间只不过是 InnoDB 对文件系统上一个或几个实际文件的抽象，也就是说我们的数据说到底还是存储在磁盘上的。但是各位也都知道，磁盘的速度慢的跟乌龟一样，怎么能配得上<code>“快如风，疾如电&quot;的CPU</code>呢？这里，缓冲池可以帮助我们消除 CPU 和磁盘之间的<code>鸿沟</code>。所以 InnoDB 存储引擎在处理客户端的请求时，当需要访问某个页的数据时，就会把<code>完整的页的数据全部加载到内存</code>中，也就是说即使我们只需要访问一个页的一条记录，那也需要先把整个页的数据加载到内存中。将整个页加载到内存中后就可以进行读写访问了，在进行完读写访问之后并不着急把该页对应的内存空间释放掉，而是将其<code>缓存</code>起来，这样将来有请求再次访问该页面时，就可以<code>省去磁盘IO的开销</code>了。</p> <p><strong>缓存原则</strong></p> <p><code>位置 * 频次</code> 这个原则，对 I/O 访问效率进行优化。</p> <p>首先，位置决定效率，提供缓冲池就是为了在内存中可以直接访问数据。</p> <p>其次，频次决定优先级顺序。因为缓冲池的大小是有限的，比如磁盘有 200G，但是内存只有 16G，缓冲池大小只有 1G，就无法将所有数据都加载到缓冲池里，这时就涉及到优先级顺序，会<code>优先对使用频次高的热数据进行加载</code>。</p> <p><strong>缓冲池的预读特性</strong></p> <p>缓冲池的作用就是提升 I/O 效率，而我们进行读取数据的时候存在一个“局部性原理”，也就是说我们使用了一些数据，<strong>大概率还会使用它周围的一些数据</strong>，因此采用“预读”的机制提前加载，可以减少未来可能的磁盘 I/O 操作。</p> <h4>查询缓存</h4> <p>查询缓存是提前把<code>查询结果缓存</code>起来，这样下次不需要执行就可以直接拿到结果。需要说明的是，在 MySQL 中的查询缓存，不是缓存查询计划，而是查询对应的结果。因为命中条件苛刻，而且只要数据表发生变化，查询缓存就会效，因此命中率低。</p> <p>缓冲池服务于数据库整体的/O 操作，它们的共同点都是通过缓存的机制来提升效率。</p> <h3 id="_3-2-缓冲池如何读取数据"><a href="#_3-2-缓冲池如何读取数据" class="header-anchor">#</a> 3.2 缓冲池如何读取数据</h3> <p>缓冲池管理器会尽量将经常使用的数据保存起来，在数据库进行页面读操作的时候，首先会判断该页面是否在缓冲池中，如果存在就直接读取，如果不存在，就会通过内存或磁盘将页面存放到缓冲池中再进行读取。</p> <p>缓存在数据库中的结构和作用如下图所示：</p> <p><img src="/assets/img/Buffer_Pool.533700c4.webp" alt="Buffer_Pool"></p> <p><strong>如果我们执行 SQL 语句的时候更新了缓存池中的数据，那么这些数据会马上同步到磁盘上吗？</strong></p> <p>实际上，当我们对数据库中的记录进行修改的时候，首先会修改缓冲池中页里面的记录信息，然后数据库会<code>以一定的频率刷新</code>到磁盘中。注意并不是每次发生更新操作，都会立即进行磁盘回写。缓冲池会采用一种叫做 <code>checkpoint 的机制</code> 将数据回写到磁盘上，这样做的好处就是提升了数据库的整体性能。</p> <p>比如，当<code>缓冲池不够用</code>时，需要释放掉一些不常用的页，此时就可以强行采用 checkpoint 的方式，将不常用的脏页回写到磁盘上，然后再从缓存池中将这些页释放掉。这里的脏页 (dirty page) 指的是缓冲池中被修改过的页，与磁盘上的数据页不一致。</p> <h3 id="_3-3-查看-设置缓冲池的大小"><a href="#_3-3-查看-设置缓冲池的大小" class="header-anchor">#</a> 3.3 查看/设置缓冲池的大小</h3> <p>Mysql MyISAM 存储引擎只缓存索引，不缓存数据，对应的键缓存参数为<code>key_buffer_size</code></p> <p>InnoDB 存储引擎，可以通过查看<code>innodb_buffer_pool_size</code>变量来查看缓冲池的大小。</p> <p><strong>查看缓冲池的大小</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'innodb_buffer_pool_size'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------------+-----------+</span>
<span class="token operator">|</span> Variable_name           <span class="token operator">|</span> <span class="token keyword">Value</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+-----------+</span>
<span class="token operator">|</span> innodb_buffer_pool_size <span class="token operator">|</span> <span class="token number">134217728</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+-----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>此时 InnoDB 的缓冲池大小是 <code>134217728/1024/1024=128MB</code></p> <p><strong>设置缓冲池的大小</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> innodb_buffer_pool_size <span class="token operator">=</span> <span class="token number">268435456</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">server</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">innodb_buffer_pool_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">268435456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-4-多个-buffer-pool-实例"><a href="#_3-4-多个-buffer-pool-实例" class="header-anchor">#</a> 3.4 多个 Buffer Pool 实例</h3> <p>Buffer Pool 本质是 InnoDB 向操作系统申请的一块<code>连续的内存空间</code>，在多线程环境下，访问 Buffer Pool 中的数据都需要<code>加锁</code>处理。在 Buffer Pool 特别大而且多线程并发访问特别高的情况下，单一的 Buffer Pool 可能会影响请求的处理速度。所以在 Buffer Pool 特别大的时候，可以把它们<code>拆分成若干个小的Buffer Pool</code>，每个 Buffer Pool 都称为一个<code>实例</code>，它们都是独立的，独立的去申请内存空间，独立的管理各种链表。所以在多线程并发访问时并不会相互影响，从而提高并发处理能力。</p> <p>可以在服务器启动的时候通过设置<code>innodb_buffer_pool_instances</code>的值来修改 Buffer Pool 实例的个数</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">server</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">innodb_buffer_pool_instances</span> <span class="token punctuation">=</span> <span class="token value attr-value">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>表明创建 2 个 <code>Buffer Pool</code> 实例</p> <p>查看缓冲池的个数</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'innodb_buffer_pool_instances'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>每个<code>Buffer Pool</code>实例实际占内存空间</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>innodb_buffer_pool_size/innodb_buffer_pool_instances
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>总共的大小除以实例的个数，结果就是每个<code>Buffer Pool</code>实例占用的大小。</p> <p>不过也不是说 Buffer Pool 实例创建的越多越好，分别<code>管理各个Buffer Pool也是需要性能开销的</code>，InnDB 规定：当 <code>innodb_buffer_pool_size</code> 的值小于 1G 的时候设置多个实例是无效的，InnoDB 会默认把 innodb_buffer_pool_instances 的值修改为 1。建议在 Buffer Pool 大于等于 1G 的时候设置多个 Buffer Pool 实例。</p> <h3 id="_3-5-引申问题"><a href="#_3-5-引申问题" class="header-anchor">#</a> 3.5 引申问题</h3> <p>Buffer Pool 是 MySQL 内存结构中十分核心的一个组成，可以先把它想象成一个黑盒子</p> <p><strong>黑盒下的更新数据流程</strong></p> <p>查询数据的时候，会先去 Buffer Pool 中查询。如果 Buffer Pool 中不存在，存储引擎会先将数据从磁盘加载到 Buffer Pool 中，然后将数据返回给客户端；同理，当我们更新某个数据的时候，如果这个数据不存在于 Buffer Pool，同样会先数据加载进来，然后修改内存的数据。被修改的数据会在之后统一刷入磁盘。</p> <p><img src="/assets/img/Buffer_Pool_Problem.0632f4ff.webp" alt="Buffer_Pool_Problem"></p> <p>这个过程看似没啥问题，实则是有问题的。假设我们修改 Buffer Pool 中的数据成功，但是还没来得及将数据刷入磁盘 MySQL 就挂了怎么办？按照上图的逻辑，此时更新之后的数据只存在于 Buffer Pool 中，如果此时 MySQL 宕机了，这部分数据将会永久地丢失；</p> <p>再者，更新到一半突然发生错误了，想要回滚到更新之前的版本，该怎么办？连数据持久化的保证、事务回滚都做不到还谈什么崩溃恢复？</p> <p>答案：<strong>Redo Log &amp; Undo Log</strong></p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/07/17, 22:40:25</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-3/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第03章_用户与权限管理</div></a> <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-5/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第05章_存储引擎</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-3/" class="prev">第03章_用户与权限管理</a></span> <span class="next"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-5/">第05章_存储引擎</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/jdbc-core/"><div>
            JDBC 核心技术(JDK21版)
            <!----></div></a> <span class="date">09-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/"><div>
            第00章_写在前面
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/"><div>
            第01章_Linux 下 MySQL 的安装与使用
            <!----></div></a> <span class="date">05-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca5c989c.js" defer></script><script src="/assets/js/3.f2884e99.js" defer></script><script src="/assets/js/2.81e8b964.js" defer></script><script src="/assets/js/46.dff72ed3.js" defer></script>
  </body>
</html>
