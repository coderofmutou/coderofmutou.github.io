<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安全框架之 Spring Security | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.ca5c989c.js" as="script"><link rel="preload" href="/assets/js/3.f2884e99.js" as="script"><link rel="preload" href="/assets/js/2.81e8b964.js" as="script"><link rel="preload" href="/assets/js/13.680e50fd.js" as="script"><link rel="prefetch" href="/assets/js/1.f754fd0b.js"><link rel="prefetch" href="/assets/js/10.bde6e567.js"><link rel="prefetch" href="/assets/js/100.000718ad.js"><link rel="prefetch" href="/assets/js/101.863f022a.js"><link rel="prefetch" href="/assets/js/102.7b45f43b.js"><link rel="prefetch" href="/assets/js/103.ba5681a8.js"><link rel="prefetch" href="/assets/js/104.e35b7e87.js"><link rel="prefetch" href="/assets/js/105.15a150cd.js"><link rel="prefetch" href="/assets/js/106.aea81b3b.js"><link rel="prefetch" href="/assets/js/107.4f4dec09.js"><link rel="prefetch" href="/assets/js/108.0079fda6.js"><link rel="prefetch" href="/assets/js/109.7a5059de.js"><link rel="prefetch" href="/assets/js/11.fa1b0bc7.js"><link rel="prefetch" href="/assets/js/110.85007649.js"><link rel="prefetch" href="/assets/js/111.dbec93e3.js"><link rel="prefetch" href="/assets/js/112.f17a38c0.js"><link rel="prefetch" href="/assets/js/113.6478506e.js"><link rel="prefetch" href="/assets/js/114.6031c0db.js"><link rel="prefetch" href="/assets/js/115.d7094af2.js"><link rel="prefetch" href="/assets/js/116.316a6234.js"><link rel="prefetch" href="/assets/js/117.1336f5e0.js"><link rel="prefetch" href="/assets/js/118.4b882789.js"><link rel="prefetch" href="/assets/js/119.503f83be.js"><link rel="prefetch" href="/assets/js/12.04b9b957.js"><link rel="prefetch" href="/assets/js/120.af7d94d8.js"><link rel="prefetch" href="/assets/js/121.5cd3597d.js"><link rel="prefetch" href="/assets/js/122.82f45642.js"><link rel="prefetch" href="/assets/js/123.f2ba0b19.js"><link rel="prefetch" href="/assets/js/14.dfca4100.js"><link rel="prefetch" href="/assets/js/15.01784967.js"><link rel="prefetch" href="/assets/js/16.81c1d5ab.js"><link rel="prefetch" href="/assets/js/17.9a472859.js"><link rel="prefetch" href="/assets/js/18.5366cb68.js"><link rel="prefetch" href="/assets/js/19.b1b74ef9.js"><link rel="prefetch" href="/assets/js/20.e938fa21.js"><link rel="prefetch" href="/assets/js/21.3e38db33.js"><link rel="prefetch" href="/assets/js/22.f9d18654.js"><link rel="prefetch" href="/assets/js/23.8eea4b67.js"><link rel="prefetch" href="/assets/js/24.6fe732dc.js"><link rel="prefetch" href="/assets/js/25.b1885cb6.js"><link rel="prefetch" href="/assets/js/26.936ee89a.js"><link rel="prefetch" href="/assets/js/27.fb3beb63.js"><link rel="prefetch" href="/assets/js/28.af721a74.js"><link rel="prefetch" href="/assets/js/29.427b7eae.js"><link rel="prefetch" href="/assets/js/30.2af5e34e.js"><link rel="prefetch" href="/assets/js/31.60102330.js"><link rel="prefetch" href="/assets/js/32.746872da.js"><link rel="prefetch" href="/assets/js/33.9466d03b.js"><link rel="prefetch" href="/assets/js/34.c7f7b0ef.js"><link rel="prefetch" href="/assets/js/35.53799eb8.js"><link rel="prefetch" href="/assets/js/36.e8875fc1.js"><link rel="prefetch" href="/assets/js/37.c386b2c5.js"><link rel="prefetch" href="/assets/js/38.ee46082f.js"><link rel="prefetch" href="/assets/js/39.11d092ff.js"><link rel="prefetch" href="/assets/js/4.920d0610.js"><link rel="prefetch" href="/assets/js/40.4ee40bcf.js"><link rel="prefetch" href="/assets/js/41.81c3174c.js"><link rel="prefetch" href="/assets/js/42.18f42b9d.js"><link rel="prefetch" href="/assets/js/43.7426d1ac.js"><link rel="prefetch" href="/assets/js/44.d5baff75.js"><link rel="prefetch" href="/assets/js/45.7b25c5ca.js"><link rel="prefetch" href="/assets/js/46.dff72ed3.js"><link rel="prefetch" href="/assets/js/47.15531a4f.js"><link rel="prefetch" href="/assets/js/48.48bbc098.js"><link rel="prefetch" href="/assets/js/49.49acd468.js"><link rel="prefetch" href="/assets/js/5.847584a2.js"><link rel="prefetch" href="/assets/js/50.e26ee1bf.js"><link rel="prefetch" href="/assets/js/51.6728bddb.js"><link rel="prefetch" href="/assets/js/52.c238e7bf.js"><link rel="prefetch" href="/assets/js/53.025903f6.js"><link rel="prefetch" href="/assets/js/54.05baf03a.js"><link rel="prefetch" href="/assets/js/55.b6fc3e0a.js"><link rel="prefetch" href="/assets/js/56.8e5ef1fc.js"><link rel="prefetch" href="/assets/js/57.db41b6fb.js"><link rel="prefetch" href="/assets/js/58.b4cb51f8.js"><link rel="prefetch" href="/assets/js/59.423b27e1.js"><link rel="prefetch" href="/assets/js/6.b384c550.js"><link rel="prefetch" href="/assets/js/60.57eff889.js"><link rel="prefetch" href="/assets/js/61.387a5103.js"><link rel="prefetch" href="/assets/js/62.23ba2982.js"><link rel="prefetch" href="/assets/js/63.2d69780b.js"><link rel="prefetch" href="/assets/js/64.d3f669fb.js"><link rel="prefetch" href="/assets/js/65.f5410640.js"><link rel="prefetch" href="/assets/js/66.59887fb2.js"><link rel="prefetch" href="/assets/js/67.01fba30e.js"><link rel="prefetch" href="/assets/js/68.8a6bbb81.js"><link rel="prefetch" href="/assets/js/69.12e673c4.js"><link rel="prefetch" href="/assets/js/70.a227d4b3.js"><link rel="prefetch" href="/assets/js/71.bd6a3bd7.js"><link rel="prefetch" href="/assets/js/72.4f2efca4.js"><link rel="prefetch" href="/assets/js/73.7dbf57a8.js"><link rel="prefetch" href="/assets/js/74.28c26d0a.js"><link rel="prefetch" href="/assets/js/75.d36a4feb.js"><link rel="prefetch" href="/assets/js/76.9123efc1.js"><link rel="prefetch" href="/assets/js/77.cbe2020d.js"><link rel="prefetch" href="/assets/js/78.7ab3eb40.js"><link rel="prefetch" href="/assets/js/79.bc69c4a8.js"><link rel="prefetch" href="/assets/js/80.da17de0b.js"><link rel="prefetch" href="/assets/js/81.1d16813f.js"><link rel="prefetch" href="/assets/js/82.586f2e97.js"><link rel="prefetch" href="/assets/js/83.129cc5fa.js"><link rel="prefetch" href="/assets/js/84.83d65ed9.js"><link rel="prefetch" href="/assets/js/85.f4327096.js"><link rel="prefetch" href="/assets/js/86.866a7d4f.js"><link rel="prefetch" href="/assets/js/87.f8aba274.js"><link rel="prefetch" href="/assets/js/88.43c5a138.js"><link rel="prefetch" href="/assets/js/89.b47b6d86.js"><link rel="prefetch" href="/assets/js/9.ef15744b.js"><link rel="prefetch" href="/assets/js/90.4950712a.js"><link rel="prefetch" href="/assets/js/91.80bbaffe.js"><link rel="prefetch" href="/assets/js/92.0d03ce50.js"><link rel="prefetch" href="/assets/js/93.fff94cff.js"><link rel="prefetch" href="/assets/js/94.91d0e36d.js"><link rel="prefetch" href="/assets/js/95.15227fb3.js"><link rel="prefetch" href="/assets/js/96.b3ef20b0.js"><link rel="prefetch" href="/assets/js/97.9e5e1675.js"><link rel="prefetch" href="/assets/js/98.b213b526.js"><link rel="prefetch" href="/assets/js/99.1ec76897.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b448e12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title router-link-active">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title router-link-active">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>安全框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/micro-service-ecology/SpringSecurity/" aria-current="page" class="active sidebar-link">安全框架之 Spring Security</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-框架简介" class="sidebar-link">SpringSecurity 框架简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#概要" class="sidebar-link">概要</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#同款产品对比" class="sidebar-link">同款产品对比</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#spring-security" class="sidebar-link">Spring Security</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#shiro" class="sidebar-link">Shiro</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#项目模块划分" class="sidebar-link">项目模块划分</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#权限管理中的相关概念" class="sidebar-link">权限管理中的相关概念</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#主体" class="sidebar-link">主体</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#认证" class="sidebar-link">认证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#授权" class="sidebar-link">授权</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#获取-spring-security" class="sidebar-link">获取 Spring Security</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#spring-boot-和-maven" class="sidebar-link">Spring Boot 和 Maven</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#没有使用-spring-boot-的-maven" class="sidebar-link">没有使用 Spring Boot 的 Maven</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#基本原理" class="sidebar-link">基本原理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#userdetailsservice-接口" class="sidebar-link">UserDetailsService 接口</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#passwordencoder-接口" class="sidebar-link">PasswordEncoder 接口</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#配置类实现-websecurityconfigureradapter-类" class="sidebar-link">配置类实现 WebSecurityConfigurerAdapter 类</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#csrf" class="sidebar-link">CSRF</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-微服务权限方案" class="sidebar-link">SpringSecurity 微服务权限方案</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#访问令牌-jwt" class="sidebar-link">访问令牌 JWT</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-原理总结" class="sidebar-link">SpringSecurity 原理总结</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-的过滤器介绍" class="sidebar-link">SpringSecurity 的过滤器介绍</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-基本流程" class="sidebar-link">SpringSecurity 基本流程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-认证流程" class="sidebar-link">SpringSecurity 认证流程</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#usernamepasswordauthenticationfilter-源码" class="sidebar-link">UsernamePasswordAuthenticationFilter 源码</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#providermanager-源码" class="sidebar-link">ProviderManager 源码</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#认证成功-失败处理" class="sidebar-link">认证成功/失败处理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-权限访问流程" class="sidebar-link">SpringSecurity 权限访问流程</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#exceptiontranslationfilter-过滤器" class="sidebar-link">ExceptionTranslationFilter 过滤器</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#filtersecurityinterceptor-过滤器" class="sidebar-link">FilterSecurityInterceptor 过滤器</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-请求间共享认证信息" class="sidebar-link">SpringSecurity 请求间共享认证信息</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#securitycontextpersistencefilter-过滤器" class="sidebar-link">SecurityContextPersistenceFilter 过滤器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#spring-security-快速入门" class="sidebar-link">Spring Security 快速入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#身份认证-authentication" class="sidebar-link">身份认证(authentication)</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#创建-spring-boot-项目" class="sidebar-link">创建 Spring Boot 项目</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#创建-indexcontroller" class="sidebar-link">创建 IndexController</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#创建-index-html" class="sidebar-link">创建 index.html</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#启动项目测试-controller" class="sidebar-link">启动项目测试 Controller</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#注意事项" class="sidebar-link">注意事项</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#logout-的作用" class="sidebar-link">@{/logout} 的作用</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#页面样式无法加载的问题" class="sidebar-link">页面样式无法加载的问题</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#spring-security-默认做了什么" class="sidebar-link">Spring Security 默认做了什么</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#spring-security-的底层原理" class="sidebar-link">Spring Security 的底层原理</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#程序的启动和运行" class="sidebar-link">程序的启动和运行</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#defaultsecurityfilterchain" class="sidebar-link">DefaultSecurityFilterChain</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#securitproperties" class="sidebar-link">SecuritProperties</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#spring-security-自定义配置" class="sidebar-link">Spring Security 自定义配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#基于内存的用户认证" class="sidebar-link">基于内存的用户认证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#创建自定义配置" class="sidebar-link">创建自定义配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#基于内存的用户认证流程" class="sidebar-link">基于内存的用户认证流程</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#基于数据库的数据源" class="sidebar-link">基于数据库的数据源</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#sql" class="sidebar-link">SQL</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#引入依赖" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#配置数据源" class="sidebar-link">配置数据源</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#实体类" class="sidebar-link">实体类</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#mapper" class="sidebar-link">Mapper</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#service" class="sidebar-link">Service</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#controller" class="sidebar-link">Controller</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#基于数据库的用户认证" class="sidebar-link">基于数据库的用户认证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#基于数据库的用户认证流程" class="sidebar-link">基于数据库的用户认证流程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#定义-dbuserdetailsmanager" class="sidebar-link">定义 DBUserDetailsManager</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#初始化-userdetailsservice" class="sidebar-link">初始化 UserDetailsService</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#springsecurity-的默认配置" class="sidebar-link">SpringSecurity 的默认配置</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#添加用户功能" class="sidebar-link">添加用户功能</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#controller-2" class="sidebar-link">Controller</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#sevice" class="sidebar-link">Sevice</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#修改配置" class="sidebar-link">修改配置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#使用-swagger-测试" class="sidebar-link">使用 Swagger 测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#关闭-csrf-攻击防御" class="sidebar-link">关闭 csrf 攻击防御</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#密码加密算法" class="sidebar-link">密码加密算法</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#密码加密方式" class="sidebar-link">密码加密方式</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#passwordencoder" class="sidebar-link">PasswordEncoder</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#密码加密测试" class="sidebar-link">密码加密测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#delegatingpasswordencoder" class="sidebar-link">DelegatingPasswordEncoder</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#自定义登录页面" class="sidebar-link">自定义登录页面</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#创建登录-controller" class="sidebar-link">创建登录 Controller</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#创建登录页面" class="sidebar-link">创建登录页面</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#配置-securityfilterchain" class="sidebar-link">配置 SecurityFilterChain</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#前后端分离" class="sidebar-link">前后端分离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#用户认证流程" class="sidebar-link">用户认证流程</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#引入-fastjson" class="sidebar-link">引入 fastjson</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#认证成功的响应" class="sidebar-link">认证成功的响应</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#成功结果处理" class="sidebar-link">成功结果处理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#securityfilterchain-配置" class="sidebar-link">SecurityFilterChain 配置</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#认证失败响应" class="sidebar-link">认证失败响应</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#失败结果处理" class="sidebar-link">失败结果处理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#securityfilterchain-配置-2" class="sidebar-link">SecurityFilterChain 配置</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#注销响应" class="sidebar-link">注销响应</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#注销结果处理" class="sidebar-link">注销结果处理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#securityfilterchain-配置-3" class="sidebar-link">SecurityFilterChain 配置</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#请求未认证的接口" class="sidebar-link">请求未认证的接口</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#实现-authenticationentrypoint-接口" class="sidebar-link">实现 AuthenticationEntryPoint 接口</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#securityfilterchain-配置-4" class="sidebar-link">SecurityFilterChain 配置</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#跨域" class="sidebar-link">跨域</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#身份认证" class="sidebar-link">身份认证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#用户认证信息" class="sidebar-link">用户认证信息</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#在-controller-中获取用户信息" class="sidebar-link">在 Controller 中获取用户信息</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#会话并发处理" class="sidebar-link">会话并发处理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#实现处理器接口" class="sidebar-link">实现处理器接口</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#securityfilterchain-配置-5" class="sidebar-link">SecurityFilterChain 配置</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#授权-2" class="sidebar-link">授权</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#基于-request-的授权" class="sidebar-link">基于 request 的授权</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#用户-权限-资源" class="sidebar-link">用户-权限-资源</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#配置权限" class="sidebar-link">配置权限</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#授予权限" class="sidebar-link">授予权限</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#请求未授权的接口" class="sidebar-link">请求未授权的接口</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#用户-角色-资源" class="sidebar-link">用户-角色-资源</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#配置角色" class="sidebar-link">配置角色</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#授予角色" class="sidebar-link">授予角色</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#用户-角色-权限-资源" class="sidebar-link">用户-角色-权限-资源</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#基于方法的授权" class="sidebar-link">基于方法的授权</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#开启方法授权" class="sidebar-link">开启方法授权</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#给用户授予角色和权限" class="sidebar-link">给用户授予角色和权限</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#常用授权注解" class="sidebar-link">常用授权注解</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#oauth2" class="sidebar-link">OAuth2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#oauth2-简介" class="sidebar-link">OAuth2 简介</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#oauth2-是什么" class="sidebar-link">OAuth2 是什么</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#oauth2-的角色" class="sidebar-link">OAuth2 的角色</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#oauth2-的使用场景" class="sidebar-link">OAuth2 的使用场景</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#开放系统间授权" class="sidebar-link">开放系统间授权</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#社交登录" class="sidebar-link">社交登录</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#开放-api" class="sidebar-link">开放 API</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#现代微服务安全" class="sidebar-link">现代微服务安全</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#单块应用安全" class="sidebar-link">单块应用安全</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#微服务安全" class="sidebar-link">微服务安全</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#企业内部应用认证授权" class="sidebar-link">企业内部应用认证授权</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#oauth2-的四种授权模式" class="sidebar-link">OAuth2 的四种授权模式</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#第一种方式-授权码" class="sidebar-link">第一种方式：授权码</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#第二种方式-隐藏式" class="sidebar-link">第二种方式：隐藏式</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#第三种方式-密码式" class="sidebar-link">第三种方式：密码式</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#第四种方式-凭证式" class="sidebar-link">第四种方式：凭证式</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#授权类型的选择" class="sidebar-link">授权类型的选择</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#spring-中的-oauth2" class="sidebar-link">Spring 中的 OAuth2</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#相关角色" class="sidebar-link">相关角色</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#spring-中的实现" class="sidebar-link">Spring 中的实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#相关依赖" class="sidebar-link">相关依赖</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#授权登录的实现思路" class="sidebar-link">授权登录的实现思路</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#giuhub-社交登录案例" class="sidebar-link">GiuHub 社交登录案例</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#创建应用" class="sidebar-link">创建应用</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#创建测试项目" class="sidebar-link">创建测试项目</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#配置-oauth-客户端属性" class="sidebar-link">配置 OAuth 客户端属性</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#创建-controller" class="sidebar-link">创建 Controller</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#创建-html-页面" class="sidebar-link">创建 html 页面</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#启动应用程序" class="sidebar-link">启动应用程序</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#案例分析" class="sidebar-link">案例分析</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#登录流程" class="sidebar-link">登录流程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#commonoauth2provider" class="sidebar-link">CommonOAuth2Provider</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#案例实战" class="sidebar-link">案例实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#开发环境" class="sidebar-link">开发环境</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#认证-2" class="sidebar-link">认证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#思路分析" class="sidebar-link">思路分析</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#登录" class="sidebar-link">登录</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#校验" class="sidebar-link">校验</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#准备工作" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#添加依赖" class="sidebar-link">添加依赖</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#添加-redis-相关配置" class="sidebar-link">添加 Redis 相关配置</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#fastjsonredisserializer" class="sidebar-link">FastJsonRedisSerializer</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#redisconfig" class="sidebar-link">RedisConfig</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#响应类-responseresult" class="sidebar-link">响应类 ResponseResult</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#工具类" class="sidebar-link">工具类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#jwt-工具类" class="sidebar-link">JWT 工具类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#redis-缓存" class="sidebar-link">Redis 缓存</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#将字符串渲染到客户端" class="sidebar-link">将字符串渲染到客户端</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#实体类-2" class="sidebar-link">实体类</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#user" class="sidebar-link">User</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#menu" class="sidebar-link">Menu</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#数据库校验用户" class="sidebar-link">数据库校验用户</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#准备工作-2" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#核心代码实现" class="sidebar-link">核心代码实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#密码加密存储" class="sidebar-link">密码加密存储</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#登录接口" class="sidebar-link">登录接口</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#logincontroller" class="sidebar-link">LoginController</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#loginservcie" class="sidebar-link">LoginServcie</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#securityconfig" class="sidebar-link">SecurityConfig</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#认证过滤器" class="sidebar-link">认证过滤器</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#认证过滤器-2" class="sidebar-link">认证过滤器</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#securityconfig-2" class="sidebar-link">SecurityConfig</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#退出登录" class="sidebar-link">退出登录</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#logincontroller-2" class="sidebar-link">LoginController</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#loginserviceimpl" class="sidebar-link">LoginServiceImpl</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#授权-3" class="sidebar-link">授权</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#权限系统的作用" class="sidebar-link">权限系统的作用</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#授权基本流程" class="sidebar-link">授权基本流程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#授权基本实现" class="sidebar-link">授权基本实现</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#rbac-权限模型" class="sidebar-link">RBAC 权限模型</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#准备工作-3" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#限制访问资源所需权限" class="sidebar-link">限制访问资源所需权限</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/SpringSecurity/#封装权限信息" class="sidebar-link">封装权限信息</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#loginuser" class="sidebar-link">LoginUser</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#userdetailsserviceimpl" class="sidebar-link">UserDetailsServiceImpl</a></li><li class="sidebar-sub-header level6"><a href="/micro-service-ecology/SpringSecurity/#jwtauthenticationtokenfilter" class="sidebar-link">JwtAuthenticationTokenFilter</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#跨域-2" class="sidebar-link">跨域</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#先对-springboot-配置-允许跨域请求" class="sidebar-link">先对 SpringBoot 配置，允许跨域请求</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#开启-springsecurity-的跨域访问" class="sidebar-link">开启 SpringSecurity 的跨域访问</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#其它知识点" class="sidebar-link">其它知识点</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#自定义失败处理器" class="sidebar-link">自定义失败处理器</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#其它权限校验方法" class="sidebar-link">其它权限校验方法</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#自定义权限校验方法" class="sidebar-link">自定义权限校验方法</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#基于配置的权限控制" class="sidebar-link">基于配置的权限控制</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/SpringSecurity/#csrf-2" class="sidebar-link">CSRF</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#认证方案总结" class="sidebar-link">认证方案总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#方案-1" class="sidebar-link">方案 1</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/SpringSecurity/#方案-2" class="sidebar-link">方案 2</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/SpringSecurity/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/micro-service-ecology/Shiro/" class="sidebar-link">安全框架之 Shiro</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>定时任务框架</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/micro-service-ecology/#微服务生态" data-v-06225672>微服务生态</a></li><li data-v-06225672><a href="/micro-service-ecology/#安全框架" data-v-06225672>安全框架</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-04-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">安全框架之 Spring Security<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="springsecurity-框架简介"><a href="#springsecurity-框架简介" class="header-anchor">#</a> SpringSecurity 框架简介</h2> <h3 id="概要"><a href="#概要" class="header-anchor">#</a> 概要</h3> <ul><li>Spring 是非常流行和成功的 Java 应用开发框架，SpringSecurity 正是 Spring 家族中的成员。SpringSecurity 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。</li> <li>正如你可能知道的关于安全方面的两个主要区域是“<strong>认证</strong>”和“<strong>授权</strong>”（或者访问控制），一般来说，Web 应用的安全性包括 <strong>用户认证(Authentication)和用户授权(Authorization)</strong> 两个部分，这两点也是 SpringSecurity 重要核心功能。
<ul><li>用户认证指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。<strong>通俗点说就是系统认为用户是否能登录</strong>。</li> <li>用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。<strong>通俗点讲就是系统判断用户是否有权限去做某些事情。</strong></li></ul></li></ul> <blockquote><p>Spring Security 是一个框架，提供针对常见攻击的身份验证，授权和保护。通过对命令式和反应式应用程序的一流支持，它是保护基于 Spring 的应用程序的事实标准。</p></blockquote> <h3 id="同款产品对比"><a href="#同款产品对比" class="header-anchor">#</a> 同款产品对比</h3> <h4 id="spring-security"><a href="#spring-security" class="header-anchor">#</a> <a href="https://spring.io/projects/spring-security" target="_blank" rel="noopener noreferrer">Spring Security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>Spring 技术栈的组成部分。通过提供完整可扩展的认证和授权支持保护你的应用程序。</p> <p><strong>特点：</strong></p> <ol><li>和 Spring 无缝整合。</li> <li>全面的权限控制。</li> <li>专门为 Web 开发而设计。</li> <li>旧版本不能脱离 Web 环境使用。</li> <li>新版本对整个框架进行了分层抽取，分成了核心模块和 Web 模块。单独引入核心模块就可以脱离 Web 环境。</li> <li>重量级。</li></ol> <h4 id="shiro"><a href="#shiro" class="header-anchor">#</a> Shiro</h4> <p>Apache 旗下的轻量级权限控制框架。</p> <p><strong>特点：</strong></p> <ol><li>轻量级。Shiro 主张的理念是把复杂的事情变简单。针对对性能有更高要求的互联网应用有更好表现。</li> <li>通用性。</li> <li>好处：不局限于 Web 环境，可以脱离 Web 环境使用。</li> <li>缺陷：在 Web 环境下一些特定的需求需要手动编写代码定制。</li></ol> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ul><li>Spring Security 是 Spring 家族中的一个安全管理框架，实际上，在 Spring Boot 出现之前，Spring Security 就已经发展了多年了，但是使用的并不多，安全管理这个领域，一直是 Shiro 的天下。</li> <li>相对于 Shiro，在 SSM 中整合 Spring Security 都是比较麻烦的操作，所以，Spring Security 虽然功能比 Shiro 强大，但是使用反而没有 Shiro 多（Shiro 虽然功能没有 Spring Security 多，但是对于大部分项目而言，Shiro 也够用了）。</li> <li>自从有了 Spring Boot 之后，Spring Boot 对于 Spring Security 提供了自动化配置方案，可以使用更少的配置来使用 Spring Security。</li> <li>因此，一般来说，常见的安全管理技术栈的组合是这样的：
<ul><li>SSM + Shiro</li> <li>Spring Boot/Spring Cloud + Spring Security</li></ul></li></ul> <blockquote><p>以上只是一个推荐的组合而已，如果单纯从技术上来说，无论怎么组合，都是可以运行的。</p></blockquote> <h3 id="项目模块划分"><a href="#项目模块划分" class="header-anchor">#</a> 项目模块划分</h3> <p>在 Spring Security 3.0 中，代码库被细分为单独的 jar，它们更清楚地区分不同的功能区域和第三方依赖项。如</p> <ol><li><strong>Core</strong></li></ol> <blockquote><p><code>spring-security-core.jar</code> 包含核心身份验证和 access-contol 类和接口，远程支持和基本配置 API。任何使用 Spring Security 的应用程序都需要。支持独立应用程序，远程客户端，方法（服务层）安全性和 JDBC 用户配置。包含顶级包：<code>org.springframework.security.core</code>、<code>org.springframework.security.access</code>、<code>org.springframework.security.authentication</code>、<code>org.springframework.security.provisioning</code>。</p></blockquote> <ol start="2"><li><strong>Remoting</strong></li></ol> <blockquote><p><code>spring-security-remoting.jar</code>提供与 Spring Remoting 的整合。除非正在编写使用 Spring 远程处理的远程客户端，否则不需要此操作。主要包是<code>org.springframework.security.remoting</code>。</p></blockquote> <ol start="3"><li><strong>Web</strong></li></ol> <blockquote><p><code>spring-security-web.jar</code>包含过滤器和相关的 web - 安全基础结构代码。任何具有 servlet API 依赖性的东西。如果您需要 Spring Security web 身份验证服务和基于 URL 的访问控制，则需要它。主要包是<code>org.springframework.security.web</code>。</p></blockquote> <ol start="4"><li><strong>Config</strong></li></ol> <blockquote><p><code>spring-security-config.jar</code>包含安全名称空间解析代码和 Java 配置代码。如果您使用 Spring Security XML 命名空间进行配置或 Spring Security 的 Java 配置支持，则需要它。主要包是<code>org.springframework.security.config</code>。这些类都不打算直接用于应用程序。</p></blockquote> <ol start="5"><li><strong>LDAP</strong></li></ol> <blockquote><p><code>spring-security-ldap.jar</code>LDAP 身份验证和配置代码。如果需要使用 LDAP 身份验证或管理 LDAP 用户条目，则为必需。顶级包是<code>org.springframework.security.ldap</code>。</p></blockquote> <ol start="6"><li><strong>OAuth 2.0 Core</strong></li></ol> <blockquote><p><code>spring-security-oauth2-core.jar</code> 包含为 OAuth 2.0 授权框架和 OpenID Connect Core 1.0 提供支持的核心类和接口。使用 OAuth 2.0 或 OpenID Connect Core 1.0 的应用程序（例如客户端，资源服务器和授权服务器）需要它。顶级包是<code>org.springframework.security.oauth2.core</code>。</p></blockquote> <ol start="7"><li><strong>OAuth 2.0 Client</strong></li></ol> <blockquote><p><code>spring-security-oauth2-client.jar</code> 是 Spring Security 对 OAuth 2.0 授权框架和 OpenID Connect Core 1.0 的客户端支持。应用程序需要利用<strong>OAuth 2.0 登录</strong>和/或 OAuth 客户端支持。顶级包是<code>org.springframework.security.oauth2.client</code>。</p></blockquote> <ol start="8"><li><strong>OAuth 2.0 JOSE</strong></li></ol> <blockquote><p><code>spring-security-oauth2-jose.jar</code> 包含 Spring Security 对 JOSE（Javascript 对象签名和加密）框架的支持。JOSE 旨在提供安全地传输双方之间的权利要求的方法。它由一系列规范构建：</p> <ul><li>JSON Web 令牌(JWT)</li> <li>JSON Web 签名(JWS)</li> <li>JSON Web 加密(JWE)</li> <li>JSON Web 密钥(JWK)</li></ul> <p>它包含顶级包：<code>org.springframework.security.oauth2.jwt</code>、<code>org.springframework.security.oauth2.jose</code></p></blockquote> <ol start="9"><li><strong>ACL</strong></li></ol> <blockquote><p><code>spring-security-acl.jar</code> 专门的域对象 ACL 实现。用于将安全性应用于应用程序中的特定域对象实例。顶级包是<code>org.springframework.security.acls</code>。</p></blockquote> <ol start="10"><li><strong>CAS</strong></li></ol> <blockquote><p><code>spring-security-cas.jar</code> Spring Security CAS 客户端集成。如果要对 CAS 单点登录服务器使用 Spring Security web 身份验证。顶级包是<code>org.springframework.security.cas</code>。</p></blockquote> <ol start="11"><li><strong>OpenID</strong></li></ol> <blockquote><p><code>spring-security-openid.jar</code> OpenID web 身份验证支持。用于针对外部 OpenID 服务器对用户进行身份验证。<code>org.springframework.security.openid</code>。需要 OpenID4Java。</p></blockquote> <ol start="12"><li><strong>Test</strong></li></ol> <blockquote><p><code>spring-security-test.jar</code> 支持使用 Spring Security 进行测试。</p></blockquote> <h3 id="权限管理中的相关概念"><a href="#权限管理中的相关概念" class="header-anchor">#</a> 权限管理中的相关概念</h3> <h4 id="主体"><a href="#主体" class="header-anchor">#</a> 主体</h4> <p>英文单词：principal。<strong>使用系统的用户或设备或从其他系统远程登录的用户等等</strong>。简单说就是谁使用系统谁就是主体。</p> <h4 id="认证"><a href="#认证" class="header-anchor">#</a> 认证</h4> <p>英文单词：authentication。<strong>权限管理系统确认一个主体的身份，允许主体进入系统</strong>。简单说就是“主体”证明自己是谁。笼统的认为就是以前所做的登录操作。</p> <h4 id="授权"><a href="#授权" class="header-anchor">#</a> 授权</h4> <p>英文单词：authorization。<strong>将操作系统的“权力”“授予”“主体”，这样主体就具备了操作系统中特定功能的能力</strong>。所以简单来说，授权就是给用户分配权限。</p> <h3 id="获取-spring-security"><a href="#获取-spring-security" class="header-anchor">#</a> 获取 Spring Security</h3> <h4 id="spring-boot-和-maven"><a href="#spring-boot-和-maven" class="header-anchor">#</a> Spring Boot 和 Maven</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- ... 其他依赖元素 ... --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="没有使用-spring-boot-的-maven"><a href="#没有使用-spring-boot-的-maven" class="header-anchor">#</a> 没有使用 Spring Boot 的 Maven</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-security.version</span><span class="token punctuation">&gt;</span></span>6.2.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-security.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- ... 其他依赖节点 ... --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-bom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>{spring-security-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <h4 id="基本原理"><a href="#基本原理" class="header-anchor">#</a> 基本原理</h4> <p>本质是一个过滤器链：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>request<span class="token punctuation">.</span>async<span class="token punctuation">.</span></span>WebAsyncManagerIntegrationFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>SecurityContextPersistenceFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>header<span class="token punctuation">.</span></span>HeaderWriterFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>csrf<span class="token punctuation">.</span></span>CsrfFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>logout<span class="token punctuation">.</span></span>LogoutFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span>UsernamePasswordAuthenticationFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span>DefaultLoginPageGeneratingFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span>DefaultLogoutPageGeneratingFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>savedrequest<span class="token punctuation">.</span></span>RequestCacheAwareFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servletapi<span class="token punctuation">.</span></span>SecurityContextHolderAwareRequestFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span>AnonymousAuthenticationFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span>SessionManagementFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span>ExceptionTranslationFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>access<span class="token punctuation">.</span>intercept<span class="token punctuation">.</span></span>FilterSecurityInterceptor</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>主要的三个过滤器：</p> <p><code>FilterSecurityInterceptor</code>：是一个方法级的权限过滤器, 基本位于过滤链的最底部。</p> <ul><li><code>super.beforeInvocation(fi)</code> 表示查看之前的 filter 是否通过。</li> <li><code>fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</code>表示真正的调用后台的服务。</li></ul> <p><img src="/assets/img/C38b0edDEb1711034791318-4b839450-b27a-472f-a61a-00e3606394df.4bf52c57.webp" alt="FilterSecurityInterceptor"></p> <p><code>ExceptionTranslationFilter</code>：是个异常过滤器，用来处理在认证授权过程中抛出的异常。</p> <p><img src="/assets/img/F9E78A11AB1711034804386-3ec8dbfc-8f07-4dc7-8119-b4630cb3b3ce.908d2054.webp" alt="ExceptionTranslationFilter"></p> <p><code>UsernamePasswordAuthenticationFilter</code> ：对 <code>/login</code> 的 POST 请求做拦截，校验表单中用户名，密码。</p> <p><img src="/assets/img/287e656c211711034807997-ada2495c-fa0a-4f21-8008-452ce0675f45.ebcb6ecb.webp" alt="UsernamePasswordAuthenticationFilter"></p> <h4 id="userdetailsservice-接口"><a href="#userdetailsservice-接口" class="header-anchor">#</a> UserDetailsService 接口</h4> <ul><li>当什么也没有配置的时候，账号和密码是由 Spring Security 定义生成的。而在实际项目中账号和密码都是从数据库中查询出来的。 所以我们要通过自定义逻辑控制认证逻辑。</li> <li><strong>如果需要自定义逻辑时，只需要实现 UserDetailsService 接口即可</strong>。接口定义如下：</li></ul> <p><img src="/assets/img/aa2c45CDD71706802405020-a58103b3-5190-4f4d-a382-37ddfd7e20c1.80e919b6.webp" alt="aa2c45CDD71706802405020"></p> <p>返回值 UserDetails。这个类是系统默认的用户“主体”，我们只需要使用 User 这个实体类即可！</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 表示获取登录用户所有权限</span>
<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示获取密码</span>
<span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示获取用户名</span>
<span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示判断账户是否过期</span>
<span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示判断账户是否被锁定</span>
<span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示凭证{密码}是否过期</span>
<span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示当前用户是否可用</span>
<span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="/assets/img/809bBEbC851706802592723-4599e3c9-52c8-470c-a8bd-faa9ffc4a745.41ec574b.webp" alt="809bBEbC851706802592723"></p> <p>方法参数 username：表示用户名。此值是客户端表单传递过来的数据。默认情况下必须叫 username，否则无法接收。但可以在配置类中通过以下方法修改：</p> <p><img src="data:image/webp;base64,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" alt="image"></p> <h4 id="passwordencoder-接口"><a href="#passwordencoder-接口" class="header-anchor">#</a> PasswordEncoder 接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 表示把参数按照特定的解析规则进行解析</span>
<span class="token class-name">String</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> rawPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示验证从存储中获取的编码密码与编码后提交的原始密码是否匹配。如果密码匹配，则返回 true；如果不匹配，则返回 false。第一个参数表示需要被解析的密码。第二个参数表示存储的密码。</span>
<span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> rawPassword<span class="token punctuation">,</span> <span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表示如果解析的密码能够再次进行解析且达到更安全的结果则返回 true，否则返回false。默认返回 false。</span>
<span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">upgradeEncoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>接口实现类：</p> <p><img src="/assets/img/e6da9DdfF51706802715081-12d2a7e5-1236-4927-9457-e6906b97e084.e6cb182c.webp" alt="e6da9DdfF51706802715081"></p> <p><strong>BCryptPasswordEncoder 是 Spring Security 官方推荐的密码解析器，平时多使用这个解析器</strong>。BCryptPasswordEncoder 是对 bcrypt 强散列方法的具体实现。是基于 Hash 算法实现的单向加密。可以通过 strength 控制加密强度，默认 10。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 创建密码解析</span>
    <span class="token class-name">BCryptPasswordEncoder</span> bCryptPasswordEncoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 对密码进行加密</span>
    <span class="token class-name">String</span> atguigu <span class="token operator">=</span> bCryptPasswordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印加密之后的数据</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;加密之后数据：\t&quot;</span><span class="token operator">+</span>atguigu<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">//判断原字符加密后和加密之前是否匹配</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> bCryptPasswordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">,</span> atguigu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印比较结果</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;比较结果：\t&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="配置类实现-websecurityconfigureradapter-类"><a href="#配置类实现-websecurityconfigureradapter-类" class="header-anchor">#</a> 配置类实现 WebSecurityConfigurerAdapter 类</h4> <blockquote><p>后续版本已经没有该配置类</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       auth<span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>userDetailsService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
<span class="token comment">//        http.formLogin()</span>
<span class="token comment">//                .usernameParameter(&quot;loginAcct&quot;)     // 获取登录用户名</span>
<span class="token comment">//                .passwordParameter(&quot;userpswd&quot;);     // 获取登录密码</span>

        <span class="token comment">// 退出</span>
        http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/test/hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 配置没有权限访问跳转自定义页面</span>
        http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accessDeniedPage</span><span class="token punctuation">(</span><span class="token string">&quot;/unauth.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// 自定义自己编写的登录页面</span>
                <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// 登录页面设置</span>
                <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span>     <span class="token comment">// 登录访问路径</span>
<span class="token comment">//                .defaultSuccessUrl(&quot;/test/index&quot;)   // 登录成功之后，跳转路径</span>
                <span class="token punctuation">.</span><span class="token function">defaultSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/success.html&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/test/hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 设置哪些路径可以直接访问，不需要认证</span>
                <span class="token comment">// 当前登录用户，只有具有admins权限才没有访问这个路径</span>
                <span class="token comment">// 1. hasAuthority()方法，如果当前的主体具有指定的权限，则返回 true,否则返回 false</span>
<span class="token comment">//                .antMatchers(&quot;/test/index&quot;).hasAuthority(&quot;admins&quot;)</span>
                <span class="token comment">// 2. hasAnyAuthority()方法，如果当前的主体有任何提供的角色的话，返回true.</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/test/index&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">hasAnyAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;admins&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;manager&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// 需要用户待用admins或manager全写</span>
                <span class="token comment">// 3. hasRole()方法，注意配置文件中不需要添加“ROLE_”，因为底层代码会自动添加与之进行匹配。</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/test/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;sale&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/findAll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;管理员&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/find&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAnyAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;menu:system&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// 其他请求</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">//需要认证</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 关闭csrf防护</span>
        http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">tokenRepository</span><span class="token punctuation">(</span><span class="token function">persistentTokenRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>   <span class="token comment">// 设置有效时长，单位秒</span>
                <span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>userDetailsService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h4> <ul><li>跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack 或者 session riding，通常缩写为 CSRF 或者 XSRF， 是一种挟制用户在当前已登录的 Web 应用程序上执行非本意的操作的攻击方法。跟跨网站脚本(XSS)相比，XSS 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。</li> <li>跨站请求攻击，简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去运行。这利用了 web 中用户身份验证的一个漏洞：简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。</li> <li>从 Spring Security 4.0 开始，<strong>默认情况下会启用 CSRF 保护</strong>，以防止 CSRF 攻击应用程序，Spring Security CSRF <strong>会针对 PATCH，POST，PUT 和 DELETE 方法进行防护</strong>。</li></ul> <h4 id="springsecurity-微服务权限方案"><a href="#springsecurity-微服务权限方案" class="header-anchor">#</a> SpringSecurity 微服务权限方案</h4> <ol><li>如果是基于 Session，那么 Spring security 会对 cookie 里的 sessionid 进行解析，找到服务器存储的 session 信息，然后判断当前用户是否符合请求的要求。</li> <li>如果是 token，则是解析出 token，然后将当前请求加入到 Spring security 管理的权限信息中去。</li></ol> <p><img src="/assets/img/C0FaDfdDAA1711036428762-f5cbfac2-3a98-4238-96d9-cb4985d4419a.74ffaca0.webp" alt="过程"></p> <p>如果系统的模块众多，每个模块都需要进行授权与认证，所以我们选择基于 token 的形式进行授权与认证，用户根据用户名密码认证成功，然后获取当前用户角色的一系列权限值，并以用户名为 key，权限列表为 value 的形式存入 redis 缓存中，根据用户名相关信息生成 token 返回，浏览器将 token 记录到 cookie 中，每次调用 api 接口都默认将 token 携带到 header 请求头中，Spring security 解析 header 头获取 token 信息，解析 token 获取当前用户名，根据用户名就可以从 redis 中获取权限列表，这样 Spring-security 就能够判断当前请求是否有权限访问。</p> <h4 id="访问令牌-jwt"><a href="#访问令牌-jwt" class="header-anchor">#</a> 访问令牌 JWT</h4> <p><img src="/assets/img/Be47C62fbA1711036511382-98c8f918-b082-4ae4-9a4c-c5d8f3e141b4.ff278698.webp" alt="JWT"></p> <h3 id="springsecurity-原理总结"><a href="#springsecurity-原理总结" class="header-anchor">#</a> SpringSecurity 原理总结</h3> <h4 id="springsecurity-的过滤器介绍"><a href="#springsecurity-的过滤器介绍" class="header-anchor">#</a> SpringSecurity 的过滤器介绍</h4> <p>SpringSecurity 采用的是责任链的设计模式，它有一条很长的过滤器链。现在对这条过滤器链的 15 个过滤器进行说明:</p> <ol><li><code>WebAsyncManagerIntegrationFilter</code>：将 Security 上下文与 Spring Web 中用于处理异步请求映射的 WebAsyncManager 进行集成。</li> <li><code>SecurityContextPersistenceFilter</code>：在每次请求处理之前将该请求相关的安全上下文信息加载到 SecurityContextHolder 中，然后在该次请求处理完成之后，将 SecurityContextHolder 中关于这次请求的信息存储到一个“仓储”中，然后将 SecurityContextHolder 中的信息清除，例如在 Session 中维护一个用户的安全信息就是这个过滤器处理的。</li> <li><code>HeaderWriterFilter</code>：用于将头信息加入响应中。</li> <li><code>CsrfFilter</code>：用于处理跨站请求伪造。</li> <li><code>LogoutFilter</code>：用于处理退出登录。</li> <li><code>UsernamePasswordAuthenticationFilter</code>：用于处理基于表单的登录请求，从表单中获取用户名和密码。默认情况下处理来自 <code>/login</code> 的请求。从表单中获取用户名和密码时，默认使用的表单 name 值为 <code>username</code> 和 <code>password</code>，这两个值可以通过设置这个过滤器的 <code>usernameParameter</code> 和 <code>passwordParameter</code> 两个参数的值进行修改。</li> <li><code>DefaultLoginPageGeneratingFilter</code>：如果没有配置登录页面，那系统初始化时就会配置这个过滤器，并且用于在需要进行登录时生成一个登录表单页面。</li> <li><code>BasicAuthenticationFilter</code>：检测和处理 http basic 认证。</li> <li><code>RequestCacheAwareFilter</code>：用来处理请求的缓存。</li> <li><code>SecurityContextHolderAwareRequestFilter</code>：主要是包装请求对象 request。</li> <li><code>AnonymousAuthenticationFilter</code>：检测 SecurityContextHolder 中是否存在 Authentication 对象，如果不存在为其提供一个匿名 Authentication。</li> <li><code>SessionManagementFilter</code>：管理 session 的过滤器。</li> <li><code>ExceptionTranslationFilter</code>：处理 AccessDeniedException 和 AuthenticationException 异常。</li> <li><code>FilterSecurityInterceptor</code>：可以看做过滤器链的出口。</li> <li><code>RememberMeAuthenticationFilter</code>：当用户没有登录而直接访问资源时, 从 cookie 里找出用户的信息, 如果 Spring Security 能够识别出用户提供的 remember me cookie, 用户将不必填写用户名和密码, 而是直接登录进入系统，该过滤器默认不开启。</li></ol> <h4 id="springsecurity-基本流程"><a href="#springsecurity-基本流程" class="header-anchor">#</a> SpringSecurity 基本流程</h4> <p>Spring Security 采取过滤链实现认证与授权，只有当前过滤器通过，才能进入下一个过滤器：</p> <p><img src="/assets/img/image-20240422214525224.0c54e0f2.webp" alt="image-20240422214525224"></p> <p><img src="/assets/img/image-20240625232502614.ae7f964a.webp" alt="image-20240625232502614"></p> <p><strong>绿色部分</strong>是认证过滤器，需要我们自己配置，可以配置多个认证过滤器。认证过滤器可以使用 Spring Security 提供的认证过滤器，也可以自定义过滤器（例如：短信验证）。认证过滤器要在 configure(HttpSecurity http)方法中配置，没有配置不生效。下面会重点介绍以下三个过滤器：</p> <p><code>UsernamePasswordAuthenticationFilter</code> 过滤器：该过滤器会拦截前端提交的 POST 方式的登录表单请求，并进行身份认证。</p> <p><code>ExceptionTranslationFilter</code> 过滤器：该过滤器不需要我们配置，对于前端提交的请求会直接放行，捕获后续抛出的异常并进行处理（例如：权限访问限制）。</p> <p><code>FilterSecurityInterceptor</code> 过滤器：该过滤器是过滤器链的最后一个过滤器，根据资源权限配置来判断当前请求是否有权限访问对应的资源。如果访问受限会抛出相关异常，并由 ExceptionTranslationFilter 过滤器进行捕获和处理。</p> <h4 id="springsecurity-认证流程"><a href="#springsecurity-认证流程" class="header-anchor">#</a> SpringSecurity 认证流程</h4> <p>认证流程是在 <code>UsernamePasswordAuthenticationFilter</code> 过滤器中处理的，具体流程如下所示：</p> <p><img src="/assets/img/23-认证流程.b3f098f5.webp" alt="23-认证流程"></p> <p><img src="/assets/img/image-20240625233441022.22198976.webp" alt="image-20240625233441022"></p> <h5 id="usernamepasswordauthenticationfilter-源码"><a href="#usernamepasswordauthenticationfilter-源码" class="header-anchor">#</a> UsernamePasswordAuthenticationFilter 源码</h5> <p>当前端提交的是一个 POST 方式的登录表单请求，就会被该过滤器拦截，并进行身份认证。该过滤器的 doFilter() 方法实现在其抽象父类<code>AbstractAuthenticationProcessingFilter</code> 中，查看相关源码：</p> <p><img src="/assets/img/image-20240422215055748.55b5a0e7.webp" alt="image-20240422215055748"></p> <p><img src="/assets/img/image-20240422215122699.a64ccc7e.webp" alt="image-20240422215122699"></p> <p><img src="/assets/img/image-20240422215152167.62148db0.webp" alt="image-20240422215214361"></p> <p><img src="/assets/img/image-20240422215214361.7df31606.webp" alt="image-20240422215214361"></p> <p><img src="/assets/img/image-20240422215231178.ffd0f72b.webp" alt="image-20240422215231178"></p> <p>上述的 第二 过程调用了 <code>UsernamePasswordAuthenticationFilter</code> 的 <code>attemptAuthentication()</code>方法，源码如下：</p> <p><img src="/assets/img/image-20240422215359136.5412dddc.webp" alt="image-20240422215359136"></p> <p><img src="/assets/img/image-20240422215419826.eed2c8e6.webp" alt="image-20240422215419826"></p> <p><img src="/assets/img/image-20240422215434883.3f869476.webp" alt="image-20240422215434883"></p> <p>上述的(3)过程创建的 <code>UsernamePasswordAuthenticationToken</code> 是 <code>Authentication</code> 接口的实现类，该类有两个构造器，一个用于封装前端请求传入的未认证的用户信息，一个用于封装认证成功后的用户信息：</p> <p><img src="/assets/img/image-20240422215532309.0526244c.webp" alt="image-20240422215532309"></p> <p><code>Authentication</code> 接口的实现类用于存储用户认证信息，查看该接口具体定义：</p> <p><img src="/assets/img/image-20240422215608321.8dfce1a1.webp" alt="image-20240422215608321"></p> <h5 id="providermanager-源码"><a href="#providermanager-源码" class="header-anchor">#</a> ProviderManager 源码</h5> <p>上述过程中，<code>UsernamePasswordAuthenticationFilter</code> 过滤器的 <code>attemptAuthentication()</code> 方法的(5)过程将未认证的 Authentication 对象传入 ProviderManager 类的 authenticate() 方法进行身份认证。</p> <p>ProviderManager 是 AuthenticationManager 接口的实现类，该接口是认证相关的核心接口，也是认证的入口。在实际开发中，我们可能有多种不同的认证方式，例如：用户名+ 密码、邮箱+密码、手机号+验证码等，而这些认证方式的入口始终只有一个，那就是 AuthenticationManager。在该接口的常用实现类 ProviderManager 内部会维护一个 <code>List&lt;AuthenticationProvider&gt;</code> 列表，存放多种认证方式，实际上这是委托者模式(Delegate)的应用。每种认证方式对应着一个 AuthenticationProvider， AuthenticationManager 根据认证方式的不同（根据传入的 Authentication 类型判断）委托对应的 AuthenticationProvider 进行用户认证。</p> <p><img src="/assets/img/image-20240422215814055.465557e5.webp" alt="image-20240422215814055"></p> <p><img src="/assets/img/image-20240422215855846.40386d34.webp" alt="image-20240422215855846"></p> <p><img src="/assets/img/image-20240422220007046.c233bbe3.webp" alt="image-20240422220007046"></p> <p><img src="/assets/img/image-20240422220029162.f22af21c.webp" alt="image-20240422220029162"></p> <p>上述认证成功之后的(6)过程，调用 <code>CredentialsContainer</code> 接口定义的 <code>eraseCredentials()</code> 方法去除敏感信息。查看<code>UsernamePasswordAuthenticationToken</code> 实现的 <code>eraseCredentials()</code> 方法，该方法实现在其父类中：</p> <p><img src="/assets/img/image-20240422220125987.ae29b1dc.webp" alt="image-20240422220125987"></p> <h5 id="认证成功-失败处理"><a href="#认证成功-失败处理" class="header-anchor">#</a> 认证成功/失败处理</h5> <p>上述过程就是认证流程的最核心部分，接下来重新回到 <code>UsernamePasswordAuthenticationFilter</code> 过滤器的 <code>doFilter()</code> 方法，查看认证成功/失败的处理：</p> <p><img src="/assets/img/image-20240422220235323.397f4fb1.webp" alt="image-20240422220235323"></p> <p>查看 <code>successfulAuthentication()</code> 和 <code>unsuccessfulAuthentication()</code> 方法源码</p> <p><img src="/assets/img/image-20240422220550530.fed8990d.webp" alt="image-20240422220550530"></p> <p><img src="/assets/img/24-认证流程中各核心类和接口的关系图.224d5cf0.webp" alt="24-认证流程中各核心类和接口的关系"></p> <h4 id="springsecurity-权限访问流程"><a href="#springsecurity-权限访问流程" class="header-anchor">#</a> SpringSecurity 权限访问流程</h4> <p>上一个部分通过源码的方式介绍了认证流程，下面介绍权限访问流程，主要是对 <code>ExceptionTranslationFilter</code> 过滤器和 <code>FilterSecurityInterceptor</code> 过滤器进行介绍。</p> <h5 id="exceptiontranslationfilter-过滤器"><a href="#exceptiontranslationfilter-过滤器" class="header-anchor">#</a> ExceptionTranslationFilter 过滤器</h5> <p>该过滤器是用于处理异常的，不需要我们配置，对于前端提交的请求会直接放行，捕获后续抛出的异常并进行处理（例如：权限访问限制）。具体源码如下：</p> <p><img src="/assets/img/image-20240422220805549.390836d6.webp" alt="image-20240422220805549"></p> <h5 id="filtersecurityinterceptor-过滤器"><a href="#filtersecurityinterceptor-过滤器" class="header-anchor">#</a> FilterSecurityInterceptor 过滤器</h5> <p><code>FilterSecurityInterceptor</code> 是过滤器链的最后一个过滤器，该过滤器是过滤器链的最后一个过滤器，根据资源权限配置来判断当前请求是否有权限访问对应的资源。如果访问受限会抛出相关异常，最终所抛出的异常会由前一个过滤器 <code>ExceptionTranslationFilter</code> 进行捕获和处理。具体源码如下：</p> <p><img src="/assets/img/image-20240422220933151.b4d16ebc.webp" alt="image-20240422220933151"></p> <p>需要注意，Spring Security 的过滤器链是配置在 SpringMVC 的核心组件 DispatcherServlet 运行之前。也就是说，请求通过 Spring Security 的所有过滤器， 不意味着能够正常访问资源，该请求还需要通过 SpringMVC 的拦截器链。</p> <h4 id="springsecurity-请求间共享认证信息"><a href="#springsecurity-请求间共享认证信息" class="header-anchor">#</a> SpringSecurity 请求间共享认证信息</h4> <p>一般认证成功后的用户信息是通过 Session 在多个请求之间共享，那么 Spring Security 中是如何实现将已认证的用户信息对象 Authentication 与 Session 绑定的进行具体分析。</p> <p><img src="/assets/img/image-20240422221118815.5287f5c2.webp" alt="image-20240422221118815"></p> <ul><li><p>在前面讲解认证成功的处理方法 <code>successfulAuthentication()</code> 时，有以下代码：</p> <p><img src="/assets/img/image-20240422221210869.698c74b9.webp" alt="image-20240422221210869"></p></li> <li><p>查看 SecurityContext 接口及其实现类 <code>SecurityContextImpl</code>， 该类其实就是对 Authentication 的封装</p> <p><img src="/assets/img/image-20240422221347113.b89a9f51.webp" alt="image-20240422221347113"></p></li> <li><p>查看  <code>SecurityContextHolder</code> 类 ， 该类其实是对 ThreadLocal 的封装 ， 存储 SecurityContext 对象</p> <p><img src="/assets/img/image-20240422221423767.a5d9c0f2.webp" alt="image-20240422221423767"></p> <p><img src="/assets/img/image-20240422221444667.6002d372.webp" alt="image-20240422221444667"></p></li></ul> <p><img src="/assets/img/image-20240422221511108.b2b48cea.webp" alt="image-20240422221511108"></p> <h5 id="securitycontextpersistencefilter-过滤器"><a href="#securitycontextpersistencefilter-过滤器" class="header-anchor">#</a> SecurityContextPersistenceFilter 过滤器</h5> <p>前面提到过，在 <code>UsernamePasswordAuthenticationFilter</code> 过滤器认证成功之后，会在认证成功的处理方法中将已认证的用户信息对象 Authentication 封装进 SecurityContext，并存入 SecurityContextHolder。</p> <p>之后，响应会通过 <code>SecurityContextPersistenceFilter</code> 过滤器，该过滤器的位置在所有过滤器的最前面，请求到来先进它，响应返回最后一个通过它，所以在该过滤器中处理已认证的用户信息对象 Authentication 与 Session 绑定。</p> <p>认证成功的响应通过 <code>SecurityContextPersistenceFilter</code> 过滤器时，会从 <code>SecurityContextHolder</code> 中取出封装了已认证用户信息对象 Authentication 的 SecurityContext，放进 Session 中。当请求再次到来时，请求首先经过该过滤器，该过滤器会判断当前请求的 Session 是否存有 SecurityContext 对象，如果有则将该对象取出再次放入 <code>SecurityContextHolder</code> 中，之后该请求所在的线程获得认证用户信息，后续的资源访问不需要进行身份认证；当响应再次返回时，该过滤器同样从 <code>SecurityContextHolder</code> 取出 SecurityContext 对象，放入 Session 中。具体源码如下：</p> <p><img src="/assets/img/image-20240422221927771.47d51c1f.webp" alt="image-20240422221927771"></p> <p><img src="/assets/img/image-20240422222009702.fcdbb8b7.webp" alt="image-20240422222009702"></p> <h2 id="spring-security-快速入门"><a href="#spring-security-快速入门" class="header-anchor">#</a> Spring Security 快速入门</h2> <p>官方文档：<a href="https://docs.spring.io/spring-security/reference/index.html" target="_blank" rel="noopener noreferrer">Spring Security :: Spring Security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>功能：</strong></p> <ul><li><p>身份认证(authentication)</p> <ul><li>身份认证是验证<code>谁正在访问系统资源</code>，判断用户是否为合法用户。认证用户的常见方式是要求用户输入用户名和密码。</li></ul></li> <li><p>授权(authorization)</p> <ul><li>用户进行身份认证后，系统会控制<code>谁能访问哪些资源</code>，这个过程叫做授权。用户无法访问没有权限的资源。</li></ul></li> <li><p>防御常见攻击(protection against common attacks)</p> <ul><li>CSRF</li> <li>HTTP Headers</li> <li>HTTP Requests</li></ul></li></ul> <h3 id="身份认证-authentication"><a href="#身份认证-authentication" class="header-anchor">#</a> 身份认证(authentication)</h3> <p><strong>官方代码示例：</strong><a href="https://github.com/spring-projects/spring-security-samples/tree/main" target="_blank" rel="noopener noreferrer">GitHub - spring-projects/spring-security-samples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="创建-spring-boot-项目"><a href="#创建-spring-boot-项目" class="header-anchor">#</a> 创建 Spring Boot 项目</h5> <p>项目名：<a href="https://gitee.com/ismutou/workspace_atguigu_idea/tree/master/springsecurity-study/springsecutity-new/security-demo" target="_blank" rel="noopener noreferrer">security-demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>JDK：17</li> <li>SpringBoot：3.2.0（依赖了 Spring Security 6.2.0）</li> <li>Dependencies：Spring Web、Spring Security、Thymeleaf</li></ul> <h5 id="创建-indexcontroller"><a href="#创建-indexcontroller" class="header-anchor">#</a> 创建 IndexController</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="创建-index-html"><a href="#创建-index-html" class="header-anchor">#</a> 创建 index.html</h5> <p>在路径 <code>resources/templates</code> 中创建 <code>index.html</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Hello Security!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello Security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--通过使用@{/logout}，Thymeleaf将自动处理生成正确的URL，以适应当前的上下文路径。
这样，无论应用程序部署在哪个上下文路径下，生成的URL都能正确地指向注销功能。--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/logout}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Log Out 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--如果设置server.servlet.context-path=/demo，此时该url就不能正确指向注销功能--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/logout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Log Out 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="启动项目测试-controller"><a href="#启动项目测试-controller" class="header-anchor">#</a> 启动项目测试 Controller</h5> <p>浏览器中访问：<code>http://localhost:8080/</code></p> <p><strong>浏览器自动跳转到登录页面</strong>：<code>http://localhost:8080/login</code></p> <p><img src="data:image/webp;base64,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" alt="image-20240623221627090"></p> <ol><li>输入用户名：user</li> <li>输入密码：在控制台的启动日志中查找初始的默认密码</li> <li>点击&quot;Sign in&quot;进行登录，浏览器就跳转到了 index 页面</li></ol> <h5 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h5> <h6 id="logout-的作用"><a href="#logout-的作用" class="header-anchor">#</a> <code>@{/logout}</code> 的作用</h6> <p>通过使用 <code>@{/logout}</code>，Thymeleaf 将自动处理生成正确的 URL，以适应当前的上下文路径。这样，无论应用程序部署在哪个上下文路径下，生成的 URL 都能正确地指向注销功能。</p> <p>例如：如果我们在配置文件中添加如下内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server.servlet.context<span class="token punctuation">-</span>path=/demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么 <code>@{/logout}</code> 可以自动处理 url 为正确的相对路径，但是如果是普通的 <code>/logout</code>，路径就会不正确</p> <h6 id="页面样式无法加载的问题"><a href="#页面样式无法加载的问题" class="header-anchor">#</a> 页面样式无法加载的问题</h6> <p>页面样式 <code>bootstrap.min.css</code> 是一个 CDN 地址，需要通过科学上网的方式访问</p> <p><img src="data:image/webp;base64,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" alt="image-20240623221916041"></p> <p>否则你的登录页会加载很久，并且看到的页面是这样的（登录按钮没有样式文件渲染，但是不影响登录功能的执行）</p> <p><img src="data:image/webp;base64,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" alt="image-20240623221930704"></p> <h5 id="spring-security-默认做了什么"><a href="#spring-security-默认做了什么" class="header-anchor">#</a> Spring Security 默认做了什么</h5> <ul><li>保护应用程序 URL，要求对应用程序的任何交互进行身份验证。</li> <li>程序启动时生成一个默认用户“user”。</li> <li>生成一个默认的随机密码，并将此密码记录在控制台上。</li> <li>生成默认的登录表单和注销页面。</li> <li>提供基于表单的登录和注销流程。</li> <li>对于 Web 请求，重定向到登录页面；</li> <li>对于服务请求，返回 401 未经授权。</li> <li>处理跨站请求伪造(CSRF)攻击。</li> <li>处理会话劫持攻击。</li> <li>写入 <code>Strict-Transport-Security</code> 以确保 HTTPS。</li> <li>写入 <code>X-Content-Type-Options</code> 以处理嗅探攻击。</li> <li>写入 <code>Cache Control</code>头来保护经过身份验证的资源。</li> <li>写入 <code>X-Frame-Options</code> 以处理点击劫持攻击。</li></ul> <h3 id="spring-security-的底层原理"><a href="#spring-security-的底层原理" class="header-anchor">#</a> Spring Security 的底层原理</h3> <p><strong>官方文档：</strong><a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html" target="_blank" rel="noopener noreferrer">Spring Security 的底层原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>中文文档：</strong><a href="https://springdoc.cn/spring-security/servlet/architecture.html" target="_blank" rel="noopener noreferrer">Spring Security 的底层原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Spring Security 之所以默认帮助我们做了那么多事情，它的底层原理是传统的<code>Servlet过滤器</code></p> <h3 id="程序的启动和运行"><a href="#程序的启动和运行" class="header-anchor">#</a> 程序的启动和运行</h3> <h4 id="defaultsecurityfilterchain"><a href="#defaultsecurityfilterchain" class="header-anchor">#</a> DefaultSecurityFilterChain</h4> <p>SecurityFilterChain 接口的实现，加载了默认的 16 个 Filter（根据版本不同可能有所不同）</p> <p><img src="/assets/img/image-20240623224306903.8b52081f.webp" alt="image-20240623224306903"></p> <h4 id="securitproperties"><a href="#securitproperties" class="header-anchor">#</a> SecuritProperties</h4> <p>默认情况下 Spring Security 将初始的用户名和密码存在了 SecurityProperties 类中。这个类中有一个静态内部类 User，配置了默认的用户名（<code>name = &quot;user&quot;</code>）和密码（<code>password = uuid</code>）</p> <p><img src="/assets/img/image-20240623224335383.2c9a8400.webp" alt="image-20240623224335383"></p> <p>我们也可以将用户名、密码配置在 SpringBoot 的配置文件中：在 <code>application.properties</code> 中配置自定义用户名和密码</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.security.user.name</span><span class="token punctuation">=</span><span class="token value attr-value">admin</span>
<span class="token key attr-name">spring.security.user.password</span><span class="token punctuation">=</span><span class="token value attr-value">111111</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="spring-security-自定义配置"><a href="#spring-security-自定义配置" class="header-anchor">#</a> Spring Security 自定义配置</h2> <p><strong>官方文档：</strong><a href="https://docs.spring.io/spring-security/reference/servlet/configuration/java.html" target="_blank" rel="noopener noreferrer">Java Configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>中文文档：</strong><a href="https://springdoc.cn/spring-security/servlet/configuration/java.html" target="_blank" rel="noopener noreferrer">Java 配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="基于内存的用户认证"><a href="#基于内存的用户认证" class="header-anchor">#</a> 基于内存的用户认证</h3> <h4 id="创建自定义配置"><a href="#创建自定义配置" class="header-anchor">#</a> 创建自定义配置</h4> <p>实际开发的过程中，我们需要应用程序更加灵活，可以在 SpringSecurity 中创建自定义配置文件</p> <p><strong>UserDetailsService</strong> 用来管理用户信息，<strong>InMemoryUserDetailsManager</strong> 是 UserDetailsService 的一个实现，用来管理基于内存的用户信息。</p> <p>创建一个 WebSecurityConfig 文件，定义一个 Bean，类型是 UserDetailsService，实现是 InMemoryUserDetailsManager</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token comment">//@EnableWebSecurity // Spring 项目总需要添加此注解（在 SpringBoot 项目中可以省略此注解）</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建基于内存的用户信息管理器</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用 manager 管理 UserDetailsService 对象</span>
        manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>
                <span class="token comment">// 创建 UserDetailsService 对象，用于管理用户名、密码、角色、权限等内润</span>
                <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>测试</strong>：使用用户名 user，密码 111111 登录</p> <h4 id="基于内存的用户认证流程"><a href="#基于内存的用户认证流程" class="header-anchor">#</a> 基于内存的用户认证流程</h4> <ul><li>程序启动时：
<ul><li>创建<code>InMemoryUserDetailsManager</code>对象</li> <li>创建 <code>User</code> 对象，封装用户名密码</li> <li>使用 <code>InMemoryUserDetailsManager</code> 将 <code>User</code> 存入<code>内存</code></li></ul></li> <li>校验用户时：
<ul><li>SpringSecurity 自动使用 <code>InMemoryUserDetailsManager</code> 的<code>loadUserByUsername</code>方法从<code>内存中</code>获取 User 对象</li> <li>在 <code>UsernamePasswordAuthenticationFilter</code> 过滤器中的 <code>attemptAuthentication</code> 方法中将用户输入的用户名密码和从内存中获取到的用户信息进行比较，进行用户认证</li></ul></li></ul> <h3 id="基于数据库的数据源"><a href="#基于数据库的数据源" class="header-anchor">#</a> 基于数据库的数据源</h3> <h4 id="sql"><a href="#sql" class="header-anchor">#</a> SQL</h4> <p>创建数据库表 user 并插入三个测试数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token identifier"><span class="token punctuation">`</span>spring_security<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">USE</span> <span class="token identifier"><span class="token punctuation">`</span>spring_security<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token comment">-- 创建用户表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>enabled<span class="token punctuation">`</span></span> <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 唯一索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>user_username_uindex<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">-- 插入用户数据(密码是 &quot;password&quot; )</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>enabled<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'{bcrypt}$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW'</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Helen'</span><span class="token punctuation">,</span> <span class="token string">'{bcrypt}$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW'</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">,</span> <span class="token string">'{bcrypt}$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW'</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.4.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="配置数据源"><a href="#配置数据源" class="header-anchor">#</a> 配置数据源</h4> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#MySQL数据源</span>
<span class="token key attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/spring_security</span>
<span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>
<span class="token comment">#SQL日志</span>
<span class="token key attr-name">mybatis-plus.configuration.log-impl</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.ibatis.logging.stdout.StdOutImpl</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="实体类"><a href="#实体类" class="header-anchor">#</a> 实体类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="mapper"><a href="#mapper" class="header-anchor">#</a> Mapper</h4> <ul><li>接口</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>xml</li></ul> <p><code>resources/mapper/UserMapper.xml</code></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.securitydemo.mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="service"><a href="#service" class="header-anchor">#</a> Service</h4> <ul><li>接口</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>实现</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserMapper</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="controller"><a href="#controller" class="header-anchor">#</a> Controller</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">public</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>测试：</strong><code>http://localhost:8080/demo/user/list</code></p> <h3 id="基于数据库的用户认证"><a href="#基于数据库的用户认证" class="header-anchor">#</a> 基于数据库的用户认证</h3> <h4 id="基于数据库的用户认证流程"><a href="#基于数据库的用户认证流程" class="header-anchor">#</a> 基于数据库的用户认证流程</h4> <ul><li>程序启动时：
<ul><li>创建 <code>DBUserDetailsManager</code> 类，实现接口 <code>UserDetailsManager, UserDetailsPasswordService</code></li> <li>在应用程序中初始化这个类的对象</li></ul></li> <li>校验用户时：
<ul><li>SpringSecurity 自动使用 <code>DBUserDetailsManager</code> 的 <code>loadUserByUsername</code> 方法从<code>数据库中</code>获取 User 对象</li> <li>在 <code>UsernamePasswordAuthenticationFilter</code> 过滤器中的 <code>attemptAuthentication</code> 方法中将用户输入的用户名密码和从数据库中获取到的用户信息进行比较，进行用户认证</li></ul></li></ul> <h4 id="定义-dbuserdetailsmanager"><a href="#定义-dbuserdetailsmanager" class="header-anchor">#</a> 定义 DBUserDetailsManager</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DBUserDetailsManager</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsManager</span><span class="token punctuation">,</span> <span class="token class-name">UserDetailsPasswordService</span> <span class="token punctuation">{</span>
        
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * 从数据库中获取用户信息
     * @param username the username identifying the user whose data is required.
     * @return
     * @throws UsernameNotFoundException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span><span class="token punctuation">(</span>
                user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                user<span class="token punctuation">.</span><span class="token function">getEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 用户账号是否过期</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 用户凭证是否过期</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 用户是否被锁定</span>
                authorities <span class="token comment">// 权限列表</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> newPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changePassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> oldPassword<span class="token punctuation">,</span> <span class="token class-name">String</span> newPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">userExists</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h4 id="初始化-userdetailsservice"><a href="#初始化-userdetailsservice" class="header-anchor">#</a> 初始化 UserDetailsService</h4> <p>修改 WebSecurityConfig 中的 userDetailsService 方法如下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DBUserDetailsManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DBUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>或者直接在 DBUserDetailsManager 类上添加 <code>@Component</code> 注解</strong></p> <p><strong>测试</strong>：使用数据库中配置的用户名和密码进行登录(password:password)</p> <h3 id="springsecurity-的默认配置"><a href="#springsecurity-的默认配置" class="header-anchor">#</a> SpringSecurity 的默认配置</h3> <p>在 WebSecurityConfig 中添加如下配置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">//authorizeRequests()：开启授权保护</span>
    <span class="token comment">//anyRequest()：对所有请求开启授权保护</span>
    <span class="token comment">//authenticated()：已认证请求会自动被授权</span>
    http
        <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//表单授权方式</span>
        <span class="token punctuation">.</span><span class="token function">httpBasic</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//基本授权方式</span>

    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="添加用户功能"><a href="#添加用户功能" class="header-anchor">#</a> 添加用户功能</h3> <h4 id="controller-2"><a href="#controller-2" class="header-anchor">#</a> Controller</h4> <p>UserController 中添加方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    userService<span class="token punctuation">.</span><span class="token function">saveUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="sevice"><a href="#sevice" class="header-anchor">#</a> Sevice</h4> <p>UserService 接口中添加方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">saveUserDetails</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>UserServiceImpl 实现中添加方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserMapper</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">DBUserDetailsManager</span> dbUserDetailsManager<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveUserDetails</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span>
                <span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbUserDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="修改配置"><a href="#修改配置" class="header-anchor">#</a> 修改配置</h4> <p>DBUserDetailsManager 中添加方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> userDetails<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="使用-swagger-测试"><a href="#使用-swagger-测试" class="header-anchor">#</a> 使用 Swagger 测试</h4> <p>pom 中添加配置用于测试</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--swagger测试--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.xiaoymin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>knife4j-openapi3-jakarta-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Swagger 测试地址</strong>：<code>http://localhost:8080/demo/doc.html</code></p> <p><img src="/assets/img/image-20240624213206246.4a2e3e39.webp" alt="image-20240624213206246"></p> <h4 id="关闭-csrf-攻击防御"><a href="#关闭-csrf-攻击防御" class="header-anchor">#</a> 关闭 csrf 攻击防御</h4> <p>默认情况下 SpringSecurity 开启了 csrf 攻击防御的功能，这要求请求参数中必须有一个隐藏的 <strong>_csrf</strong> 字段，如下：</p> <p><img src="/assets/img/image-20240624213236887.1bb32f76.webp" alt="image-20240624213236887"></p> <p>在 filterChain 方法中添加如下代码，关闭 csrf 攻击防御</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//关闭csrf攻击防御</span>
http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>csrf<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="密码加密算法"><a href="#密码加密算法" class="header-anchor">#</a> 密码加密算法</h3> <p><strong>参考文档：</strong><a href="https://docs.spring.io/spring-security/reference/features/authentication/password-storage.html" target="_blank" rel="noopener noreferrer">Password Storage :: Spring Security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://springdoc.cn/spring-security/features/authentication/password-storage.html" target="_blank" rel="noopener noreferrer">密码存储 :: Spring Security Reference (springdoc.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="密码加密方式"><a href="#密码加密方式" class="header-anchor">#</a> 密码加密方式</h4> <ol><li><p><strong>明文密码</strong></p> <p>最初，密码以明文形式存储在数据库中。但是恶意用户可能会通过 SQL 注入等手段获取到明文密码，或者程序员将数据库数据泄露的情况也可能发生。</p></li> <li><p><strong>Hash 算法</strong></p> <p>Spring Security 的 <code>PasswordEncoder</code> 接口用于对密码进行<code>单向转换</code>，从而将密码安全地存储。对密码单向转换需要用到<code>哈希算法</code>，例如 MD5、SHA-256、SHA-512 等，哈希算法是单向的，<code>只能加密，不能解密</code>。</p> <p>因此，<code>数据库中存储的是单向转换后的密码</code>，Spring Security 在进行用户身份验证时需要将用户输入的密码进行单向转换，然后与数据库的密码进行比较。</p> <p>因此，如果发生数据泄露，只有密码的单向哈希会被暴露。由于哈希是单向的，并且在给定哈希的情况下只能通过<code>暴力破解的方式猜测密码</code>。</p></li> <li><p><strong>彩虹表</strong></p> <p>恶意用户创建称为<code>彩虹表</code>的查找表。彩虹表就是一个庞大的、针对各种可能的字母组合预先生成的哈希值集合，有了它可以快速破解各类密码。越是复杂的密码，需要的彩虹表就越大，主流的彩虹表都是 100G 以上，目前主要的算法有 LM, NTLM, MD5, SHA1, MYSQLSHA1, HALFLMCHALL, NTLMCHALL, ORACLE-SYSTEM, MD5-HALF。</p></li> <li><p><strong>加盐密码</strong></p> <p>为了减轻彩虹表的效果，开发人员开始使用加盐密码。不再只使用密码作为哈希函数的输入，而是为每个用户的密码生成随机字节（称为盐）。盐和用户的密码将一起经过哈希函数运算，生成一个唯一的哈希。盐将以明文形式与用户的密码一起存储。然后，当用户尝试进行身份验证时，盐和用户输入的密码一起经过哈希函数运算，再与存储的密码进行比较。唯一的盐意味着彩虹表不再有效，因为对于每个盐和密码的组合，哈希都是不同的。</p></li> <li><p><strong>自适应单向函数</strong></p> <p>随着硬件的不断发展，加盐哈希也不再安全。原因是，计算机可以每秒执行数十亿次哈希计算。这意味着我们可以轻松地破解每个密码。</p> <p>现在，开发人员开始使用自适应单向函数来存储密码。使用自适应单向函数验证密码时，<code>故意占用资源（故意使用大量的CPU、内存或其他资源）</code>。自适应单向函数允许配置一个<code>“工作因子”</code>，随着硬件的改进而增加。我们建议将“工作因子”调整到系统中验证密码需要约一秒钟的时间。这种权衡是为了<code>让攻击者难以破解密码</code>。</p> <p>自适应单向函数包括 <code>bcrypt、PBKDF2、scrypt和argon2</code>。</p></li></ol> <h4 id="passwordencoder"><a href="#passwordencoder" class="header-anchor">#</a> PasswordEncoder</h4> <ol><li><p><strong>BCryptPasswordEncoder</strong></p> <p>使用广泛支持的 bcrypt 算法来对密码进行哈希。为了增加对密码破解的抵抗力，bcrypt 故意设计得较慢。和其他自适应单向函数一样，应该调整其参数，使其在您的系统上验证一个密码大约需要 1 秒的时间。BCryptPasswordEncoder 的默认实现使用强度 10。建议您在自己的系统上调整和测试强度参数，以便验证密码时大约需要 1 秒的时间。</p></li> <li><p><strong>Argon2PasswordEncoder</strong></p> <p>使用 Argon2 算法对密码进行哈希处理。Argon2 是密码哈希比赛的获胜者。为了防止在自定义硬件上进行密码破解，Argon2 是一种故意缓慢的算法，需要大量内存。与其他自适应单向函数一样，它应该在您的系统上调整为大约 1 秒来验证一个密码。当前的 Argon2PasswordEncoder 实现需要使用 BouncyCastle 库。</p></li> <li><p><strong>Pbkdf2PasswordEncoder</strong></p> <p>使用 PBKDF2 算法对密码进行哈希处理。为了防止密码破解，PBKDF2 是一种故意缓慢的算法。与其他自适应单向函数一样，它应该在您的系统上调整为大约 1 秒来验证一个密码。当需要 FIPS 认证时，这种算法是一个很好的选择。</p></li></ol> <p><img src="/assets/img/image-20240624214136392.776591be.webp" alt="image-20240624214136392"></p> <ol start="4"><li><p><strong>SCryptPasswordEncoder</strong></p> <p>使用 scrypt 算法对密码进行哈希处理。为了防止在自定义硬件上进行密码破解，scrypt 是一种故意缓慢的算法，需要大量内存。与其他自适应单向函数一样，它应该在您的系统上调整为大约 1 秒来验证一个密码。</p></li></ol> <h4 id="密码加密测试"><a href="#密码加密测试" class="header-anchor">#</a> 密码加密测试</h4> <p>在测试类中编写一个测试方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 工作因子，默认值是10，最小值是4，最大值是31，值越大运算速度越慢</span>
    <span class="token class-name">PasswordEncoder</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//明文：&quot;password&quot;</span>
    <span class="token comment">//密文：result，即使明文密码相同，每次生成的密文也不一致</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//密码校验</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>encoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;密码不一致&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="delegatingpasswordencoder"><a href="#delegatingpasswordencoder" class="header-anchor">#</a> DelegatingPasswordEncoder</h4> <ul><li>表中存储的密码形式：<code>{bcrypt}$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW</code></li> <li>通过如下源码可以知道：可以通过<code>{bcrypt}</code>前缀动态获取和密码的形式类型一致的 PasswordEncoder 对象</li> <li>目的：方便随时做密码策略的升级，兼容数据库中的老版本密码策略生成的密码</li></ul> <p><img src="/assets/img/image-20240624215713088.c07e6176.webp" alt="image-20240624215713088"></p> <h3 id="自定义登录页面"><a href="#自定义登录页面" class="header-anchor">#</a> 自定义登录页面</h3> <h4 id="创建登录-controller"><a href="#创建登录-controller" class="header-anchor">#</a> 创建登录 Controller</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="创建登录页面"><a href="#创建登录页面" class="header-anchor">#</a> 创建登录页面</h4> <p><code>resources/templates/login.html</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${param.error}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    错误的用户名和密码.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--method必须为&quot;post&quot;--&gt;</span>
<span class="token comment">&lt;!--th:action=&quot;@{/login}&quot; ，
使用动态参数，表单中会自动生成_csrf隐藏字段，用于防止csrf攻击
login: 和登录页面保持一致即可，SpringSecurity自动进行登录认证--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/login}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--name必须为&quot;username&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--name必须为&quot;password&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>密码<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="配置-securityfilterchain"><a href="#配置-securityfilterchain" class="header-anchor">#</a> 配置 SecurityFilterChain</h4> <p>SecurityConfiguration：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启授权保护</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize
                           <span class="token comment">// 对所有请求开启授权保护</span>
                           <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token comment">// 已认证的请求会被自动授权</span>
                           <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 无需授权即可访问当前页面</span>
                <span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;myusername&quot;</span><span class="token punctuation">)</span> <span class="token comment">//自定义表单用户名参数，默认是username</span>
                <span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;mypassword&quot;</span><span class="token punctuation">)</span> <span class="token comment">//自定义表单用户名参数，默认是username</span>
                <span class="token punctuation">.</span><span class="token function">failureUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login?error&quot;</span><span class="token punctuation">)</span> <span class="token comment">//登录失败的返回地址</span>
                <span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 使用表单授权方式</span>
    <span class="token comment">//                .httpBasic(withDefaults()); // 使用基本授权方式</span>
    <span class="token comment">// 关闭 csrf 攻击防御</span>
    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="前后端分离"><a href="#前后端分离" class="header-anchor">#</a> 前后端分离</h2> <h3 id="用户认证流程"><a href="#用户认证流程" class="header-anchor">#</a> 用户认证流程</h3> <ul><li>登录成功后调用：AuthenticationSuccessHandler</li> <li>登录失败后调用：AuthenticationFailureHandler</li></ul> <p><img src="/assets/img/usernamepasswordauthenticationfilter.2b73cfb5.webp" alt="usernamepasswordauthenticationfilter"></p> <h3 id="引入-fastjson"><a href="#引入-fastjson" class="header-anchor">#</a> 引入 fastjson</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.37<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="认证成功的响应"><a href="#认证成功的响应" class="header-anchor">#</a> 认证成功的响应</h3> <h4 id="成功结果处理"><a href="#成功结果处理" class="header-anchor">#</a> 成功结果处理</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAuthenticationSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token comment">//获取用户身份信息</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转换成json字符串</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//返回响应</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="securityfilterchain-配置"><a href="#securityfilterchain-配置" class="header-anchor">#</a> SecurityFilterChain 配置</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 无需授权即可访问当前页面</span>
        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 认证成功时的处理  </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="认证失败响应"><a href="#认证失败响应" class="header-anchor">#</a> 认证失败响应</h3> <h4 id="失败结果处理"><a href="#失败结果处理" class="header-anchor">#</a> 失败结果处理</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAuthenticationFailureHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationFailureHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationFailure</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取错误信息</span>
        <span class="token class-name">String</span> localizedMessage <span class="token operator">=</span> exception<span class="token punctuation">.</span><span class="token function">getLocalizedMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> localizedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转换成json字符串</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//返回响应</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="securityfilterchain-配置-2"><a href="#securityfilterchain-配置-2" class="header-anchor">#</a> SecurityFilterChain 配置</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 无需授权即可访问当前页面理</span>
        <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 认证失败时的处理</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="注销响应"><a href="#注销响应" class="header-anchor">#</a> 注销响应</h3> <h4 id="注销结果处理"><a href="#注销结果处理" class="header-anchor">#</a> 注销结果处理</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLogoutSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">LogoutSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLogoutSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;注销成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转换成json字符串</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//返回响应</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="securityfilterchain-配置-3"><a href="#securityfilterchain-配置-3" class="header-anchor">#</a> SecurityFilterChain 配置</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启授权保护</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize
                           <span class="token comment">// 对所有请求开启授权保护</span>
                           <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token comment">// 已认证的请求会被自动授权</span>
                           <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 无需授权即可访问当前页面</span>
            <span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;myusername&quot;</span><span class="token punctuation">)</span> <span class="token comment">//自定义表单用户名参数，默认是username</span>
            <span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;mypassword&quot;</span><span class="token punctuation">)</span> <span class="token comment">//自定义表单用户名参数，默认是username</span>
            <span class="token punctuation">.</span><span class="token function">failureUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login?error&quot;</span><span class="token punctuation">)</span> <span class="token comment">//登录失败的返回地址</span>
            <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 认证成功时的处理</span>
            <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 认证失败时的处理</span>
            <span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 使用表单授权方式</span>
    <span class="token comment">//                .httpBasic(withDefaults()); // 使用基本授权方式</span>

    http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注销成功时的处理</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 关闭 csrf 攻击防御</span>
    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="请求未认证的接口"><a href="#请求未认证的接口" class="header-anchor">#</a> 请求未认证的接口</h3> <h4 id="实现-authenticationentrypoint-接口"><a href="#实现-authenticationentrypoint-接口" class="header-anchor">#</a> 实现 AuthenticationEntryPoint 接口</h4> <p><a href="https://docs.spring.io/spring-security/reference/servlet/authentication/architecture.html" target="_blank" rel="noopener noreferrer">Servlet Authentication Architecture :: Spring Security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://springdoc.cn/spring-security/servlet/authentication/architecture.html" target="_blank" rel="noopener noreferrer">Servlet 认证架构 :: Spring Security Reference (springdoc.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>当访问一个需要认证之后才能访问的接口的时候，Spring Security 会使用 <code>AuthenticationEntryPoint</code> 将用户请求跳转到登录页面，要求用户提供登录凭证。</p> <p>这里我们也希望系统<code>返回json结果</code>，因此我们定义类<code>实现AuthenticationEntryPoint接口</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAuthenticationEntryPoint</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationEntryPoint</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commence</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span> authException<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token comment">//获取错误信息</span>
        <span class="token comment">//String localizedMessage = authException.getLocalizedMessage();</span>

        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;需要登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转换成json字符串</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//返回响应</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="securityfilterchain-配置-4"><a href="#securityfilterchain-配置-4" class="header-anchor">#</a> SecurityFilterChain 配置</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//错误处理</span>
http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception  <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//请求未认证的接口</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="跨域"><a href="#跨域" class="header-anchor">#</a> 跨域</h3> <p>跨域全称是跨域资源共享(Cross-Origin Resources Sharing,CORS)，它是浏览器的保护机制，只允许网页请求统一域名下的服务，同一域名指=&gt;协议、域名、端口号都要保持一致，如果有一项不同，那么就是跨域请求。在前后端分离的项目中，需要解决跨域的问题。</p> <p>在 SpringSecurity 中解决跨域很简单，在配置文件中添加如下配置即可</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 跨域</span>
http<span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="身份认证"><a href="#身份认证" class="header-anchor">#</a> 身份认证</h2> <h3 id="用户认证信息"><a href="#用户认证信息" class="header-anchor">#</a> 用户认证信息</h3> <h4 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h4> <p><img src="/assets/img/securitycontextholder.36210085.webp" alt="securitycontextholder"></p> <p>在 Spring Security 框架中，SecurityContextHolder、SecurityContext、Authentication、Principal 和 Credential 是一些与身份验证和授权相关的重要概念。它们之间的关系如下：</p> <ol><li>SecurityContextHolder：SecurityContextHolder 是 Spring Security 存储已认证用户详细信息的地方。</li> <li>SecurityContext：SecurityContext 是从 SecurityContextHolder 获取的内容，包含当前已认证用户的 Authentication 信息。</li> <li>Authentication：Authentication 表示用户的身份认证信息。它包含了用户的 Principal、Credential 和 Authority 信息。</li> <li>Principal：表示用户的身份标识。它通常是一个表示用户的实体对象，例如用户名。Principal 可以通过 Authentication 对象的 <code>getPrincipal()</code> 方法获取。</li> <li>Credentials：表示用户的凭证信息，例如密码、证书或其他认证凭据。Credential 可以通过 Authentication 对象的 <code>getCredentials()</code> 方法获取。</li> <li>GrantedAuthority：表示用户被授予的权限</li></ol> <p>总结起来，SecurityContextHolder 用于管理当前线程的安全上下文，存储已认证用户的详细信息，其中包含了 SecurityContext 对象，该对象包含了 Authentication 对象，后者表示用户的身份验证信息，包括 Principal（用户的身份标识）和 Credential（用户的凭证信息）。</p> <h4 id="在-controller-中获取用户信息"><a href="#在-controller-中获取用户信息" class="header-anchor">#</a> 在 Controller 中获取用户信息</h4> <p>IndexController：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;index controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityContext</span> context <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//存储认证对象的上下文</span>
        <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//认证对象</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用户名</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span>authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//身份</span>
        <span class="token class-name">Object</span> credentials <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//凭证(脱敏)</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//权限</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>credentials<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="会话并发处理"><a href="#会话并发处理" class="header-anchor">#</a> 会话并发处理</h3> <p>后登录的账号会使先登录的账号失效</p> <h4 id="实现处理器接口"><a href="#实现处理器接口" class="header-anchor">#</a> 实现处理器接口</h4> <p>实现接口 SessionInformationExpiredStrategy</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>securitydemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySessionInformationExpiredStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">SessionInformationExpiredStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onExpiredSessionDetected</span><span class="token punctuation">(</span><span class="token class-name">SessionInformationExpiredEvent</span> event<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;该账号已从其他设备登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转换成json字符串</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//返回响应</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="securityfilterchain-配置-5"><a href="#securityfilterchain-配置-5" class="header-anchor">#</a> SecurityFilterChain 配置</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 会话管理</span>
http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span>session <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    session
        <span class="token punctuation">.</span><span class="token function">maximumSessions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expiredSessionStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MySessionInformationExpiredStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="授权-2"><a href="#授权-2" class="header-anchor">#</a> 授权</h2> <p>授权管理的实现在 SpringSecurity 中非常灵活，可以帮助应用程序实现以下两种常见的授权需求：</p> <ul><li><p>用户-权限-资源：例如张三的权限是添加用户、查看用户列表，李四的权限是查看用户列表</p></li> <li><p>用户-角色-权限-资源：例如张三是角色是管理员、李四的角色是普通用户，管理员能做所有操作，普通用户只能查看信息</p></li></ul> <h3 id="基于-request-的授权"><a href="#基于-request-的授权" class="header-anchor">#</a> 基于 request 的授权</h3> <h4 id="用户-权限-资源"><a href="#用户-权限-资源" class="header-anchor">#</a> 用户-权限-资源</h4> <p><strong>需求：</strong></p> <ul><li>具有 <code>USER_LIST</code> 权限的用户可以访问 <code>/user/list</code> 接口</li> <li>具有 <code>USER_ADD</code> 权限的用户可以访问 <code>/user/add</code> 接口</li></ul> <h5 id="配置权限"><a href="#配置权限" class="header-anchor">#</a> 配置权限</h5> <p>SecurityFilterChain</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//开启授权保护</span>
http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>
        authorize <span class="token operator">-&gt;</span> authorize
    			<span class="token comment">//具有USER_LIST权限的用户可以访问/user/list</span>
                <span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;USER_LIST&quot;</span><span class="token punctuation">)</span>
    			<span class="token comment">//具有USER_ADD权限的用户可以访问/user/add</span>
    			<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//对所有请求开启授权保护</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//已认证的请求会被自动授权</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="授予权限"><a href="#授予权限" class="header-anchor">#</a> 授予权限</h5> <p>DBUserDetailsManager 中的 loadUserByUsername 方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token string">&quot;USER_LIST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="请求未授权的接口"><a href="#请求未授权的接口" class="header-anchor">#</a> 请求未授权的接口</h5> <p>SecurityFilterChain</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//错误处理</span>
http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception  <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//请求未认证的接口</span>
    exception<span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> <span class="token comment">//请求未授权的接口</span>

        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;没有权限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转换成json字符串</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//返回响应</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>更多的例子：</strong></p> <ul><li><p><a href="https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html" target="_blank" rel="noopener noreferrer">Authorize HttpServletRequests :: Spring Security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://springdoc.cn/spring-security/servlet/authorization/authorize-http-requests.html" target="_blank" rel="noopener noreferrer">授权 HttpServletRequest :: Spring Security Reference (springdoc.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h4 id="用户-角色-资源"><a href="#用户-角色-资源" class="header-anchor">#</a> 用户-角色-资源</h4> <p><strong>需求</strong>：角色为 <code>ADMIN</code> 的用户才可以访问 <code>/user/**</code> 路径下的资源</p> <h5 id="配置角色"><a href="#配置角色" class="header-anchor">#</a> 配置角色</h5> <p>SecurityFilterChain</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//开启授权保护</span>
http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>
        authorize <span class="token operator">-&gt;</span> authorize
                <span class="token comment">//具有管理员角色的用户可以访问/user/**</span>
                <span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//对所有请求开启授权保护</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//已认证的请求会被自动授权</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="授予角色"><a href="#授予角色" class="header-anchor">#</a> 授予角色</h5> <p>DBUserDetailsManager 中的 loadUserByUsername 方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span>
        <span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="用户-角色-权限-资源"><a href="#用户-角色-权限-资源" class="header-anchor">#</a> 用户-角色-权限-资源</h4> <p>RBAC（Role-Based Access Control，基于角色的访问控制）是一种常用的数据库设计方案，它将用户的权限分配和管理与角色相关联。以下是一个基本的 RBAC 数据库设计方案的示例：</p> <ol><li>用户表(User table)：包含用户的基本信息，例如用户名、密码和其他身份验证信息。</li></ol> <table><thead><tr><th>列名</th> <th>数据类型</th> <th>描述</th></tr></thead> <tbody><tr><td>user_id</td> <td>int</td> <td>用户 ID</td></tr> <tr><td>username</td> <td>varchar</td> <td>用户名</td></tr> <tr><td>password</td> <td>varchar</td> <td>密码</td></tr> <tr><td>email</td> <td>varchar</td> <td>电子邮件地址</td></tr> <tr><td>...</td> <td>...</td> <td>...</td></tr></tbody></table> <ol start="2"><li>角色表(Role table)：存储所有可能的角色及其描述。</li></ol> <table><thead><tr><th>列名</th> <th>数据类型</th> <th>描述</th></tr></thead> <tbody><tr><td>role_id</td> <td>int</td> <td>角色 ID</td></tr> <tr><td>role_name</td> <td>varchar</td> <td>角色名称</td></tr> <tr><td>description</td> <td>varchar</td> <td>角色描述</td></tr> <tr><td>...</td> <td>...</td> <td>...</td></tr></tbody></table> <ol start="3"><li>权限表(Permission table)：定义系统中所有可能的权限。</li></ol> <table><thead><tr><th>列名</th> <th>数据类型</th> <th>描述</th></tr></thead> <tbody><tr><td>permission_id</td> <td>int</td> <td>权限 ID</td></tr> <tr><td>permission_name</td> <td>varchar</td> <td>权限名称</td></tr> <tr><td>description</td> <td>varchar</td> <td>权限描述</td></tr> <tr><td>...</td> <td>...</td> <td>...</td></tr></tbody></table> <ol start="4"><li>用户角色关联表(User-Role table)：将用户与角色关联起来。</li></ol> <table><thead><tr><th>列名</th> <th>数据类型</th> <th>描述</th></tr></thead> <tbody><tr><td>user_role_id</td> <td>int</td> <td>用户角色关联 ID</td></tr> <tr><td>user_id</td> <td>int</td> <td>用户 ID</td></tr> <tr><td>role_id</td> <td>int</td> <td>角色 ID</td></tr> <tr><td>...</td> <td>...</td> <td>...</td></tr></tbody></table> <ol start="5"><li>角色权限关联表(Role-Permission table)：将角色与权限关联起来。</li></ol> <table><thead><tr><th>列名</th> <th>数据类型</th> <th>描述</th></tr></thead> <tbody><tr><td>role_permission_id</td> <td>int</td> <td>角色权限关联 ID</td></tr> <tr><td>role_id</td> <td>int</td> <td>角色 ID</td></tr> <tr><td>permission_id</td> <td>int</td> <td>权限 ID</td></tr> <tr><td>...</td> <td>...</td> <td>...</td></tr></tbody></table> <p>在这个设计方案中，用户可以被分配一个或多个角色，而每个角色又可以具有一个或多个权限。通过对用户角色关联和角色权限关联表进行操作，可以实现灵活的权限管理和访问控制。</p> <p>当用户尝试访问系统资源时，系统可以根据用户的角色和权限决定是否允许访问。这样的设计方案使得权限管理更加简单和可维护，因为只需调整角色和权限的分配即可，而不需要针对每个用户进行单独的设置。</p> <h3 id="基于方法的授权"><a href="#基于方法的授权" class="header-anchor">#</a> 基于方法的授权</h3> <h4 id="开启方法授权"><a href="#开启方法授权" class="header-anchor">#</a> 开启方法授权</h4> <p>在配置文件中添加如下注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableMethodSecurity</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="给用户授予角色和权限"><a href="#给用户授予角色和权限" class="header-anchor">#</a> 给用户授予角色和权限</h4> <p>DBUserDetailsManager 中的 loadUserByUsername 方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span>
        <span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;USER_UPDATE&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="常用授权注解"><a href="#常用授权注解" class="header-anchor">#</a> 常用授权注解</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 用户必须有 ADMIN 角色 并且 用户名是 admin 才能访问此方法</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasRole('ADMIN') and authentication.name == 'admim'&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用户必须有 USER_ADD 权限 才能访问此方法</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority('USER_ADD')&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    userService<span class="token punctuation">.</span><span class="token function">saveUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>更多的例子：</strong></p> <ul><li><p><a href="https://docs.spring.io/spring-security/reference/servlet/authorization/method-security.html" target="_blank" rel="noopener noreferrer">Method Security :: Spring Security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://springdoc.cn/spring-security/servlet/authorization/method-security.html" target="_blank" rel="noopener noreferrer">方法安全(Method Security) :: Spring Security Reference (springdoc.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h2 id="oauth2"><a href="#oauth2" class="header-anchor">#</a> OAuth2</h2> <h3 id="oauth2-简介"><a href="#oauth2-简介" class="header-anchor">#</a> OAuth2 简介</h3> <h4 id="oauth2-是什么"><a href="#oauth2-是什么" class="header-anchor">#</a> OAuth2 是什么</h4> <ul><li>“Auth” 表示 “授权” Authorization</li> <li>“O” 是 Open 的简称，表示 “开放”</li> <li>连在一起就表示 <strong>“开放授权”</strong>，OAuth2 是一种开放授权协议。</li> <li><strong>OAuth2 最简向导：</strong> <ul><li><a href="https://darutk.medium.com/the-simplest-guide-to-oauth-2-0-8c71bd9a15bb" target="_blank" rel="noopener noreferrer">The Simplest Guide To OAuth 2.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://gitee.com/geektime-geekbang/oauth2lab/blob/master/ppt/OAuth2.0%E6%9C%80%E7%AE%80%E5%90%91%E5%AF%BC.pdf" target="_blank" rel="noopener noreferrer">ppt/OAuth2.0 最简向导.pdf · 极客时间/oauth2lab - Gitee.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h4 id="oauth2-的角色"><a href="#oauth2-的角色" class="header-anchor">#</a> OAuth2 的角色</h4> <p>OAuth 2 协议包含以下角色：</p> <ul><li>资源所有者(Resource Owner)：即用户，资源的拥有人，想要通过客户应用访问资源服务器上的资源。</li> <li>客户应用(Client)：通常是一个 Web 或者无线应用，它需要访问用户的受保护资源。</li> <li>资源服务器(Resource Server)：存储受保护资源的服务器或定义了可以访问到资源的 API，接收并验证客户端的访问令牌，以决定是否授权访问资源。</li> <li>授权服务器(Authorization Server)：负责验证资源所有者的身份并向客户端颁发访问令牌。</li></ul> <p><img src="/assets/img/image-20240625000050755.a7025bae.webp" alt="image-20240625000050755"></p> <h4 id="oauth2-的使用场景"><a href="#oauth2-的使用场景" class="header-anchor">#</a> OAuth2 的使用场景</h4> <h5 id="开放系统间授权"><a href="#开放系统间授权" class="header-anchor">#</a> 开放系统间授权</h5> <h6 id="社交登录"><a href="#社交登录" class="header-anchor">#</a> 社交登录</h6> <p>在传统的身份验证中，用户需要提供用户名和密码，还有很多网站登录时，允许使用第三方网站的身份，这称为&quot;第三方登录&quot;。所谓第三方登录，实质就是 OAuth 授权。用户想要登录 A 网站，A 网站让用户提供第三方网站的数据，证明自己的身份。获取第三方网站的身份数据，就需要 OAuth 授权。</p> <p><img src="/assets/img/image-20240625000144124.60198fe9.webp" alt="image-20240625000144124"></p> <h6 id="开放-api"><a href="#开放-api" class="header-anchor">#</a> 开放 API</h6> <p>例如云冲印服务的实现</p> <p><img src="/assets/img/image-20240625000115745.86cb6255.webp" alt="image-20240625000115745"></p> <h5 id="现代微服务安全"><a href="#现代微服务安全" class="header-anchor">#</a> 现代微服务安全</h5> <h6 id="单块应用安全"><a href="#单块应用安全" class="header-anchor">#</a> 单块应用安全</h6> <p><img src="/assets/img/image-20240625000232166.3ce7dd1e.webp" alt="image-20240625000232166"></p> <h6 id="微服务安全"><a href="#微服务安全" class="header-anchor">#</a> 微服务安全</h6> <p><img src="/assets/img/image-20240625000259879.5ea97731.webp" alt="image-20240625000259879"></p> <h5 id="企业内部应用认证授权"><a href="#企业内部应用认证授权" class="header-anchor">#</a> 企业内部应用认证授权</h5> <ul><li><p>SSO：Single Sign On 单点登录</p></li> <li><p>IAM：Identity and Access Management 身份识别与访问管理</p></li></ul> <h4 id="oauth2-的四种授权模式"><a href="#oauth2-的四种授权模式" class="header-anchor">#</a> OAuth2 的四种授权模式</h4> <p>RFC6749：</p> <p><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noopener noreferrer">RFC 6749 - The OAuth 2.0 Authorization Framework (ietf.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>阮一峰：</p> <p><a href="https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html" target="_blank" rel="noopener noreferrer">OAuth 2.0 的四种方式 - 阮一峰的网络日志 (ruanyifeng.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>四种模式：</p> <ul><li>授权码(authorization-code)</li> <li>隐藏式(implicit)</li> <li>密码式(password)</li> <li>客户端凭证(client credentials)</li></ul> <h5 id="第一种方式-授权码"><a href="#第一种方式-授权码" class="header-anchor">#</a> 第一种方式：授权码</h5> <p><strong>授权码(authorization code)，指的是第三方应用先申请一个授权码，然后再用该码获取令牌。</strong></p> <p>这种方式是最常用，最复杂，也是最安全的，它适用于那些有后端的 Web 应用。授权码通过前端传送，令牌则是储存在后端，而且所有与资源服务器的通信都在后端完成。这样的前后端分离，可以避免令牌泄漏。</p> <p><img src="/assets/img/image-20240625001044802.d8d4ea00.webp" alt="image-20240625001044802"></p> <ul><li>注册客户应用：客户应用如果想要访问资源服务器需要有凭证，需要在授权服务器上注册客户应用。注册后会<strong>获取到一个 ClientID 和 ClientSecrets</strong></li></ul> <p><img src="/assets/img/image-20240625001058120.2fa1c5af.webp" alt="image-20240625001058120"></p> <h5 id="第二种方式-隐藏式"><a href="#第二种方式-隐藏式" class="header-anchor">#</a> 第二种方式：隐藏式</h5> <p><strong>隐藏式(implicit)，也叫简化模式，有些 Web 应用是纯前端应用，没有后端。这时就不能用上面的方式了，必须将令牌储存在前端。</strong></p> <p>RFC 6749 规定了这种方式，允许直接向前端颁发令牌。这种方式没有授权码这个中间步骤，所以称为隐藏式。这种方式把令牌直接传给前端，是很不安全的。因此，只能用于一些安全要求不高的场景，并且令牌的有效期必须非常短，通常就是会话期间(session)有效，浏览器关掉，令牌就失效了。</p> <p><img src="data:image/webp;base64,UklGRiwfAABXRUJQVlA4ICAfAABQkwCdASrDAvYAPpFEnkulo6MhonSqKLASCWNu+vw6Oz+snx9rqXZu41x/vgDUNpH6ufvH4zvZxY+w/KXo+fJ9RvIw6vyq+mTPV/yv+T7Hf7h/nPYF/unoY/8Pqw/dr1AftT+43vJf8b9zvdp/W/837AH9H/2/raf9H2Qf79/r/YN/Zb1m//L+6vwo/37/n/ut7VX/39gD//+oB//+t36o/3fta/xvhj+L/MP3T+0ftvx2+k/+n6F/y37Z/m/7/5uf7Pwn+CH+D6gX5J/LP+BvJ+reYL7GfRf+T/gvFz/yvQv69/8v3AP57/av+p62/4/waPSvYA/pH9v/9Hsw/13/r/3Hn3+qv/f7hX659Zn96faD/bcdMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMRenNWtJFAC/eyO0yUs/ut9ordj7TsBH10iIiIiIiIiIiIiIiIiIiIiIiIcyQKJwzSyivo9eD3lDz0c72i+6fVGfNzASqvIE76M20l5/bkiIiIiIiIiIiIiIiIiIiIiIdaMtE3+dOMzo7J6DVdpZeu7u7u7u7u7u7snj38/Aw8fKzM+LKgBeO13d2TyINPjRcHhw/DF3T2fB/V28kREREQ9I2Hd3awS1xzeOe+eRkss7MnKURj383O7CftSBq3Nrd5DqkHlBpo/lw2V1wgCvd9RAZHeTYgtV/KJHavySa3zu35CdhK3CUDu2s+Ir8GdWt1qRJYmzqE7ujO84mXn9kMqPk8e1ssiLSwJ9uAMooHpN3ff5YbgNDLuWFX8zsm9awPeZC20ZF7E1WDpUVmZ8gzOj9DyI6DVxzh8fKzM+Ek7uXj/7hJ7f55sCNutNsSWYJU5zvNaKY9WhuSF/oaysWd3Xp+dnRwuRjafLuWEHVsGqRn2JwKpUsS43+dOMzo/Q8iOg1cc4aesd48jKeW9xI1uq8EoThX3gvBQNt0eJR9eplQP9WmzyNZ+HOISFtDwozCdWUYdrGdHf01Q6u/hmZmZmZmZmZmcNggwSzL5V+mFVF2WFotnNcHD8ZA4g6qCDmEhOI8kY7mIcMyconGUBuI7Py7qiUf6Nu5lWdX6tE5Q7Dx8rMz5FTVVdYWdu9XuBh4+VigvcHNts6mB48JG6up/8DkKu0CD4/44ZRs3vgYGNnVQ+iUgeiNBOpdRnLhj1hfeYUyjGDVCR1m/zw2EP92r/F2Og6ZCP9KrDaO3Nd5HjEuL92p3Jow/nWv7ybtRzIpLttdNJxkYJVZixtaTy8ooUNAQ6tlGyj7dyQ3UnDtY1QnignX9pmy2nLO9dKZSJQKJ24D921y07kzJpbsMJjVmuRjBqOyjtte3QJyGl4voWrBoQkAawCH0b//6ejA9p96H67vOSYJpBVxesgeNwYUHtJ+27ilnewu6MLGgpqqusKhhR4ppEYNUyQof8sXj0gAGiAOZfYzBrn3JPi+FcLORYAULRp3O4m8bp/cDDx8rMyFj9cjJyiJG7BNbDiAfFmbXYy/Pel2jlmgixN3d3d3d3zsxSkrshIAAAAAAAAACdJeZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZiAAD+/tagAAAAAADRoHSFV/G3lzlYiim+wPoJqewzo+n7U6agf1IG1pb4BFUKqjqUH3a8s28jo+CVMynt+gE1YjQ/yK5czcqPyLMWWegvulVMeIxmUotRSGbjg0TeKbs/887Bs+hfpCAX8AaxJFfq3O1c0lss8hjnsSPVH8sTjoJ5Baapthphey2RiS4bEbGYE3obY65JInmSV13kEEVHflAOLj8TSj9USgyZDpzXKTy1zJaJRpenlV65iRyzBDgVCARdjYPebSoTGr/dvnTJbnvPDZMMxGOhMMfHsfBP5oPKHVG/cRzcAiy3JQbNc6e9rAStWXbVyZtCq8ghMB+OqY3J+7LHEw+s+xT6NtNZnlbQrHnKj5OMqaiMLvq/ahTv6GWIvOfYtTWkpOTZ9wd2+1pKh40RBt0sXQUivWc8IaZQ0pScsIdrTXE53Gm+014fe7fgOk7v7kmHL/tvQHB3gPhOf3UHPrK7jWqy9QJkrmNumA3UxbcM4N/64mv1i/wQAAAACFpiAimbLlmElOT2QpL1w1BSloJwHohfuTj86YtadGXrzcqGtgTSiRLvQJ/FdEe9BMtW+vlQqbLexzH1QP3Weed/aRloe76JufjvdEgZTfP2GKdiMVkrePRR0JD1KKWA9gP3d6Caryk+VoeDp6F/M7UIv5bQl+FUJe993pLg9T7/mF9kbKkejBlEEsnAwbZoFvVDU22cxq8IG9jLl/bbVDBXU/P+iiyMTaeqM/9da7t1UxjEClKW6kZDTzWsUds1AOjsC3qXH3VvY5kCCwDRVzw1wyPuFoqm8dcDDiuZedfkW8BrecOJWLsHU++FNslaHQXbudxfmJbt4Sek0habZUa74QI3/MS4Sy/B2I5mFqiCaKcbJg6OWEqK9t7ZdXts2QXGDljHb0bZiH/pS4K8mq1jd/0wlrm4elMENtNQIOXK7lN82/ECTmVCeve+PMYH2ldO8pICPSipmjZbxmEfhKRsmeE9CydZ6Xy+qWclkj5N2OnrEXbhCsSHUoLw4nvE0wbSKE2elNPmhy19ZLrF5yGms2Qzxsr7B17WFcpbCAIAcof7X60DD/im374quVUQ0eGVX577EU/1hDmlKNa9yTAc5L4MhyTA7Ez659wHyIme1b5R6WdCFkvOxPGW+WIQL988Cbn25s0wNYWoeaYK42iLrOHgdN8VYi/2mO4FpZ+IAAAAG4728MlEV9CA7hqagqQYDCqcf1Tv+XLg1u/c2PdMjCPMx+aVVnjW7Ow1384Nd4eTM8jKAgcTl/YKhTmaZxhNrAAAA/UN+jsYQcS8mfbLp/brJohfp1ncLGrvweNaxysOIZp7CnLMDvMoH7h5JmvDQ0dMtTGVAkv6busElhoLsmJvo3DTHJsMfb41mk5pWz3Kx45BHG5G/qn1P+V2HAe/tXTA6lx0d7c4aouY9VLPw8zv7+QC4Rhrg+QIGp1YLT4cHacQQDM8GGyXlRNFQVRpgL0XLyErZBfuoUzBjBHgh2ANlGJny30zUvWg5apPjbSajPIfQr60fYv3rmsv4YJY8tqi0AFtpxtdrXXAdCYWetezQ7HKjLoX5+6LwZUvFWrElrNy6MYEas/otIdGkrGlr5rAYPNpqmOCfviQRodgUUJ26z03Y1TU4W8cTRE71o2YTcMcC1UOphBcBmLDpy82o52ijh2cj/M+ZUk/v/UkCE2yensdH4lhOBUIxygIrD4HqEQvjegrKwYJFH3J+7580e2st6LkaZqaTR6AByC3TaWHXaGK2EjKqmcL4h+tO9PIbf/iZRaBwEYMRS2leSxrosPsaRLytYPQk96QcWHOndTxINnFZaRtjz6SDn9FU5A0TEkvXae3geNWGfK3SbMrGeSIb1DG4Ef3sTN7dpfibCChW8VUMUyxti1Hhvpt2cn68jlo1yDXVmVemsWTb9qwh+3foACn68X3ROXm4IcEYotgsRrfeO5wwFYrXNZ7+KKBewhAJ6ee5deABJdcMIT/dGomerocvGQgYnXaU/VQJfOvPzL7QrUbj3izZBCbvh8OiC7bOSghRIEwZ/wBWZtwAcFTypNixRmnsr14bBOTxBJfpqK5sU8HFKfIf7u1/joKEoOXVRY3FJKZ70hd7kKRIQESdqkm6cxcHbDERf4boxAsUsy5plY1D9Zc+K14Oz/6XgYEMOGXcBIECWCKnbbxxg99witSxCQLgYItcaGRlXEKD++sm4rNVb9JK/nVaGBWHjMXhjnn6EqEdE9FY2lzgYJekJvaiYmEXXCbrON0zC5XVO236RN6gAZKq+vEeTk6ZaO7JM3ZbjMt8fzUDnQiePv4BBdGR/+DNMLr6zmjvTvY+3vok/64bDmDRvrUnN8BpEeRZVi3ThqD3gTFRmDcnq1plMTZILO6d33iMwcTFZ4V20NpuFTn9rGCOlYv3robPYi4eOT3fS6Vmy0R1KqrgBeCxYLLKwWEbWyBBVZa4dAX+0yTQyXrU0jybB6j8VzQiYICaI/SxwD2K9DaKyGgD90VS2+7FZY2k9b03ZbhCSDqNG857hDrxZKDlrt4JoiiSoz1QAGrTzsdirNYoN/Br5BYz6pnif72lLtFtz0iPb/WByFYXoBNzIat+05tL732p9OayFRQqvyQRghKcyUh5mCXSBsodp6XWTPe6LMk+s4LLaANTpy/jZU4zsO0p90BsapGAGjFuTShiQsevHoEWxuCBaGYLABHJLa11I01dNzhoL3UO+VLPpihfomvMD3H7lBnNCj/nQWlSH9IUOfBIa4Oe3kWCDg1qZ7/z8AJmLT2JV2jp11YT5UIGlHBTdsqZauE4ZpCnaRW4dprYUb8ifH2J4fO0FFio+Vngbbyc/bIBNm87QU/1PizCfos+83da8L9L6yLLC0RmaWuOIiAcqcIhZAP85CabfVl+50Fzpolxi0i0fXq55Py2E/dF1Z2JRYird/tB8MFo1ES+kGYl0mkqozGkVL4HIG/00AgKP0twh1dIE4mlHU9vapS6qbV+SwcZGY5vWB8dvZGeq8aBGVtEINpR/rR4wogglW7qVL7cjWs7wk6691rC/ssyfqSLXnnNjhNVP2mKv7ziPr6F1Qp43jXpCTUyWnbAKcMrDSopXuJHMX5eIUvhTK/V+RoJtFofutWALALcfuCJvbUma9C/+jdJoVJkktwHgMdnf1o7F239yMc+L4WXNWvosZNg5AA+Y6RCOthuWiiaZRINlGqhYdGJitKwHx3/VgEAPvN76uundN4+Lu+Idg17KoaNOShKNyuwufKzhJeJ0Vxwd+rFTruwRpju7ulaT53/JmbBFQ5K2wYGIAH13Opz2ZrZ7pfLfgV4GlgewYsioFyNvI4I3IqFQftOsxa6HAlcT+ZFPyoLdLl1L04Hy2fSETnWVcnDrC3k6kq1+ZL4YC967cUB/AnPxa1co2DPQl1h6iqLEGu2itcAqNacL3UVB493/kIhg4mD3HuXMntluVuFmISiDGcIfHq13y5JZYGNQc2PHHoclabCtCkZ5H2fvSnQcDBYUK6k42eItlvYJ9utlFyQ0JiUVPLq5ov/3W2Zxfe5dUma34LmQA/6FJSzfI2fS/bbNA8eEWJHDBOmpwPjA2ddsYVogflx2HpReNAnIBiAIXSpTfQXwmTJZuzxhFcZMEp9nm4VDvkLTy5T+6pYzYW/qghNkavl4BxY++Fz+KMwu0YGaemLXeEYF/sWqVhkYFTy6zg5E1yRH9a6AwPGvs+BuEslWnu4g60fMAmeInsie6rYUTPV5vFw7ZSGs2EYyimmeHww+n9jZXvIATWduh5Z+SKPoyGpHMXiPwzS2+Ql1yT/HUz8w0CH7rx0inhwigonDqTcmcunhNlwa8TldtMqYBEX8G4ksOhR/dL/3vXqVloPdVHTGr86u8qMz836XLiRZAQIh68IMtKnCsxw0hueD9nelzp9uQOC1aINB8Jgfqa6/ZuCCudCXXEJdpphzerlHjl4BJUIf+Glr4QxhNQmBSjVmVVCaulufcvONUk9rMPJsS6PFH5TYNh+fSCWo4usMcnmOyOdRy2374ZkK1dTpPrDv3JWQB7GDKEvuzhIKJgsDMMkNhAqfOoomuYS31XlzKZv6dYiSS0UfwkOC7hMkrxnr5nVdsm+ykoGszvtrpUr24RaNekLQEGtsk4o5bJ3HuPTg577jGkvKsLP/G0NFAPa3lYu126LCasRtelOGxdH/r8dZDg/PRVvknde6Hhgy6TOvLEend/Y06b8dNTf+br7H9n/iJ4lar7REqSwncnoilEGO8efFzT393Q1y4FxWG5FdT1Iz2ueoFf3qmR1kCes47Lq37P1brBlzyjBEJi4deIEj7y80KgOv2xAwtuq/YprAnud6UficLPTDFDBzKoKLluC5ivlXYl4vznYbA7gIjk5X6hA8JU8rKEEvUEDehO0plrZ9j5lwsCfkFn7NGOpqvGVMRIFM2+obl2i3Eym6nzlhToReVSEZNvGfFM56UrNoML2EfHyj14xlwUcIIthqrmhoPXqAraju3oKEVSCCKSBJoSAVJdT9iyJnjxhpOqjJ9p6q4iZufvLi1nsjg+mWSenCpaBRKt97hDkFHJC6zjfZNgU9/Rh+7ZUfOgyqxkpToVWbo8LNMXoWE84WvBMePZbdJNf/7N1mvRnBM9utjKQbosB/ISmI9IHdxe79ioqzKcnWlWaHKfIY5lxrD5D4vDnGQV6cMR2Z4Uz+UuY6mHbljndSfzkJKei1Bo0fcow4SMag3qomVWmwaJRVccACbQnO+LVtjk6Wn9Ux+ngX1JGKqc+2o7sYfsuYvGmJip2KegV9OfLMR+kC9Ggioen9tEaDIylVgO2sxmtelynxSdJkXxc2MCet+AYdAcOToFKsnkGvNLPArYi6+fhvnHOcibKQn+ioTB9MorlGH1P/lhrMRD3wAa+8srY9d1dH5PHo0WRn0u1JUqCHffPPm84ggxQ8v07qtjQRuhdex0gAbY6I/9fC6+Luac/7zAfKBDSyZ7aKUQioXI4EwXw0ugAAAAAAQ8Wl80ItFBVuym4Lza9yu+XPclZ+5FW6JgblGO0tzgXxZYic7iMWZfaCEmTbW6no+jZ1YRZlU+ZkQ35gJtL0S4X8y6zGIkEZsKH0E1J5L8aPjYlTuONHrVEmbaPDg/gQCa3fFEwanXWrRWmvl6iioEM7M16XpRCGVhbO+F4uORaenc7VZA3KW2R0d0oTxH2yfswcaA1GB/B1ZLS/q1uHyoR0pXvRNXG4AalrmCcfkF7gjXydOOvV2JQGm3ZzeoDZ2FaanKRO65s4FhS5aoxChGJc3FR9Azpw8ugCJPYehD2oVGtNyhngAxbgRgtsC5QmFQOEKwAwIdaaC6EFYwkarPgVU7FbGlv7zoiR44URH48LX6eiC7MsEJ9HS3nlvQJVD9KKTIH3Qi2Rl8z/LUkZS2bBKa7vMrRB0DwEkY2vRt0huqB5srohQ62D47I+DEZa3rIzaH4q4YnCrj4FrWjycPa/s1NJdGduGV1rX8a63o1B0x2sepYeM6uU9UmKIOA11FNnHwZZIcnuaKdRun1+ttQHZK31N7GkMEijpv2JGDXETE4U4MKAGOm8FN18J63A8WWqbXsJFse1w5FtDb0aGjVl7AWYH6pLHT/uV7apZF+R4uA4aaQfPW4mAajEhv76yuqgcQOPiqf6WeEI2JpqxqPbaGzKsObD7bAQ1ZZEJhQrhOzQLrZAACgc5LGYuwaeMvc1+glmoPcmJmbtwUTuh56QLdheA196YzSjgBjJu3cJoD6wXkIhWDOQMz3CUn9FGiAa/9oqHtDNv/k+5tP6nCTcfSRyo8LZkXAA18nmrJU4MCFTubOYlFJdkTH40Q9AuCJc8VVfGS/p/MUfxmQnmshUp4zeF1hS027QdvitASXBXLAmlS5dWTeFDJW2wZ5wRGCjc3QUBliYFWisZOTrjVk805uq0ouOGrQ1qrv2INdw25bu8ZJrH8kGZz4oJBwg+FpTYGz5LeB0YTV2rE/b5HClvplioVU+lxidjC51+BURpXYk5HOOvv0e4I6RClmcWZvjCvGH5mTP7a7vugaRskW+40bnfOmuIvXSrPwdJE0kAdMQJvae7jOlDoqaHMcquZDlYMx+z4xylTl65hBOm3vsmU3ZZOODa7Wi+fBDhULn4e68oFszY3uPo11OdaC73+pk8TdtKe20WwvUCdhAv/fxpKu8HwB+ivefAA+Lid7zF7HMBqBt0XrYHirEZ+0GmPc1YXnkEv8uUYYwgs62TXF6C+5WhCoH1grWQxJUHpj4PmMqv4bPOjnUoeJtQw8lrwK+WTp4wI5E8CNqRtireIrT/lDHhGOGp4QUG5rsF4ii9mZo8TMBJMlUncA6zXjhABY1W3RQB2Oi1oREBHz0HY56HHQqkUctC39KN9YbSFJcFvoY4loiT2EinEMihUWKs+KIuZfp9Nr2eAae7gZHVTGaZ410DR73C1Q5jgmV6EEex0S4wU2GTI+pA6SjPBdsLzfKo9+pAFYWDVTL5CnumqMMGiICTHb0QBYkRDK9hkZvghUCgdPy4Epr+vjsQRSxPec+wyVAUdNnS0tXuNKBRy8gi8vVZTyaeWUtTfwH21BBwL8XB3T+Ewcmr/KZjZjkSI4Pg48uk07EHsFbrUMz9cpHWPA/76iEa7RIPsSOjrtfdslM4+jIaZ/t5A6vb5hOHokQGMKv5W+ORzw5bTDQQdz2ByFF3mA5q8mz6ZaQ97vN/vvk8cRoePqpTGXgZWJEvJ7ZUfCAu65fa8UwQBDrG4DSsdvoc4bOx3a1nlyaeeMkvkjYHS2/2l5ggdM9pMl7kbkRiibOaHrhRhVk7UU0Airyu39Td/A/74+xoDpc85PJsupVjNZ9vHfJwjwJZh2lBfDV3LQpNHrYPJRJP0811aOo7Ab8F2D7liVhWJJmz49SiGBt33kmj1ptTPCuE/KOR5mplBs8bwj+11GM6Mnzeg2DsnNH2a6xjF+IEoy2xOoJaRzbVQsUrebVO/mf7xDXrj2d7/4bZ46rNAevBqQ+iPKlqFr5Nz65Lc2QjlBdw7KNtCJ82i0V0imyYiGtyRPoo4kpRJ08q5Q7gME/fnF3iLUdIrfIXCwjafh4ULQ0dMoAAnVKgdLRHzIesN+uBU1944KXtAUad/ORFIYrf7B56h5s8ZQ9LpQHV9Y0am7T/3V60Vo8WuQ18s5nvD5C6a68EpM0D5Z47d+MGsCFTYTJbgI7JT+XLm8/e9v1pVEYiS1ueRwXql7Yu7QDcts1BEG7t2Mcxwv0H7DAUTr65056tLm/QUq9iZbSng/lJR/582GZYdmOgjePpgoSbKIuQxHAaiQOYlj2NV4O9ynb4EyfQecWTMh75+fQzx7JZbbl/4O6DpSWLNvSnojuPaHusoICbZ//dDHzIiM5CAm9VQS8qErVSt5CdftcI3drba05rAZMeIEfhOCxfRD3Jnz2LvxkGC3OpO8GuxKxngi80JeDLc4fBBdGzDPdUrKp6RSeHmz15QbXJW2wTziOHyiI0ejmDoliYPxYky4VkVSdPhHOHoKuN266r1yltXO8oj5qAI9aMM62soCXTD3zNl1/fIz/eysIJd5LxwV5XoQchI6hJmFd7+I6trJwbrDd/JOEX1JZfRMdR1z9flie0KG0Q70OCHFrpau02pg8t8s3TpZDIYMV1JYRLC+/q9FSW3QXgEiP7cf7FC49JR2dyW7lXO3dXQTO9rW4dmmxXchlC0WTBMhcetBouccTuDk0mZBYwW+1/vomug1UoGVPcYw6Kz5KPCdCXv2PAF3utivWWwmhh0dxkP2BaZhT8FzjWfkulwWo70bdZCcELVK0jaAaco2HzI5lK8e4805IEgxzpC7r/ZbF+oyYWclgzgdFmyD94GxLXsOd4jE13SdyZZf1DqjZzAVNM2obRFNUuqrEAIIyz0jQL5MH73E/ABQJcJKrNbYMv3Cka74Xhlt8GVe20dvEiWVNIqJTGCVL+YDMrxg2PndH5T4k9V6lBpjUJHtxQwxkoq6ij0xp/8Zh3SaEQWmjXVvaPTXWlZ+KnPrir0bU5WecNSjUF6t2gZxX89IQDFqjqsmCruRXsf3JTSsAnmNnK8MdgEYlgLR8t8F9NS39Iu1oIjbO142kdaEAiRJdZkzoo2aj6Eh+kZbwh73rmV+fTFmKnVcZV3WIkfFThA1OC++U8cGuMe3G+t5TtUQPLJrbIHt5eySWanJHz+ofLftmhFyQS1YA6lxzyXfGgzi5Dors0hcCZaenUWsdy2Yk92NIQQCoJ3f1oPcTacBwhGq7KagtbD+dXVinDJSUttd17O2rSljQKSQAGTGs5bH4LOJpVgRtc4CBdvdSyA5NNbUnMgSkMKa8+XmhIq2sBHtY3lKcwZhc3fqw8BWbUobSlYVfsVldwRdkz0ZF8XWeUFZV5i96myr3kNOdbEN/chi1pJN1Ipc3mjh024Zdrrs8dXMG+3FgbY7LDDLLPM5pkfCvX0nch3t84i1FYYcBQuKNjGTQDXnqaspIrU1Zq61+rXQaShafafwX5J7AnkDjVWwJFMkOmIyXn78mkNFG+fZ9psiL25YDZb5AhoEQ+lnuwn/b4k1egoB5RihFbAIb3KaVfePnHZ0D7WyBwH1C0I5fSz/GHfAa9/+5mYE6iavxGAHkr7uRGYyMB6SGIsKew5+g2cpk1rlJ7r2yUm79nuFX7zsVdUUurdsVqlNchhrIpGh4sONV2JyaIKcdbD2J8Yq9DUWfIVRsO/qdr1ZEQdS4MPhBDyZexCRz96LSCcnNTFGPTbdc2THWuD2JvNRYrWge0ln551NJhUB3yn9ktk+Sk1hOtf3eX+VEuFMiLJyYThMAAAx6d1g4b6hPHGudKoRstf/chHFKfz55JrXHxSutT6M+t3+1kJD/9AAhurAyF8DIFdI5g3Dr7ZQWzbwdgSoP6XjFg2sfUIYAAAAyt4p6t6GRVB7yXeRmAA7KUDGJISO21FzWiNdd3PDTZ94+jt1MmGZZscbf7oabclQqFiZ5kQRHe6PAyScWN2xLVwAAAAAAAAAAAAAAAAAAAAAAA=" alt="image-20240625001113875"></p> <p><img src="/assets/img/image-20240625001121743.282829fa.webp" alt="image-20240625001121743"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://a.com/callback#token=ACCESS_TOKEN
将访问令牌包含在URL锚点中的好处：锚点在HTTP请求中不会发送到服务器，减少了泄漏令牌的风险。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="第三种方式-密码式"><a href="#第三种方式-密码式" class="header-anchor">#</a> 第三种方式：密码式</h5> <p><strong>密码式(Resource Owner Password Credentials)：如果你高度信任某个应用，RFC 6749 也允许用户把用户名和密码，直接告诉该应用。该应用就使用你的密码，申请令牌。</strong></p> <p>这种方式需要用户给出自己的用户名/密码，显然风险很大，因此只适用于其他授权方式都无法采用的情况，而且必须是用户高度信任的应用。</p> <p><img src="/assets/img/image-20240625001140201.93f208a4.webp" alt="image-20240625001140201"></p> <p><img src="/assets/img/image-20240625001146274.0dc2e48f.webp" alt="image-20240625001146274"></p> <h5 id="第四种方式-凭证式"><a href="#第四种方式-凭证式" class="header-anchor">#</a> 第四种方式：凭证式</h5> <p><strong>凭证式(client credentials)：也叫客户端模式，适用于没有前端的命令行应用，即在命令行下请求令牌。</strong></p> <p>这种方式给出的令牌，是针对第三方应用的，而不是针对用户的，即有可能多个用户共享同一个令牌。</p> <p><img src="data:image/webp;base64,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" alt="image-20240625001154666"></p> <p><img src="data:image/webp;base64,UklGRtAaAABXRUJQVlA4IMQaAACweACdASpxAqMAPpFEnkqlo6MhpLQaaLASCWVu/HyZceQHT6Yzd8hT/SM90PB6ehL/8en/6f/Q9zv/+P9IDpgf+h///c4/qHqLfwf/Q/////+936sH+c6QD//+oB//+uH6L/3L+Zf1D+++BH9e/S7/Xf2b1F/D/lf7l/Xv2R81zxvxGvmn1i+/f3T+oeb/+i/pn9A/2X9e9F/gtqBfj/8P/xv8m3wkAX4j/NP9H/W/ys9DT+N9Bfyb/Efp7+AH2Afxz+i/9b+0ew3+78Cn6B/2PYD/l/+H/7nspfzv/c/yH4x+z782/z3/q/xv+l+Qf+Wf1b/jf3T/Q++h7GPRbJi6RsqRI2VIkbKkSNlSJGypEjZUiQqp+sdHl36uzlEWXp08AHRAWhvPvxZ7RwNGDo+ejZUiRsqRI2VIkLBmWHhcIG0y49T0uCM7Ft5lrchU2XFFbG5DoxT+A7OURZenTwBB5sY7QuahQg2gI16Kt+PTHjXSNlSJGypEhUtzqrz3R1fnp++zMBJIKHjwBjDmU1t8bwNZFBnaZfG0PVFRLV2dhmeBA2zkokrs0iS1IZeEeCVry3DX3ww9+3VAddyQSq0ebkWF83DZwPU8JC5EoJzKVwxMhXIMc/wUdcPcpRXFP2ieOejIEWmiNjacpqP7FZHAezglTS4WsyDDAnMpXDEyGBsU1D4nNcMoNKbzFka5fxVZuF0kFSObQHYUts4KN5vdIEiQGzs9qDbDAmBlgkawmkBDQJmG4tYIAMBRAfDAJw3pKVdEBdLZPAc/NatLUy5MOx0hLg8NajJfcolSJ1fbQGt6vujFBGQHBZIGh6y1r7+XCFYnz0NFL9fPdDPsLhFCTUAirESSK35VOUpR/c4tbkn7s4rbZHj/UHRE/mZE1ShrxvAzPmRwqqdLcAatioUmYylSY+Ex4/Y/wUobU1q971kXTEUvxd0oeYGB6RlbaRFLMinTjHkmx9/q9OFz/qJSW93zaGAA4NmWdwJ4NVtHh2idAsM/HBbVTtBPvGzM+xFK/jcCAwzzDugV9Wr0fd2xab6lOT3ID8D3s1AT8N1+eJPpkPvMqCt7eFANAxyFXYB5pVgBmwLWADs5EFA3+d7uJ4q9cgGDd+pp/MddzmKvPdHSOvtoCNF0Lmn8IL52xq6cZaRYma8DXKtCjrz3SJhZNEwsmiCE7FMgPyRdN5v4KgPyRdN5v4KgPyRdRDY+UxLw8pa0BwdcLVQ8JP4NYFNdI2VIkbKjsjS+uI7x2MFl2h5x/dsmI8SXjXSNlSJGypEjZUiRsqc4n9EtiT+KoAD+/3fQAAAAsvfEX9CPc6fD0Epbuz5EZkbXp9GiHQlngWUNGpYTPaIpC+Txpx7fuFkTxqTHoOIQT7sb8Ve0uSVBMNdMSX2opbMrLI9JIwwb9YV1SY7KG18iwnX1HSkckSTy2JxcDwhJzLr7wObXBNd5YW9PNUdWeqrqlHdThvV5YD0v5iR0rHqt3Z17F5YJ+9g0Y6ZkTe0grMy0zRZJXIlokKVMtlhqj1bXyLCdfUdKRyRJPLYnFwPCEnMuvvA5tcE13m0d4o7ZSj+j4Xsf0nNv2PAJgoZgTZ8hgYwuCCGrzzZ/0gnza5l60r2XqLAG4+K6wr5v6ItCNWsH64bqel416rlIR4c1MTg7agOt32Bk3JWC8a4vQSuMZmvtNYSpGOCrKXaaJUw5n9CCE8xDtKkM5o2OuL9YV1SY7KG18iwnX1HSkckSTy2JxcDwhJzLr7wObXBNd5YW9PNUdWeqrqlHdThvV5YD0v5iR0rHqtkVFYY/39MQDWZOFXAHdSp1fwA+CxMhfOHfVVTACqj5fgHO9mIxU40I8uitfulm/h/QAk1NVM6KtWO8XxJbudZEvrvfaCBJdwHxuao/uvRGxlgxbNELS/ewaMdMyJvaQVmZaZoskrkS0SFKmWyw1R6tr5FhOvqOlI5IknlsTi4HhCTmXX3gc2uCa7zQjkJkuv+j4iaylfDaMZl/PInpOVkcBJEadRmz3SDnT9Gb9FFoe8hKa/gzjn7ScK+WcHK184T3yEaCFwXA1Bnps5ay+7Alti6yiO1LRCzEbVtjsDrzWNpS/Tx+wb1yO4AiLVuU8bVtjsMA81gAJ2Jqv8y57ahpbSdmDpm8bVtjsMA81grtBvP8ZKGg0RsIyMbDHiEQAfwjxufLZU1IXtF9VA8rvNQuGp9MZv7q91ffMSiEAbQJTT+hGs1e9q1vEJjtNfiVNS3sThMgehdz3CJmTQmhvBQNZ4UUOyT6aWfCbxDc33kIg1txeWtPz7hivdiYYvy0w5nCH4xaXMPECh0wWbLU5Ef1lnE4gXIa5UF1+KFVyXMptkeTdlY7M3oHvXh6MeMYr+yt7JqrYObF1grEI60ehzc4Dx097ORfTq+nOGokM8E7AaVIGzU6/YuK7bXmgLnFeDWjD3TWhPhazMWO9rLxQolD/34aFONmmzgYrufC/C1fRKUFQX7TS5fQeJq6kOlAfrtZNKwFHRHIcaDYkOI/H4a+VMAb7a9vlv3h4nHeZAfciCyxV/YHHxGXonKghNoXEW4LMwOMcaDA/mVQfvXL1oeCPP7Ddwl4b9fPqch5+Q80TmC0J0oxh+hrjSWBVAAr53Wzw7ZkGib3mOmNRPaeK6UVWZvtu1ImhPhiASiz/Z4YckzSo5j5cRt7EkIYkX+vubTJGK8d0/UzV7XyFPR+pz1KlI9DKuMlNLdR16miBTg6D8bTQoD0F/SapGZpQNf4Fvr42L8vg2kR9Cbju6qr0HPHIahKNCnTI3V/E9kkx80x5CFOfGLXy/fykqvMXSZnaXLjiEqEGQOndsThlQKpOffVnT8FLt1Ah5F7QV431pDzxFyqOzq51R8pulSHXoOh0mRwl3gB4Dp/iTLlY7oha0KCsuHx7KExBT5BuJ497ZuwKAMQFhh2niSm7TAM4hbIg/S7uLek9/Rm4yrThKbdIqH/xoUyR0rtREBlBSSXDRBxjsFMyX/PklbZqXaHpVg2ZkDlxCKrmuMxoNFQ9bkn5XiWh2hzTIeUbQsDQH4RdUb+sfvXU11AnGEdsI+6UZN958lgNGrG9el+w8zq/VcbhvwqdLBszpMr6qwvmebUzcs0ZZjpJ9w24qD/yXm3qlr8nXKDtXFLInNqWWE89J2GzBZOPrSxqlIfEaiS9rFpaGKFVqeTIo6/M2Ec04xaXtmmHunuhuNrW34TX2aKVwA2dX5Mxa4HEcFJ2X1MZBZSO9zvx4z5FgoNVRh3jj02TyHrv8ow9K+zLLHZL3tlNjXpbgnDa58zoVTJVHQdxJlyKXeyVKgcMVseJH9HRxh3XwXgCpgD6vP1tKwSYWXRkunCenNClwZJ9nX8u78Jw38MBciTRYlTZJSjXrO18ykj3di8FFpvY5/wwV1kN6EaonNOe5EkDUP/ke5nRQEJ0yPoaNXW44zPvJ6gNk4dSx4O7kTU5kV53cmi9mYdkX6rnFQYJXAHdSp1fwA+CxMhgUvtJETIWVgMToE464lo676HWnBlp6qPVtfIsJ19R0pHJDPBHHAG/vLQTLrMrIluSXL3G/WPR8g6O8gP3MDoSyA3shrLUkIwdcdLIFP+ntc2YHC7RUkCyR31ygt8tTnTIbl/9n7oJbpXanuQjUoFwRtzdBNP/rA4TWKWJhUgHIOBgezjhA3uXgZcggIhrtELknk0ndJNndRsILIODDS6Prs3RZlTnRGGlpLdbhcHZ56L/g9DfcU+r57SpU5zuGWGgCnIBQID1l8H6cjm/seORnLfLEzhC7GV/ECVTgovaOMsgflAtl+AA8zC16nXIBn7SDMmgVg4ydlh81GOEmXV+mlIBMK/4UtRkEXHL6V516/iVweIqjyeF+FOm8O51s1fgl/gw82L0iPL6IJpZKW3EyH1oBTuRZqohjNxC4hphYQKamRwm/7Xg0eWqdRHhzzcwVoDTZ3wTKHIkO2Zm2+m2sQn5IiNOEVdtcDiOCk7L6mMgspHe5348Z8iwUGqYc/BlGE/ICCDQA5Y6hcAXWZyFlBWOlvaCUq1ZW6MB4WRf0PNex485IweMpN7cwWpZrx17maElMD9O8qJvoXJmDc6lrnbWq9dmXhHX+DJPs6/l3fhOG/hgLkSaLEqbJKUa9Z2vmUke7sXgotN7HP+GCushvQjVE5pz3Ikgah/8j3M6KAhOmR9DRq63HGZ95PUBsnDqWPB5mDTupgRuEmtvoZeCLvYxVChfLefVEdrIH35WCf/1ISs+ICJEMlCYSYZGxyDFysKzs1xTHpVdbLNqoOsOoZFOmD33s0+SDmdgJb6R2M+5wrE1ptC6uDXMIDWqxO/D6jfK+rlDKASepxFhZlkrQRUzf4cPLpqxveVtr10jdsjfkvP1wBFE2EapHPIqtSCwRU7aK/xUR0KmTBcg75Iwf3E4k8cBCWnNS5GncEfLYTgCwUk1GYpvyCGklAfJtoNMRlum/vB5yyrA2vk7USKX4Zps5aH7mB0JY/SVtZGWnbzRvjzKu1/O7pJUgF3MtQD/8kZYQRj+48KGj14RnUIZBwCS44noHaIvfq27S85x40Nn8p4KXRINQbxgGWoSl8beKVrlg7wme2szvSkjnmgXaVRJEThgLacXnjcTN7IFgVQ11bh1FsQ2U9f3sK3IFVP3BLfkq1jD245EvPVA068vD81a+XuC8Rk8+dgUi0qdq/uZ/B5vVCTtLHRoPT/i+LT4ZXGIc2EnDIpn3+9alcCV9/HjGLxpXZdUvoOu2OvrjTjQsSwsbK9cjueph55IBiNW522emiebO49jny3ntMbriIdsgt7XjTaIoGHz1cyo9bYb1hZP9nRMgMGlPH8GMCUqP5QfmhGpLQcolnQr3GGxW6gwibgD6y6s77015ie6+eI8OqSkjEF8envhR/2BB0cKIV7SUAmPXOEfIyy/wt4XlLEYKuJgUjP46gJ5jRfYoqkUrnd0xthtPw1Zpk1TZodD1WC8VyjgqRzWs60gNYZ3ArByVuIRFj9YaVNE3hPHOTpRnmoXT8HvQfDJxj26ySDtx9Kvw00ienOA1N+QEfyJlMtO05+ABT9nM9HgwdxBeLykr4cfSUzdspfSdMDeFXDGasTcaexYeGpbjFwmjYAb1dkK/0Yom+KCx0f9la6MQZ61n3h94ITPdGKo0FqvK8/5ZE+rRtUi7ml4X64j8RU4B3J4ersb+mCavshGpq5hVVGGoPfo8Znr2kjtM1icuLSoTvc/Riu123hXVSHk3EPkn8tH13BvaZW2cHxCkTNpc3Gsy6LgFamGf9o5aU51NTde5Ye/ikUB5QrMLklXFvAi0XBj3Zdrk6bYTO84gXKwFRO+YM+v4XHNw9GWd0Kd/RKz2bHGwTlv3X+jEMYboFjQqwdXP3I9KFdz5sYmfexV94erzKj7PekGjge/Lr+LNsT2isbPIRXBdQo2xigE08XcrrfH1xOkjNV8AzutxfkjTT04LkjBN9PLrLmECqD56fuFr++iQTjx6kH9fz+0rlSJlDnk+BZxRw5yZKWQ5/zsFfIHVemERIUbaRTNZUnaZaWwHKab3yKNu+u7/88wmzdHFZMUbbBVs4ocjj0fwbCFBv3X9gLpeR3OlWBYdwL48ADs0zUzenb9hOvlZ4YihLW441C5RaEPN7I7ldQuFPvHj5ViSku3fgIWpMkBziRy16SvtOXQl/Oss0IsGo+5n6xSbCqlsbXJFDrbD1y2PCtouiCOpZINCYZP3Ipv8rscaodf15zTemmgvJPr6FvNh+GUolJP4q9uZOtAzlM1viaCx9NVSlCFHp8GumHXfv62XFpUJ3ufoxXa7bwrqpSnQNmUjetPAhlK+qLh1t83iHCiFvslOST8AQFoYaxVcme7Cm4FmS1lYmsZossr8SqQ2n1WmWlKZRXH/yTbnDh2h97H9ARt9y39uvy8UWk1bYNfg5St4Hy+kXvCTnJ0yeNi/f8uz+wCCzAH3ZcXIa5iOjwiuhUK0mJpf/DVgmfRstbY+BkleRkWP3AAyBu3cscnEkjDvZ9DPdTp8LqezUO2r7FneHnVsiBQ5/xPgCTtwjJt8n3bksZ6il25kwxmmMeyjrPLbJGImX+rk8+C8G4mamI2kr817k78Ka1LV4Wg6AjwpX7DbijHE9NUc0JSbMOx4GXU0L6SmKvhNQ5uQskfYmTFroEDFLu2dFl/7ALZbAXsBukOpZl0M/7Ry0pzqam69yxP7d7LBf31mJfq3BN7Q3wpx+B2XDc6WlZnWAT1A47D1YJv2Qp5826sUNiEHMKBi4LsAyDa8NrVYuJGU5KbTsgyQBrlZXzGTacoPq0O71j8WEz7G6N/L26dpM8T4h7V83zkbMCfk1PxY7l/4l6kqVzgLretXMtetrKg8PZ4HELf688qPP96q06I2wtM/mMjH29E8S/MHCS34UiJTqIvaygF9MlgaiZ222zWv75cQ3PLylP6uyYTl5Nn6q6uE7edwMXv6EQAM5jfLwxo6wS1khublblU67M86iWQ1dSJ5UOdhEzzk2oEi4SCcEDFfJndCuWX29VeqRsIsJSMx+zc4xtzVr2ALgzl+ZhJK7cYJMrWPQWoOrXSjFgnEm+KUZeUK1x5M8SoFqxcjsBTwcIhONIF4fmekxhkDe9cekJ8NO6mBG4SnDmLu8LE10sWcIEw3sM3nARUQnavpRV98jA2E5KKpqU9uCl7PRjwa0zJJdrhhpwBZZRyd3MEp1ixbSnJTadkGFreIZC/8p5xvTGgGBrjUIiehYfSHLJuFHP8jVO4MAEa4YXS8n5ch9LWEo8Ks+tJEze+7wBVx6H7Xyu6VpP6+o4xe/BPUCRBnQGwkfvZBk5bSW/nBSaFx/1EGazfRxFsYXq8Z6KlPLLIzv3s56ewxogRjAzP0J/W13Gj3TVfIetdD71H6oG9uBl/5iEIKvFYoPXOBz+GEHtrXVAD1f9dTefha/i9NdCedQsVoaiPL6oOeq99YSaZKxaRceWowzzMY5VI181DLQbwtdKGKzEK0G4mWoDXdDt8dpStCDuwdOgS3J6SAX0y8RNGMYX6WqTHZQ2vkWE6+o6UjkiSeWxOLgeEJOZdfeBza4JrvLC3p5qjqz1VdUo7qcN6vKhDH8wH2dJMcVPRNbQPnISveeSnbcDXXyzcZk9hGqUzQrd7KC+lafJZyrVbQXcP1S7+pW7FGHhvjcS6lljunT8CTzb6yvndEujNrrl02UqUCbn/EaB3JyUMLqTMarhf7iVdPFec94Bso15L++wAj9/bRi7XrzndQNgABifCUjKpH3NI+xjwSkeNedsnzxRCrNAByz6U+C5g3VsHadNOjhTUaUBmRFH38w9qyg48wxm3KAMDsn5qpKCI8k8GJzwEOcIX7+1mg8oe5O5xBrfYOvDRlv8HX4BETAg4UAYp62jv+Pt323BS3/j/S9oKBlwfWkribdH0VMd9+iO/RYTHMN92V6vgRRygiB/KFJrm+C1V2IDGEWanAOdkhsQB0Jx2pmKINGYhaZwMc/U/D5VQWG6RKVr5VEtDzu/mvo3yZ3W3s0JOxqrBW5lrVDmu0h/1xDLHS1sTFiOygbTR3cvYRnuXpi+z1z+f3WAGUh0gM0ubHqzBDnYH09vxVmrSWK1WtuRZ2aV+eOVrPWXL+dbOur5l1iM5PIWvynR4Bu783AbcPxzK2b0YefiLY/bDm4GmPGtRMn6y+WCAsIfCT9OCDt/PJzgj9R2fcCIc2GTLwQ4gkZEu5MIXPGfm81F8noDgURBoLKtnEBjCLM4Q3Ima0xiu16Vyd3qMJYzN0e18D/4HW0geO8BXwrRfmh6P/42rztyPJRmAKW70a21S26pVA9PePIj7Z7Q6NpqmcatySaCf4R/iL0h3T7sXUlsFtI803GlI9UeVqeirRfmxV03KHh/CilrdUkj5xwbjeYAnQDYBQ5rxe+5dDOlfPSjpP7ZwaFfK01J2c/0laZCXVKO6nDerywLcUp8s8HrcCiExFYZKJZDB0320nMgJNS++Ghrmy1OBtoDySXCxoov4UQKh4hSZdEcWWe99eUgHs0e/RqtMJblPM2Ow9Seskcd8xjaBMQDYGVZDycnYpC+Txphd2aIaE4gNX8sHtopVMyUO6QSVyJaJClTSW31qfxWkqckgfts/yS4WNFF/CiBUPEKTLojuugg/EvY/o4K7oDXwc2U7pDOEdsC1FbxwMxJZmFyi9kIFVaDZyzX/YE7L+CAkhQg3sBlIEeMWp1KUEMNEA4ChsSS4xWPH1cb12VG0QU/oCLJLaXduJKHdd3M/Tx+wb+vF3l3/4hyHeJ+AAAAAGCZA9C7nuETL6nrg/1PLmyQxAxulk+zSxIcDRPQ1RvXqePsbHtgmEAj0Ubq3steXhvp9zvdBvJVjxQpj9u/xSy5TotTQaD52UODSpQghmYLxp90MWUymohjjLU3/a0fJ9MGcpRfeQkyiXMSp3ph886N+e+0iQvci7wbfevQ0jXX9MRUcuitfulm/h/QAk1NVNCJmya4nJcyfu7z0X/tBAku4D43NUf3XojYy355RDWRZ3MdHL0mVbpQacziLALQ9SAC8Mqkx2UNr5FhOvqOlI5IknlsTi4HhCTmXX3gc2vZzTN/Gi5HVQ4491jrCvm/oinGqM9n7khDDEx59GuQvDFI+xfruwAKRwKo0NOLWdwCm+yL/N9InK5tmCRIZC6UoJS1Qmf1BMBL5rNqysfCMquBg+iaZFW/4GkgwH9nAFylJeWDizvN+6xilHynxbaikZ2I5RA/x7jf+aEUKSq1N34ehqIG81NCQCcgN+v2hywTkRRDAPopTSdU1lK+G0YzL+eRPScrI4Cme8QGGPyR1Sj2zOphenqAomxJjp1IJXADb6KIH+Nk3cez0B0Nj+8HsBStil/7ydUiDiossc4kEI5k+L4a+rIZqJitAwEQihzOJ6TlZHAUz3iAwx+SOqUe2Z1ML09QFE2JMdOpBK4AbfRRA/xsm7j2egOhsf3g9gKVsUv/eTqkQcVFljnEghHMnxfDX1ZvPYDBCFeAwMZwj5Uk1VzWSVHAko7UL7hJiAbAyrHX/JtTD/Jb+bAvECU3TJ1drcIgbd7/4cI0uFTiBs1gM6GROoRj/Lhzg6+C4Ite6gAgeC5Km68kpAAFU4ArCmoOpMAAACK2DJi2uSQrgAAAAAAAAAA=" alt="image-20240625001200165"></p> <h4 id="授权类型的选择"><a href="#授权类型的选择" class="header-anchor">#</a> 授权类型的选择</h4> <p><img src="/assets/img/image-20240625001221009.bd06ed4d.webp" alt="image-20240625001221009"></p> <h3 id="spring-中的-oauth2"><a href="#spring-中的-oauth2" class="header-anchor">#</a> Spring 中的 OAuth2</h3> <h4 id="相关角色"><a href="#相关角色" class="header-anchor">#</a> 相关角色</h4> <p><strong>回顾</strong>：OAuth 2 中的角色</p> <ol><li>资源所有者(Resource Owner)</li> <li>客户应用(Client)</li> <li>资源服务器(Resource Server)</li> <li>授权服务器(Authorization Server)</li></ol> <h4 id="spring-中的实现"><a href="#spring-中的实现" class="header-anchor">#</a> Spring 中的实现</h4> <p><a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html" target="_blank" rel="noopener noreferrer">OAuth2 :: Spring Security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://springdoc.cn/spring-security/servlet/oauth2/index.html" target="_blank" rel="noopener noreferrer">OAuth2 :: Spring Security Reference (springdoc.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Spring Security</strong></p> <ul><li>客户应用(OAuth2 Client)：OAuth2 客户端功能中包含 OAuth2 Login</li> <li>资源服务器(OAuth2 Resource Server)</li></ul> <p><strong>Spring</strong></p> <ul><li>授权服务器(Spring Authorization Server)：它是在 Spring Security 之上的一个单独的项目。</li></ul> <h4 id="相关依赖"><a href="#相关依赖" class="header-anchor">#</a> 相关依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 资源服务器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-resource-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 客户应用 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 授权服务器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-authorization-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="授权登录的实现思路"><a href="#授权登录的实现思路" class="header-anchor">#</a> 授权登录的实现思路</h4> <p>使用 OAuth2 Login</p> <p><img src="/assets/img/image-20240625001240274.8bbf50a0.webp" alt="image-20240625001240274"></p> <h3 id="giuhub-社交登录案例"><a href="#giuhub-社交登录案例" class="header-anchor">#</a> GiuHub 社交登录案例</h3> <h4 id="创建应用"><a href="#创建应用" class="header-anchor">#</a> 创建应用</h4> <p><strong>注册客户应用：</strong></p> <p>登录 GitHub，在开发者设置中找到 OAuth Apps，创建一个 application，为客户应用创建访问 GitHub 的凭据：</p> <p><img src="/assets/img/image-20240625001249858.9f50281f.webp" alt="image-20240625001249858"></p> <p>填写应用信息：<code>默认的重定向URI模板为{baseUrl}/login/oauth2/code/{registrationId}</code>。registrationId 是 ClientRegistration 的唯一标识符。</p> <p><img src="/assets/img/image-20240625001302113.1b80593e.webp" alt="image-20240625001302113"></p> <p>获取应用程序 id，生成应用程序密钥：</p> <p><img src="/assets/img/image-20240625001311418.c65f8e5c.webp" alt="image-20240625001311418"></p> <h4 id="创建测试项目"><a href="#创建测试项目" class="header-anchor">#</a> 创建测试项目</h4> <p>创建一个 springboot 项目 <code>oauth2-login-demo</code>，创建时引入如下依赖</p> <p><img src="data:image/webp;base64,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" alt="image-20240625001322523"></p> <p>示例代码参考：<a href="https://github.com/spring-projects/spring-security-samples/tree/6.2.x/servlet/spring-boot/java/oauth2/login" target="_blank" rel="noopener noreferrer">spring-security-samples/servlet/spring-boot/java/oauth2/login at 6.2.x · spring-projects/spring-security-samples (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="配置-oauth-客户端属性"><a href="#配置-oauth-客户端属性" class="header-anchor">#</a> 配置 OAuth 客户端属性</h4> <p>application.yml：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring</span><span class="token punctuation">:</span>
<span class="token key attr-name">  security</span><span class="token punctuation">:</span>
<span class="token key attr-name">    oauth2</span><span class="token punctuation">:</span>
<span class="token key attr-name">      client</span><span class="token punctuation">:</span>
<span class="token key attr-name">        registration</span><span class="token punctuation">:</span>
<span class="token key attr-name">          github</span><span class="token punctuation">:</span>
<span class="token key attr-name">            client-id</span><span class="token punctuation">:</span> <span class="token value attr-value">7807cc3bb1534abce9f2</span>
<span class="token key attr-name">            client-secret</span><span class="token punctuation">:</span> <span class="token value attr-value">008dc141879134433f4db7f62b693c4a5361771b</span>
<span class="token comment">#            redirectUri: http://localhost:8200/login/oauth2/code/github</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="创建-controller"><a href="#创建-controller" class="header-anchor">#</a> 创建 Controller</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>oauthdemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span>
            <span class="token class-name">Model</span> model<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RegisteredOAuth2AuthorizedClient</span> <span class="token class-name">OAuth2AuthorizedClient</span> authorizedClient<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@AuthenticationPrincipal</span> <span class="token class-name">OAuth2User</span> oauth2User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">,</span> oauth2User<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;clientName&quot;</span><span class="token punctuation">,</span> authorizedClient<span class="token punctuation">.</span><span class="token function">getClientRegistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClientName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;userAttributes&quot;</span><span class="token punctuation">,</span> oauth2User<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="创建-html-页面"><a href="#创建-html-页面" class="header-anchor">#</a> 创建 html 页面</h4> <p><code>resources/templates/index.html</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org/thymeleaf-extras-springsecurity5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Spring Security - OAuth 2.0 Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span> right</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logout<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isAuthenticated()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>User: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>none</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>right</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/logout}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Logout<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>OAuth 2.0 Login with Spring Security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    You are successfully logged in <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    via the OAuth 2.0 Client <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${clientName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>User Attributes:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAttribute : ${userAttributes}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userAttribute.key}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userAttribute.value}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="启动应用程序"><a href="#启动应用程序" class="header-anchor">#</a> 启动应用程序</h4> <ul><li>启动程序并访问 localhost:8080。浏览器将被重定向到默认的自动生成的登录页面，该页面显示了一个用于 GitHub 登录的链接。</li> <li>点击 GitHub 链接，浏览器将被重定向到 GitHub 进行身份验证。</li> <li>使用 GitHub 账户凭据进行身份验证后，用户会看到授权页面，询问用户是否允许或拒绝客户应用访问 GitHub 上的用户数据。点击允许以授权 OAuth 客户端访问用户的基本个人资料信息。</li> <li>此时，OAuth 客户端访问 GitHub 的获取用户信息的接口获取基本个人资料信息，并建立一个已认证的会话。</li></ul> <h3 id="案例分析"><a href="#案例分析" class="header-anchor">#</a> 案例分析</h3> <h4 id="登录流程"><a href="#登录流程" class="header-anchor">#</a> 登录流程</h4> <ol><li><strong>A 网站让用户跳转到 GitHub，并携带参数 ClientID 以及 Redirection URI。</strong></li> <li>GitHub 要求用户登录，然后询问用户&quot;A 网站要求获取用户信息的权限，你是否同意？&quot;</li> <li>用户同意，GitHub 就会重定向回 A 网站，同时发回一个授权码。</li> <li><strong>A 网站使用授权码，向 GitHub 请求令牌。</strong></li> <li>GitHub 返回令牌.</li> <li><strong>A 网站使用令牌，向 GitHub 请求用户数据。</strong></li> <li>GitHub 返回用户数据</li> <li><strong>A 网站使用 GitHub 用户数据登录</strong></li></ol> <p><img src="/assets/img/image-20240625001338793.efd0be09.webp" alt="image-20240625001338793"></p> <h4 id="commonoauth2provider"><a href="#commonoauth2provider" class="header-anchor">#</a> CommonOAuth2Provider</h4> <p>CommonOAuth2Provider 是一个预定义的通用 OAuth2Provider，为一些知名资源服务 API 提供商（如 Google、GitHub、Facebook）预定义了一组默认的属性。</p> <p>例如，<strong>授权 URI、令牌 URI 和用户信息 URI</strong> 通常不经常变化。因此，提供默认值以减少所需的配置。</p> <p>因此，当我们配置 GitHub 客户端时，只需要提供 client-id 和 client-secret 属性。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token constant">GITHUB</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">ClientRegistration<span class="token punctuation">.</span>Builder</span> <span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> registrationId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClientRegistration<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBuilder</span><span class="token punctuation">(</span>
        registrationId<span class="token punctuation">,</span> 
        <span class="token class-name">ClientAuthenticationMethod</span><span class="token punctuation">.</span><span class="token constant">CLIENT_SECRET_BASIC</span><span class="token punctuation">,</span> 
        
        <span class="token comment">//授权回调地址(GitHub向客户应用发送回调请求，并携带授权码)   </span>
		<span class="token string">&quot;{baseUrl}/{action}/oauth2/code/{registrationId}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;read:user&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//授权页面</span>
        builder<span class="token punctuation">.</span><span class="token function">authorizationUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/authorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//客户应用使用授权码，向 GitHub 请求令牌</span>
        builder<span class="token punctuation">.</span><span class="token function">tokenUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/access_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//客户应用使用令牌向GitHub请求用户数据</span>
        builder<span class="token punctuation">.</span><span class="token function">userInfoUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.github.com/user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//username属性显示GitHub中获取的哪个属性的信息</span>
        builder<span class="token punctuation">.</span><span class="token function">userNameAttributeName</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//登录页面超链接的文本</span>
        builder<span class="token punctuation">.</span><span class="token function">clientName</span><span class="token punctuation">(</span><span class="token string">&quot;GitHub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="案例实战"><a href="#案例实战" class="header-anchor">#</a> 案例实战</h2> <h3 id="开发环境"><a href="#开发环境" class="header-anchor">#</a> 开发环境</h3> <ul><li>JDK：jdk8</li> <li>springboot：2.6.13</li> <li>spring security：5.6.8</li></ul> <h3 id="认证-2"><a href="#认证-2" class="header-anchor">#</a> 认证</h3> <h4 id="思路分析"><a href="#思路分析" class="header-anchor">#</a> 思路分析</h4> <h5 id="登录"><a href="#登录" class="header-anchor">#</a> 登录</h5> <ol><li>自定义登录接口
<ul><li>调用 <code>ProviderManager</code> 的方法进行认证 如果认证通过生成 jwt</li> <li>把用户信息存入 redis 中</li></ul></li></ol> <blockquote><p><code>SpringSecurity</code> 在默认的认证过程中如果账号密码校验成功会返回 Authentication 对象，之后 <code>UsernamePasswordAuthenticationFilter</code>会将用户信息 <code>Authentication</code> 存入 <code>SecurityContextHolder</code> 中</p> <p>但是我们在实际运用场景中认证通过后还需要向前端返回一个 JSON 格式的数据里面包括了 JWT</p> <p>所以此时我们需要写一个自定义登录接口</p></blockquote> <ol start="2"><li>自定义 UserDetailsService 接口
<ul><li>在这个实现类中去查询数据库</li></ul></li></ol> <h5 id="校验"><a href="#校验" class="header-anchor">#</a> 校验</h5> <ol><li>定义 Jwt 认证过滤器
<ul><li>获取 token</li> <li>解析 token 获取其中的 userid</li> <li>从 redis 中获取用户信息</li> <li>存入 SecurityContextHolder</li></ul></li></ol> <blockquote><p><code>SpringSecurity</code> 默认是在内存中查找对应的用户名密码然后封装成 <code>UserDetail</code>对象交给 <code>DaoAuthenticationProcider</code>校验</p> <p>但是我们在实际运用场景中是从数据库中查找用户信息</p> <p>所以此时我们需要写一个 <code>UserDetailsService</code> 的实现类用来在数据库中查询用户信息并且封装到 <code>UserDetail</code>对象中</p></blockquote> <h4 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h4> <h5 id="添加依赖"><a href="#添加依赖" class="header-anchor">#</a> 添加依赖</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Spring Boot 安全功能的starter包，用于web应用的安全控制 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Spring Boot Web功能的starter包，提供web应用的基本功能 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Spring Boot的测试starter包，用于单元测试和集成测试 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Spring Security的测试包，用于安全测试 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Lombok，提供简单的代码生成工具，减少样板代码，设置为可选依赖 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Redis的starter包，用于集成Redis作为缓存或持久化方案 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- FastJSON，一个Java语言编写的高性能功能完备的JSON库 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- JWT（JSON Web Token）的库，用于生成和解析JWT --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- MyBatis Plus，用于简化MyBatis的使用 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- MySQL连接器，用于连接和操作MySQL数据库 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.29<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h5 id="添加-redis-相关配置"><a href="#添加-redis-相关配置" class="header-anchor">#</a> 添加 Redis 相关配置</h5> <h6 id="fastjsonredisserializer"><a href="#fastjsonredisserializer" class="header-anchor">#</a> FastJsonRedisSerializer</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FastJsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Charset</span> <span class="token constant">DEFAULT_CHARSET</span> <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">ParserConfig</span><span class="token punctuation">.</span><span class="token function">getGlobalInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoTypeSupport</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">FastJsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>clazz <span class="token operator">=</span> clazz<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SerializationException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteClassName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SerializationException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> bytes<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token class-name">JavaType</span> <span class="token function">getJavaType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">TypeFactory</span><span class="token punctuation">.</span><span class="token function">defaultInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constructType</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h6 id="redisconfig"><a href="#redisconfig" class="header-anchor">#</a> RedisConfig</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FastJsonRedisSerializer</span> serializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FastJsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用StringRedisSerializer来序列化和反序列化redis的key值</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>serializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Hash的key也采用StringRedisSerializer的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>serializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="响应类-responseresult"><a href="#响应类-responseresult" class="header-anchor">#</a> 响应类 ResponseResult</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@JsonInclude</span><span class="token punctuation">(</span><span class="token class-name">JsonInclude<span class="token punctuation">.</span>Include</span><span class="token punctuation">.</span><span class="token constant">NON_NULL</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 状态码
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 提示信息，如果有错误时，前端可以获取该字段进行提示
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 查询到的结果数据，
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h5 id="工具类"><a href="#工具类" class="header-anchor">#</a> 工具类</h5> <h6 id="jwt-工具类"><a href="#jwt-工具类" class="header-anchor">#</a> JWT 工具类</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * JWT工具类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtUtil</span> <span class="token punctuation">{</span>
    <span class="token comment">//有效期为</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> <span class="token constant">JWT_TTL</span> <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000L</span><span class="token punctuation">;</span><span class="token comment">// 60 * 60 *1000 一个小时</span>
    <span class="token comment">//设置秘钥明文</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">JWT_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;sangeng&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> token<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 生成jwt
     *
     * @param subject token中要存放的数据（json格式）
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtBuilder</span> builder <span class="token operator">=</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置过期时间</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 生成jtw
     *
     * @param subject   token中要存放的数据（json格式）
     * @param ttlMillis token超时时间
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Long</span> ttlMillis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtBuilder</span> builder <span class="token operator">=</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> ttlMillis<span class="token punctuation">,</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置过期时间</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">JwtBuilder</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Long</span> ttlMillis<span class="token punctuation">,</span> <span class="token class-name">String</span> uuid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SignatureAlgorithm</span> signatureAlgorithm <span class="token operator">=</span> <span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">HS256</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> <span class="token function">generalKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> nowMillis <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>nowMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ttlMillis <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ttlMillis <span class="token operator">=</span> <span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token constant">JWT_TTL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> expMillis <span class="token operator">=</span> nowMillis <span class="token operator">+</span> ttlMillis<span class="token punctuation">;</span>
        <span class="token class-name">Date</span> expDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>expMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span> <span class="token comment">//唯一的ID</span>
                <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span> <span class="token comment">// 主题 可以是JSON数据</span>
                <span class="token punctuation">.</span><span class="token function">setIssuer</span><span class="token punctuation">(</span><span class="token string">&quot;sg&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 签发者</span>
                <span class="token punctuation">.</span><span class="token function">setIssuedAt</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span> <span class="token comment">// 签发时间</span>
                <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span>signatureAlgorithm<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span> <span class="token comment">//使用HS256对称加密算法签名, 第二个参数为秘钥</span>
                <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 创建token
     *
     * @param id
     * @param subject
     * @param ttlMillis
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Long</span> ttlMillis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtBuilder</span> builder <span class="token operator">=</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> ttlMillis<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置过期时间</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token function">createJWT</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token function">parseJWT</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>claims<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 生成加密后的秘钥 secretKey
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SecretKey</span> <span class="token function">generalKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encodedKey <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token constant">JWT_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKey</span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>encodedKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> encodedKey<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 解析
     *
     * @param jwt
     * @return
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Claims</span> <span class="token function">parseJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> jwt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> <span class="token function">generalKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>jwt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br></div></div><h6 id="redis-缓存"><a href="#redis-缓存" class="header-anchor">#</a> Redis 缓存</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCache</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 缓存基本的对象，Integer、String、实体类等
     *
     * @param key   缓存的键值
     * @param value 缓存的值
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">setCacheObject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 缓存基本的对象，Integer、String、实体类等
     *
     * @param key      缓存的键值
     * @param value    缓存的值
     * @param timeout  时间
     * @param timeUnit 时间颗粒度
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">setCacheObject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">T</span> value<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> timeout<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">TimeUnit</span> timeUnit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> timeUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置有效时间
     *
     * @param key     Redis键
     * @param timeout 超时时间
     * @return true=设置成功；false=设置失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">expire</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">long</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置有效时间
     *
     * @param key     Redis键
     * @param timeout 超时时间
     * @param unit    时间单位
     * @return true=设置成功；false=设置失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">expire</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得缓存的基本对象。
     *
     * @param key 缓存键值
     * @return 缓存键值对应的数据
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getCacheObject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> operation <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> operation<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除单个对象
     *
     * @param key
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">deleteObject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除集合对象
     *
     * @param collection 多个对象
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">deleteObject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Collection</span> collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 缓存List数据
     *
     * @param key      缓存的键值
     * @param dataList 待缓存的List数据
     * @return 缓存的对象
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">long</span> <span class="token function">setCacheList</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> count <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得缓存的list对象
     *
     * @param key 缓存的键值
     * @return 缓存键值对应的数据
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCacheList</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 缓存Set
     *
     * @param key     缓存键值
     * @param dataSet 缓存的数据
     * @return 缓存数据的对象
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">BoundSetOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">setCacheSet</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataSet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BoundSetOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> setOperation <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> it <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            setOperation<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> setOperation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得缓存的set
     *
     * @param key
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCacheSet</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 缓存Map
     *
     * @param key
     * @param dataMap
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">setCacheMap</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataMap <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得缓存的Map
     *
     * @param key
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCacheMap</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 往Hash中存入数据
     *
     * @param key   Redis键
     * @param hKey  Hash键
     * @param value 值
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">setCacheMapValue</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> hKey<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hKey<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取Hash中的数据
     *
     * @param key  Redis键
     * @param hKey Hash键
     * @return Hash中的对象
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getCacheMapValue</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> hKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> opsForHash <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> opsForHash<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除Hash中的数据
     *
     * @param key
     * @param hkey
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delCacheMapValue</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> hkey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashOperations</span> hashOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashOperations<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hkey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取多个Hash中的数据
     *
     * @param key   Redis键
     * @param hKeys Hash键集合
     * @return Hash对象集合
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMultiCacheMapValue</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> hKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiGet</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hKeys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得缓存的基本对象列表
     *
     * @param pattern 字符串前缀
     * @return 对象列表
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> pattern<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br></div></div><h6 id="将字符串渲染到客户端"><a href="#将字符串渲染到客户端" class="header-anchor">#</a> 将字符串渲染到客户端</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 将字符串渲染到客户端
     *
     * @param response 渲染对象
     * @param string   待渲染的字符串
     * @return null
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">renderString</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="实体类-2"><a href="#实体类-2" class="header-anchor">#</a> 实体类</h5> <h6 id="user"><a href="#user" class="header-anchor">#</a> User</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 用户表
 *
 * @TableName sys_user
 */</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;sys_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 主键
     */</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 用户名
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 昵称
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 密码
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 用户类型：0代表普通用户，1代表管理员
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 账号状态（0正常 1停用）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 邮箱
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 手机号
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phonenumber<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 用户性别（0男，1女，2未知）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 头像
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> avatar<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建人的用户id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> createBy<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建时间
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新人
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> updateBy<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新时间
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updateTime<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 删除标志（0代表未删除，1代表已删除）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> delFlag<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><h6 id="menu"><a href="#menu" class="header-anchor">#</a> Menu</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 菜单表（Menu）实体类
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;sys_menu&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Menu</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 菜单ID
     */</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 菜单名称
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> menuName<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 父菜单ID
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> parentId<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 显示顺序
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> orderNum<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 路由地址
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 组件路径
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> component<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 是否为外链（0是 1否）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> isFrame<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 菜单类型（M目录 C菜单 F按钮）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> menuType<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 菜单状态（0显示 1隐藏）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> visible<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 菜单状态（0正常 1停用）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 权限标识
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> perms<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 菜单图标
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> icon<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建者
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> createBy<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建时间
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新者
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> updateBy<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新时间
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updateTime<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 备注
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> delFlag<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div><h4 id="数据库校验用户"><a href="#数据库校验用户" class="header-anchor">#</a> 数据库校验用户</h4> <p>从之前的分析我们可以知道，我们可以自定义一个 UserDetailsService,让 SpringSecurity 使用我们的 UserDetailsService。我们自己的 UserDetailsService 可以从数据库中查询用户名和密码。</p> <h5 id="准备工作-2"><a href="#准备工作-2" class="header-anchor">#</a> 准备工作</h5> <ol><li><p>数据库表, 建表语句如下</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'主键'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">64</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'NULL'</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>nick_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">64</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'NULL'</span> <span class="token keyword">COMMENT</span> <span class="token string">'昵称'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">64</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'NULL'</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>type<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户类型：0代表普通用户，1代表管理员'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'账号状态（0正常 1停用）'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">64</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>phonenumber<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">32</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户性别（0男，1女，2未知）'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>avatar<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">128</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'头像'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>create_by<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建人的用户id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>update_by<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新人'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>del_flag<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'删除标志（0代表未删除，1代表已删除）'</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_0900_ai_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'用户表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>nick_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'$2a$10$PQKLmyDowFuRIYCEPZ6cguT2vS3CrPsVtrNWq4t83osKcKyi0HLJa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>nick_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'$2a$10$PQKLmyDowFuRIYCEPZ6cguT2vS3CrPsVtrNWq4t83osKcKyi0HLJa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>引入 MybatisPuls 和 mysql 驱动的依赖</p></li> <li><p>配置数据库信息（顺带配置好 redis）</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> TokenApplication
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/spring_security<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.239.200
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">111111</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>定义 Mapper 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>配置 Mapper 扫描</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.sangeng.sangengtokendemo.mapper&quot;</span><span class="token punctuation">)</span><span class="token comment">// 扫描mapper</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TokenApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TokenApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>测试 MP 是否能正常使用</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">MapperTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUserMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h5 id="核心代码实现"><a href="#核心代码实现" class="header-anchor">#</a> 核心代码实现</h5> <ol><li><p>创建 UserDetailsService 实现类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDetailsServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 查询用户信息</span>
        <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUserName</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果没有查到用户就抛出异常</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;用户名或者密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// TODO 查询对应的权限信息</span>

        <span class="token comment">// 把数据封装成 UserDetails 返回</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoginUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p>创建 UserDetail 实现类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginUser</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>
    <span class="token comment">// 封装用户信息</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

    <span class="token comment">// 获取权限</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取密码</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取用户名</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 账户是否未过期</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 账户是否未锁定</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 密码是否未过期</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 账户是否可用</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></li></ol> <p><strong>注意</strong>：如果要测试，需要往用户表中写入用户数据，并且如果你想让用户的密码是明文存储，需要在密码前加 <code>{noop}</code>。例如: <code>{noop}111111</code>，这样就可以使用 <code>111111</code> 作为密码登录了。</p> <h4 id="密码加密存储"><a href="#密码加密存储" class="header-anchor">#</a> 密码加密存储</h4> <ul><li>实际项目中我们不会把密码明文存储在数据库中。</li> <li>默认使用的 PasswordEncoder 要求数据库中的密码格式为：<code>{id}password</code> 。它会根据 id 去判断密码的加密方式。</li> <li>但是我们一般不会采用这种方式。所以就需要替换 PasswordEncoder。</li> <li>我们一般使用 SpringSecurity 为我们提供的 <code>BCryptPasswordEncoder</code>。</li> <li>我们只需要使用把 <code>BCryptPasswordEncoder</code> 对象注入 Spring 容器中，SpringSecurity 就会使用该 PasswordEncoder 来进行密码校验。</li> <li>我们可以定义一个 SpringSecurity 的配置类，SpringSecurity 要求这个配置类要继承 <code>WebSecurityConfigurerAdapter</code>。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建 BCryptPasswordEncoder 注入容器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>测试：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span>
<span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">TestBCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;111111&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2a – the version of bcrypt, can be 2a,2b,2y strength
10 - the log rounds to use, between 4 and 31
random – the secure random instance to use，即 salt
7 + 22 + 31 = 60
$2a$10$ + salt(22位) + 密文(31)
salt 是 $2a$10$ 后面 22 字符长度的字符串，salt 后面 31 长度的字符串是 hash
比较的时候就从数据库中提取 salt 和明文密码计算得到 hash，再与数据库中的 hash 比较是否相等
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="登录接口"><a href="#登录接口" class="header-anchor">#</a> 登录接口</h4> <ul><li>接下我们需要自定义登陆接口，然后让 SpringSecurity 对这个接口放行，让用户访问这个接口的时候不用登录也能访问。</li> <li>在接口中我们通过 <code>AuthenticationManager</code> 的 <code>authenticate</code> 方法来进行用户认证，所以需要在 SecurityConfig 中配置把 <code>AuthenticationManager</code> 注入容器。</li> <li>认证成功的话要生成一个 jwt，放入响应中返回。并且为了让用户下回请求时能通过 jwt 识别出具体的是哪个用户，我们需要把用户信息存入 redis，可以把用户 id 作为 key。</li></ul> <h5 id="logincontroller"><a href="#logincontroller" class="header-anchor">#</a> LoginController</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">LoginService</span> loginService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 登录</span>
        <span class="token keyword">return</span> loginService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="loginservcie"><a href="#loginservcie" class="header-anchor">#</a> LoginServcie</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LoginService</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResponseResult</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">LoginService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisCache</span> redisCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// AuthenticationManager.authenticate 进行用户认证</span>
        <span class="token class-name">UsernamePasswordAuthenticationToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Authentication</span> authenticate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            authenticate <span class="token operator">=</span> authenticationManager<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果认证没通过，给出对应的提示</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果认证通过，使用 userId 生成一个 jwt， jwt 存入 ResponseResult 返回</span>
        <span class="token class-name">LoginUser</span> loginUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoginUser</span><span class="token punctuation">)</span> authenticate<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> loginUser<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> jwt <span class="token operator">=</span> <span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token function">createJWT</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> jwt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把完整的用户信息存入 redis userId 作为 key</span>
        redisCache<span class="token punctuation">.</span><span class="token function">setCacheObject</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">,</span> loginUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h5 id="securityconfig"><a href="#securityconfig" class="header-anchor">#</a> SecurityConfig</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建 BCryptPasswordEncoder 注入容器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
                <span class="token comment">// 禁用 CSRF 保护</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 不通过 Session 获取 SecurityContext</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 对于登录接口，允许匿名访问</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 除上面外的所有请求全部需要授权认证</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h5 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h5> <p><img src="/assets/img/image-20240626234832545.06e7ec17.webp" alt="image-20240626234832545"></p> <h4 id="认证过滤器"><a href="#认证过滤器" class="header-anchor">#</a> 认证过滤器</h4> <ol><li>我们需要自定义一个过滤器，这个过滤器会去获取请求头中的 token，对 token 进行解析取出其中的 userid。（主要作用于除登录外的请求）</li> <li>使用 userid 去 redis 中获取对应的 LoginUser 对象。</li> <li>然后封装 Authentication 对象存入 SecurityContextHolder</li></ol> <h5 id="认证过滤器-2"><a href="#认证过滤器-2" class="header-anchor">#</a> 认证过滤器</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token comment">// OncePerRequestFilter特点是在处理单个HTTP请求时确保过滤器的 doFilterInternal 方法只被调用一次</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisCache</span> redisCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取 token</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 放行</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 解析 token</span>
        <span class="token class-name">String</span> userId<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token function">parseJWT</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userId <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;token 非法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 从 redis 中获取用户信息</span>
        <span class="token class-name">LoginUser</span> loginUser <span class="token operator">=</span> redisCache<span class="token punctuation">.</span><span class="token function">getCacheObject</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 存入 SecurityContextHolder</span>
            <span class="token comment">// TODO 获取权限信息封装到 Authentication 中</span>
            <span class="token class-name">UsernamePasswordAuthenticationToken</span> authenticationToken <span class="token operator">=</span>
                    <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 放行</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h5 id="securityconfig-2"><a href="#securityconfig-2" class="header-anchor">#</a> SecurityConfig</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> jwtAuthenticationTokenFilter<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http
        <span class="token comment">// 禁用 CSRF 保护</span>
        <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 不通过 Session 获取 SecurityContext</span>
        <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 对于登录接口，允许匿名访问</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 除上面外的所有请求全部需要授权认证</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加JWT认证过滤器</span>
    http<span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span>jwtAuthenticationTokenFilter<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="退出登录"><a href="#退出登录" class="header-anchor">#</a> 退出登录</h4> <p>我们只需要定义一个登录接口，然后获取 SecurityContextHolder 中的认证信息，删除 redis 中对应的数据即可。</p> <h5 id="logincontroller-2"><a href="#logincontroller-2" class="header-anchor">#</a> LoginController</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/logout&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> loginService<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="loginserviceimpl"><a href="#loginserviceimpl" class="header-anchor">#</a> LoginServiceImpl</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ResponseResult</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseResult</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取 SecurityContextHolder 中的用户 id</span>
    <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LoginUser</span> loginUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoginUser</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> userId <span class="token operator">=</span> loginUser<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除 redis 中的值</span>
    redisCache<span class="token punctuation">.</span><span class="token function">deleteObject</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;注销成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="授权-3"><a href="#授权-3" class="header-anchor">#</a> 授权</h3> <h4 id="权限系统的作用"><a href="#权限系统的作用" class="header-anchor">#</a> 权限系统的作用</h4> <ul><li>例如一个学校图书馆的管理系统，如果是普通学生登录就能看到借书还书相关的功能，不可能让他看到并且去使用添加书籍信息，删除书籍信息等功能。但是如果是一个图书馆管理员的账号登录了，应该就能看到并使用添加书籍信息，删除书籍信息等功能。</li> <li>总结起来就是<strong>不同的用户可以使用不同的功能</strong>。这就是权限系统要去实现的效果。</li> <li>我们不能只依赖前端去判断用户的权限来选择显示哪些菜单哪些按钮。因为如果只是这样，如果有人知道了对应功能的接口地址就可以不通过前端，直接去发送请求来实现相关功能操作。</li> <li>所以我们还需要在后台进行用户权限的判断，判断当前用户是否有相应的权限，必须具有所需权限才能进行相应的操作。</li></ul> <h4 id="授权基本流程"><a href="#授权基本流程" class="header-anchor">#</a> 授权基本流程</h4> <ul><li>在 SpringSecurity 中，会使用默认的 <code>FilterSecurityInterceptor</code> 来进行权限校验。在 <code>FilterSecurityInterceptor</code> 中会从 <code>SecurityContextHolder</code> 获取其中的 <code>Authentication</code>，然后获取其中的权限信息。当前用户是否拥有访问当前资源所需的权限。</li> <li>所以我们在项目中只需要把当前登录用户的权限信息也存入 <code>Authentication</code>。</li> <li>然后设置我们的资源所需要的权限即可。</li></ul> <h4 id="授权基本实现"><a href="#授权基本实现" class="header-anchor">#</a> 授权基本实现</h4> <h5 id="rbac-权限模型"><a href="#rbac-权限模型" class="header-anchor">#</a> RBAC 权限模型</h5> <p>RBAC 权限模型(Role-Based Access Control)，即：基于角色的权限控制。这是目前最常被开发者使用也是相对易用、通用权限模型。</p> <p><img src="/assets/img/image-20240627234251159.5f7ff4c8.webp" alt="image-20240627234251159"></p> <h5 id="准备工作-3"><a href="#准备工作-3" class="header-anchor">#</a> 准备工作</h5> <ol><li><p>数据库表, 建表语句如下</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_menu<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'菜单ID'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>menu_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">50</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'菜单名称'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>parent_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'父菜单ID'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>order_num<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'显示顺序'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">200</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'路由地址'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>component<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'组件路径'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>is_frame<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token string">'1'</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否为外链（0是 1否）'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>menu_type<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'菜单类型（M目录 C菜单 F按钮）'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>visible<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'菜单状态（0显示 1隐藏）'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'菜单状态（0正常 1停用）'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>perms<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">100</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限标识'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>icon<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">100</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'#'</span> <span class="token keyword">COMMENT</span> <span class="token string">'菜单图标'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>create_by<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建者'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>update_by<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新者'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>remark<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">500</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'备注'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>del_flag<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb3 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'菜单权限表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_menu<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>menu_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>component<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>perms<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'部门管理'</span><span class="token punctuation">,</span> <span class="token string">'dept'</span><span class="token punctuation">,</span> <span class="token string">'system/dept/index'</span><span class="token punctuation">,</span> <span class="token string">'system:dept:list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_menu<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>menu_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>component<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>perms<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'system/test/index'</span><span class="token punctuation">,</span> <span class="token string">'system:test:list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色名称'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色权限字符串'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role_sort<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'显示顺序'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色状态（0正常 1停用）'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>del_flag<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'删除标志（0代表存在 1代表删除）'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_by<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建者'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_by<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新者'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>remark<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'备注'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'角色信息表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>role_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>role_key<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>role_sort<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CEO'</span><span class="token punctuation">,</span> <span class="token string">'ceo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>role_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>role_key<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>role_sort<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'Coder'</span><span class="token punctuation">,</span> <span class="token string">'coder'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_role_menu<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>menu_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'菜单ID'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>menu_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'角色和菜单关联表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_role_menu<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>menu_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_role_menu<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>menu_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user_role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色ID'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户和角色关联表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user_role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div></li> <li><p>定义 Mapper 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MenuMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Menu</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> selectPermsByUserId <span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.sangeng.sangengtokendemo.mapper.MenuMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectPermsByUserId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT DISTINCT
            m.perms
        FROM
            sys_user_role ur
                LEFT JOIN sys_role r ON ur.role_id = r.id
                LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id
                LEFT JOIN sys_menu m ON m.id = rm.menu_id
        WHERE
            user_id = #{userId}
          AND r.`status` = 0
          AND m.`status` = 0;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ol> <p>​	然后我们可以在 UserDetailsServiceImpl 中去调用该 mapper 的方法查询权限信息封装到 LoginUser 对象中即可</p> <h5 id="限制访问资源所需权限"><a href="#限制访问资源所需权限" class="header-anchor">#</a> 限制访问资源所需权限</h5> <p>SpringSecurity 为我们提供了基于注解的权限控制方案，这也是我们项目中主要采用的方式。我们可以使用注解去指定访问对应的资源所需的权限。</p> <p>但是要使用它我们需要先开启相关配置。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableGlobalMethodSecurity</span><span class="token punctuation">(</span>prePostEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注：后面版本 <code>@EnableGlobalMethodSecurity</code> 已过时，可直接用 <code>@EnableMethodSecurity</code> 代替，其不需要在注解中添加 <code>prePostEnabled</code>，因为它现在默认为 true。</p> <p>然后就可以使用对应的注解 <code>@PreAuthorize</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority('test')&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="封装权限信息"><a href="#封装权限信息" class="header-anchor">#</a> 封装权限信息</h5> <h6 id="loginuser"><a href="#loginuser" class="header-anchor">#</a> LoginUser</h6> <ul><li>前面在写 UserDetailsServiceImpl 的时候说过，在查询出用户后还要获取对应的权限信息，封装到 UserDetails 中返回。</li> <li>我们之前定义了 UserDetails 的实现类 LoginUser，想要让其能封装权限信息就要对其进行修改</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginUser</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>
    <span class="token comment">// 封装用户信息</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions<span class="token punctuation">;</span>

    <span class="token comment">// 存储 SpringSecurity 所需要的权限信息的集合</span>
    <span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>serialize<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">LoginUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>permissions <span class="token operator">=</span> permissions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取权限</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 把 permissions 中 Sting类型的权限信息封装成 SimpleGrantedAuthority 对象</span>
        authorities <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取密码</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取用户名</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 账户是否未过期</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 账户是否未锁定</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 密码是否未过期</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 账户是否可用</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h6 id="userdetailsserviceimpl"><a href="#userdetailsserviceimpl" class="header-anchor">#</a> UserDetailsServiceImpl</h6> <p>LoginUser 修改完后我们就可以在 UserDetailsServiceImpl 中去把权限信息封装到 LoginUser 中了。我们写死权限进行测试，后面我们再从数据库中查询权限信息。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDetailsServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">MenuMapper</span> menuMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 查询用户信息</span>
        <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUserName</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果没有查到用户就抛出异常</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;用户名或者密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token comment">//        List&lt;String&gt; list = Arrays.asList(&quot;test&quot;, &quot;admin&quot;);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> perms <span class="token operator">=</span> menuMapper<span class="token punctuation">.</span><span class="token function">selectPermsByUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把数据封装成 UserDetails 返回</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoginUser</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> perms<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>注意</strong>：此处需要注意修改 HelloController 中的权限，之前写的是 <code>@PreAuthorize(&quot;hasAuthority('user')&quot;)</code> 要改为数据库中对应有的权限</p> <h6 id="jwtauthenticationtokenfilter"><a href="#jwtauthenticationtokenfilter" class="header-anchor">#</a> JwtAuthenticationTokenFilter</h6> <p>在 SpringSecurity 中，会使用默认的 FilterSecurityInterceptor 来进行权限校验。在 FilterSecurityInterceptor 中会从 SecurityContextHolder 获取其中的 Authentication，然后获取其中的权限信息。当前用户是否拥有访问当前资源所需的权限。所以我们在项目中只需要<strong>把当前登录用户的权限信息也存入 Authentication</strong>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token comment">// OncePerRequestFilter特点是在处理单个HTTP请求时确保过滤器的 doFilterInternal 方法只被调用一次</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisCache</span> redisCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取 token</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 放行</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 解析 token</span>
        <span class="token class-name">String</span> userId<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token function">parseJWT</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userId <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;token 非法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 从 redis 中获取用户信息</span>
        <span class="token class-name">LoginUser</span> loginUser <span class="token operator">=</span> redisCache<span class="token punctuation">.</span><span class="token function">getCacheObject</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 存入 SecurityContextHolder</span>
            <span class="token comment">// TODO 获取权限信息封装到 Authentication 中</span>
            <span class="token class-name">UsernamePasswordAuthenticationToken</span> authenticationToken <span class="token operator">=</span>
                    <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 放行</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="跨域-2"><a href="#跨域-2" class="header-anchor">#</a> 跨域</h3> <ul><li>浏览器出于安全的考虑，使用 <code>XMLHttpRequest</code> 对象发起 HTTP 请求时必须遵守同源策略，否则就是跨域的 HTTP 请求</li> <li>默认情况下是被禁止的。 同源策略要求源相同才能正常进行通信，即<code>协议、域名、端口号都完全一致</code>。</li> <li>前后端分离项目，前端项目和后端项目一般都不是同源的，所以肯定会存在跨域请求的问题。所以我们就要处理一下，让前端能进行跨域请求。</li></ul> <h4 id="先对-springboot-配置-允许跨域请求"><a href="#先对-springboot-配置-允许跨域请求" class="header-anchor">#</a> 先对 SpringBoot 配置，允许跨域请求</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置允许跨域请求的域名</span>
                <span class="token punctuation">.</span><span class="token function">allowedOriginPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// 是否允许cookie</span>
                <span class="token punctuation">.</span><span class="token function">allowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置允许的请求方式</span>
                <span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置允许的header属性</span>
                <span class="token punctuation">.</span><span class="token function">allowedHeaders</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// 跨域允许时间</span>
                <span class="token punctuation">.</span><span class="token function">maxAge</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="开启-springsecurity-的跨域访问"><a href="#开启-springsecurity-的跨域访问" class="header-anchor">#</a> 开启 SpringSecurity 的跨域访问</h4> <p>由于我们的资源都会受到 SpringSecurity 的保护，所以想要跨域访问还要让 SpringSecurity 运行跨域访问。<code>http.cors()</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableGlobalMethodSecurity</span><span class="token punctuation">(</span>prePostEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建 BCryptPasswordEncoder 注入容器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> jwtAuthenticationTokenFilter<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationEntryPoint</span> authenticationEntryPoint<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AccessDeniedHandler</span> accessDeniedHandler<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
                <span class="token comment">// 禁用 CSRF 保护</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 不通过 Session 获取 SecurityContext</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 对于登录接口，允许匿名访问</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/testCors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;system:dept:list&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// 除上面外的所有请求全部需要授权认证</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加JWT认证过滤器</span>
        http<span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span>jwtAuthenticationTokenFilter<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 配置异常处理器</span>
        http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span>authenticationEntryPoint<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span>accessDeniedHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 允许跨域</span>
        http<span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="其它知识点"><a href="#其它知识点" class="header-anchor">#</a> 其它知识点</h3> <h4 id="自定义失败处理器"><a href="#自定义失败处理器" class="header-anchor">#</a> 自定义失败处理器</h4> <ul><li>我们还希望在认证失败或者是授权失败的情况下也能和我们的接口一样返回相同结构的 json，这样可以让前端能对响应进行统一的处理。要实现这个功能我们需要知道 SpringSecurity 的异常处理机制。</li> <li>在 SpringSecurity 中，如果我们在认证或者授权的过程中出现了异常会被 ExceptionTranslationFilter 捕获到。在 ExceptionTranslationFilter 中会去判断是认证失败还是授权失败出现的异常。</li> <li>如果是认证过程中出现的异常会被封装成 AuthenticationException 然后调用 <strong>AuthenticationEntryPoint</strong> 对象的方法去进行异常处理。</li> <li>如果是授权过程中出现的异常会被封装成 AccessDeniedException 然后调用 <strong>AccessDeniedHandler</strong> 对象的方法去进行异常处理。</li> <li>所以如果我们需要自定义异常处理，我们只需要自定义 AuthenticationEntryPoint 和 AccessDeniedHandler 然后配置 SpringSecurity 即可。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccessDeniedHandlerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccessDeniedHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                       <span class="token class-name">AccessDeniedException</span> accessDeniedException<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span>
            <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResponseResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;权限不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationEntryPointImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationEntryPoint</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commence</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span>
            response<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span> authException<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span>
            <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResponseResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span>
                <span class="token class-name">ResponseResult</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;认证失败请重新登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 配置异常处理</span>
http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception <span class="token operator">-&gt;</span> exception<span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span>accessDeniedHandler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span>authenticationEntryPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="其它权限校验方法"><a href="#其它权限校验方法" class="header-anchor">#</a> 其它权限校验方法</h4> <ul><li>除了使用 <code>@PreAuthorize</code> 注解，然后在在其中使用的是 <code>hasAuthority</code> 方法进行校验外，SpringSecurity 还为我们提供了其它方法例如：<code>hasAnyAuthority</code>，<code>hasRole</code>，<code>hasAnyRole</code> 等。</li> <li><code>hasAuthority</code> 方法实际是执行到了 <code>SecurityExpressionRoot</code> 的 <code>hasAuthority</code>，它内部其实是调用 <code>authentication</code> 的 <code>getAuthorities</code> 方法获取用户的权限列表。然后判断存入的方法参数数据是否在权限列表中。</li></ul> <p><code>hasAnyAuthority</code> 方法可以传入多个权限，只有用户有其中任意一个权限都可以访问对应资源。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAnyAuthority('admin','test','system:dept:list')&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>hasRole</code> 要求有对应的角色才可以访问，但是它内部会把我们传入的参数拼接上 <strong>ROLE_</strong> 后再去比较。所以这种情况下要用户对应的权限也要有 <strong>ROLE_</strong> 这个前缀才可以。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasRole('system:dept:list')&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>hasAnyRole</code> 有任意的角色就可以访问。它内部也会把我们传入的参数拼接上 <strong>ROLE_</strong> 后再去比较。所以这种情况下要用用户对应的权限也要有 <strong>ROLE_</strong> 这个前缀才可以。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAnyRole('admin','system:dept:list')&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="自定义权限校验方法"><a href="#自定义权限校验方法" class="header-anchor">#</a> 自定义权限校验方法</h4> <p>我们也可以定义自己的权限校验方法，在 <code>@PreAuthorize</code> 注解中使用我们的方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sangeng<span class="token punctuation">.</span>sangengtokendemo<span class="token punctuation">.</span>expression</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySecurityExpressionRoot</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token class-name">String</span> authority<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取当前用户的权限</span>
        <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LoginUser</span> loginUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoginUser</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> loginUser<span class="token punctuation">.</span><span class="token function">getPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断用户权限集合中是否存在 authority</span>
        <span class="token keyword">return</span> permissions<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>authority<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在 SPEL 表达式中使用 <code>@mySecurityExpressionRoot</code> 相当于获取容器中 bean 的名字为 <code>mySecurityExpressionRoot</code> 的对象。然后再调用这个对象的 <code>hasAuthority</code> 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@PreAuthorize(&quot;hasAuthority('system:dept:list')&quot;)</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;@mySecurityExpressionRoot.hasAuthority('system:dept:list')&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="基于配置的权限控制"><a href="#基于配置的权限控制" class="header-anchor">#</a> 基于配置的权限控制</h4> <p>我们也可以在配置类中使用使用配置的方式对资源进行权限控制。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http
        <span class="token comment">// 禁用 CSRF 保护</span>
        <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 不通过 Session 获取 SecurityContext</span>
        <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 对于登录接口，允许匿名访问</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/testCors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;system:dept:list&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// 除上面外的所有请求全部需要授权认证</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加JWT认证过滤器</span>
    http<span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span>jwtAuthenticationTokenFilter<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 配置异常处理器</span>
    http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span>authenticationEntryPoint<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span>accessDeniedHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 允许跨域</span>
    http<span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="csrf-2"><a href="#csrf-2" class="header-anchor">#</a> CSRF</h4> <ul><li>CSRF 是指跨站请求伪造(Cross-site request forgery)，是 web 常见的攻击之一。</li> <li><a href="https://blog.csdn.net/freeking101/article/details/86537087" target="_blank" rel="noopener noreferrer">CSRF 攻击与防御-CSDN 博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>SpringSecurity 去防止 CSRF 攻击的方式就是通过 <code>csrf_token</code>。后端会生成一个 <code>csrf_token</code>，前端发起请求的时候需要携带这个 <code>csrf_token</code>，后端会有过滤器进行校验，如果没有携带或者是伪造的就不允许访问。</li> <li>我们可以发现 CSRF 攻击依靠的是 cookie 中所携带的认证信息。但是在前后端分离的项目中我们的认证信息其实是 token，而 token 并不是存储中 cookie 中，并且需要前端代码去把 token 设置到请求头中才可以，所以 CSRF 攻击也就不用担心了。</li></ul> <h2 id="认证方案总结"><a href="#认证方案总结" class="header-anchor">#</a> 认证方案总结</h2> <h3 id="方案-1"><a href="#方案-1" class="header-anchor">#</a> 方案 1</h3> <ol><li><p>实现 <code>UserDetailsManager</code> 方法，从数据库查询用户信息</p></li> <li><p>在配置类进行各种配置，如</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启授权保护</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize
                           <span class="token comment">// 对所有请求开启授权保护</span>
                           <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token comment">// 已认证的请求会被自动授权</span>
                           <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 无需授权即可访问当前页面</span>
            <span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;myusername&quot;</span><span class="token punctuation">)</span> <span class="token comment">//自定义表单用户名参数，默认是username</span>
            <span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;mypassword&quot;</span><span class="token punctuation">)</span> <span class="token comment">//自定义表单用户名参数，默认是username</span>
            <span class="token punctuation">.</span><span class="token function">failureUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login?error&quot;</span><span class="token punctuation">)</span> <span class="token comment">//登录失败的返回地址</span>
            <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 认证成功时的处理</span>
            <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 认证失败时的处理</span>
            <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span>     <span class="token comment">// 登录访问路径</span>
            <span class="token punctuation">.</span><span class="token function">defaultSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/success.html&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 登录成功之后，跳转路径</span>
            <span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 使用表单授权方式</span>
    <span class="token comment">//                .httpBasic(withDefaults()); // 使用基本授权方式</span>

    <span class="token comment">// 退出相关配置</span>
    http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 注销成功时的处理</span>
            <span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// 退出访问路径</span>
            <span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login?logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 退出成功之后，跳转路径</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 配置没有权限访问跳转自定义页面</span>
    http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求未认证的处理</span>
        exception<span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAccessDeniedHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 请求未授权的接口</span>
        exception<span class="token punctuation">.</span><span class="token function">accessDeniedPage</span><span class="token punctuation">(</span><span class="token string">&quot;unauth.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 没有权限访问跳转自定义页面</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span>session <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">maximumSessions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expiredSessionStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MySessionInformationExpiredStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 跨域</span>
    http<span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 关闭 csrf 攻击防御</span>
    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// remember me</span>
    http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">HttpSessionEventPublisher</span> <span class="token function">httpSessionEventPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpSessionEventPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div></li></ol> <h3 id="方案-2"><a href="#方案-2" class="header-anchor">#</a> 方案 2</h3> <p>如案例实战，自己写登录验证方法</p> <p>还可参考 <a href="https://gitee.com/ismutou/workspace_atguigu_idea/tree/master/springsecurity-study/acl_parent" target="_blank" rel="noopener noreferrer">springsecurity-study<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://www.springcloud.cc/spring-security.html" target="_blank" rel="noopener noreferrer">Spring Security 中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://springdoc.cn/spring-security/" target="_blank" rel="noopener noreferrer">Spring Security 中文文档 :: Spring Security Reference (springdoc.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://springdoc.cn/spring-deprecated-websecurityconfigureradapter/" target="_blank" rel="noopener noreferrer">Spring Security：升级已弃用的 WebSecurityConfigurerAdapter - spring 中文网 (springdoc.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/06/12, 00:25:27</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/micro-service-ecology/Shiro/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">安全框架之 Shiro</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/micro-service-ecology/Shiro/">安全框架之 Shiro</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/jdbc-core/"><div>
            JDBC 核心技术(JDK21版)
            <!----></div></a> <span class="date">09-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/"><div>
            第00章_写在前面
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/"><div>
            第01章_Linux 下 MySQL 的安装与使用
            <!----></div></a> <span class="date">05-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca5c989c.js" defer></script><script src="/assets/js/3.f2884e99.js" defer></script><script src="/assets/js/2.81e8b964.js" defer></script><script src="/assets/js/13.680e50fd.js" defer></script>
  </body>
</html>
