<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安全框架之 Shiro | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.1f9bc03c.js" as="script"><link rel="preload" href="/assets/js/3.be9e7e99.js" as="script"><link rel="preload" href="/assets/js/2.c36d0987.js" as="script"><link rel="preload" href="/assets/js/48.e1366a45.js" as="script"><link rel="prefetch" href="/assets/js/1.0094a9f8.js"><link rel="prefetch" href="/assets/js/10.57dc9feb.js"><link rel="prefetch" href="/assets/js/100.549e8107.js"><link rel="prefetch" href="/assets/js/101.cdc9900a.js"><link rel="prefetch" href="/assets/js/102.559eb4e1.js"><link rel="prefetch" href="/assets/js/103.e93e873a.js"><link rel="prefetch" href="/assets/js/104.f72a97fa.js"><link rel="prefetch" href="/assets/js/105.8a88aff1.js"><link rel="prefetch" href="/assets/js/106.a6928366.js"><link rel="prefetch" href="/assets/js/107.88f8c8a9.js"><link rel="prefetch" href="/assets/js/108.221fcd72.js"><link rel="prefetch" href="/assets/js/109.83b01a4c.js"><link rel="prefetch" href="/assets/js/11.95ba941a.js"><link rel="prefetch" href="/assets/js/110.3a8bfc21.js"><link rel="prefetch" href="/assets/js/111.e09a67c7.js"><link rel="prefetch" href="/assets/js/112.8f29c828.js"><link rel="prefetch" href="/assets/js/113.a3ec218a.js"><link rel="prefetch" href="/assets/js/114.46baaf9a.js"><link rel="prefetch" href="/assets/js/115.dca2a47e.js"><link rel="prefetch" href="/assets/js/116.95b35ab7.js"><link rel="prefetch" href="/assets/js/117.748a7942.js"><link rel="prefetch" href="/assets/js/118.9baa4784.js"><link rel="prefetch" href="/assets/js/119.c98d396a.js"><link rel="prefetch" href="/assets/js/12.3e375fac.js"><link rel="prefetch" href="/assets/js/120.c56ebb20.js"><link rel="prefetch" href="/assets/js/121.0046ecb9.js"><link rel="prefetch" href="/assets/js/122.9266562d.js"><link rel="prefetch" href="/assets/js/123.607dd163.js"><link rel="prefetch" href="/assets/js/124.f902b1cd.js"><link rel="prefetch" href="/assets/js/125.a1fc58d3.js"><link rel="prefetch" href="/assets/js/126.0f7e19b0.js"><link rel="prefetch" href="/assets/js/127.0849390a.js"><link rel="prefetch" href="/assets/js/128.948551ba.js"><link rel="prefetch" href="/assets/js/129.d9ca416a.js"><link rel="prefetch" href="/assets/js/13.e15907e1.js"><link rel="prefetch" href="/assets/js/130.24c7e3fb.js"><link rel="prefetch" href="/assets/js/131.1b011ee5.js"><link rel="prefetch" href="/assets/js/132.8751add7.js"><link rel="prefetch" href="/assets/js/133.715ef8cf.js"><link rel="prefetch" href="/assets/js/14.8bc7a04e.js"><link rel="prefetch" href="/assets/js/15.45052e8a.js"><link rel="prefetch" href="/assets/js/16.9c02512f.js"><link rel="prefetch" href="/assets/js/17.48a859d1.js"><link rel="prefetch" href="/assets/js/18.5c00cde2.js"><link rel="prefetch" href="/assets/js/19.a40de13b.js"><link rel="prefetch" href="/assets/js/20.df43b03f.js"><link rel="prefetch" href="/assets/js/21.ceeba2d0.js"><link rel="prefetch" href="/assets/js/22.1bba0f00.js"><link rel="prefetch" href="/assets/js/23.76e4c23a.js"><link rel="prefetch" href="/assets/js/24.f9c3a106.js"><link rel="prefetch" href="/assets/js/25.d3ac7e27.js"><link rel="prefetch" href="/assets/js/26.2dccc980.js"><link rel="prefetch" href="/assets/js/27.470222d7.js"><link rel="prefetch" href="/assets/js/28.0083644b.js"><link rel="prefetch" href="/assets/js/29.c51b5005.js"><link rel="prefetch" href="/assets/js/30.e4d96a02.js"><link rel="prefetch" href="/assets/js/31.a6e5f592.js"><link rel="prefetch" href="/assets/js/32.f513417c.js"><link rel="prefetch" href="/assets/js/33.a02e512f.js"><link rel="prefetch" href="/assets/js/34.828ac0a3.js"><link rel="prefetch" href="/assets/js/35.6a8d3b2a.js"><link rel="prefetch" href="/assets/js/36.a17d9cce.js"><link rel="prefetch" href="/assets/js/37.b28188f4.js"><link rel="prefetch" href="/assets/js/38.6c0bad74.js"><link rel="prefetch" href="/assets/js/39.4ac705c3.js"><link rel="prefetch" href="/assets/js/4.80fad3d6.js"><link rel="prefetch" href="/assets/js/40.e1295e6b.js"><link rel="prefetch" href="/assets/js/41.ab0dc1d3.js"><link rel="prefetch" href="/assets/js/42.abf81f78.js"><link rel="prefetch" href="/assets/js/43.c6055770.js"><link rel="prefetch" href="/assets/js/44.2adf0a62.js"><link rel="prefetch" href="/assets/js/45.dfeaf4aa.js"><link rel="prefetch" href="/assets/js/46.4b7c2b21.js"><link rel="prefetch" href="/assets/js/47.d4a6831e.js"><link rel="prefetch" href="/assets/js/49.1bebc46f.js"><link rel="prefetch" href="/assets/js/5.1478cf6c.js"><link rel="prefetch" href="/assets/js/50.668f9cb0.js"><link rel="prefetch" href="/assets/js/51.dea0d5d9.js"><link rel="prefetch" href="/assets/js/52.3000ebc8.js"><link rel="prefetch" href="/assets/js/53.66f5ad34.js"><link rel="prefetch" href="/assets/js/54.319b0662.js"><link rel="prefetch" href="/assets/js/55.ffc0758d.js"><link rel="prefetch" href="/assets/js/56.b67a2b8d.js"><link rel="prefetch" href="/assets/js/57.70e2950c.js"><link rel="prefetch" href="/assets/js/58.a0a2420f.js"><link rel="prefetch" href="/assets/js/59.01790419.js"><link rel="prefetch" href="/assets/js/6.3409ab2f.js"><link rel="prefetch" href="/assets/js/60.43219c1e.js"><link rel="prefetch" href="/assets/js/61.ed48312b.js"><link rel="prefetch" href="/assets/js/62.62ea2fef.js"><link rel="prefetch" href="/assets/js/63.d1527c65.js"><link rel="prefetch" href="/assets/js/64.b10abcac.js"><link rel="prefetch" href="/assets/js/65.2206c2d8.js"><link rel="prefetch" href="/assets/js/66.bd612805.js"><link rel="prefetch" href="/assets/js/67.ad9c475a.js"><link rel="prefetch" href="/assets/js/68.7f975389.js"><link rel="prefetch" href="/assets/js/69.36725aff.js"><link rel="prefetch" href="/assets/js/70.b3cfc9e1.js"><link rel="prefetch" href="/assets/js/71.ef2c6abc.js"><link rel="prefetch" href="/assets/js/72.77bf484b.js"><link rel="prefetch" href="/assets/js/73.ca8e0259.js"><link rel="prefetch" href="/assets/js/74.9aa20efa.js"><link rel="prefetch" href="/assets/js/75.9de36ec8.js"><link rel="prefetch" href="/assets/js/76.79e8f077.js"><link rel="prefetch" href="/assets/js/77.a71d38fe.js"><link rel="prefetch" href="/assets/js/78.2168cfa5.js"><link rel="prefetch" href="/assets/js/79.d830dc29.js"><link rel="prefetch" href="/assets/js/80.ed07f097.js"><link rel="prefetch" href="/assets/js/81.036542c0.js"><link rel="prefetch" href="/assets/js/82.ccd57590.js"><link rel="prefetch" href="/assets/js/83.08279d07.js"><link rel="prefetch" href="/assets/js/84.fb82a36b.js"><link rel="prefetch" href="/assets/js/85.cc257bf7.js"><link rel="prefetch" href="/assets/js/86.9b4a4d60.js"><link rel="prefetch" href="/assets/js/87.be2fbadd.js"><link rel="prefetch" href="/assets/js/88.5dbe3bf4.js"><link rel="prefetch" href="/assets/js/89.baa4fea0.js"><link rel="prefetch" href="/assets/js/9.9ffa17fb.js"><link rel="prefetch" href="/assets/js/90.0b8138d9.js"><link rel="prefetch" href="/assets/js/91.6c5e4907.js"><link rel="prefetch" href="/assets/js/92.d4a76597.js"><link rel="prefetch" href="/assets/js/93.8a94df70.js"><link rel="prefetch" href="/assets/js/94.ed88a857.js"><link rel="prefetch" href="/assets/js/95.2f75b854.js"><link rel="prefetch" href="/assets/js/96.6946c831.js"><link rel="prefetch" href="/assets/js/97.b26e97d9.js"><link rel="prefetch" href="/assets/js/98.07ba851b.js"><link rel="prefetch" href="/assets/js/99.347e0865.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.cc39ba74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li><li class="dropdown-subitem"><a href="/java-basic/java-web/" class="nav-link">JavaWeb 技术</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title router-link-active">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li><li class="dropdown-subitem"><a href="/java-basic/java-web/" class="nav-link">JavaWeb 技术</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title router-link-active">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" class="nav-link">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>安全框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/micro-service-ecology/SpringSecurity/" class="sidebar-link">安全框架之 Spring Security</a></li><li><a href="/micro-service-ecology/Shiro/" aria-current="page" class="active sidebar-link">安全框架之 Shiro</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/Shiro/#入门概述" class="sidebar-link">入门概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#是什么" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#为什么要用-shiro" class="sidebar-link">为什么要用 Shiro</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#shiro-与-springsecurity-的对比" class="sidebar-link">Shiro 与 SpringSecurity 的对比</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#基本功能" class="sidebar-link">基本功能</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#shiro-架构概述" class="sidebar-link">Shiro 架构概述</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#shiro-架构详情" class="sidebar-link">Shiro 架构详情</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/Shiro/#基本使用" class="sidebar-link">基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#环境准备" class="sidebar-link">环境准备</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#ini-文件" class="sidebar-link">INI 文件</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#登录认证" class="sidebar-link">登录认证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#登录认证概念" class="sidebar-link">登录认证概念</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#登录认证基本流程" class="sidebar-link">登录认证基本流程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#登录认证实例" class="sidebar-link">登录认证实例</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#身份认证流程" class="sidebar-link">身份认证流程</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#角色、授权" class="sidebar-link">角色、授权</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权概念" class="sidebar-link">授权概念</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权方式" class="sidebar-link">授权方式</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权流程" class="sidebar-link">授权流程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权实例" class="sidebar-link">授权实例</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#shiro-加密" class="sidebar-link">Shiro 加密</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#shiro-自定义登录认证" class="sidebar-link">Shiro 自定义登录认证</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/Shiro/#与-spring-boot-整合" class="sidebar-link">与 Spring Boot 整合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#开发环境" class="sidebar-link">开发环境</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#框架整合" class="sidebar-link">框架整合</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#创建模块" class="sidebar-link">创建模块</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#添加依赖" class="sidebar-link">添加依赖</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#添加配置文件" class="sidebar-link">添加配置文件</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#添加启动类" class="sidebar-link">添加启动类</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#登录认证实现" class="sidebar-link">登录认证实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#后端接口服务实现" class="sidebar-link">后端接口服务实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#前端页面实现" class="sidebar-link">前端页面实现</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#多个-realm-的认证策略设置" class="sidebar-link">多个 realm 的认证策略设置</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#多个-realm-实现原理" class="sidebar-link">多个 realm 实现原理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#多个-realm-代码实现" class="sidebar-link">多个 realm 代码实现</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#remember-me-功能" class="sidebar-link">remember me 功能</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#基本流程" class="sidebar-link">基本流程</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#代码实现" class="sidebar-link">代码实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#实验" class="sidebar-link">实验</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#用户登录认证后登出" class="sidebar-link">用户登录认证后登出</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#代码实现-2" class="sidebar-link">代码实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#授权、角色认证" class="sidebar-link">授权、角色认证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权" class="sidebar-link">授权</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#后端接口服务注解" class="sidebar-link">后端接口服务注解</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权验证-没有角色无法访问" class="sidebar-link">授权验证-没有角色无法访问</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权验证-获取角色进行验证" class="sidebar-link">授权验证-获取角色进行验证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权验证-获取权限进行验证" class="sidebar-link">授权验证-获取权限进行验证</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#授权验证-异常处理" class="sidebar-link">授权验证-异常处理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#前端页面授权验证" class="sidebar-link">前端页面授权验证</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#实现缓存" class="sidebar-link">实现缓存</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#缓存工具-ehcache" class="sidebar-link">缓存工具 EhCache</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#ehcache-搭建使用" class="sidebar-link">EhCache 搭建使用</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#shiro-整合-ehcache" class="sidebar-link">Shiro 整合 EhCache</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Shiro/#会话管理" class="sidebar-link">会话管理</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#sessionmanager" class="sidebar-link">SessionManager</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#会话管理实现" class="sidebar-link">会话管理实现</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Shiro/#获得-session-方式" class="sidebar-link">获得 session 方式</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>定时任务框架</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/micro-service-ecology/#微服务生态" data-v-06225672>微服务生态</a></li><li data-v-06225672><a href="/micro-service-ecology/#安全框架" data-v-06225672>安全框架</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-06-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">安全框架之 Shiro<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="安全框架之-shiro"><a href="#安全框架之-shiro" class="header-anchor">#</a> 安全框架之 Shiro</h1> <h2 id="入门概述"><a href="#入门概述" class="header-anchor">#</a> 入门概述</h2> <h3 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么</h3> <ul><li>Apache Shiro 是一个功能强大且易于使用的 Java 安全（权限）框架。</li> <li>Shiro 可以完成：认证、授权、加密、会话管理、与 Web 集成、缓存等。</li> <li>借助 Shiro 您可以快速轻松地保护任何应用程序——从最小的移动应用程序到最大的 Web 和企业应用程序。</li> <li>官网：<a href="https://shiro.apache.org/" target="_blank" rel="noopener noreferrer">https://shiro.apache.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.docs4dev.com/docs/zh/apache-shiro/1.5.3/reference/introduction.html" target="_blank" rel="noopener noreferrer">Apache Shiro 中文文档 | Docs4dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="为什么要用-shiro"><a href="#为什么要用-shiro" class="header-anchor">#</a> 为什么要用 Shiro</h3> <p>自 2003 年以来，框架格局发生了相当大的变化，因此今天仍然有很多系统在使用 Shiro。这与 Shiro 的特性密不可分。</p> <ul><li><strong>易于使用</strong>：使用 Shiro 构建系统安全框架非常简单。就算第一次接触也可以快速掌握。</li> <li><strong>全面</strong>：Shiro 包含系统安全框架需要的功能，满足安全需求的“一站式服务”。</li> <li><strong>灵活</strong>：Shiro 可以在任何应用程序环境中工作。虽然它可以在 Web、EJB 和 IoC 环境中工作，但不需要依赖它们。Shiro 也没有强制要求任何规范，甚至没有很多依赖项。</li> <li><strong>强力支持 Web</strong>：Shiro 具有出色的 Web 应用程序支持，可以基于应用程序 URL 和 Web 协议（例如 REST）创建灵活的安全策略，同时还提供一组 JSP 库来控制页面输出。</li> <li><strong>兼容性强</strong>：Shiro 的设计模式使其易于与其他框架和应用程序集成。Shiro 与 Spring、Grails、Wicket、Tapestry、Mule、Apache Camel、Vaadin 等框架无缝集成。</li> <li><strong>社区支持</strong>：Shiro 是 Apache 软件基金会的一个开源项目，有完备的社区支持，文档支持。如果需要，像 Katasoft 这样的商业公司也会提供专业的支持和服务。</li></ul> <h3 id="shiro-与-springsecurity-的对比"><a href="#shiro-与-springsecurity-的对比" class="header-anchor">#</a> Shiro 与 SpringSecurity 的对比</h3> <ol><li>Spring Security 基于 Spring 开发，项目若使用 Spring 作为基础，配合 Spring Security 做权限更加方便，而 Shiro 需要和 Spring 进行整合开发；</li> <li>Spring Security 功能比 Shiro 更加丰富些，例如安全维护方面；</li> <li>Spring Security 社区资源相对比 Shiro 更加丰富；</li> <li>Shiro 的配置和使用比较简单，Spring Security 上手复杂些；</li> <li>Shiro 依赖性低，不需要任何框架和容器，可以独立运行。Spring Security 依赖 Spring 容器；</li> <li>Shiro 不仅仅可以使用在 web 中，它可以工作在任何应用环境中。在集群会话时 Shiro 最重要的一个好处或许就是它的会话是独立于容器的。</li></ol> <h3 id="基本功能"><a href="#基本功能" class="header-anchor">#</a> 基本功能</h3> <p><img src="/assets/img/ShiroFeatures.9f50ec4c.webp" alt="ShiroFeatures"></p> <ol><li><strong>Authentication</strong>：身份认证/登录，验证用户是不是拥有相应的身份；</li> <li><strong>Authorization</strong>：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能进行什么操作，如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；</li> <li><strong>Session Manager</strong>：会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通 JavaSE 环境，也可以是 Web 环境的；</li> <li><strong>Cryptography</strong>：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；</li> <li><strong>Web Support</strong>：Web 支持，可以非常容易的集成到 Web 环境；</li> <li><strong>Caching</strong>：缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率；</li> <li><strong>Concurrency</strong>：Shiro 支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</li> <li><strong>Testing</strong>：提供测试支持；</li> <li><strong>Run As</strong>：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；</li> <li><strong>Remember Me</strong>：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了。</li></ol> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <h4 id="shiro-架构概述"><a href="#shiro-架构概述" class="header-anchor">#</a> Shiro 架构概述</h4> <p><img src="data:image/webp;base64,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" alt="ShiroBasicArchitecture"></p> <ul><li><strong>Subject</strong>：应用代码直接交互的对象是 Subject，也就是说 Shiro 的对外 API 核心就是 Subject。Subject 代表了当前“用户”， 这个用户不一定是一个具体的人，与当前应用交互的任何东西都是 Subject，如网络爬虫， 机器人等；与 Subject 的所有交互都会委托给 SecurityManager；Subject 其实是一个门面，SecurityManager 才是实际的执行者；</li> <li><strong>SecurityManager</strong>：安全管理器；即所有与安全有关的操作都会与 SecurityManager 交互；且其管理着所有 Subject；可以看出它是 Shiro 的核心，它负责与 Shiro 的其他组件进行交互，它相当于 SpringMVC 中 DispatcherServlet 的角色；</li> <li><strong>Realm</strong>：Shiro 从 Realm 获取安全数据（如用户、角色、权限），就是说 SecurityManager 要验证用户身份，那么它需要从 Realm 获取相应的用户进行比较以确定用户身份是否合法；也需要从 Realm 得到用户相应的角色/权限进行验证用户是否能进行操作；可以把 Realm 看成 DataSource。</li></ul> <h4 id="shiro-架构详情"><a href="#shiro-架构详情" class="header-anchor">#</a> Shiro 架构详情</h4> <p><img src="/assets/img/ShiroArchitecture.3702176f.webp" alt="ShiroArchitecture"></p> <ul><li><strong>Subject</strong> <code>org.apache.shiro.subject.Subject</code>：任何可以与应用交互的“用户”；</li> <li><strong>SecurityManager</strong> <code>org.apache.shiro.mgt.SecurityManager</code>：相当于 SpringMVC 中的 DispatcherServlet；是 Shiro 的心脏； 所有具体的交互都通过 SecurityManager 进行控制；它管理着所有 Subject、且负责进行认证、授权、会话及缓存的管理。</li> <li><strong>Authenticator</strong> <code>org.apache.shiro.authc.Authenticator</code>：负责 Subject 认证，是一个扩展点，可以自定义实现；可以使用认证策略(Authentication Strategy)，即什么情况下算用户认证通过了；</li> <li><strong>Authorizer</strong> <code>org.apache.shiro.authz.Authorizer)</code>：授权器、即访问控制器，用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能；</li> <li><strong>Realm</strong> <code>org.apache.shiro.authz.Authorizer</code>：可以有 1 个或多个 Realm，可以认为是安全实体数据源，即用于获取安全实体的；可以是 JDBC 实现，也可以是内存实现等等；由用户提供；所以一般在应用中都需要实现自己的 Realm；</li> <li><strong>SessionManager</strong> <code>org.apache.shiro.session.mgt.SessionManager</code>：管理 Session 生命周期的组件；而 Shiro 并不仅仅可以用在 Web 环境，也可以用在如普通的 JavaSE 环境；</li> <li><strong>CacheManager</strong> <code>org.apache.shiro.cache.CacheManager</code>：缓存控制器，用来管理如用户、角色、权限等的缓存的；因为这些数据基本上很少改变，放到缓存中后可以提高访问的性能；</li> <li><strong>Cryptography</strong> <code>org.apache.shiro.crypto.*</code>：密码模块，Shiro 提高了一些常见的加密组件用于如密码加密/解密。</li></ul> <h2 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h2> <h3 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h3> <ol><li><p>Shiro 不依赖容器，直接创建 maven 工程即可</p></li> <li><p>添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.13.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ol> <h3 id="ini-文件"><a href="#ini-文件" class="header-anchor">#</a> INI 文件</h3> <p><font color="red">注：仅案例 demo 用，后期都是使用数据库。</font></p> <p>Shiro 获取权限相关信息可以通过数据库获取，也可以通过 ini 配置文件获取。</p> <p>创建 ini 文件 <code>shiro.ini</code></p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">users</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">zhangsan</span><span class="token punctuation">=</span><span class="token value attr-value">z3</span>
<span class="token key attr-name">lisi</span><span class="token punctuation">=</span><span class="token value attr-value">l4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="登录认证"><a href="#登录认证" class="header-anchor">#</a> 登录认证</h3> <h4 id="登录认证概念"><a href="#登录认证概念" class="header-anchor">#</a> 登录认证概念</h4> <ul><li>身份验证：一般需要提供如身份 ID 等一些标识信息来表明登录者的身份，如提供 email，用户名/密码来证明。</li> <li>在 shiro 中，用户需要提供 principals（身份）和 credentials（证明）给 shiro，从而应用能验证用户身份：</li> <li>principals：身份，即主体的标识属性，可以是任何属性，如用户名、邮箱等，唯一即可。一个主体可以有多个 principals，但只有一个 Primary principals，一般是用户名/邮箱/手机号。</li> <li>credentials：证明/凭证，即只有主体知道的安全值，如密码/数字证书等。</li> <li>最常见的 principals 和 credentials 组合就是用户名/密码。</li></ul> <h4 id="登录认证基本流程"><a href="#登录认证基本流程" class="header-anchor">#</a> 登录认证基本流程</h4> <p><img src="/assets/img/ShiroAuthenticationSequence.1e11842a.webp" alt="ShiroAuthenticationSequence"></p> <ol><li>收集用户身份/凭证，即如用户名/密码；</li> <li>调用 <code>Subject.login()</code> 进行登录，如果失败将得到相应的 <code>AuthenticationException</code> 异常，根据异常提示用户错误信息；否则登录成功；</li> <li>创建自定义的 Realm 类，继承 <code>org.apache.shiro.realm.AuthenticatingRealm</code> 类，实现 <code>doGetAuthenticationInfo()</code> 方法。</li></ol> <h4 id="登录认证实例"><a href="#登录认证实例" class="header-anchor">#</a> 登录认证实例</h4> <p>创建测试类，获取认证对象，进行登录认证，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroRun</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 初始化获取 SecurityManager</span>
        <span class="token class-name">Environment</span> env <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicIniEnvironment</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:shiro.ini&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityManager</span> securityManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SecurityManager</span><span class="token punctuation">)</span> env<span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 获取 Subject 对象</span>
        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 创建 token 对象，web 应用用户名密码从页面传递</span>
        <span class="token class-name">AuthenticationToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;z3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 完成登录</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="身份认证流程"><a href="#身份认证流程" class="header-anchor">#</a> 身份认证流程</h4> <ol><li>首先调用 <code>Subject.login(token)</code> 进行登录，其会自动委托给 <code>SecurityManager</code>；</li> <li><code>SecurityManager</code> 负责真正的身份验证逻辑；它会委托给 <code>Authenticator</code> 进行身份验证；</li> <li><code>Authenticator</code> 才是真正的身份验证者，Shiro API 中核心的身份认证入口点，此处可以自定义插入自己的实现；</li> <li><code>Authenticator</code> 可能会委托给相应的 <code>AuthenticationStrategy</code> 进行多 Realm 身份验证，默认 <code>ModularRealmAuthenticator</code> 会调用 <code>AuthenticationStrategy</code> 进行多 Realm 身份验证；</li> <li><code>Authenticator</code> 会把相应的 token 传入 Realm，从 Realm 获取身份验证信息，如果没有返回/抛出异常表示身份验证失败了。此处可以配置多个 Realm，将按照相应的顺序及策略进行访问。</li></ol> <h3 id="角色、授权"><a href="#角色、授权" class="header-anchor">#</a> 角色、授权</h3> <h4 id="授权概念"><a href="#授权概念" class="header-anchor">#</a> 授权概念</h4> <p><strong>授权</strong>，也叫<strong>访问控制，即在应用中控制谁访问哪些资源</strong>（如访问页面/编辑数据/页面操作等）。在授权中需了解的几个关键对象：主体(Subject)、资源(Resource)、权限 (Permission)、角色(Role)。</p> <ul><li><strong>主体(Subject)</strong>：访问应用的用户，在 Shiro 中使用 <strong>Subject</strong> 代表该用户。用户只有授权后才允许访问相应的资源。</li> <li><strong>资源(Resource)</strong>：<strong>在应用中用户可以访问的 URL</strong>，比如访问 JSP 页面、查看/编辑某些数据、访问某个业务方法、打印文本等等都是资源。用户只要授权后才能访问。</li> <li><strong>权限(Permission)</strong>：安全策略中的原子授权单位，通过权限我们可以表示在应用中用户有没有操作某个资源的权力。<strong>即权限表示在应用中用户能不能访问某个资源</strong>，如：访问用户列表页面查看/新增/修改/删除用户数据（即很多时候都是 CRUD（增查改删）式权限控制）等。权限代表了用户有没有操作某个资源的权利，即反映在某个资源上的操作允不允许。</li> <li>Shiro 支持粗粒度权限（如用户模块的所有权限）和细粒度权限（操作某个用户的权限， 即实例级别的）</li> <li><strong>角色(Role)</strong>：<strong>权限的集合</strong>，一般情况下会赋予用户角色而不是权限，即这样用户可以拥有一组权限，赋予权限时比较方便。典型的如：项目经理、技术总监、CTO、开发工程师等都是角色，不同的角色拥有一组不同的权限。</li></ul> <h4 id="授权方式"><a href="#授权方式" class="header-anchor">#</a> 授权方式</h4> <ol><li><p>编程式：通过 <code>if/else</code> 授权代码块完成</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 有权限</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 无权限</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>注解式：通过在执行的 Java 方法上放置相应的注解完成，没有权限将抛出相应的异常</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequiresRoles</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 有权限</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>JSP/GSP 标签：在 JSP/GSP 页面通过相应的标签完成</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasRole</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 有权限 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasRole</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h4 id="授权流程"><a href="#授权流程" class="header-anchor">#</a> 授权流程</h4> <p><img src="/assets/img/ShiroAuthorizationSequence.e00839db.webp" alt="Shiro authorization sequence graphic"></p> <ol><li>首先调用 <code>Subject.isPermitted/hasRole</code> 接口，其会委托给 <code>SecurityManager</code>，而 <code>SecurityManager</code> 接着会委托给 <code>Authorizer</code>；</li> <li><code>Authorizer</code> 是真正的授权者，如果调用如 <code>isPermitted(&quot;user:view&quot;)</code>，其首先会通过 <code>PermissionResolver</code> 把字符串转换成相应的 <code>Permission</code> 实例；</li> <li>在进行授权之前，其会调用相应的 Realm 获取 Subject 相应的角色/权限用于匹配传入的角色/权限；</li> <li><code>Authorizer</code> 会判断 Realm 的角色/权限是否和传入的匹配，如果有多个 Realm，会委托给 <code>ModularRealmAuthorizer</code> 进行循环判断，如果匹配<code>isPermitted/hasRole</code> 会返回 true，否则返回 false 表示授权失败。</li></ol> <h4 id="授权实例"><a href="#授权实例" class="header-anchor">#</a> 授权实例</h4> <ol><li><p>获取角色信息</p> <ul><li><p>给 <code>shiro.ini</code> 增加角色配置</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">users</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">zhangsan</span><span class="token punctuation">=</span><span class="token value attr-value">z3,role1,role2</span>
<span class="token key attr-name">lisi</span><span class="token punctuation">=</span><span class="token value attr-value">l4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>给例子添加代码，通过 <code>hasRole()</code> 判断用户是否有指定角色</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 5. 判断角色</span>
    <span class="token keyword">boolean</span> hasRole <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;role1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 是否拥有此角色: &quot;</span> <span class="token operator">+</span> hasRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul></li> <li><p>判断权限信息</p> <ul><li><p>给 <code>shiro.ini</code> 增加权限配置</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">roles</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">role1</span><span class="token punctuation">=</span><span class="token value attr-value">user:insert,user:select</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>给例子添加代码，判断用户是否有指定权限</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 6. 判断权限</span>
<span class="token keyword">boolean</span> permitted <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;user:insert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 是否拥有此权限: &quot;</span> <span class="token operator">+</span> permitted<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 也可以用 checkPermission 方法。但没有返回值，没权限抛 UnauthorizedException</span>
subject<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token string">&quot;user:delete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li></ol> <h3 id="shiro-加密"><a href="#shiro-加密" class="header-anchor">#</a> Shiro 加密</h3> <p>实际系统开发中，一些敏感信息需要进行加密，比如说用户的密码。Shiro 内嵌很多常用的加密算法，比如 MD5 加密。Shiro 可以很简单的使用信息加密。</p> <p>shiro 中实现的常见加密算法：</p> <p><img src="/assets/img/image-20240616222048673.8a1ceafe.webp" alt="image-20240616222048673"></p> <p>使用 Shiro 进行密码加密(MD5)：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroMD5</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 密码明文</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;z3&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用 md5 加密</span>
        <span class="token class-name">Md5Hash</span> md5Hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>password <span class="token operator">+</span> <span class="token string">&quot; 使用 md5加密后为 &quot;</span> <span class="token operator">+</span> md5Hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 带盐的 md5 加密，盐就是在密码明文后拼接新字符串，然后再进行加密</span>
        <span class="token class-name">Md5Hash</span> md5Hash2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token string">&quot;salt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>password <span class="token operator">+</span> <span class="token string">&quot; 使用 md5 带盐加密后为 &quot;</span> <span class="token operator">+</span> md5Hash2<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 为了保证安全，避免被破解还可以多次迭代加密，保证数据安全</span>
        <span class="token class-name">Md5Hash</span> md5Hash3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token string">&quot;salt&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>password <span class="token operator">+</span> <span class="token string">&quot; 使用 md5 带盐三次加密后为 &quot;</span> <span class="token operator">+</span> md5Hash3<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用父类实现加密</span>
        <span class="token class-name">SimpleHash</span> simpleHash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleHash</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token string">&quot;salt&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>password <span class="token operator">+</span> <span class="token string">&quot; 使用 父类带盐三次加密后为 &quot;</span> <span class="token operator">+</span> simpleHash<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="shiro-自定义登录认证"><a href="#shiro-自定义登录认证" class="header-anchor">#</a> Shiro 自定义登录认证</h3> <p>Shiro 默认的登录认证是不带加密的，如果想要实现加密认证需要自定义登录认证，自定义 Realm。</p> <ol><li><p>自定义登录认证</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthenticatingRealm</span> <span class="token punctuation">{</span>
    <span class="token comment">// 自定义登录验证方法，shiro 的 login 方法底层会调用该类的认证方法进行认证。</span>
    <span class="token comment">// 需要配置自定义的 realm 生效，在 ini 文件中配置，或在 SpringBoot 中配置</span>
    <span class="token comment">// 该方法只是获取进行对比的信息，认证逻辑还是按照 shiro 底层认证逻辑完成</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 获取身份信息</span>
        <span class="token class-name">String</span> principal <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 获取凭证信息</span>
        <span class="token class-name">String</span> credentials <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;认证用户信息：&quot;</span> <span class="token operator">+</span> principal <span class="token operator">+</span> <span class="token string">&quot;----&quot;</span> <span class="token operator">+</span> credentials<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 获取数据库中存储的用户信息</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>principal<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 3.1 数据库中存储的加盐三次迭代的面密码</span>
            <span class="token class-name">String</span> pwdInfo <span class="token operator">=</span> <span class="token string">&quot;7174f64b13022acd3c56e2781e098a5f&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">// 4. 创建封装校验逻辑的对象，封装数据返回</span>
            <span class="token class-name">AuthenticationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>
                    token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    pwdInfo<span class="token punctuation">,</span> <span class="token class-name">ByteSource<span class="token punctuation">.</span>Util</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token string">&quot;salt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> info<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>在 <code>shiro.ini</code> 中添加配置信息</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">main</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">md5CredentialsMatcher</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.shiro.authc.credential.Md5CredentialsMatcher</span>
<span class="token key attr-name">md5CredentialsMatcher.hashIterations</span><span class="token punctuation">=</span><span class="token value attr-value">3</span>

<span class="token key attr-name">myrealm</span><span class="token punctuation">=</span><span class="token value attr-value">com.atguigu.shirotest.MyRealm</span>
<span class="token key attr-name">myrealm.credentialsMatcher</span><span class="token punctuation">=</span><span class="token value attr-value">$md5CredentialsMatcher</span>
<span class="token key attr-name">securityManager.realms</span><span class="token punctuation">=</span><span class="token value attr-value">$myrealm</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h2 id="与-spring-boot-整合"><a href="#与-spring-boot-整合" class="header-anchor">#</a> 与 Spring Boot 整合</h2> <h3 id="开发环境"><a href="#开发环境" class="header-anchor">#</a> 开发环境</h3> <ul><li>JDK：JDK8+</li> <li>Spring Boot：2.7.6（shiro-spring-boot-web-starter 1.13.0 内部包含 2.7.17）</li></ul> <h3 id="框架整合"><a href="#框架整合" class="header-anchor">#</a> 框架整合</h3> <h4 id="创建模块"><a href="#创建模块" class="header-anchor">#</a> 创建模块</h4> <p>创建模块 shiro_springboot</p> <h4 id="添加依赖"><a href="#添加依赖" class="header-anchor">#</a> 添加依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- shiro --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-web-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.13.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- mybatis-plus --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- mysql --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="添加配置文件"><a href="#添加配置文件" class="header-anchor">#</a> 添加配置文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/shirodb<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
  <span class="token key atrule">jackson</span><span class="token punctuation">:</span>
    <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss
    <span class="token key atrule">time-zone</span><span class="token punctuation">:</span> GMT+8

<span class="token key atrule">shiro</span><span class="token punctuation">:</span>
  <span class="token key atrule">loginUrl</span><span class="token punctuation">:</span> /myController/login
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="添加启动类"><a href="#添加启动类" class="header-anchor">#</a> 添加启动类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.shiro_springboot.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroSpringbootApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ShiroSpringbootApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="登录认证实现"><a href="#登录认证实现" class="header-anchor">#</a> 登录认证实现</h3> <p>访问数据库获取用户信息，实现登录认证</p> <h4 id="后端接口服务实现"><a href="#后端接口服务实现" class="header-anchor">#</a> 后端接口服务实现</h4> <ol><li><p>创建库表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">USE</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">30</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>pwd<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">50</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色编号'</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'用户表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>pwd<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'7174f64b13022acd3c56e2781e098a5f'</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>pwd<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token string">'7174f64b13022acd3c56e2781e098a5f'</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>创建实体</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> rid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>创建 mapper</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>创建 service</p> <ol><li><p>创建接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用户登录</span>
    <span class="token class-name">User</span> <span class="token function">getUserInfoByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>创建实现类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserInfoByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ol></li> <li><p>自定义 realm</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token comment">// 自定义授权方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 自定义登录认证方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 获取用户身份信息</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 调用业务层获取用户信息（数据库）</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserInfoByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 非空判断，将数据封装返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>
                    token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    user<span class="token punctuation">.</span><span class="token function">getPwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">ByteSource<span class="token punctuation">.</span>Util</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token string">&quot;salt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li> <li><p>编写配置类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MyRealm</span> myRealm<span class="token punctuation">;</span>

    <span class="token comment">// 配置 SecurityManager</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">defaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 创建 DefaultWebSecurityManager 对象</span>
        <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 创建加密对象，设置相关属性</span>
        <span class="token class-name">HashedCredentialsMatcher</span> matcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.1 采用 md5 加密</span>
        matcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.2 迭代加密次数</span>
        matcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 将加密对象存储到 myRealm 中</span>
        myRealm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span>matcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 将 myRealm 存储到 DefaultWebSecurityManager 对象</span>
        defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>myRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 返回</span>
        <span class="token keyword">return</span> defaultWebSecurityManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 配置 Shiro 内置过滤器拦截范围</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span> <span class="token function">shiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultShiroFilterChainDefinition</span> definition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// anon 是匿名拦截器，不需要登录就能访问资源</span>
        <span class="token comment">// authc 是登录拦截器，需要登陆才能访问资源</span>
        <span class="token comment">// 设置不认证可以访问的资源</span>
        definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/myController/userLogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/myController/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置需要进行登录认证的拦截范围</span>
        definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> definition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div></li> <li><p>实现 controller</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;myController&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/userLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 获取 subject 对象</span>
        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 封装请求数据到 token</span>
        <span class="token class-name">AuthenticationToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 调用 subject.login(token) 方法进行登录认证</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>测试：http://localhost:8080/myController/userLogin?name=张三&amp;pwd=z3</p></li></ol> <h4 id="前端页面实现"><a href="#前端页面实现" class="header-anchor">#</a> 前端页面实现</h4> <p>Shiro 整合 Thymeleaf</p> <ol><li><p>确认依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>添加 login 页面</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Shiro 登录认证<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myController/userLogin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>添加 main 页面</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Shiro 登录认证后主页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    登录用户为：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${session.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>添加 controller 方法，改造认证方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;myController&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyController</span> <span class="token punctuation">{</span>
    <span class="token comment">//跳转登录页面</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/userLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 获取 subject 对象</span>
        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 封装请求数据到 token</span>
        <span class="token class-name">AuthenticationToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 调用 subject.login(token) 方法进行登录认证</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> subject<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//            return &quot;登录成功&quot;;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li> <li><p>修改配置文件</p> <p><img src="/assets/img/image-20240617234248824.90a36e95.webp" alt="image-20240617234248824"></p></li> <li><p>修改配置类</p> <p><img src="/assets/img/image-20240617234310359.4374deac.webp" alt="image-20240617234310359"></p></li> <li><p>启动，访问测试</p> <p><img src="data:image/webp;base64,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" alt="image-20240617234329390"></p> <p><img src="data:image/webp;base64,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" alt="image-20240617234341805"></p></li></ol> <h3 id="多个-realm-的认证策略设置"><a href="#多个-realm-的认证策略设置" class="header-anchor">#</a> 多个 realm 的认证策略设置</h3> <h4 id="多个-realm-实现原理"><a href="#多个-realm-实现原理" class="header-anchor">#</a> 多个 realm 实现原理</h4> <ul><li><p>当应用程序配置多个 Realm 时，例如：用户名密码校验、手机号验证码校验等等。Shiro 的 <code>ModularRealmAuthenticator</code> 会使用内部的 <code>AuthenticationStrategy</code> 组件判断认证是成功还是失败。</p></li> <li><p><code>AuthenticationStrategy</code> 是一个无状态的组件，它在身份验证尝试中被询问 4 次（这 4 次交互所需的任何必要的状态将被作为方法参数）：</p> <ul><li>在所有 Realm 被调用之前</li> <li>在调用 Realm 的 <code>getAuthenticationInfo</code> 方法之前</li> <li>在调用 Realm 的 <code>getAuthenticationInfo</code> 方法之后</li> <li>在所有 Realm 被调用之后</li></ul></li> <li><p>认证策略的另外一项工作就是聚合所有 Realm 的结果信息封装至一个 <code>AuthenticationInfo</code> 实例中，并将此信息返回，以此作为 Subject 的身份信息。</p></li></ul> <p>Shiro 中定义了 3 种认证策略的实现：</p> <table><thead><tr><th>AuthenticationStrategy class</th> <th>描述</th></tr></thead> <tbody><tr><td><code>AtLeastOneSuccessfulStrategy</code></td> <td>只要有一个（或更多）的 Realm 验证成功，那么认证将视为成功</td></tr> <tr><td><code>FirstSuccessfulStrategy</code></td> <td>第一个 Realm 验证成功，整体认证将视为成功，且后续 Realm 将被忽略</td></tr> <tr><td><code>AllSuccessfulStrategy</code></td> <td>所有 Realm 成功，认证才视为成功</td></tr></tbody></table> <ul><li><code>ModularRealmAuthenticator</code> 内置的认证策略默认实现是 <code>AtLeastOneSuccessfulStrategy</code> 方式。可以通过配置修改策略。</li></ul> <h4 id="多个-realm-代码实现"><a href="#多个-realm-代码实现" class="header-anchor">#</a> 多个 realm 代码实现</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//配置SecurityManager</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">defaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 创建 DefaultWebSecurityManager 对象</span>
    <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManag</span>
    <span class="token comment">// 2. 创建认证对象，并设置认证策略</span>
    <span class="token class-name">ModularRealmAuthenticator</span> modularRealmAuthenticator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModularRealmAuthenticat</span>
    modularRealmAuthenticator<span class="token punctuation">.</span><span class="token function">setAuthenticationStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AllSuccessfulStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setAuthenticator</span><span class="token punctuation">(</span>modularRealmAuthenticator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 封装 myRealm 集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Realm</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>myRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>myRealm2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4. 将 myRealm 存储到 DefaultWebSecurityManager 对象</span>
    defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRealms</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 5. 返回</span>
    <span class="token keyword">return</span> defaultWebSecurityManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="remember-me-功能"><a href="#remember-me-功能" class="header-anchor">#</a> remember me 功能</h3> <p>Shiro 提供了记住我(RememberMe)的功能，比如访问一些网站时，关闭了浏览器，下次再打开时还是能记住你是谁， 下次访问时无需再登录即可访问。</p> <h4 id="基本流程"><a href="#基本流程" class="header-anchor">#</a> 基本流程</h4> <ol><li>首先在登录页面选中 RememberMe 然后登录成功；如果是浏览器登录，一般会把 RememberMe 的 Cookie 写到客户端并保存下来；</li> <li>关闭浏览器再重新打开；会发现浏览器还是记住你的；</li> <li>访问一般的网页服务器端，仍然知道你是谁，且能正常访问；</li> <li>但是，如果我们访问电商平台时，如果要查看我的订单或进行支付时，此时还是需要再进行身份认证的，以确保当前用户还是你。</li></ol> <h4 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h4> <ol><li><p>修改配置类，设置 rememberMe，cookie 属性设置，创建 Shiro 的 cookie 管理对象，添加存在用户的过滤器(rememberMe)</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MyRealm</span> myRealm<span class="token punctuation">;</span>

    <span class="token comment">// 配置 SecurityManager</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">defaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 创建 DefaultWebSecurityManager 对象</span>
        <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 创建加密对象，设置相关属性</span>
        <span class="token class-name">HashedCredentialsMatcher</span> matcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.1 采用 md5 加密</span>
        matcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.2 迭代加密次数</span>
        matcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 将加密对象存储到 myRealm 中</span>
        myRealm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span>matcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 将 myRealm 存储到 DefaultWebSecurityManager 对象</span>
        defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>myRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.5 设置 rememberMe</span>
        defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRememberMeManager</span><span class="token punctuation">(</span><span class="token function">rememberMeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 返回</span>
        <span class="token keyword">return</span> defaultWebSecurityManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// cookie 属性设置</span>
    <span class="token keyword">public</span> <span class="token class-name">SimpleCookie</span> <span class="token function">rememberMeCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SimpleCookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleCookie</span><span class="token punctuation">(</span><span class="token string">&quot;rememberMe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置跨域</span>
        <span class="token comment">// cookie.setDomain(domain);</span>
        cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cookie<span class="token punctuation">.</span><span class="token function">setHttpOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cookie<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建 Shiro 的 cookie 管理对象</span>
    <span class="token keyword">public</span> <span class="token class-name">CookieRememberMeManager</span> <span class="token function">rememberMeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CookieRememberMeManager</span> cookieRememberMeManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CookieRememberMeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cookieRememberMeManager<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token function">rememberMeCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cookieRememberMeManager<span class="token punctuation">.</span><span class="token function">setCipherKey</span><span class="token punctuation">(</span><span class="token string">&quot;1234567890987654&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cookieRememberMeManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 配置 Shiro 内置过滤器拦截范围</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span> <span class="token function">shiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultShiroFilterChainDefinition</span> definition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// anon 是匿名拦截器，不需要登录就能访问资源</span>
        <span class="token comment">// authc 是登录拦截器，需要登陆才能访问资源</span>
        <span class="token comment">// 设置不认证可以访问的资源</span>
        definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/myController/userLogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/myController/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置需要进行登录认证的拦截范围</span>
        definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加存在用户的过滤器（rememberMe）</span>
        definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> definition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div></li> <li><p>修改 controller，添加 rememberMe 参数</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;myController&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyController</span> <span class="token punctuation">{</span>
    <span class="token comment">//跳转登录页面</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/userLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>defaultValue <span class="token operator">=</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span> <span class="token keyword">boolean</span> rememberMe<span class="token punctuation">,</span>
                            <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 获取 subject 对象</span>
        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 封装请求数据到 token</span>
        <span class="token class-name">AuthenticationToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> pwd<span class="token punctuation">,</span> rememberMe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 调用 subject.login(token) 方法进行登录认证</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> subject<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 登录认证验证rememberMe</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;userLoginRm&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rememberMe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div></li> <li><p>改造页面 login.html，添加选项框</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Shiro 登录认证<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myController/userLogin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>记住用户：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rememberMe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol> <h4 id="实验"><a href="#实验" class="header-anchor">#</a> 实验</h4> <ul><li>通过地址访问 userLoginRm：http://localhost:8080/myController/userLoginRm，过滤器拦截跳回登录页面</li> <li>登录不记住用户，关闭浏览器再进入无法访问 userLoginRm</li> <li>登录记住用户，关闭浏览器再进入可以访问 userLoginRm</li></ul> <h3 id="用户登录认证后登出"><a href="#用户登录认证后登出" class="header-anchor">#</a> 用户登录认证后登出</h3> <p>用户登录后，配套的有登出操作。直接通过 Shiro 过滤器即可实现登出</p> <h4 id="代码实现-2"><a href="#代码实现-2" class="header-anchor">#</a> 代码实现</h4> <ol><li><p>修改登录后的 main.html，添加登出链接</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Shiro 登录认证后主页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    登录用户为：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${session.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/logout<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>登出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>修改配置类，添加 logout 过滤器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 配置 Shiro 内置过滤器拦截范围</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span> <span class="token function">shiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DefaultShiroFilterChainDefinition</span> definition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// anon 是匿名拦截器，不需要登录就能访问资源</span>
    <span class="token comment">// authc 是登录拦截器，需要登陆才能访问资源</span>
    <span class="token comment">// 设置不认证可以访问的资源</span>
    definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/myController/userLogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/myController/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置登出过滤器</span>
    definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置需要进行登录认证的拦截范围</span>
    definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加存在用户的过滤器（rememberMe）</span>
    definition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> definition<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol> <h4 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h4> <ol><li>通过登录验证</li> <li>点击“登出”登出系统，登出后无法再访问 userLoginRm</li></ol> <h3 id="授权、角色认证"><a href="#授权、角色认证" class="header-anchor">#</a> 授权、角色认证</h3> <h4 id="授权"><a href="#授权" class="header-anchor">#</a> 授权</h4> <ul><li><p>用户登录后，需要验证是否具有指定角色指定权限。Shiro 也提供了方便的工具进行判断。</p></li> <li><p>这个工具就是 Realm 的 doGetAuthorizationInfo 方法进行判断。触发权限判断的有两种方式：</p> <ol><li>在页面中通过 <code>shiro:**属性</code> 判断</li> <li>在接口服务中通过注解 <code>@Requires**</code> 进行判断</li></ol></li></ul> <h4 id="后端接口服务注解"><a href="#后端接口服务注解" class="header-anchor">#</a> 后端接口服务注解</h4> <p>通过给接口服务方法添加注解可以实现权限校验，可以加在控制器方法上，也可以加在业务方法上，一般加在控制器方法上。常用注解如下：</p> <ul><li><p><code>@RequiresAuthentication</code>：验证用户是否登录，等同于方法 <code>subject.isAuthenticated()</code></p></li> <li><p><code>@RequiresUser</code>：验证用户是否被记忆：</p> <ul><li>登录认证成功 <code>subject.isAuthenticated()</code> 为 <code>true</code></li> <li>登录后被记忆 <code>subject.isRemembered()</code> 为 <code>true</code></li></ul></li> <li><p><code>@RequiresGuest</code>：验证是否是一个 guest 的请求，是否是游客的请求，此时 <code>subject.getPrincipal()</code> 为 <code>null</code></p></li> <li><p><code>@RequiresRoles</code>：验证 subject 是否有相应角色，有角色访问方法，没有则会抛出异常 <code>AuthorizationException</code>。</p> <ul><li><p>例如：只有 subject 有 <code>aRoleName</code> 角色才能访问方法 <code>someMethod()</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequiresRoles</span><span class="token punctuation">(</span><span class="token string">&quot;aRoleName&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li> <li><p><code>@RequiresPermissions</code>：验证 subject 是否有相应权限，有权限访问方法，没有则会抛出异常 <code>AuthorizationException</code>。</p> <ul><li><p>例如：subject 必须同时含有 <code>file:read</code> 和 <code>wite:aFile.txt</code> 权限才能访问方法 <code>someMethod()</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span><span class="token string">&quot;file:read&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wite:aFile.txt&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li></ul> <h4 id="授权验证-没有角色无法访问"><a href="#授权验证-没有角色无法访问" class="header-anchor">#</a> 授权验证-没有角色无法访问</h4> <ol><li><p>添加 controller 方法，并添加验证角色注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 登录认证验证角色</span>
<span class="token annotation punctuation">@RequiresRoles</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;userLoginRoles&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLoginRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录认证验证角色&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;验证角色成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>修改 main.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Shiro 登录认证后主页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    登录用户为：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${session.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/logout<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>登出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myController/userLoginRoles<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试授权-角色验证<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>修改 MyRealm 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 自定义授权方法：获取当前登录用户的角色、权限信息，返回给 shiro 用来进行授权认证</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义授权方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>运行测试</p> <p><img src="/assets/img/image-20240618234221639.75db6a27.webp" alt="image-20240618234221639"></p></li></ol> <h4 id="授权验证-获取角色进行验证"><a href="#授权验证-获取角色进行验证" class="header-anchor">#</a> 授权验证-获取角色进行验证</h4> <ol><li><p>修改 MyRealm 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 自定义授权方法：获取当前登录用户的角色、权限信息，返回给 shiro 用来进行授权认证</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义授权方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1. 创建对象，封装当前登录用户的角色、权限信息</span>
    <span class="token class-name">SimpleAuthorizationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 存储角色</span>
    info<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 返回信息</span>
    <span class="token keyword">return</span> info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>运行测试：验证角色成功</p></li> <li><p>确认库表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">30</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色名'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">50</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'描述'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>realname<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色显示名'</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'角色表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>realname<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;所有权限&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;管理员&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role<span class="token punctuation">`</span></span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>realname<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">&quot;userMag&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户管理权限&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户管理&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>role_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户 id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色 id'</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'角色用户映射表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role_user<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role_user<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role_user<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>查询 sql，根据用户名查询对应角色信息</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> NAME <span class="token keyword">FROM</span> role <span class="token keyword">WHERE</span> id <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> rid <span class="token keyword">FROM</span> role_user <span class="token keyword">WHERE</span> uid <span class="token operator">=</span><span class="token punctuation">(</span> <span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> <span class="token string">'张三'</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>mapper 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT NAME FROM role WHERE id IN ( SELECT rid FROM role_user WHERE uid =( SELECT id FROM user WHERE NAME = #{principal} ));&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserRoleInfoMapper</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;principal&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>service 实现</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用户登录</span>
    <span class="token class-name">User</span> <span class="token function">getUserInfoByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 根据用户查询角色信息</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserRoleInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">// 根据用户查询角色信息</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserRoleInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> principal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserRoleInfoMapper</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>MyRealm 方法改造</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 自定义授权方法：获取当前登录用户的角色、权限信息，返回给 shiro 用来进行授权认证</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义授权方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1. 获取用户身份信息</span>
    <span class="token class-name">String</span> principal <span class="token operator">=</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 调用业务层获取用户角色信息（数据库）</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserRoleInfo</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前用户角色信息 = &quot;</span> <span class="token operator">+</span> roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 创建对象，封装当前登录用户的角色、权限信息</span>
    <span class="token class-name">SimpleAuthorizationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span><span class="token function">addRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 返回信息</span>
    <span class="token keyword">return</span> info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>启动登录测试：验证角色成功，当前用户角色信息 = [admin, userMag]</p></li></ol> <h4 id="授权验证-获取权限进行验证"><a href="#授权验证-获取权限进行验证" class="header-anchor">#</a> 授权验证-获取权限进行验证</h4> <p>获取权限验证和获取角色相类似</p> <ol><li><p>确认库表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>permissions<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">30</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限名'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>info<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">30</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限信息'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">50</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'描述'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'权限表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>permissions<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>info<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&quot;删除用户&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user:delete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;删除用户&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>permissions<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>info<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&quot;新增用户&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user:add&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;新增用户&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>permissions<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>info<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&quot;修改用户&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user:edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;修改用户&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>role_ps<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色 id'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限 id'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'角色权限映射表'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role_ps<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role_ps<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>shirodb<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>role_ps<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>rid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>查询 sql，根据角色名查询对应权限信息</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> info <span class="token keyword">FROM</span> permissions <span class="token keyword">WHERE</span> id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> pid <span class="token keyword">FROM</span> role_ps <span class="token keyword">WHERE</span> rid <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> role <span class="token keyword">WHERE</span> name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'userMag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>mapper 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;&lt;script&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;select info FROM permissions WHERE id IN &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;(SELECT pid FROM role_ps WHERE rid IN (&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;SELECT id FROM role WHERE NAME IN &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&lt;foreach collection='roles' item='name' open='(' separator=',' close= ')' &gt; &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;#{name}&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&lt;/foreach&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;))&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&lt;/script&gt;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserPermissionInfoMapper</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;roles&quot;</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>service 实现</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 获取用户角色权限信息</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserPermissionInfo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 获取用户角色权限信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserPermissionInfo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserPermissionInfoMapper</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>MyRealm 方法改造</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 自定义授权方法：获取当前登录用户的角色、权限信息，返回给 shiro 用来进行授权认证</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义授权方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1. 获取用户身份信息</span>
    <span class="token class-name">String</span> principal <span class="token operator">=</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 调用业务层获取用户角色信息（数据库）</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserRoleInfo</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前用户角色信息 = &quot;</span> <span class="token operator">+</span> roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.5 调用业务层获取用户权限信息（数据库）</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserPermissionInfo</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前用户权限信息 = &quot;</span> <span class="token operator">+</span> permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 创建对象，封装当前登录用户的角色、权限信息</span>
    <span class="token class-name">SimpleAuthorizationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span><span class="token function">addRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span><span class="token function">addStringPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 返回信息</span>
    <span class="token keyword">return</span> info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p>添加 controller 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 登录认证验证权限</span>
<span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span><span class="token string">&quot;user:delete&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;userLoginPermissions&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLoginPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录认证验证权限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;验证权限成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>改造 main.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Shiro 登录认证后主页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    登录用户为：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${session.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/logout<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>登出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myController/userLoginRoles<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试授权-角色验证<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myController/userLoginPermissions<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试授权-权限验证<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>启动登录测试：验证权限成功，当前用户权限信息 = [user:delete, user:add, user:edit]</p></li></ol> <h4 id="授权验证-异常处理"><a href="#授权验证-异常处理" class="header-anchor">#</a> 授权验证-异常处理</h4> <ol><li><p>创建认证异常处理类，使用 <code>@ControllerAdvice</code> 加 <code>@ExceptionHandler</code> 实现特殊异常处理。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionsException</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">UnauthorizedException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">unauthorizedExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;无权限&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">authorizationExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;权限认证失败&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>启动运行，用李四登录测试。</p></li></ol> <h4 id="前端页面授权验证"><a href="#前端页面授权验证" class="header-anchor">#</a> 前端页面授权验证</h4> <ol><li><p>添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--配置 Thymeleaf 与 Shrio 的整合依赖--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.theborakompanioni<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-extras-shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>配置类添加新配置，用于解析 thymeleaf 中的 <code>shiro:相关属性</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ShiroDialect</span> <span class="token function">shiroDialect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ShiroDialect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Thymeleaf 中常用的 <code>shiro:属性</code></p> <ul><li><p><strong>guest 标签</strong>：用户没有身份验证时显示相应信息，即游客访问信息。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>guest</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>guest</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>user 标签</strong>：用户已经身份验证/记住我登录后显示相应的信息。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>user</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>authenticated 标签</strong>：用户已经身份验证通过，即 <code>Subject.login</code> 登录成功，不是记住我登录的。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>authenticated</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>authenticated</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>notAuthenticated 标签</strong>：用户已经身份验证通过，即没有调用 <code>Subject.login</code> 进行登录，包括记住我自动登录的也属于未进行身份验证。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>notAuthenticated</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>notAuthenticated</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>principal 标签</strong>：相当于 <code>((User)Subject.getPrincipals()).getUsername()</code>。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span></span> <span class="token attr-name">principal</span><span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>principal</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>lacksPermission 标签</strong>：如果当前 Subject 没有权限将显示 body 体内容。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>lacksPermission</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org:create<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>lacksPermission</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>hasRole 标签</strong>：如果当前 Subject 有角色将显示 body 体内容。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasRole</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasRole</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>hasAnyRoles 标签</strong>：如果当前 Subject 有任意一个角色（或的关系）将显示 body 体内容。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasAnyRoles</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin,user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasAnyRoles</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>lacksRole 标签</strong>：如果当前 Subject 没有角色将显示 body 体内容。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>lacksRole</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>lacksRole</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>hasPermission 标签</strong>：如果当前 Subject 有权限将显示 body 体内容</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasPermission</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user:create<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasPermission</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>改造 main.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>shiro</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Shiro 登录认证后主页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    登录用户为：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${session.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/logout<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>登出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">shiro:</span>hasRole</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myController/userLoginRoles<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试授权-角色验证<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">shiro:</span>hasPermission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user:delete<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myController/userLoginPermissions<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试授权-权限验证<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>测试</p> <p><img src="data:image/webp;base64,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" alt="image-20240619231406513"></p> <p><img src="/assets/img/image-20240619231418274.7cc52c27.webp" alt="image-20240619231418274"></p></li></ol> <h3 id="实现缓存"><a href="#实现缓存" class="header-anchor">#</a> 实现缓存</h3> <h4 id="缓存工具-ehcache"><a href="#缓存工具-ehcache" class="header-anchor">#</a> 缓存工具 EhCache</h4> <ul><li>EhCache 是一种广泛使用的开源 Java 分布式缓存。主要面向通用缓存，Java EE 和轻量级容器。可以和大部分 Java 项目无缝整合，例如：Hibernate 中的缓存就是基于 EhCache 实现的。</li> <li>EhCache 支持内存和磁盘存储，默认存储在内存中，如内存不够时把缓存数据同步到磁盘中。EhCache 支持基于 Filter 的 Cache 实现，也支持 Gzip 压缩算法。</li> <li>EhCache 直接在 JVM 虚拟机中缓存，速度快，效率高；</li> <li>EhCache 缺点是缓存共享麻烦，集群分布式应用使用不方便。</li></ul> <h4 id="ehcache-搭建使用"><a href="#ehcache-搭建使用" class="header-anchor">#</a> EhCache 搭建使用</h4> <ol><li><p>创建模块，添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ehcache_test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.sf.ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p>添加配置文件 <code>ehcache.xml</code></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 磁盘的缓存位置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.io.tmpdir/ehcache<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 默认缓存 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span> <span class="token attr-name">maxEntriesLocalHeap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">maxEntriesLocalDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">diskExpiryThreadIntervalSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span> <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LRU<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence</span> <span class="token attr-name">strategy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localTempSwap<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultCache</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- helloworld 缓存--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HelloWorldCache<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LRU<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--
        defaultCache：默认缓存策略，当 ehcache 找不到定义的缓存时，则使用这个缓存策略。只能定义一个。
    --&gt;</span>
    <span class="token comment">&lt;!--
    name:缓存名称。
    maxElementsInMemory:缓存最大数目
    maxElementsOnDisk：硬盘最大缓存个数。
    eternal:对象是否永久有效，一但设置了，timeout 将不起作用。
    overflowToDisk:是否保存到磁盘，当系统宕机时
    timeToIdleSeconds:设置对象在失效前的允许闲置时间（单位：秒）。仅当eternal=false 对象不是永久有效时使用，可选属性，默认值是0，也就是可闲置时间无穷大。
    timeToLiveSeconds:设置对象在失效前允许存活时间（单位：秒）。最大时间介于创建时间和失效时间之间。
                      仅当eternal=false 对象不是永久有效时使用，默认是0，也就是对象存活时间无穷大。
    diskPersistent：是否缓存虚拟机重启期数据 Whether the disk store persists between restarts of the Virtual Machine. The default value is false.
    diskSpoolBufferSizeMB：这个参数设置 DiskStore（磁盘缓存）的缓存区大小。默认是30MB。每个 Cache 都应该有自己的一个缓冲区。
    diskExpiryThreadIntervalSeconds：磁盘失效线程运行时间间隔，默认是 120 秒。
    memoryStoreEvictionPolicy：当达到 maxElementsInMemory 限制时，Ehcache 将会根据指定的策略去清理内存。
    默认策略是LRU（最近最少使用）。你可以设置为 FIFO（先进先出）或是 LFU（较少使用）。
    clearOnFlush：内存数量最大时是否清除。
    memoryStoreEvictionPolicy:可选策略有：LRU（最近最少使用，默认策略）、FIFO（先进先出）、LFU（最少访问次数）。
    FIFO，first in first out，这个是大家最熟的，先进先出。
    LFU， Less Frequently Used，就是上面例子中使用的策略，直白一点就是讲一直以来最少被使用的。如上面所讲，缓存的元素有一个hit 属性，hit 值最小的将会被清出缓存。
    LRU，Least Recently Used，最近最少使用的，缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存。
    --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></li> <li><p>创建测试类，操作缓存</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestEH</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 获取编译目录下的资源的流对象</span>
        <span class="token class-name">InputStream</span> input <span class="token operator">=</span> <span class="token class-name">TestEH</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;ehcache.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 获取 EhCache 的缓存管理对象</span>
        <span class="token class-name">CacheManager</span> cacheManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheManager</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 获取缓存对象</span>
        <span class="token class-name">Cache</span> cache <span class="token operator">=</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">&quot;HelloWorldCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 创建缓存数据</span>
        <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhang3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 存入缓存</span>
        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6. 从缓存中取出数据输出</span>
        <span class="token class-name">Element</span> element1 <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;缓存中数据 = &quot;</span> <span class="token operator">+</span> element1<span class="token punctuation">.</span><span class="token function">getObjectValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol> <h4 id="shiro-整合-ehcache"><a href="#shiro-整合-ehcache" class="header-anchor">#</a> Shiro 整合 EhCache</h4> <p>Shiro 官方提供了 <code>shiro-ehcache</code>，实现了整合 EhCache 作为 Shiro 的缓存工具。可以缓存认证执行的 Realm 方法，减少对数据库的访问，提高认证效率。</p> <ol><li><p>添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>在 <code>resources</code> 下添加配置文件 <code>ehcache/ehcache-shiro.xml</code></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ehcache<span class="token punctuation">&quot;</span></span> <span class="token attr-name">updateCheck</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 磁盘的缓存位置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.io.tmpdir<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--默认缓存--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span> <span class="token attr-name">maxEntriesLocalHeap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3600<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3600<span class="token punctuation">&quot;</span></span>
                  <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultCache</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 登录认证信息缓存：缓存用户角色权限 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loginRolePsCache<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxEntriesLocalHeap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>600<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">statistics</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>修改配置类 ShiroConfig</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 配置 SecurityManager</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">defaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 创建 DefaultWebSecurityManager 对象</span>
    <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 创建加密对象，设置相关属性</span>
    <span class="token class-name">HashedCredentialsMatcher</span> matcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.1 采用 md5 加密</span>
    matcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.2 迭代加密次数</span>
    matcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 将加密对象存储到 myRealm 中</span>
    myRealm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span>matcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 将 myRealm 存储到 DefaultWebSecurityManager 对象</span>
    defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>myRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4.5 设置 rememberMe</span>
    defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRememberMeManager</span><span class="token punctuation">(</span><span class="token function">rememberMeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4.6 设置缓存管理器</span>
    defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setCacheManager</span><span class="token punctuation">(</span><span class="token function">getEhCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 5. 返回</span>
    <span class="token keyword">return</span> defaultWebSecurityManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 缓存管理器</span>
<span class="token keyword">private</span> <span class="token class-name">EhCacheManager</span> <span class="token function">getEhCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">EhCacheManager</span> ehCacheManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EhCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ehCacheManager<span class="token punctuation">.</span><span class="token function">setCacheManagerConfigFile</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:ehcache/ehcache-shiro.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ehCacheManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li> <li><p>启动测试</p></li></ol> <h3 id="会话管理"><a href="#会话管理" class="header-anchor">#</a> 会话管理</h3> <h4 id="sessionmanager"><a href="#sessionmanager" class="header-anchor">#</a> SessionManager</h4> <ul><li>会话管理器，负责创建和管理用户的会话(Session)生命周期，它能够在任何环境中在本地管理用户会话，即使没有 Web/Servlet/EJB 容器，也一样可以保存会话。</li> <li>默认情况下，Shiro 会检测当前环境中现有的会话机制（比如 Servlet 容器）进行适配，如果没有（比如独立应用程序或者非 Web 环境），它将会使用内置的企业会话管理器来提供相应的会话管理服务，其中还涉及一个名为 SessionDAO 的对象。</li> <li>SessionDAO 负责 Session 的持久化操作(CRUD)，允许 Session 数据写入到后端持久化数据库。</li></ul> <h4 id="会话管理实现"><a href="#会话管理实现" class="header-anchor">#</a> 会话管理实现</h4> <p><img src="/assets/img/image-20240620000832311.7e3d6e42.webp" alt="image-20240620000832311"></p> <p>SessionManager 由 SecurityManager 管理。Shiro 提供了三种实现</p> <ul><li><code>DefaultSessionManager</code>：用于 JavaSE 环境</li> <li><code>ServletContainerSessionManager</code>：用于 web 环境，直接使用 Servlet 容器的会话</li> <li><code>DefaultWebSessionManager</code>：用于 web 环境，自己维护会话（不使用 Servlet 容器的会话管理）</li></ul> <h4 id="获得-session-方式"><a href="#获得-session-方式" class="header-anchor">#</a> 获得 session 方式</h4> <ol><li><p>实现</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>“key”<span class="token punctuation">,</span>”value”<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>说明</p> <ul><li>Controller 中的 request，在 shiro 过滤器中的 <code>doFilerInternal</code> 方法，被包装成 <code>ShiroHttpServletRequest</code>。</li> <li><code>SecurityManager</code> 和 <code>SessionManager</code> 会话管理器决定 session 来源于 ServletRequest 还是由 Shiro 管理的会话。</li> <li>无论是通过 <code>request.getSession</code> 或 <code>subject.getSession</code> 获取到 session，操作 session，两者都是等价的。</li></ul></li></ol></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/05/11, 20:50:35</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/micro-service-ecology/SpringSecurity/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">安全框架之 Spring Security</div></a> <a href="/micro-service-ecology/Quartz/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">定时任务框架之 Quartz</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/micro-service-ecology/SpringSecurity/" class="prev">安全框架之 Spring Security</a></span> <span class="next"><a href="/micro-service-ecology/Quartz/">定时任务框架之 Quartz</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/java-web/chapter-9/"><div>
            第九章 前端工程化-下
            <!----></div></a> <span class="date">12-11</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/java-web/chapter-8/"><div>
            第八章 前端工程化-中
            <!----></div></a> <span class="date">12-11</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/java-web/chapter-7/"><div>
            第七章 前端工程化-上
            <!----></div></a> <span class="date">12-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2026
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1f9bc03c.js" defer></script><script src="/assets/js/3.be9e7e99.js" defer></script><script src="/assets/js/2.c36d0987.js" defer></script><script src="/assets/js/48.e1366a45.js" defer></script>
  </body>
</html>
