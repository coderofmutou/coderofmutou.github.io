<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>定时任务框架之 Quartz | Bombax&#39;s Knowledge Document Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术知识学习笔记">
    <meta name="keywords" content="技术知识学习笔记">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a5ee4d2c.css" as="style"><link rel="preload" href="/assets/js/app.ca5c989c.js" as="script"><link rel="preload" href="/assets/js/3.f2884e99.js" as="script"><link rel="preload" href="/assets/js/2.81e8b964.js" as="script"><link rel="preload" href="/assets/js/51.6728bddb.js" as="script"><link rel="prefetch" href="/assets/js/1.f754fd0b.js"><link rel="prefetch" href="/assets/js/10.bde6e567.js"><link rel="prefetch" href="/assets/js/100.000718ad.js"><link rel="prefetch" href="/assets/js/101.863f022a.js"><link rel="prefetch" href="/assets/js/102.7b45f43b.js"><link rel="prefetch" href="/assets/js/103.ba5681a8.js"><link rel="prefetch" href="/assets/js/104.e35b7e87.js"><link rel="prefetch" href="/assets/js/105.15a150cd.js"><link rel="prefetch" href="/assets/js/106.aea81b3b.js"><link rel="prefetch" href="/assets/js/107.4f4dec09.js"><link rel="prefetch" href="/assets/js/108.0079fda6.js"><link rel="prefetch" href="/assets/js/109.7a5059de.js"><link rel="prefetch" href="/assets/js/11.fa1b0bc7.js"><link rel="prefetch" href="/assets/js/110.85007649.js"><link rel="prefetch" href="/assets/js/111.dbec93e3.js"><link rel="prefetch" href="/assets/js/112.f17a38c0.js"><link rel="prefetch" href="/assets/js/113.6478506e.js"><link rel="prefetch" href="/assets/js/114.6031c0db.js"><link rel="prefetch" href="/assets/js/115.d7094af2.js"><link rel="prefetch" href="/assets/js/116.316a6234.js"><link rel="prefetch" href="/assets/js/117.1336f5e0.js"><link rel="prefetch" href="/assets/js/118.4b882789.js"><link rel="prefetch" href="/assets/js/119.503f83be.js"><link rel="prefetch" href="/assets/js/12.04b9b957.js"><link rel="prefetch" href="/assets/js/120.af7d94d8.js"><link rel="prefetch" href="/assets/js/121.5cd3597d.js"><link rel="prefetch" href="/assets/js/122.82f45642.js"><link rel="prefetch" href="/assets/js/123.f2ba0b19.js"><link rel="prefetch" href="/assets/js/13.680e50fd.js"><link rel="prefetch" href="/assets/js/14.dfca4100.js"><link rel="prefetch" href="/assets/js/15.01784967.js"><link rel="prefetch" href="/assets/js/16.81c1d5ab.js"><link rel="prefetch" href="/assets/js/17.9a472859.js"><link rel="prefetch" href="/assets/js/18.5366cb68.js"><link rel="prefetch" href="/assets/js/19.b1b74ef9.js"><link rel="prefetch" href="/assets/js/20.e938fa21.js"><link rel="prefetch" href="/assets/js/21.3e38db33.js"><link rel="prefetch" href="/assets/js/22.f9d18654.js"><link rel="prefetch" href="/assets/js/23.8eea4b67.js"><link rel="prefetch" href="/assets/js/24.6fe732dc.js"><link rel="prefetch" href="/assets/js/25.b1885cb6.js"><link rel="prefetch" href="/assets/js/26.936ee89a.js"><link rel="prefetch" href="/assets/js/27.fb3beb63.js"><link rel="prefetch" href="/assets/js/28.af721a74.js"><link rel="prefetch" href="/assets/js/29.427b7eae.js"><link rel="prefetch" href="/assets/js/30.2af5e34e.js"><link rel="prefetch" href="/assets/js/31.60102330.js"><link rel="prefetch" href="/assets/js/32.746872da.js"><link rel="prefetch" href="/assets/js/33.9466d03b.js"><link rel="prefetch" href="/assets/js/34.c7f7b0ef.js"><link rel="prefetch" href="/assets/js/35.53799eb8.js"><link rel="prefetch" href="/assets/js/36.e8875fc1.js"><link rel="prefetch" href="/assets/js/37.c386b2c5.js"><link rel="prefetch" href="/assets/js/38.ee46082f.js"><link rel="prefetch" href="/assets/js/39.11d092ff.js"><link rel="prefetch" href="/assets/js/4.920d0610.js"><link rel="prefetch" href="/assets/js/40.4ee40bcf.js"><link rel="prefetch" href="/assets/js/41.81c3174c.js"><link rel="prefetch" href="/assets/js/42.18f42b9d.js"><link rel="prefetch" href="/assets/js/43.7426d1ac.js"><link rel="prefetch" href="/assets/js/44.d5baff75.js"><link rel="prefetch" href="/assets/js/45.7b25c5ca.js"><link rel="prefetch" href="/assets/js/46.dff72ed3.js"><link rel="prefetch" href="/assets/js/47.15531a4f.js"><link rel="prefetch" href="/assets/js/48.48bbc098.js"><link rel="prefetch" href="/assets/js/49.49acd468.js"><link rel="prefetch" href="/assets/js/5.847584a2.js"><link rel="prefetch" href="/assets/js/50.e26ee1bf.js"><link rel="prefetch" href="/assets/js/52.c238e7bf.js"><link rel="prefetch" href="/assets/js/53.025903f6.js"><link rel="prefetch" href="/assets/js/54.05baf03a.js"><link rel="prefetch" href="/assets/js/55.b6fc3e0a.js"><link rel="prefetch" href="/assets/js/56.8e5ef1fc.js"><link rel="prefetch" href="/assets/js/57.db41b6fb.js"><link rel="prefetch" href="/assets/js/58.b4cb51f8.js"><link rel="prefetch" href="/assets/js/59.423b27e1.js"><link rel="prefetch" href="/assets/js/6.b384c550.js"><link rel="prefetch" href="/assets/js/60.57eff889.js"><link rel="prefetch" href="/assets/js/61.387a5103.js"><link rel="prefetch" href="/assets/js/62.23ba2982.js"><link rel="prefetch" href="/assets/js/63.2d69780b.js"><link rel="prefetch" href="/assets/js/64.d3f669fb.js"><link rel="prefetch" href="/assets/js/65.f5410640.js"><link rel="prefetch" href="/assets/js/66.59887fb2.js"><link rel="prefetch" href="/assets/js/67.01fba30e.js"><link rel="prefetch" href="/assets/js/68.8a6bbb81.js"><link rel="prefetch" href="/assets/js/69.12e673c4.js"><link rel="prefetch" href="/assets/js/70.a227d4b3.js"><link rel="prefetch" href="/assets/js/71.bd6a3bd7.js"><link rel="prefetch" href="/assets/js/72.4f2efca4.js"><link rel="prefetch" href="/assets/js/73.7dbf57a8.js"><link rel="prefetch" href="/assets/js/74.28c26d0a.js"><link rel="prefetch" href="/assets/js/75.d36a4feb.js"><link rel="prefetch" href="/assets/js/76.9123efc1.js"><link rel="prefetch" href="/assets/js/77.cbe2020d.js"><link rel="prefetch" href="/assets/js/78.7ab3eb40.js"><link rel="prefetch" href="/assets/js/79.bc69c4a8.js"><link rel="prefetch" href="/assets/js/80.da17de0b.js"><link rel="prefetch" href="/assets/js/81.1d16813f.js"><link rel="prefetch" href="/assets/js/82.586f2e97.js"><link rel="prefetch" href="/assets/js/83.129cc5fa.js"><link rel="prefetch" href="/assets/js/84.83d65ed9.js"><link rel="prefetch" href="/assets/js/85.f4327096.js"><link rel="prefetch" href="/assets/js/86.866a7d4f.js"><link rel="prefetch" href="/assets/js/87.f8aba274.js"><link rel="prefetch" href="/assets/js/88.43c5a138.js"><link rel="prefetch" href="/assets/js/89.b47b6d86.js"><link rel="prefetch" href="/assets/js/9.ef15744b.js"><link rel="prefetch" href="/assets/js/90.4950712a.js"><link rel="prefetch" href="/assets/js/91.80bbaffe.js"><link rel="prefetch" href="/assets/js/92.0d03ce50.js"><link rel="prefetch" href="/assets/js/93.fff94cff.js"><link rel="prefetch" href="/assets/js/94.91d0e36d.js"><link rel="prefetch" href="/assets/js/95.15227fb3.js"><link rel="prefetch" href="/assets/js/96.b3ef20b0.js"><link rel="prefetch" href="/assets/js/97.9e5e1675.js"><link rel="prefetch" href="/assets/js/98.b213b526.js"><link rel="prefetch" href="/assets/js/99.1ec76897.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b448e12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5ee4d2c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.webp" alt="Bombax's Knowledge Document Notes" class="logo"> <span class="site-name can-hide">Bombax's Knowledge Document Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title router-link-active">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" aria-current="page" class="nav-link router-link-exact-active router-link-active">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.webp"> <div class="blogger-info"><h3>bombax</h3> <span>小小程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><a href="/java-basic/" class="link-title">Java基础</a> <span class="title" style="display:none;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前置</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-learning/" class="nav-link">尚硅谷Java学习</a></li><li class="dropdown-subitem"><a href="/java-basic/software-install-config/" class="nav-link">基础软件安装与配置</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java-basic/java-from-entry-to-proficiency/" class="nav-link">Java从入门到精通(JDK17版)</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/beginners/" class="nav-link">MySQL从入门到高级-基础篇</a></li><li class="dropdown-subitem"><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/" class="nav-link">MySQL从入门到高级-高级篇</a></li><li class="dropdown-subitem"><a href="/java-basic/jdbc-core/" class="nav-link">JDBC 核心技术(JDK21版)</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/pojo/" class="nav-link">POJO 概念</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务核心" class="dropdown-title"><a href="/micro-service-core/" class="link-title">微服务核心</a> <span class="title" style="display:none;">微服务核心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-subitem"><a href="/micro-service-core/SpringCloud-Alibaba/" class="nav-link">SpringCloud-Alibaba</a></li></ul></li><li class="dropdown-item"><h4>持久层框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-core/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/micro-service-core/MyBatisPlus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>相关知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/20b7dd/" class="nav-link">Mybatis 代码生成工具比较</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务生态" class="dropdown-title"><a href="/micro-service-ecology/" class="link-title router-link-active">微服务生态</a> <span class="title" style="display:none;">微服务生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>安全框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/SpringSecurity/" class="nav-link">安全框架之 Spring Security</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/Shiro/" class="nav-link">安全框架之 Shiro</a></li></ul></li><li class="dropdown-item"><h4>定时任务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/micro-service-ecology/Quartz/" aria-current="page" class="nav-link router-link-exact-active router-link-active">定时任务框架之 Quartz</a></li><li class="dropdown-subitem"><a href="/micro-service-ecology/XXL-JOB/" class="nav-link">定时任务框架之 XXL-JOB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用工具" class="dropdown-title"><a href="/tools/" class="link-title">实用工具</a> <span class="title" style="display:none;">实用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/java-logs/" class="nav-link">Java 日志热门框架</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git 常用命令</a></li><li class="dropdown-item"><!----> <a href="/tools/swagger/" class="nav-link">Swagger API 文档生成工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weibocom/motan/wiki/zh_overview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Motan RPC
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.knowledgedict.com/tutorial/lombok-intro.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Tutorial
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://projectlombok.org/features/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lombok Features
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/fastjson2/wiki/fastjson2_intro_cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FastJSON2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://felord.cn/_doc/spring/5.x.RELEASE/_book/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Framework 5 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x-stream.github.io/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XStream
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://neoremind.com/2016/02/java%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E9%AA%8C%E8%AF%81%E6%A1%86%E6%9E%B6fluent-validator/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  fluent-validator 业务逻辑验证框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.ehcache.org/documentation/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ehcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/alibaba/jetcache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetcache java 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caffeine.gitbook.io/caffeine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  caffeine 缓存框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://springdoc.cn/spring/integration.html#cache" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Cache
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/imyjy/p/15695160.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主流缓存框架调研
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer" class="nav-link external">
  redisson 官方中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012934325/article/details/100652805" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 中文学习指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.liquibase.com/concepts/introduction-to-liquibase.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LiquiBase 官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/coderofmutou/coderofmutou.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>定时任务框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/micro-service-ecology/Quartz/" aria-current="page" class="active sidebar-link">定时任务框架之 Quartz</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/Quartz/#springtask-与-timer-实现定时任务" class="sidebar-link">SpringTask 与 Timer 实现定时任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#timer-实现定时任务" class="sidebar-link">Timer 实现定时任务</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#springtask-实现定时任务" class="sidebar-link">SpringTask 实现定时任务</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/Quartz/#quartz-基本介绍" class="sidebar-link">Quartz 基本介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-概念" class="sidebar-link">Quartz 概念</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-运行环境" class="sidebar-link">Quartz 运行环境</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-设计模式" class="sidebar-link">Quartz 设计模式</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-学习的核心概念" class="sidebar-link">Quartz 学习的核心概念</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-的体系结构" class="sidebar-link">Quartz 的体系结构</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-的几个常用-api" class="sidebar-link">Quartz 的几个常用 API</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/Quartz/#quartz-的使用" class="sidebar-link">Quartz 的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#使用基本步骤" class="sidebar-link">使用基本步骤</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#准备工作" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#入门案例" class="sidebar-link">入门案例</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#job-和-jobdetail-介绍" class="sidebar-link">Job 和 JobDetail 介绍</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#jobexecutioncontext-介绍" class="sidebar-link">JobExecutionContext 介绍</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#jobdatamap-介绍" class="sidebar-link">JobDataMap 介绍</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#job-状态与并发" class="sidebar-link">Job 状态与并发</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#trigger-介绍" class="sidebar-link">Trigger 介绍</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#simpletrigger-触发器" class="sidebar-link">SimpleTrigger 触发器</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#crontrigger-触发器" class="sidebar-link">CronTrigger 触发器</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#配置、资源-schedulerfactory" class="sidebar-link">配置、资源 SchedulerFactory</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-properties" class="sidebar-link">Quartz.properties</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-监听器" class="sidebar-link">Quartz 监听器</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#joblistener" class="sidebar-link">JobListener</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#triggerlistener" class="sidebar-link">TriggerListener</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#schedulerlistener" class="sidebar-link">SchedulerListener</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-中的错过补偿机制-misfire" class="sidebar-link">Quartz 中的错过补偿机制 MisFire</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#job-stores" class="sidebar-link">Job Stores</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#ramjobstore" class="sidebar-link">RAMJobStore</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#jdbc-jobstore" class="sidebar-link">JDBC JobStore</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#terracottajobstore" class="sidebar-link">TerracottaJobStore</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/micro-service-ecology/Quartz/#springboot-整合-quartz" class="sidebar-link">SpringBoot 整合 Quartz</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#简单案例" class="sidebar-link">简单案例</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#引入依赖" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#创建-job" class="sidebar-link">创建 Job</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#创建-jobdetail-和-trigger" class="sidebar-link">创建 JobDetail 和 Trigger</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#主启动类" class="sidebar-link">主启动类</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-实现定时任务的动态调度" class="sidebar-link">Quartz 实现定时任务的动态调度</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#什么是动态定时任务" class="sidebar-link">什么是动态定时任务</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#动态定时任务的使用场景" class="sidebar-link">动态定时任务的使用场景</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#scheduler-调度器常用-api" class="sidebar-link">Scheduler 调度器常用 API</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#实现动态调度的定时任务" class="sidebar-link">实现动态调度的定时任务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/Quartz/#自定义任务类" class="sidebar-link">自定义任务类</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/Quartz/#任务-bean" class="sidebar-link">任务 Bean</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/Quartz/#操作任务的工具类" class="sidebar-link">操作任务的工具类</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/Quartz/#编写控制器操作任务" class="sidebar-link">编写控制器操作任务</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/Quartz/#测试-2" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#关于修改定时任务的问题" class="sidebar-link">关于修改定时任务的问题</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-的持久化" class="sidebar-link">Quartz 的持久化</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#为什么需要-quartz-持久化" class="sidebar-link">为什么需要 Quartz 持久化</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#如何实现-jdbcjobstore" class="sidebar-link">如何实现 JDBCJobStore</a></li><li class="sidebar-sub-header level3"><a href="/micro-service-ecology/Quartz/#quartz-的集群操作" class="sidebar-link">Quartz 的集群操作</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#为什么需要-quartz-集群" class="sidebar-link">为什么需要 Quartz 集群</a></li><li class="sidebar-sub-header level4"><a href="/micro-service-ecology/Quartz/#quartz-集群的实现" class="sidebar-link">Quartz 集群的实现</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/Quartz/#集群-properties-常用配置" class="sidebar-link">集群 properties 常用配置</a></li><li class="sidebar-sub-header level5"><a href="/micro-service-ecology/Quartz/#节点的重复执行问题" class="sidebar-link">节点的重复执行问题</a></li></ul></li></ul></li><li><a href="/micro-service-ecology/XXL-JOB/" class="sidebar-link">定时任务框架之 XXL-JOB</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/micro-service-ecology/#微服务生态" data-v-06225672>微服务生态</a></li><li data-v-06225672><a href="/micro-service-ecology/#定时任务框架" data-v-06225672>定时任务框架</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/coderofmutou" target="_blank" title="作者" class="beLink" data-v-06225672>bombax</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-06-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">定时任务框架之 Quartz<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="quartz-任务调度"><a href="#quartz-任务调度" class="header-anchor">#</a> Quartz 任务调度</h1> <h2 id="springtask-与-timer-实现定时任务"><a href="#springtask-与-timer-实现定时任务" class="header-anchor">#</a> SpringTask 与 Timer 实现定时任务</h2> <h3 id="timer-实现定时任务"><a href="#timer-实现定时任务" class="header-anchor">#</a> Timer 实现定时任务</h3> <ol><li><p>JDK 1.3 开始推出定时任务实现工具类 <code>java.util.Timer</code></p></li> <li><p>API</p> <ul><li><code>Timer timer = new Timer();</code></li> <li><code>timer.schedule(任务,延迟时间|执行时间)</code></li> <li><code>timer.schedule(任务,延迟时间,重复频率)</code></li> <li><code>timer.schedule(任务,首次执行时间,重复频率)</code></li></ul></li> <li><p>案例</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTimer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建 Timer 对象</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1. 实现定时任务（hello,timer!）-具体时间点</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;2024-06-08 02:14:00&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Date</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyTimerTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTimerTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        timer.schedule(task, start);</span>
        <span class="token comment">// 2. 实现定时任务（hello,timer!）-具体时间频率(2秒)</span>
        timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyTimerTask</span> <span class="token keyword">extends</span> <span class="token class-name">TimerTask</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,timer!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;run time: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li></ol> <h3 id="springtask-实现定时任务"><a href="#springtask-实现定时任务" class="header-anchor">#</a> SpringTask 实现定时任务</h3> <ol><li><p>Spring V3.0 开始推出定时任务功能，无需引入额外的依赖（SpringTask 集成在 SpringContext 中），<strong>默认单线程方式执行所有</strong></p></li> <li><p><code>@EnableScheduling</code>：SpringBoot 启动类上添加该注解，开启定时任务功能。</p></li> <li><p><code>@Scheduled</code>：方法上添加 <code>@Scheduled(cron=&quot;cron表达式&quot;)</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;0/1 * * * * ?&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">task1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,task!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;run time:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread.currentThread().getName() = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行时间 &gt; 时间频率</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;0/1 * * * * ?&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">task2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;你好,task!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;run time:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread.currentThread().getName() = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>多线程设置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">task</span><span class="token punctuation">:</span>
    <span class="token key atrule">scheduling</span><span class="token punctuation">:</span>
      <span class="token comment"># 线程名前缀</span>
      <span class="token key atrule">thread-name-prefix</span><span class="token punctuation">:</span> mytask_
      <span class="token comment"># 线程池的线程数</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">2</span>
      <span class="token key atrule">shutdown</span><span class="token punctuation">:</span>
        <span class="token comment"># 线程关闭前是否等待所有任务执行完毕</span>
        <span class="token key atrule">await-termination</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 默认 false</span>
        <span class="token comment"># 线程关闭前的最大等待时间（防止无限执行的任务）</span>
        <span class="token key atrule">await-termination-period</span><span class="token punctuation">:</span> 10s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h2 id="quartz-基本介绍"><a href="#quartz-基本介绍" class="header-anchor">#</a> Quartz 基本介绍</h2> <h3 id="quartz-概念"><a href="#quartz-概念" class="header-anchor">#</a> Quartz 概念</h3> <ul><li><p>Quartz 是 OpenSymphony 开源组织在 Job scheduling 领域又一个开源项目，它可以与 J2EE 与 J2SE 应用程序相结合也可以单独使用。</p></li> <li><p>quartz 是开源且具有丰富特性的&quot;任务调度库&quot;，能够集成于任何的 java 应用，小到独立的应用，大至电子商业系统。</p></li> <li><p>quartz 能够创建亦简单亦复杂的调度，以执行上十、上百，甚至上万的任务。任务 job 被定义为标准的 java 组件，能够执行任何你想要实现的功能。quartz 调度框架包含许多企业级的特性，如 JTA 事务、集群的支持。</p></li> <li><p>简而言之，quartz 就是基于 java 实现的任务调度框架，用于执行你想要执行的任何任务。</p></li></ul> <p>官网：<a href="https://www.quartz-scheduler.org/" target="_blank" rel="noopener noreferrer">Quartz Enterprise Job Scheduler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>中文文档：<a href="https://www.w3cschool.cn/quartz_doc/" target="_blank" rel="noopener noreferrer">Quartz 官方文档_w3cschool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="quartz-运行环境"><a href="#quartz-运行环境" class="header-anchor">#</a> Quartz 运行环境</h3> <ul><li>Quartz 可以运行嵌入在另一个独立式应用程序</li> <li>Quartz 可以在应用程序服务器（或 servlet 容器）内被实例化，并且参与事务</li> <li>Quartz 可以作为一个独立的程序运行（其自己的 Java 虚拟机内），可以通过 RMI 使用</li> <li>Quartz 可以被实例化，作为独立的项目集群（负载平衡和故障转移功能），用于作业的执行</li></ul> <h3 id="quartz-设计模式"><a href="#quartz-设计模式" class="header-anchor">#</a> Quartz 设计模式</h3> <ul><li>Builder 模式</li> <li>Factory 模式</li> <li>组件模式</li> <li>链式编程</li></ul> <h3 id="quartz-学习的核心概念"><a href="#quartz-学习的核心概念" class="header-anchor">#</a> Quartz 学习的核心概念</h3> <ul><li><p><strong>任务 Job</strong>：Job 就是想要实现的任务类，每一个 Job 必须实现 <code>org.quartz.job</code> 接口，且只需实现接口定义的 <code>execute()</code> 方法。</p></li> <li><p><strong>触发器 Trigger</strong>：Trigger 为执行任务的触发器，比如你想每天定时 3 点发送一份统计邮件，Trigger 将会设置 3 点进行执行该任务。Trigger 主要包含两种 <code>SimpleTrigger</code> 和 <code>CronTrigger</code> 两种。</p></li> <li><p><strong>调度器 Scheduler</strong>：Scheduler 为任务的调度器，它会将任务 job 及触发器 Trigger 整合起来，负责基于 Trigger 设定的时间来执行 Job。</p></li></ul> <h3 id="quartz-的体系结构"><a href="#quartz-的体系结构" class="header-anchor">#</a> Quartz 的体系结构</h3> <p><img src="/assets/img/Architecture.07e6c480.webp" alt="Architecture"></p> <h3 id="quartz-的几个常用-api"><a href="#quartz-的几个常用-api" class="header-anchor">#</a> Quartz 的几个常用 API</h3> <p>以下是 Quartz 编程 API 几个重要接口，也是 Quartz 的重要组件</p> <ul><li><strong>Scheduler</strong>：用于与调度程序交互的主要接口。Scheduler 调度程序-任务执行计划表，只有安排进执行计划的任务 Job（通过 <code>scheduler.scheduleJob</code> 方法安排进执行计划），当它预先定义的执行时间到了的时候（任务触发 trigger），该任务才会执行。</li> <li><strong>Job</strong>：预先定义的希望在未来时间能被调度程序执行的任务类，可自定义。</li> <li><strong>JobDetail</strong>：使用 JobDetail 来定义定时任务的实例，JobDetail 实例是通过 JobBuilder 类创建的。</li> <li><strong>JobDataMap</strong>：可以包含不限量的（序列化的）数据对象，在 job 实例执行的时候，可以使用其中的数据；JobDataMap 是 Java Map 接口的一个实现，额外增加了一些便于存取基本类型的数据的方法。</li> <li><strong>Trigger 触发器</strong>：Trigger 对象是用来触发执行 Job 的。当调度一个 job 时，我们实例一个触发器然后调整它的属性来满足 job 执行的条件。表明任务在什么时候会执行。定义了一个已经被安排的任务将会在什么时候执行的时间条件，比如每 2 秒就执行一次。</li> <li><strong>JobBuilder</strong>：用于声明一个任务实例，也可以定义关于该任务的详情比如任务名、组名等，这个声明的实例将会作为一个实际执行的任务。</li> <li><strong>TriggerBuilder</strong>：触发器创建器，用于创建触发器 trigger 实例。</li> <li><strong>JobListener、TriggerListener、SchedulerListener 监听器</strong>：用于对组件的监听。</li></ul> <h2 id="quartz-的使用"><a href="#quartz-的使用" class="header-anchor">#</a> Quartz 的使用</h2> <h3 id="使用基本步骤"><a href="#使用基本步骤" class="header-anchor">#</a> 使用基本步骤</h3> <p>Quartz Scheduler 是一个功能强大且广泛使用的开源调度框架，用于在 Java 应用程序中实现定时任务调度。下面是使用 Quartz Scheduler 的基本步骤：</p> <ol><li>添加依赖：首先，在项目构建文件（如 Maven 或 Gradle）中添加 Quartz 的依赖项，确保可以引入 Quartz 框架。</li> <li>创建 Job 类：定义一个实现 <code>org.quartz.Job</code> 接口的 Java 类，该类封装了要执行的任务逻辑。你需要实现 execute 方法，该方法会在任务被触发时被调用。</li> <li>创建 Trigger：创建一个 <code>org.quartz.Trigger</code> 对象，用于定义触发任务执行的时间规则，例如每隔一段时间执行、每天固定时间执行等。</li> <li>创建 Scheduler：通过 <code>org.quartz.SchedulerFactory</code> 创建一个 <code>org.quartz.Scheduler</code> 实例，它是 Quartz 的核心调度器。通过调度器，你可以配置和管理任务。</li> <li>创建 JobDetail：使用 <code>org.quartz.JobBuilder</code> 创建一个 <code>org.quartz.JobDetail</code> 对象，用于定义要执行的具体任务（即前面创建的 Job 类）。</li> <li>将 JobDetail 和 Trigger 绑定到 Scheduler：使用 <code>org.quartz.Scheduler</code> 的 scheduleJob 方法，将 JobDetail 和 Trigger 绑定到调度器，以指定任务的执行时间规则。</li> <li>启动 Scheduler：通过调度器的 start 方法启动 Scheduler，使其开始调度任务。</li></ol> <p>通过上述步骤，你可以实现定时任务的调度。Quartz Scheduler 会根据 Trigger 定义的时间规则触发执行 Job 任务。</p> <p>此外，Quartz Scheduler 还提供了其他功能，例如任务暂停、恢复、修改触发时间规则、动态添加和删除任务等。你可以根据具体需求进一步探索 Quartz Scheduler 的高级功能。</p> <h3 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h3> <p>建立 Maven 工程，导入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.itcast.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>itcast_quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- quartz 核心包 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.quartz-scheduler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- quartz-jobs 工具包 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.quartz-scheduler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>quartz-jobs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-slf4j-impl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.17.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.11.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="入门案例"><a href="#入门案例" class="header-anchor">#</a> 入门案例</h3> <ol><li><p>创建 HelloJob 任务类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 定义任务类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 输出当前时间</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dateString <span class="token operator">=</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 工作内容</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;正在进行数据库的备份工作，备份数据库的时间是：&quot;</span> <span class="token operator">+</span> dateString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>创建任务调度类 HelloSchedulerDemo</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedulerDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 调度器（Scheduler），从工厂中获取调度的实例（默认：实例化 new StdSchedulerFactory()）</span>
        <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">.</span><span class="token function">getDefaultScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 任务实列（JobDetail）</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>   <span class="token comment">// 加载任务类，与HelloJob完成绑定，要求HelloJob实现Job接口</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：任务的名称（唯一实例）；参数2：任务组的名称）</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 触发器（Trigger）</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：触发器的名称（唯一实例）；参数2：触发器组的名称）</span>
                <span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 马上启动触发器</span>
                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">SimpleScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 每5s重复执行一次</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 让调度器关联任务和触发器，保证按照触发器定义的条件执行任务</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 启动</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p>实现效果</p></li></ol> <p><img src="/assets/img/image-20240603002347458.7b1cb4f9.webp" alt="image-20240603002347458"></p> <h3 id="job-和-jobdetail-介绍"><a href="#job-和-jobdetail-介绍" class="header-anchor">#</a> Job 和 JobDetail 介绍</h3> <ul><li><p>Job：工作任务调度的接口，任务类需要实现该接口。该接口中定义 execute 方法，类似 JDK 提供的 TimeTask 类的 run 方法。在里面编写任务执行的业务逻辑。</p></li> <li><p><strong>Job 实例在 Quartz 中的生命周期</strong>：每次调度器执行 Job 时，它在调用 execute 方法前会<strong>创建一个新的 Job 实例</strong>，当调用完成后，关联的 Job 对象实例会被释放，释放的实例会被垃圾回收机制回收。</p> <p><img src="/assets/img/image-20240603220339957.232aeca7.webp" alt="image-20240603220339957"></p></li> <li><p>JobDetail：JobDetail 为 Job 实例提供了许多设置属性，以及 JobDetaMap 成员变量属性，它用来存储特定 Job 实例的状态信息，调度器需要借助 JobDetail 对象来添加 Job 实例。</p></li> <li><p>JobDetail 重要属性：name、group、jobClass、jobDataMap</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;名称：&quot;</span><span class="token operator">+</span>jobDetail<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;组的名称：&quot;</span><span class="token operator">+</span>jobDetail<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 如果没有指定组名：DEFAULT</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务类:&quot;</span><span class="token operator">+</span>jobDetail<span class="token punctuation">.</span><span class="token function">getJobClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="jobexecutioncontext-介绍"><a href="#jobexecutioncontext-介绍" class="header-anchor">#</a> JobExecutionContext 介绍</h3> <ul><li>当 Scheduler 调用一个 Job，就会将 <code>JobExecutionContext</code> 传递给 Job 的 <code>execute()</code> 方法；</li> <li>Job 能通过 <code>JobExecutionContext</code> 对象访问到 Quartz 运行时候的环境以及 Job 本身的明细数据。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 获取JobDetail的内容</span>
<span class="token class-name">JobKey</span> jobKey <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;工作任务名称：&quot;</span><span class="token operator">+</span>jobKey<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;;工作任务组：&quot;</span><span class="token operator">+</span>jobKey<span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务类名称（带包名）：&quot;</span><span class="token operator">+</span>context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务类名称：&quot;</span><span class="token operator">+</span>context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前任务执行时间：&quot;</span><span class="token operator">+</span>context<span class="token punctuation">.</span><span class="token function">getFireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;下一任务执行时间：&quot;</span><span class="token operator">+</span>context<span class="token punctuation">.</span><span class="token function">getNextFireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取Trigger的内容</span>
<span class="token class-name">TriggerKey</span> triggerKey <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;触发器名称&quot;</span> <span class="token operator">+</span> triggerKey<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;   触发器组&quot;</span>  <span class="token operator">+</span> triggerKey<span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="jobdatamap-介绍"><a href="#jobdatamap-介绍" class="header-anchor">#</a> JobDataMap 介绍</h3> <ol><li>使用 Map 获取。
<ul><li>在进行任务调度时，<code>JobDataMap</code> 存储在<code>JobExecutionContext</code> 中，非常方便获取。</li> <li><code>JobDataMap</code> 可以用来装载任何可序列化的数据对象，当 job 实例对象被执行时这些参数对象会传递给它。</li> <li><code>JobDataMap</code> 实现了 JDK 的 Map 接口，并且添加了非常方便的方法用来存取基本数据类型。</li></ul></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 2：定义一个任务调度实例，将该实例与HelloJob绑定，任务类需要实现Job接口</span>
<span class="token class-name">JobDetail</span> job <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 定义该实例唯一标识</span>
    <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;打印日志&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3：定义触发器 ，马上执行, 然后每5秒重复执行一次</span>
<span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 定义该实例唯一标识</span>
    <span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 马上执行</span>
    <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">SimpleScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 每5s重复执行一次</span>
    <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;simple触发器&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">JobDataMap</span> jobDataMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> jobMessage <span class="token operator">=</span> jobDataMap<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务参数消息值：&quot;</span><span class="token operator">+</span>jobMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JobDataMap</span> triggerDataMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> triggerMessage <span class="token operator">=</span> triggerDataMap<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;触发器参数消息值：&quot;</span><span class="token operator">+</span>triggerMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>Job 实现类中添加 setter 方法对应 JobDataMap 的键值，Quartz 框架默认的 JobFactory 实现类在初始化 job 实例对象时会自动地调用这些 setter 方法。</li></ol> <p>HelloJob.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>注意</strong>：如果遇到同名的 key，Trigger 中的 <code>.usingJobData(&quot;message&quot;, &quot;simple 触发器&quot;)</code> 会覆盖 JobDetail 中的 <code>.usingJobData(&quot;message&quot;, &quot;打印日志&quot;)</code>。</p> <h3 id="job-状态与并发"><a href="#job-状态与并发" class="header-anchor">#</a> Job 状态与并发</h3> <p><code>@DisallowConcurrentExecution</code>：</p> <ul><li>将该注解加到 job 类上，告诉 Quartz 不要并发地执行同一个 job 定义（这里指特定的 job 类）的多个实例。</li> <li>如果“SalesReportJob”类上有该注解，则同一时刻仅允许执行一个“SalesReportForJoe”实例，但可以并发地执行“SalesReportForMike”类的一个实例。</li></ul> <p><code>@PersistJobDataAfterExecution</code>:</p> <ul><li>将该注解加在 job 类上，告诉 Quartz 在成功执行了 job 类的 execute 方法后（没有发生任何异常），更新 JobDetail 中 JobDataMap 的数据，使得该 job（即 JobDetail）在下一次执行的时候，JobDataMap 中是更新后的数据，而不是更新前的旧数据。</li> <li>有状态的 Job 可以理解为多次 Job 调用期间可以持有一些状态信息，这些状态信息存储在 JobDataMap 中，而默认的无状态 job 每次调用时都会创建一个新的 JobDataMap。在 Job 类上添加 <code>@PersistJobDataAfterExecution</code> 注解即为有状态的 Job。</li></ul> <ol><li><p>修改 HelloSchedulerDemo，添加 <code>.usingJobData(&quot;count&quot;, 0)</code>，表示计数器。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">JobDetail</span> job <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    		<span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 定义该实例唯一标识</span>
    		<span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;打印日志&quot;</span><span class="token punctuation">)</span>
    		<span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    		<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>修改 HelloJob，添加 count 的 setting 和 getting 方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>在 <code>public void execute(JobExecutionContext context) throws JobExecutionException</code> 的方法中添加。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>总结</p> <ul><li>HelloJob 类没有添加 <code>@PersistJobDataAfterExecution</code> 注解，每次调用时都会创建一个新的 JobDataMap，不会累加；</li> <li>HelloJob 类添加 <code>@PersistJobDataAfterExecution</code> 注解，多次 Job 调用期间可以持有一些状态信息，即可以实现 count 的累加。</li> <li>如果你使用了<code>@PersistJobDataAfterExecution</code> 注解，强烈建议同时使用 <code>@DisallowConcurrentExecution</code> 注解，因为当同一个 job(JobDetail)的两个实例被并发执行时，由于竞争，JobDataMap 中存储的数据很可能是不确定的。</li></ul></li></ol> <h3 id="trigger-介绍"><a href="#trigger-介绍" class="header-anchor">#</a> Trigger 介绍</h3> <p><img src="/assets/img/Trigger.8a86a316.webp" alt="Trigger"></p> <p>Quartz 有一些不同的触发器类型，不过，用得最多的是 SimpleTrigger 和 CronTrigger。</p> <ol><li><p><strong>jobKey</strong>：表示 job 实例的标识，触发器被触发时，指定的 job 实例会被执行。</p></li> <li><p><strong>startTime</strong>：设置触发器第一次触发的时间。</p></li> <li><p><strong>endTime</strong>：指定触发器失效的时间。</p></li></ol> <p><strong>案例：</strong></p> <p>HelloJobTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 定义任务类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloJobTrigger</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 输出当前时间</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dateString <span class="token operator">=</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 工作内容</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;正在进行数据库的备份工作，备份数据库的时间是：&quot;</span> <span class="token operator">+</span> dateString<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取jobKey、startTime、endTime</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;jobKey的名称：&quot;</span> <span class="token operator">+</span> trigger<span class="token punctuation">.</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\tjobKey的组名称：&quot;</span> <span class="token operator">+</span> trigger<span class="token punctuation">.</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务的开始时间：&quot;</span> <span class="token operator">+</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>trigger<span class="token punctuation">.</span><span class="token function">getStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t任务的结束时间：&quot;</span> <span class="token operator">+</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>trigger<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>HelloSchedulerDemoTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedulerDemoTrigger</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 调度器（Scheduler），从工厂中获取调度的实例（默认：实例化 new StdSchedulerFactory()）</span>
        <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">.</span><span class="token function">getDefaultScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置任务的开始时间推迟3秒</span>
        <span class="token class-name">Date</span> startDate <span class="token operator">=</span> <span class="token class-name">DateBuilder</span><span class="token punctuation">.</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">DateBuilder<span class="token punctuation">.</span>IntervalUnit</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置任务的结束时间推迟10秒（10秒后停止）</span>
        <span class="token class-name">Date</span> endDate <span class="token operator">=</span> <span class="token class-name">DateBuilder</span><span class="token punctuation">.</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">DateBuilder<span class="token punctuation">.</span>IntervalUnit</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. 任务实列（JobDetail）</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJobTrigger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;打印日志&quot;</span><span class="token punctuation">)</span> 
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 触发器（Trigger）</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：触发器的名称（唯一实例）；参数2：触发器组的名称）</span>
<span class="token comment">//                .startNow() // 马上启动触发器</span>
                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">SimpleScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>startDate<span class="token punctuation">)</span> <span class="token comment">// 设置任务的开始时间</span>
                <span class="token punctuation">.</span><span class="token function">endAt</span><span class="token punctuation">(</span>endDate<span class="token punctuation">)</span> <span class="token comment">// 设置任务的结束时间</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 让调度器关联任务和触发器，保证按照触发器定义的条件执行任务</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 启动</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="simpletrigger-触发器"><a href="#simpletrigger-触发器" class="header-anchor">#</a> SimpleTrigger 触发器</h3> <ul><li>SimpleTrigger 对于设置和使用，是最为简单的一种 QuartzTrigger。</li> <li>它是为那种需要<strong>在特定的日期/时间启动，且以一个可能的间隔时间重复执行 n 次的 Job</strong> 所设计的。</li></ul> <p><strong>案例一：在一个指定的时间段内，执行一次作业任务。</strong></p> <p>HelloJobSimpleTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloJobSimpleTrigger</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dateString <span class="token operator">=</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;正在进行数据库的备份工作，备份数据库的时间是：&quot;</span> <span class="token operator">+</span> dateString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>HelloSchedulerDemoSimpleTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedulerDemoSimpleTrigger</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 调度器（Scheduler），从工厂中获取调度的实例（默认：实例化 new StdSchedulerFactory()）</span>
        <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">.</span><span class="token function">getDefaultScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置任务的开始时间推迟3秒</span>
        <span class="token class-name">Date</span> startDate <span class="token operator">=</span> <span class="token class-name">DateBuilder</span><span class="token punctuation">.</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">DateBuilder<span class="token punctuation">.</span>IntervalUnit</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. 任务实列（JobDetail）</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJobSimpleTrigger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 触发器（Trigger）</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>startDate<span class="token punctuation">)</span> <span class="token comment">// 设置任务的开始时间</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 让调度器关联任务和触发器，保证按照触发器定义的条件执行任务</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 启动</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>案例二：在指定的时间间隔内多次执行作业任务。</strong></p> <p>修改 HelloSchedulerDemoSimpleTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 设置任务的开始时间推迟3秒</span>
<span class="token class-name">Date</span> startDate <span class="token operator">=</span> <span class="token class-name">DateBuilder</span><span class="token punctuation">.</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">DateBuilder<span class="token punctuation">.</span>IntervalUnit</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3：定义触发器</span>
<span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：触发器的名称（唯一实例）；参数2：触发器组的名称）</span>
        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>startDate<span class="token punctuation">)</span> <span class="token comment">// 设置任务的开始时间</span>
        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">SimpleScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">repeatSecondlyForever</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withRepeatCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 5秒后重复执行，只重复执行3次（共4次）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>案例三：指定任务的结束时间。</strong></p> <p>修改 HelloSchedulerDemoSimpleTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 设置任务的开始时间推迟3秒</span>
<span class="token class-name">Date</span> startDate <span class="token operator">=</span> <span class="token class-name">DateBuilder</span><span class="token punctuation">.</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">DateBuilder<span class="token punctuation">.</span>IntervalUnit</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置任务的结束时间推迟10秒（10秒后停止）</span>
<span class="token class-name">Date</span> endDate <span class="token operator">=</span> <span class="token class-name">DateBuilder</span><span class="token punctuation">.</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">DateBuilder<span class="token punctuation">.</span>IntervalUnit</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：触发器的名称（唯一实例）；参数2：触发器组的名称）</span>
        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>startDate<span class="token punctuation">)</span> <span class="token comment">// 设置任务的开始时间</span>
        <span class="token punctuation">.</span><span class="token function">endAt</span><span class="token punctuation">(</span>endDate<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">SimpleScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">repeatSecondlyForever</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withRepeatCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 5秒后重复执行，只重复执行3次（共4次）</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>需要注意的点：</strong></p> <ul><li>SimpleTrigger 的属性有：开始时间、结束时间、重复次数和重复的时间间隔。</li> <li>重复次数属性的值可以为 0、正整数、或常量 <code>SimpleTrigger.REPEAT_INDEFINITELY</code>。</li> <li>重复的时间间隔属性值必须为长整型的正整数。</li> <li>如果有指定结束时间属性值，则<strong>结束时间属性优先于重复次数属性</strong>，这样的好处在于：当我们需要创建一个每间隔 10 秒钟触发一次直到指定的结束时间的 Trigger，而无需去计算从开始到结束的所重复的次数，我们只需简单的指定结束时间和使用 <code>REPEAT_INDEFINITELY</code> 作为重复次数的属性值即可。</li></ul> <h3 id="crontrigger-触发器"><a href="#crontrigger-触发器" class="header-anchor">#</a> CronTrigger 触发器</h3> <ul><li>如果你需要像日历那样按日程来触发任务，而不是像 SimpleTrigger 那样每隔特定的间隔时间触发，CronTriggers 通常比 SimpleTrigger 更有用，因为它是基于日历的作业调度器。</li> <li>使用 CronTrigger，你可以指定诸如“每个周五中午”，或者“每个工作日的 9:30”或者“从每个周一、周三、周五的上午 9:00 到上午 10:00 之间每隔五分钟”这样日程安排来触发。甚至，像 SimpleTrigger 一样，CronTrigger 也有一个 startTime 以指定日程从什么时候开始，也有一个（可选的）endTime 以指定何时日程不再继续。</li></ul> <ol><li><p>Cron 表达式</p> <p>Cron 表达式被用来配置 CronTrigger 实例。Cron 表达式是一个由 7 个子表达式组成的字符串。每个子表达式都描述了一个单独的日程细节。这些子表达式用空格分隔，分别表示：</p> <ol><li>Seconds 秒</li> <li>Minutes 分钟</li> <li>Hours 小时</li> <li>Day-of-Month 月中的天</li> <li>Month 月</li> <li>Day-of-Week 周中的天</li> <li>Year (optional field) 年（可选的域）</li></ol></li></ol> <p>取值：
<img src="/assets/img/CronExpressionsValue.b32e5ad5.webp" alt="CronExpressionsValue"></p> <ul><li>单个子表达式可以包含范围或者列表。例如：前面例子中的周中的天这个域（这里是&quot;WED&quot;）可以被替换为&quot;MON-FRI&quot;, &quot;MON, WED, FRI&quot;或者甚至&quot;MON-WED,SAT&quot;。</li> <li>所有的域中的值都有特定的合法范围，这些值的合法范围相当明显，例如：秒和分域的合法值为 0 到 59，小时的合法范围是 0 到 23，Day-of-Month 中值得合法凡范围是 1 到 31，但是需要注意不同的月份中的天数不同。月份的合法值是 1 到 12。或者用字符串 JAN,FEB MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV 及 DEC 来表示。Days-of-Week 可以用 1 到 7 来表示（1=星期日）或者用字符串 SUN, MON, TUE, WED, THU, FRI 和 SAT 来表示。</li></ul> <p><img src="/assets/img/08.ac814be3.webp" alt="08"></p> <p><strong>练习：</strong></p> <div class="language- extra-class"><pre><code>&quot;0 0 10,14,16 * * ?&quot; 每天上午10点，下午2点，4点
&quot;0 0/30 9-17 * * ?&quot;   朝九晚五工作时间内每半小时，从0分开始每隔30分钟发送一次
&quot;0 0 12 ? * WED&quot; 表示每个星期三中午12点 
&quot;0 0 12 * * ?&quot; 每天中午12点触发 
&quot;0 15 10 ? * *&quot; 每天上午10:15触发 
&quot;0 15 10 * * ?&quot; 每天上午10:15触发 
&quot;0 15 10 * * ? *&quot; 每天上午10:15触发 
&quot;0 15 10 * * ? 2005&quot; 2005年的每天上午10:15触发 
&quot;0 * 14 * * ?&quot; 在每天下午2点到下午2:59期间的每1分钟触发 
&quot;0 0/55 14 * * ?&quot; 在每天下午2点到下午2:55期间，从0开始到55分钟触发 
&quot;0 0/55 14,18 * * ?&quot; 在每天下午2点到2:55期间和下午6点到6:55期间的，从0开始到55分钟触发 
&quot;0 0-5 14 * * ?&quot; 在每天下午2点到下午2:05期间的每1分钟触发 
&quot;0 10,44 14 ? 3 WED&quot; 每年三月的星期三的下午2:10和2:44触发 
&quot;0 15 10 ? * MON-FRI&quot; 周一至周五的上午10:15触发 
&quot;0 15 10 15 * ?&quot; 每月15日上午10:15触发 
&quot;0 15 10 L * ?&quot; 每月最后一日的上午10:15触发 
&quot;0 15 10 ? * 6L&quot; 每月的最后一个星期五上午10:15触发 
&quot;0 15 10 ? * 6L 2002-2005&quot; 2002年至2005年的每月的最后一个星期五上午10:15触发 
&quot;0 15 10 ? * 6#3&quot; 每月的第三个星期五上午10:15触发 
</code></pre></div><p><strong>案例：</strong></p> <p>HelloJobCronTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloJobCronTrigger</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dateString <span class="token operator">=</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;正在进行数据库的备份工作，备份数据库的时间是：&quot;</span> <span class="token operator">+</span> dateString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>HelloSchedulerDemoCronTrigger.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedulerDemoCronTrigger</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 调度器（Scheduler），从工厂中获取调度的实例（默认：实例化 new StdSchedulerFactory()）</span>
        <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">.</span><span class="token function">getDefaultScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 任务实列（JobDetail）</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJobCronTrigger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> 
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：任务的名称（唯一实例）；参数2：任务组的名称）</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 触发器（Trigger）</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：触发器的名称（唯一实例）；参数2：触发器组的名称）</span>
                <span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span><span class="token string">&quot;0/5 * * * * ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 日历 从整点开始每5s执行一次</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 让调度器关联任务和触发器，保证按照触发器定义的条件执行任务</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 启动</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>小提示：</p> <ul><li>‘L’和‘W’可以一起使用。（企业可用在工资计算）</li> <li>‘#’可表示月中第几个周几。（企业可用在计算母亲节和父亲节）</li> <li>周字段英文字母不区分大小写，例如 MON==mon。</li> <li>利用工具，在线生成。</li></ul> <h3 id="配置、资源-schedulerfactory"><a href="#配置、资源-schedulerfactory" class="header-anchor">#</a> 配置、资源 SchedulerFactory</h3> <ul><li>Quartz 以模块方式构架，因此，要使它运行，几个组件必须很好的咬合在一起。幸运的是，已经有了一些现存的助手可以完成这些工作。</li> <li>所有的 Scheduler 实例由 SchedulerFactory 创建。</li> <li>Quartz 的三个核心概念：调度器、任务、触发器，三者之间的关系是：</li></ul> <p><img src="data:image/webp;base64,UklGRqgaAABXRUJQVlA4IJwaAACQowCdASqWAlwBPpFGnUslo6YhobQbUMASCWNu4XOBB18QNh15/Pe4exDT+In13i0Qk+g//v9Pf0AeIB6uH/O9VPREf7z//+4p/Tv+h7AH8U/wH//9q71R/8V553qAf/L1AP/r1u/U7+f/jv4G/2z8mPOnvseDfXT96vfEzn2lfxT69fe/69+7Xs1/p/DP4UfxHqEfj38l/uv5TehHsYtG/xn+h9QL2D+Vf7T/F/kj6KX9R/WfUP8p/q//E/r/wAfyP+Vf631X78P6//uvYB/m/9i/1n+V/In6Sv3z/rf4P8svaP+af4//v/5n4Bf5X/Q/+N/c/8t74Prs/cH//+5l+zf/hHbrNtgwikv0b5xur+v+JThFJfo3zjdX9f8SnCKS/RvnG6v6/4lOEUTHZvU5dDCA09cTKcFfdwwo7Km0A6U3deZThFJfo3zb4FitWspwV93DwOfiGkoTFFkw7UkJgPqHoTpceJBeuGQv55qiICos/NKsoT7mrHJgE0NjhP2ic1LkOSZj4lRJANcvO4HXu4/IEa+8kaiOQE/XUOLazGs1+pjLlR4GeDeyPbpXz4CqusNAYBVb+JqUZLASB2rQspXdEnkp99cxR2FVVHCgHMsQ+R30xI6AGUAuu5681Xd5qsonae9gAeogvOrSGxwoBzLEPkd9MSOgBlAJ1vJU9nz6+5hgbix7ggiXTiwKYGc2YBNDY4T9tqRC22g8JHQAygHMsPwMoBzLQNjhQDmPM8CpYwkdADKAcy0DV+E58rcBEgOaAE0NjhQDmPM8CpYwkdADJ+DMqGG+cbq4oGDmngDX/EpfqVllQDBlAOZYh8jvpiR0AMoBUCZzEjN9ON9OPuo1a95VPJEc/G3/a3jHFdPQCFR4UYpnkmUkW5+dRFnY6paLtUlRuyfhlXmfzwHEpCGcGRf4zmkCaGxwDc4ILHmWgbHCYiEL0MpdW/xXfrEe9dXmJeVXCf98u8gU6J2ZS2fcQy+HJ/W3ny7NWwhlsm9unrlDQ2OFAOQigQix5loGxwkxHoYMGJimOXJ1/ui4Fn9tsyIN5chxCKajoAZQDkIoEIseZaBscKAm3u5h3UGKOLPT2hHCgHMtAuClf9WTmgBNDY4UA5jwTBlAOZaBscKAchFAhFjzLQKzpNwpzIAkfZqyCEweGqzi+5kASPsyXgTZKAwZMRVHvQzaDv7zJyM/QAygHMxRVHCgHFc/M+Y7+PCRy/e+kzyEP191f1/xKYJLaoagaDzKcG06NuyOfcmpoeQUl+jfDp5f1/xKXycbxL4pX/BJqAB4Yoe5UT/hpzq0KAxDuFICE1Vp86O6Y7UzJrMw7MVwF34XNnOe5ohZ6cPZ5srvm7ZmX1rXaSGT6F4OxwB4ikPUClRI2g2y6vz/pm9IuNgl3DakbQ3Z+lWyNuFkB3vZMaNkWnpO0WJwQLCU/1mcgmtS4ZlSMC17vn8FVZ/Pt01JOgCyhYiTSc+Cuvli4MQuXGa9hInoWbNtjDjjTmBqzEgGgzAN1Xw4rHE/Z/ugSCXD7cBjqrpCQ99HytXhnQ7nRgfyghcSNn997NcBvu68eKV/wGEYkafk0v6nGaXpJQkTDQ/Pu8nM//t/uZDDt1f1/xKcIpL9Ai1LTosxYB3fECj6V4+bAGv+JThFJfo3zjdX0n8SnCKS/RhnG6v6/4lOEUl+jfOJ36gbVviJXsWTaw27B+yCkv0b5xur+v+JThFJfo3zjdX9f8SnCKS/RvnG6v6/4lODZoHlGsTcsgAA/qTHxLbg+D/n1ayzre9k56rfn9uEBEzf4aezEVxv/+aKsp6sL6rvVKLBsy/+MCQsXIdKW0AAAAABhK5Oyc4q6IKgLV78pCw9mZgzX9//oBUev1/xFP+em3Y+6cscICC4mcmanlHb0FWzAO1Xn91Dp6xKt0pFAKwI+KVS283HaO5zQutw/lAhl9BFgJkZ5dPLp5dOn6Jxttf6gNLZl0VdPFKpllkCf81O/dQ6esSrdKRQEbX/q/qsQGRz7omwfEbfmHN4gAIHW4/XNgALDmgAAAAAF4CxmHyjZYzgT5UNeI4UnufzwV9xWxhj4Me/7UnRJz/1tHZAwilgLuXmk8+rwKrvtfK2V6Aq2/r+XnDZQftIrGeOe43MlfuWGqsfr+d4ddr3gVjE1yI4cJgh26UkY0twMfKnrB0wlHJzKBk8Deb1C8j+UjqQHqCcb7lG3q53NHZk8cfNWCoOTM0ic+eeTcYY29+8HpHju01aLi5p16AsE6wUOOfCP38OARP/lIX9Kzs0/jxYldwZBQynz/5UHzPmCoGjnGbX9xvIxeWXdhJ3gbFaxNLBVc9SRtbxUJSQOrSoZrrT3mvtWRmnC8UH5WdEO9inAMDGWtcRqEZN75qS4NflWmZgM1dqa0AU/Zbv7iECzi7UeN0Wl5JDzF6p5FbGJtZ/NQEHyg+Aohsp6w+1/mwj0fICZ1g9+4DvYmbsg5ffwCDloQHAmJP3Y/ukstTA7b87k78lwsv+b72kEzb3mtrZBgTK2wIFU/IZ5wnWp75Bt3MCp9kL1XgxiHNEjtUoh1pu+osTIKdFVbBFq/j54lx6Qt7cybMQdLz1lcnI2Z8Vqm+KiA7EyRGLP6eZlEQKZmITgSqcK+ygP/8TDcIen1xDfb2OaTdQ6myCccG9inAMDGWtce1IJX6JnGP/XFAQajcnL6IkMOMvbXsQfSC6B/qg6NSXheOJ2QlBsridJHl7QqWbjbQG/r+K0ELQ+9AyKbSclSMrlZlteIHnV/Y091MwJYPpqyPL7jvd8ifvu/IgO11vME5u2gOKtpSRWvOTAUhcoUoQQCnYO7SuXp26jxV8Vf/8QYWzc4JmQEdsfItujoinMt+MxxTOShdMQDSx+zki0Al24ZGf+u9ZJ8xB3lryqzdW4+LVR9tGYlm3zCFPneW74L73Uqz8YGVQPV3+hDexUgipxtbXNK/kPRnUfPzXgZ7yCwT2u2tKqiaCSZmhEY+2mLuyI/m+TDkgss3GJYtRfEhMp1OBPw1A7JHe+jS53TLwlrpZEFDfhqamTFA4DG98uDnLDlYaBUfj9eLxLDo/kHImkGHtZGWc54PZHoLNWzIPdFPN/HQYusJ4lZOjW6qbDP45/7wjBTpZGXkfWE1m9t0OFSw233vgYkhLqAgfm9N8DFtQ31eKY1JCIf7GMGnt5n57cgOMvmAtIsQ4XHxc+lSIWF6Ha6wKae7zBRt9NRK3/VY/RvRvhDn/x4k/nYKlv38ryLzFA9zd/y3yULfpQkKWL1aC8cuH4upEkq6yHMJAOILcvAenrseKCYXUqu8Hv64Q2uytcge5v6q/x5QEKGo8JVMQswcs4E1trJjr9LQpeAEED2q7AEbvdG7jc6DMqOBo9cnRjwl536ncNOR5KlUW1gfYAAApq0UUAAAnYVnWFFDoZPnNq6uxVpMfk8ODU7/hZt/KYDPdrsXAsIaxdsfo+siAhKRfE/LgAAbePTrKdWpKpL3EUR6uh6c9vx+yjbon0FYT1+oeHNcUzEoBEih+Z4kzl0AAAAAMAF8AAAAF9LXWiyjBecjrxlwZq5UuMJEroLzdRGZapYfkJpkBo98AAAj40B3MKIYvGiQ3crRumBJjS2h3JlLkkdPTN5ixJB0OPzvbhK3DWyILi5+x+duF7SV7QgUZInxZ2hOkqmn30xVo/9jthxHyIfpP34m8lWUKVsTVlUEx7kUOFPjEbgAAE+C8ejz2kVqQ/j+uD+YyJU8pIOHXFIlGBtyeb0Z8vZZOjOKPhZdA8CicmJd+qEXXteSLlmTUMswDJEWjUi3UXJz8PDMky+Ina6uDhfIuAMu/8GOaSMHSdUaQOScV1V0W4H48dtJh/wF6PCwaCA7JHyYt6Vtx63t9bJCpSz1tG5aTWqgc1QmWcOrnOCDxahcWfDySAxepbHa2wPDyapg9CEmItZCzcCe2VLGPDF2ANbN5SgRfhIO/KxQNRTcxPCKDBuRm9g9zG8fL1Wo5g5rHM/w/PkawSAsDd3RnSBoxDZ0yGIqMT/se/NO8OMWUmYmSyI+7KW4EM41M98oOOZUzCtGrpJMWqZ2Ipbime1gdM28KKuHrHDX1/9XiscxeVfBoZyjS6YZjtp8+8alUdSaiH7qs1GPau9YI4YfGD5KR5SYvWB+SUiX6iXKi0CkMcFVExu/DkA/9gEIYZd3mwLn4lM68EwVH+gP/ZJMi5Q6QrGHToZBSV1GaDWT2SysbCPjeviTb2qLtmVpsqT/V7Kx6l2eGXS5XF1OMj1kz6PWHVMoR2HZR5Jdisx9B+R5p4VcW2vovB+MBOWg8TAu8z4qL2oZlbUKJ5Phh93vJCxH4DdPBIfE14bQXJvsKK/I6giAHA9B7PgUUk9+xB5TufhFf85xnOIhE/bgou1TV6T3dC4juMFFWVqVvY4o9soSsF2S2iw+vLhjKhhoAMHYopydfm5+Wdj4T7IGD6ARFlPSLTQyVO8M2H8ZUIAygU/pMvjuVkQXVWXij/VJLDQpVfPAI92dZZtoF8o+TyGjMT+ijuhnvu3BDA2MICbcHSBqsmIyLPwkv00xmV1yEpsXD+WFXyaL/6UugWpiQYfv8e/mmXh7AgJdW7oXbSKudS7jV1PMuEMlDXuhp/hyY6GLVOgic6NAxIJsZFdPxhz8/+2ziwCP0QKNMN5tRoqzk/nbltkGwYglE2CHMHIhl0ygpsGw5I7yYOPnpFnfJ0f/UgRIb8XXOWQQDYdH6HsNiP7EF+TJSXru9QX8QyGMbtYimbUmc1yc5DYCEXkQNfhCMvXF3Do3+YjwxrrVc8/B+hS7XIsREV1sqUwUxDVdAWIdqVhcwUU+x4dRpsXr/WxvkeXciOI2NYcVFA3KFF5xbFU8RSEzfe6SEjZ5uNDuTieu0+Co53T4dmjJ+DTDRRxlWonJkWCbSN3WrKdkaEaUVLBEAPAABbnfCEdU2PKldiIMX14egAF4QJQcvmf5PjkCGIkmwQ+6ppLJSUPpg7rKjnLFIXb9KXrpZPjUp30mROu2d1TpnBfsKK0qDWr5MvQxDX+gCitbpOhM0KbkcZzSL18hzZZYe1nA7T8XI5I3J0yIyK3iPKQzOETJGNthtpGLc8RVnyjF9LmHtp3LXah0qsO8YbPP/ALp1OMRUaIqG6pKEVRE22DVIaFQlY5RNF474O7f8Gt6x2mt8ceuKBVSlu1ZqDyw6ehCvKJlfGlfhdXczazOzIIqcWgPyqwbT+ddiP27fhD2H84ig08lnIvtMj9qXsXPxtBjAbIIVV1EYvjFKczLD0Ivru2KeV6K9jAEssCHLcW1QUvfN0Y+/O57PGXD4PR6s1FkIAHa8T2Xnk9fETLjKMVKiEZfUIyJ4kuATQ50B+QRmDimO8vxNUXcF+KgYeFjJ4aNETLwTtitf3ZfF6jeh+FwyLQ6RjH03iG7z6ASNud85dlpRSa36tFi2TkhIoYichbdaubJ5SgqMxXv7wWirLwf12dQn7xRU2j2/yRHAqgu6klXUtgeYpK4Mq+Yt1EkQgzhetVfLXy2bN9R9kCaVHxzqejrEDNF0Gjpo8q6JoD02EeH7wvUGOWHMGPMtLrn2kAAAYFHm5bcLT85tO6fHpoItRmVWmWKDsKKFA/xVwJvH21UjoxzYR+PgAt8dE0/Lc4cGIk1D/YtaGO7GRqiJgtI9O+gyexh9tcXX+rZQAAAAAAAAAAAAAACoOLP8ZNC9S0wirGQc5IASbKsheXoMANykALlgnEurxcobdn6qYcoIAApb/2f0Fd4jcvp5O3ojvzMfF3A1kmQEXEwl/OAArDLFZYzKfPiWuYhl1DbZ/2ceN8ZBQJoosHBLIiJLS5UKidgfywd6BwWqJcxnaiFW84AWgO/Le9zz2sqdl1yTPT7YcR8iH/sdlLtX03ZhI3d+s2lq1EVLyF3I+agHFAxF8iH/sdsOI+TXP1dkrbgiKBDceZTqlORMlKJxU8lHBB4sc7c3RGz7YtaS78pRHjMbT6OWtul2jV8gG3GEaqpmn9++8pXO+/sASBrCxvx4oVC1Ta4B2mqxllcVwYVdLbBdZrpbLxuBodzIyU+LgUkvY9u3EFipRaBQzNBT/2PLMAL9Kv3tydYI93siA5j9JMXqkk3KGopSNlYz6t/k4fbXfBzVnYRImAJbRNU65St2mACok2mAvYFGrR+JpeTvz/lmYYsH8wd9iCbRsDETXRj7iofDIGDYge0m9uD5QTx2891fp4qdeyhca4ZUIV8b0sFSpKeIa/JrW2/gGjs92Rc2ZqcWaJP7P46PiTRNxDqSNK5enmRvQSZ1g+n1d4xZg4nBqRXvvm/5Rhq+cv2uyrFVVjLec6CsUcmQrylsCCC/NFS02K4eCo2vnotuafWxTJ85XaK4sfPm/pT08sItoing7qM56Xbm3T4cga5t6qHLTnlXOK4iH5qSjjOnvazHhA9SiXvTMn95hGYj4Hk4I4t+VLxZujRUmbXbAyfS/mcW2JZFo1TUoBrsE00oA3ieJxRnac7kV/2xFLml/O91MXgvXMHBv/Lo/9CAFg+7mOH+CR9n5almhIm5f36YHBvSqV5W9+1HKQHd8cbaUU+NF+QQ9SJaPxhwqNLZYsSyMye8o4/5g9wCzOJlA74IXouRDaRl3ulTpbVTrrxUHZfLNYNOmr8JCuDomIu9Vl7oq5ZkrXYfx1RvNeXs4ccK5dfrwBOoaX8S304fG5ADBWQ+nsuIS/sKJ1cPNOjnRVeQTfNZyVouEov4ACmXSh/gExdEhUyNpR8w56HTO3WF/xOnktbmS0qvI+UpHIXe8x06+tt5Z/2cAXxxaxOFAvpUuFDV+JXAWLoJpAEh9nbBmdmyG/wkxebY2PRmdzvkBpob81/rwhhBlgzdBmf5bsH9UZR9qaSm2hXkJuEOdiGhH/ZCoJH19kzq7/QUIXSG3IPDDnfdcadDEgetZ1BKdoS4BrmoJBUbagLgAujJe3g1cwO5USepIemNVFE1gRPkJYv/U2cQwj35RLdTxlm+FP/WxAlYw65DLF9BovdjR+b8dFnG12LFJtCIFLJWpzpVgyh229uFW+wAw4tMQXibPJyba/3bmvgFHNfZ4J9QybKYW1S2Z/gQqUwe76IRsJhVge9W1IREAWlgCC3dVaO6ow+nvUqWEtj28VSUl47nplfm91XL/zQmY7f709UNfLzrdW1uJxIAoPHMrv9y9SExSbmtxHe7nEl3c12hYvyZfZSNvejALh3/W8+VJgSUfClM7mvzNmyw+aW8M/EgEyqDnSPko7cPPVf4QMzdKEmE9vyLPXrv3EH+6ipJCXOxHEmQtdBiTBle6daeYN+zp4tiI//Ri+PLk78YMPJ6p3GOE+DgDLZAdiJg0J758/K2LIUOVFDH333OqARlUa+izTKwVygQwyxEP6391jkX5JU7z2ZYlTe86A4xu+7kYoBXgtFHzre3gr5m8Dha11cydQ0+Vz70I7iIMi6zLf2ZweKWMM02l6CDJa7M4HXcvbKwLyde/qdS1GpcAXonUXOoW8bgViUVKQK7pGTeYWpH7prdcBUHV5RqrnrDl+P/Cp2MVT63GsAgb0mN+bnSD8p2JO6jYxsxOy5NPNvELbJD7H/tsLtudwx1nbj8rg+lHTNwTqLnWyxULk9eZgbfbdVK/9rHhY+jfkRUO343jZyiJfzTXAevtYcsSmqn7bTwuyVp4/JLGg44BHq2JOCviTgaQ7uBd+UYfib8Y4/lNwEG1mu0SwKTvkhyJJ70VmybxEgdCQv8SNSPjRj48shLaRXsZxUBoOR+dm42WQLk7xOl7BXFWOLb9HHR2ZH9CUFrYn61RGwVTqar5EmVeRGiwMFfbdYnUvVihsuh/S81PHI2hFjp+8xLfKWl9uFJHee2beKAniXykw9tpshIraNW6S3oB9GeA0qln4ifI0D7s8V8RrIOkL691qEo35dH8BzFoFn4N8fKy0xNSFSXuqfqwqf4AgTw1gqyzfrZKbzrj//53WuQVJ3WVWUt+Rlw+Bt6431zZeERWGEUAVatL7oPji384jyD9kp+lrQ/EAAAHyt1B6EHF/VcgKz23al+GXVrpHFKu/y20OamP4e3MP6xUaFaO7rBtvulCXrm02m5Q8kzSua5c0axbCBbkZxJ1Nr8TYh9mCtCnPtU96JFVD5OSSuetHsvxvQbclPPL6YoOrGNvCt1mdCspr/0wqa4sV0HmLJqXb7AurcEVyRTaNZPx/sssjs8FO9XJAMs/zI67pBlwgGdqfdXGsQTZ7UeQv5B6FjQRxFW/TyvTK+Yck/UNdnIahLJTkq5nMzE5pOQhT1DhnDuVy+gCfuzibG83l/6Pu3fx6g/0TZSNMlPx7NXItqlEj/sCDmHrvS8NHLyOkiDXz+ABIN+OQJDEE+wRdyaiPRLXn4niS/pcyimIc29Ear/nDcbagZwNg6oFNkEmVF2HTABwQpEzk4xdL8+EXwPa6/REAiE0a/hGVecTIylTfp86kkF2eACXgPWIozLSjJwmR2ICm4K7BgX9A8nCkTtDkPVc+aN1fDieQPUTBbn1lsJmzwcpx976ZQfBmT97+nG1Sd1QBdKaybEAhK25/J1ZzhTTCqsIvhvwX1DWftTCH6JTFxThxOnESvCXW1uskf3hcYwdIEUHtVjfWVod1nY/JluNwSEUTVlwYwAeE5z5xKyo7F7GxBT4BG1oBgBs2p1dNO2YmVP8T4aorVTuF46qzTdmoD4iASINYahzgjQOcfzfUkllg7SIuV+GtKPpAUDlOfd1/BoFrNp9oBsqYsSx6cLN2KhJQ4ehPXNpH2C/NPBV0dJwm9CgKthELIFyKR0mUZxktRwr6AuKM5AQzwkzMS1GeMZEaDMO+w49YfC2k/MjC5pKKTZTbOreoRtDcU/nbk9gLtsi6Vat3ySYnan1dmnpXeUTweeSW51LmGd2zuXPxcJKF4VhswjM5QjM5QjM5QjM3i6zIIfcYIsW8Gy+1WTf/0q/8/6Ftf3EpUyHo2INHUXvhkbxzYWZC+Hx2addNb6qoiIhBsckgfgdj5heWXsu+bRiQcTopkkqVKlSpUqVKlSpUqVKlSpUqVKlSpUqVKlSpTGQgqJ4ZSTMagCja/FKXno0ONHuAAAAA==" alt="SchedulerFactory"></p> <p>一个作业，比较重要的三个要素就是 Schduler，jobDetail，Trigger；而 Trigger 对于 job 而言就好比一个驱动器；没有触发器来定时驱动作业，作业就无法运行；对于 Job 而言，<strong>一个 job 可以对应多个 Trigger</strong>，但对于 Trigger 而言，<strong>一个 Trigger 只能对应一个 job</strong>；所以一个 Trigger 只能被指派给一个 Job；如果你需要一个更复杂的触发计划，你可以创建多个 Trigger 并指派它们给同一个 Job。</p> <p><img src="/assets/img/image-20240607172849499.79003f3e.webp" alt="image-20240607172849499"></p> <p><strong>Scheduler 的创建方式：</strong></p> <ol><li><p>StdSchedulerFactory:</p> <p>Quartz 默认的 SchedulerFactory</p> <ul><li><p>使用一组参数(<code>java.util.Properties</code>)来创建和初始化 Quartz 调度器</p></li> <li><p>配置参数一般存储在 <code>quartz.properties</code> 文件中</p></li> <li><p>调用 getScheduler 方法就能创建和初始化调度器对象</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span>
<span class="token class-name">SchedulerFactory</span> schedulerFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> schedulerFactory<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ol> <ul><li><p>用法一：输出调度器开始的时间（重要：使得任务和触发器进行关联）：</p> <p><code>Date scheduleJob(JobDetail jobDetail, Trigger trigger)</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Date</span> date <span class="token operator">=</span> scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调度器的开始时间是：&quot;</span> <span class="token operator">+</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>用法二：启动任务调度：</p> <p><code>void start()</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>用法三：任务调度挂起，即暂停操作</p> <p><code>void standby()</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Scheduler执行2秒后自动挂起</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scheduler<span class="token punctuation">.</span><span class="token function">standby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token comment">// Scheduler执行5秒后自动开启</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>用法四：关闭任务调度</p> <p><code>void shutdown()</code></p> <ul><li><p><code>shutdown(true)</code>：表示等待所有正在执行的 job 执行完毕之后，再关闭 Scheduler；</p></li> <li><p><code>shutdown(false)</code>：表示直接关闭 Scheduler</p></li> <li><p>测试一：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Scheduler执行2秒后自动挂起</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scheduler<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Scheduler执行5秒后自动开启</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/assets/img/image-20240604221224298.36f3d380.webp" alt="image-20240604221224298"></p></li> <li><p>测试二：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Scheduler执行2秒后自动挂起</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * shutdown(true)：表示等待所有正在执行的job执行完毕之后，再关闭Scheduler；
 * shutdown(false)：表示直接关闭Scheduler
 */</span>
scheduler<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;scheduler是否被关闭：&quot;</span><span class="token operator">+</span>scheduler<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>同时修改：HelloJobScheduler.java，任务调度延迟 5 秒执行</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 延迟任务执行的时间，推迟5秒向后执行</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li></ul> <ol start="2"><li><p>DirectSchedulerFactory（了解）：</p> <p>DirectSchedulerFactory 是对 SchedulerFactory 的直接实现,通过它可以直接构建 Scheduler、threadpool 等</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">DirectSchedulerFactory</span> directSchedulerFactory <span class="token operator">=</span> <span class="token class-name">DirectSchedulerFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> directSchedulerFactory<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h3 id="quartz-properties"><a href="#quartz-properties" class="header-anchor">#</a> Quartz.properties</h3> <ul><li>默认路径：quartz-x.x.x.jar 中的 org.quartz 中的 <code>quartz.properties</code></li> <li>也可以在项目的资源下添加 <code>quartz.properties</code> 文件，去覆盖底层的配置文件。</li></ul> <p><strong>组成部分</strong></p> <ul><li><p>调度器属性</p> <ul><li><code>org.quartz.scheduler.instanceName</code> ：用来区分特定的调度器实例，可以按照功能用途来给调度器起名。</li> <li><code>org.quartz.scheduler.instanceId</code> ：和前者一样，也允许任何字符串，但这个值必须在所有调度器实例中是唯一的，尤其是在一个集群环境中，作为集群的唯一 key。假如你想 Quartz 帮你生成这个值的话，可以设置为 <code>AUTO</code>。</li></ul></li> <li><p>线程池属性</p> <ul><li><code>org.quartz.threadPool.threadCount</code>：处理 Job 的线程个数，至少为 1，但最多的话最好不要超过 100，在多数机器上设置该值超过 100 的话就会显得相当不实用了，特别是在你的 Job 执行时间较长的情况下。</li> <li><code>org.quartz.threadPool.threadPriority</code>：线程的优先级，优先级别高的线程比级别低的线程优先得到执行。最小为 1，最大为 10，默认为 5。</li> <li><code>org.quartz.threadPool.class</code>：一个实现了 <code>org.quartz.spi.ThreadPool</code> 接口的类，Quartz 自带的线程池实现类是 <code>org.quartz.smpl.SimpleThreadPool</code>。</li></ul></li> <li><p>作业存储设置</p> <ul><li><code>org.quartz.jobStore.class</code>：描述了在调度器实例的生命周期中，Job 和 Trigger 信息是如何被存储的。默认为<code>org.quartz.simpl.RAMJobStore</code>，表示使用内存存储。</li></ul></li> <li><p>插件配置</p> <ul><li>满足特定需求用到的 Quartz 插件的配置。</li></ul></li></ul> <p><strong>例子</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#===============================================================</span>
<span class="token comment">#Configure Main Scheduler Properties     调度器属性</span>
<span class="token comment">#===============================================================</span>
<span class="token comment">#调度器的实例名，默认为DefaultQuartzScheduler</span>
<span class="token key attr-name">org.quartz.scheduler.instanceName</span> <span class="token punctuation">=</span> <span class="token value attr-value">QuartzScheduler</span>
<span class="token comment">#调度器的实例ID，大多数情况设置为auto即可</span>
<span class="token key attr-name">org.quartz.scheduler.instanceId</span> <span class="token punctuation">=</span> <span class="token value attr-value">AUTO</span>

<span class="token comment">#===============================================================</span>
<span class="token comment">#Configure ThreadPool     线程池属性</span>
<span class="token comment">#===============================================================</span>
<span class="token comment">#处理Job的线程个数，至少为1，但最多的话最好不要超过100，在多数机器上设置该值超过100的话就会显得相当不实用了，特别是在你的 Job 执行时间较长的情况下，默认为10</span>
<span class="token key attr-name">org.quartz.threadPool.threadCount</span> <span class="token punctuation">=</span>  <span class="token value attr-value">5</span>
<span class="token comment">#线程的优先级，优先级别高的线程比级别低的线程优先得到执行。最小为1，最大为10，默认为5</span>
<span class="token key attr-name">org.quartz.threadPool.threadPriority</span> <span class="token punctuation">=</span> <span class="token value attr-value">5</span>
<span class="token comment">#一个实现了 org.quartz.spi.ThreadPool 接口的类，Quartz 自带的线程池实现类是 org.quartz.smpl.SimpleThreadPool</span>
<span class="token key attr-name">org.quartz.threadPool.class</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.quartz.simpl.SimpleThreadPool</span>

<span class="token comment">#===============================================================</span>
<span class="token comment">#Configure JobStore 作业存储设置</span>
<span class="token comment">#===============================================================</span>
<span class="token comment">#要使 Job 存储在内存中需通过设置  org.quartz.jobStrore.class 属性为 org.quartz.simpl.RAMJobStore</span>
<span class="token key attr-name">org.quartz.jobStore.class</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.quartz.simpl.RAMJobStore</span>

<span class="token comment">#===============================================================</span>
<span class="token comment">#Configure Plugins    插件配置</span>
<span class="token comment">#在1.8版之前 jobInitializer的配置为：</span>
<span class="token comment">#org.quartz.plugin.jobInitializer.class = org.quartz.plugins.xml.JobInitializationPlugin</span>
<span class="token comment">#1.8版之后 jobInitializer采用：</span>
<span class="token comment">#org.quartz.plugin.jobInitializer.class = org.quartz.plugins.xml.XMLSchedulingDataProcessorPlugin</span>
<span class="token comment">#===============================================================</span>
<span class="token key attr-name">org.quartz.plugin.jobInitializer.class</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.quartz.plugins.xml.XMLSchedulingDataProcessorPlugin</span>
<span class="token key attr-name">org.quartz.plugin.jobInitializer.overWriteExistingJobs</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">org.quartz.plugin.jobInitializer.failOnFileNotFound</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">org.quartz.plugin.jobInitializer.validating</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>也可以编写程序代码操作 <code>quartz.properties</code> 文件的内容：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建配置工厂的属性的对象</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">.</span><span class="token constant">PROP_THREAD_POOL_CLASS</span><span class="token punctuation">,</span> <span class="token string">&quot;org.quartz.simpl.SimpleThreadPool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 线程池的定义</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;org.quartz.threadPool.threadCount&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建工厂实例</span>
        <span class="token class-name">StdSchedulerFactory</span> stdSchedulerFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用定义的属性初始化工厂</span>
        stdSchedulerFactory<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> stdSchedulerFactory<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>通过 Properties 设置工厂属性的缺点在用硬编码，假如需要修改例子中线程数量，将不得不修改代码，然后重新编译。这里不推荐使用。</strong></p> <h3 id="quartz-监听器"><a href="#quartz-监听器" class="header-anchor">#</a> Quartz 监听器</h3> <h4 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h4> <ul><li>Quartz 的监听器用于当任务调度中你所关注事件发生时，能够及时获取这一事件的通知。类似于任务执行过程中的邮件、短信类的提醒。</li> <li>Quartz 监听器主要有 JobListener、TriggerListener、SchedulerListener 三种，顾名思义，分别表示任务、触发器、调度器对应的监听器。</li> <li>三者的使用方法类似，在开始介绍三种监听器之前，需要明确两个概念：全局监听器与非全局监听器，二者的区别在于：
<ul><li>全局监听器能够接收到所有的 Job/Trigger 的事件通知。</li> <li>而非全局监听器只能接收到在其上注册的 Job 或 Trigger 的事件，不在其上注册的 Job 或 Trigger 则不会进行监听。</li></ul></li> <li>为了方便起见，实现这些接口，你的类也可以扩展 JobListenerSupport 类或 TriggerListenerSupport 类，并且只需覆盖你感兴趣的事件。</li></ul> <h4 id="joblistener"><a href="#joblistener" class="header-anchor">#</a> JobListener</h4> <p>任务调度过程中，与任务 Job 相关的事件包括：<strong>job 开始要执行的提示; job 执行完成的提示</strong>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">JobListener</span> <span class="token punctuation">{</span>
  	<span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token keyword">void</span> <span class="token function">jobToBeExecuted</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token keyword">void</span> <span class="token function">jobExecutionVetoed</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">void</span> <span class="token function">jobWasExecuted</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">JobExecutionException</span> jobException<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>其中：</p> <ol><li><code>getName()</code> ：用于获取该 JobListener 的名称。</li> <li><code>jobToBeExecuted()</code>：Scheduler 在 JobDetail 将要被执行时调用这个方法。</li> <li><code>jobExecutionVetoed()</code>：Scheduler 在 JobDetail 即将被执行，但又被 TriggerListerner 否决时会调用该方法。</li> <li><code>jobWasExecuted()</code>：Scheduler 在 JobDetail 被执行之后调用这个方法。</li></ol> <p>示例：</p> <ol><li><p>创建 Job 类 HelloJobListener</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloJobListener</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dateString <span class="token operator">=</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进行数据库备份操作。当前任务执行的时间：&quot;</span><span class="token operator">+</span>dateString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>创建自定义的 MyJobListener</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJobListener</span> <span class="token keyword">implements</span> <span class="token class-name">JobListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;监听器的名称是：&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobToBeExecuted</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> jobName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Job的名称是：&quot;</span> <span class="token operator">+</span> jobName <span class="token operator">+</span> <span class="token string">&quot;\tScheduler在JobDetail将要被执行时调用这个方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobExecutionVetoed</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> jobName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Job的名称是：&quot;</span> <span class="token operator">+</span> jobName <span class="token operator">+</span> <span class="token string">&quot;\tScheduler在JobDetail即将被执行，但又被TriggerListener否决时会调用该方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobWasExecuted</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">JobExecutionException</span> jobException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> jobName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Job的名称是：&quot;</span> <span class="token operator">+</span> jobName <span class="token operator">+</span> <span class="token string">&quot;\tScheduler在JobDetail被执行之后调用这个方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>执行调度器 HelloSchedulerDemoJobListener</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedulerDemoJobListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 调度器（Scheduler），从工厂中获取调度的实例（默认：实例化 new StdSchedulerFactory()）</span>
        <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">.</span><span class="token function">getDefaultScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. 任务实列（JobDetail）</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJobListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>   <span class="token comment">// 加载任务类，与HelloJob完成绑定，要求HelloJob实现Job接口</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：任务的名称（唯一实例）；参数2：任务组的名称）</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 触发器（Trigger）</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 参数1：触发器的名称（唯一实例）；参数2：触发器组的名称）</span>
                <span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">SimpleScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">repeatSecondlyForever</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">withRepeatCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 让调度器关联任务和触发器，保证按照触发器定义的条件执行任务</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建并注册一个全局的 Job Listener</span>
        <span class="token comment">//scheduler.getListenerManager().addJobListener(new MyJobListener(), EverythingMatcher.allJobs());</span>
        <span class="token comment">// 创建并注册一个局部的 Job Listener，表示指定的任务 Job</span>
        scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">KeyMatcher</span><span class="token punctuation">.</span><span class="token function">keyEquals</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 启动</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li></ol> <h4 id="triggerlistener"><a href="#triggerlistener" class="header-anchor">#</a> TriggerListener</h4> <p>任务调度过程中，与触发器 Trigger 相关的事件包括：<strong>触发器触发、触发器未正常触发、触发器完成等</strong>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TriggerListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFired</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">,</span> <span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">vetoJobExecution</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">,</span> <span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerMisfired</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerComplete</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">,</span> <span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">,</span> <span class="token keyword">int</span> triggerInstructionCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>其中：</p> <ol><li><p><code>getName()</code>：用于获取触发器的名称</p></li> <li><p><code>triggerFired()</code>：当与监听器相关联的 Trigger 被触发，Job 上的 <code>execute()</code> 方法将被执行时，Scheduler 就调用该方法。</p></li> <li><p><code>vetoJobExecution()</code>：在 Trigger 触发后，Job 将要被执行时由 Scheduler 调用这个方法。TriggerListener 给了一个选择去否决 Job 的执行。假如这个方法返回 true，这个 Job 将不会为此次 Trigger 触发而得到执行。</p></li> <li><p><code>triggerMisfired()</code>：Scheduler 调用这个方法是在 Trigger 错过触发时。你应该关注此方法中持续时间长的逻辑：在出现许多错过触发的 Trigger 时，长逻辑会导致骨牌效应。你应当保持这上方法尽量的小。</p></li> <li><p><code>triggerComplete()</code>：Trigger 被触发并且完成了 Job 的执行时，Scheduler 调用这个方法。</p></li></ol> <p>示例：</p> <p>下面的例子简单展示了 TriggerListener 的使用，其中创建并注册 TriggerListener 与 JobListener 几乎类似。</p> <ol><li><p>创建 Job 类 HelloJobListener（同上）</p></li> <li><p>MyTriggerListener</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTriggerListener</span> <span class="token keyword">implements</span> <span class="token class-name">TriggerListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">// 构造方法，自定义传递的触发器名称，默认是类名</span>
    <span class="token keyword">public</span> <span class="token class-name">MyTriggerListener</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;触发器的名称是：&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFired</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">,</span> <span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> triggerName <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 当与监听器相关联的 Trigger 被触发，Job 上的 execute()方法将被执行时，Scheduler 就调用该方法。</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>triggerName <span class="token operator">+</span> <span class="token string">&quot; 被触发&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">vetoJobExecution</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">,</span> <span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> triggerName <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 在 Trigger 触发后，Job 将要被执行时由 Scheduler 调用这个方法。T</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>triggerName <span class="token operator">+</span> <span class="token string">&quot; 没有被触发&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// true：表示不会执行Job的方法</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerMisfired</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> triggerName <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Scheduler 调用这个方法是在 Trigger 错过触发时。</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>triggerName <span class="token operator">+</span> <span class="token string">&quot; 错过触发&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerComplete</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">,</span> <span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Trigger<span class="token punctuation">.</span>CompletedExecutionInstruction</span> triggerInstructionCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> triggerName <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Trigger 被触发并且完成了 Job 的执行时，Scheduler 调用这个方法。</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>triggerName <span class="token operator">+</span> <span class="token string">&quot; 完成之后触发&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div></li> <li><p>任务调度类 HelloSchedulerDemoTriggerListener</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedulerDemoTriggerListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token comment">// 4. 让调度器关联任务和触发器，保证按照触发器定义的条件执行任务</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建并注册一个全局的 Trigger Listener</span>
<span class="token comment">//        scheduler.getListenerManager().addTriggerListener(new MyTriggerListener(&quot;SimpleName&quot;), EverythingMatcher.allTriggers());</span>
        <span class="token comment">// 创建并注册一个局部的 Trigger Listener</span>
        scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyTriggerListener</span><span class="token punctuation">(</span><span class="token string">&quot;SimpleName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">KeyMatcher</span><span class="token punctuation">.</span><span class="token function">keyEquals</span><span class="token punctuation">(</span><span class="token class-name">TriggerKey</span><span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 启动</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol> <h4 id="schedulerlistener"><a href="#schedulerlistener" class="header-anchor">#</a> SchedulerListener</h4> <p>SchedulerListener 会在 Scheduler 的生命周期中关键事件发生时被调用。与 Scheduler 有关的事件包括：<strong>增加一个 job/trigger，删除一个 job/trigger，scheduler 发生严重错误，关闭 scheduler 等</strong>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SchedulerListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobScheduled</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobUnscheduled</span><span class="token punctuation">(</span><span class="token class-name">String</span> triggerName<span class="token punctuation">,</span> <span class="token class-name">String</span> triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFinalized</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersPaused</span><span class="token punctuation">(</span><span class="token class-name">String</span> triggerName<span class="token punctuation">,</span> <span class="token class-name">String</span> triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersResumed</span><span class="token punctuation">(</span><span class="token class-name">String</span> triggerName<span class="token punctuation">,</span> <span class="token class-name">String</span> triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsPaused</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobName<span class="token punctuation">,</span> <span class="token class-name">String</span> jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsResumed</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobName<span class="token punctuation">,</span> <span class="token class-name">String</span> jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerError</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">SchedulerException</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerInStandbyMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulingDataCleared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>其中：</p> <ol><li><p><code>jobScheduled()</code>：用于部署 JobDetail 时调用</p></li> <li><p><code>jobUnscheduled()</code>：用于卸载 JobDetail 时调用</p></li> <li><p><code>triggerFinalized()</code>：当一个 Trigger 来到了再也不会触发的状态时调用这个方法。除非这个 Job 已设置成了持久性，否则它就会从 Scheduler 中移除。</p></li> <li><p><code>triggersPaused()</code>：Scheduler 调用这个方法是发生在一个 Trigger 或 Trigger 组被暂停时。假如是 Trigger 组的话，triggerName 参数将为 null。</p></li> <li><p><code>triggersResumed()</code>：Scheduler 调用这个方法是发生成一个 Trigger 或 Trigger 组从暂停中恢复时。假如是 Trigger 组的话，triggerName 参数将为 null。</p></li> <li><p><code>jobsPaused()</code>：当一个或一组 JobDetail 暂停时调用这个方法。</p></li> <li><p><code>jobsResumed()</code>：当一个或一组 Job 从暂停上恢复时调用这个方法。假如是一个 Job 组，jobName 参数将为 null。</p></li> <li><p><code>schedulerError()</code>：在 Scheduler 的正常运行期间产生一个严重错误时调用这个方法。</p></li> <li><p><code>schedulerStarted()</code>：当 Scheduler 开启时，调用该方法。</p></li> <li><p><code>schedulerInStandbyMode()</code>： 当 Scheduler 处于 StandBy 模式时，调用该方法</p></li> <li><p><code>schedulerShutdown()</code>：当 Scheduler 停止时，调用该方法。</p></li> <li><p><code>schedulingDataCleare()</code>：当 Scheduler 中的数据被清除时，调用该方法。</p></li></ol> <p>示例：</p> <p>下面的代码简单描述了如何使用 SchedulerListener 方法：</p> <ol><li><p>创建 Job 类 HelloJobListener（同上）</p></li> <li><p>MySchedulerListener.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySchedulerListener</span> <span class="token keyword">implements</span> <span class="token class-name">SchedulerListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobScheduled</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> jobName <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jobName <span class="token operator">+</span> <span class="token string">&quot; 完成部署&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobUnscheduled</span><span class="token punctuation">(</span><span class="token class-name">TriggerKey</span> triggerKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>triggerKey <span class="token operator">+</span> <span class="token string">&quot; 完成卸载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFinalized</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> trigger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;触发器被移除 &quot;</span> <span class="token operator">+</span> trigger<span class="token punctuation">.</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerPaused</span><span class="token punctuation">(</span><span class="token class-name">TriggerKey</span> triggerKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>triggerKey <span class="token operator">+</span> <span class="token string">&quot; 正在被暂停&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersPaused</span><span class="token punctuation">(</span><span class="token class-name">String</span> triggerGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;触发器组 &quot;</span> <span class="token operator">+</span> triggerGroup <span class="token operator">+</span> <span class="token string">&quot; 正在被暂停&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerResumed</span><span class="token punctuation">(</span><span class="token class-name">TriggerKey</span> triggerKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>triggerKey <span class="token operator">+</span> <span class="token string">&quot; 正在从暂停中恢复&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersResumed</span><span class="token punctuation">(</span><span class="token class-name">String</span> triggerGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;触发器组 &quot;</span> <span class="token operator">+</span> triggerGroup <span class="token operator">+</span> <span class="token string">&quot; 正在从暂停中恢复&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobAdded</span><span class="token punctuation">(</span><span class="token class-name">JobDetail</span> jobDetail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 添加工作任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobDeleted</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jobKey <span class="token operator">+</span> <span class="token string">&quot; 删除工作任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobPaused</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jobKey <span class="token operator">+</span> <span class="token string">&quot; 工作任务正在被暂停&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsPaused</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;工作任务组 &quot;</span> <span class="token operator">+</span> jobGroup <span class="token operator">+</span> <span class="token string">&quot; 正在被暂停&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobResumed</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jobKey <span class="token operator">+</span> <span class="token string">&quot; 正在从暂停中恢复&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsResumed</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;工作任务组 &quot;</span> <span class="token operator">+</span> jobGroup <span class="token operator">+</span> <span class="token string">&quot; 正在从暂停中恢复&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerError</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">SchedulerException</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;产生严重错误时调用：\t&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> cause<span class="token punctuation">.</span><span class="token function">getUnderlyingException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerInStandbyMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调度器在挂起模式下调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调度器 开启时调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerStarting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调度器 正在开启时调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调度器 已经被关闭 时调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerShuttingdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调度器 正在被关闭 时调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulingDataCleared</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调度器的数据被清除时调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div></li> <li><p>HelloSchedulerDemoSchedulerListener.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedulerDemoSchedulerListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token comment">// 4. 让调度器关联任务和触发器，保证按照触发器定义的条件执行任务</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建并注册一个全局的 Scheduler Listener</span>
        scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MySchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 启动</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">standby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">pauseTrigger</span><span class="token punctuation">(</span><span class="token class-name">TriggerKey</span><span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">resumeTrigger</span><span class="token punctuation">(</span><span class="token class-name">TriggerKey</span><span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 移除监听器的监听</span>
        scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MySchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 关闭</span>
        scheduler<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li></ol> <h3 id="quartz-中的错过补偿机制-misfire"><a href="#quartz-中的错过补偿机制-misfire" class="header-anchor">#</a> Quartz 中的错过补偿机制 MisFire</h3> <p><strong>什么是 misfire：</strong></p> <ol><li>定时任务被出发了成为 fire，那么 misfire 自然就称之为“错过的触发”</li> <li>误解：失火、哑火</li></ol> <p><strong>为什么出现 misfire：</strong></p> <ol><li>资源紧张，定时任务请求不到对应的线程</li> <li>调度器关闭</li> <li>设置定时任务的开始时间早于启动时间（未明确指定开始时间，则开始时间=启动时间）</li></ol> <p><strong>misfire 的补偿：</strong></p> <ol><li>不同的 trigger，存在不同的补偿策略</li> <li>CronTrigger 补偿策略
<ul><li><code>CronTrigger.MISFIRE_INSTRUCTION_DO_NOTHING</code>：<code>withMisfireHandlingInstructionDoNothing()</code> <ul><li>说明：错误的不再补偿，然后正常调度</li></ul></li> <li><code>CronTrigger.MISFIRE_INSTRUCTION_FIRE_NOW</code>：<code>withMisfireHandlingInstructionFireAndProceed()</code> <ul><li>说明：错过的全部合并成一次，并立即补偿（即使任务终止时间已达到），然后正常调取。<strong>默认值</strong>。</li></ul></li> <li><code>CronTrigger.MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY</code>：<code>withMisfireHandlingInstructionIgnoreMisfires()</code> <ul><li>说明：错过的全部立即补偿（即使任务终止时间已达到），然后正常调度</li></ul></li></ul></li></ol> <h3 id="job-stores"><a href="#job-stores" class="header-anchor">#</a> Job Stores</h3> <ul><li>JobStore 负责跟踪您提供给调度程序的所有“工作数据”：jobs，triggers，日历等。</li> <li>您声明您提供给用于生成调度程序实例的 SchedulerFactory 的属性文件（或对象）中您的调度程序应使用哪个 JobStore（以及它的配置设置）。</li> <li>JobStore 用于 Quartz 本身的幕后使用，切勿在代码中直接使用 JobStore 实例。你必须告诉 Quartz（通过配置）使用哪个 JobStore，但是你应该只在代码中使用 Scheduler 界面。</li></ul> <h4 id="ramjobstore"><a href="#ramjobstore" class="header-anchor">#</a> RAMJobStore</h4> <ul><li>RAMJobStore 是使用最简单的 JobStore，它也是性能最高的（在 CPU 时间方面）。</li> <li>RAMJobStore 以其明显的方式获取其名称：它将其所有数据保存在 RAM 中。这就是为什么它是闪电般快的，也是为什么这么简单的配置。</li> <li>缺点是当您的应用程序结束（或崩溃）时，所有调度信息都将丢失。这意味着 RAMJobStore 无法履行 Job 和 Triggers 上的“非易失性”设置。对于某些应用程序，这是可以接受的，甚至是所需的行为，但对于其他应用程序，这可能是灾难性的。</li></ul> <p>要使用 RAMJobStore（并假设您使用的是 StdSchedulerFactory），只需在配置文件中设置：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">org.quartz.jobStore.class</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.quartz.simpl.RAMJobStore</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="jdbc-jobstore"><a href="#jdbc-jobstore" class="header-anchor">#</a> JDBC JobStore</h4> <ul><li>JDBCJobStore 也被恰当地命名 - 它通过 JDBC 将其所有数据保存在数据库中。因此，配置比 RAMJobStore 要复杂一点，而且也不是那么快。</li> <li>但是，性能下降并不是很糟糕，特别是如果您在主键上构建具有索引的数据库表。在相当现代的一套具有体面的 LAN（在调度程序和数据库之间）的机器上，检索和更新触发 triggers 的时间通常将小于 10 毫秒。</li> <li>JDBCJobStore 几乎与任何数据库一起使用，已被广泛应用于 Oracle，PostgreSQL，MySQL，MS SQLServer，HSQLDB 和 DB2。</li> <li>要使用 JDBCJobStore，必须首先创建一组数据库表以供 Quartz 使用。您可以在 Quartz 发行版的 <code>docs/dbTables</code> 目录或 <code>quartz-core\src\main\resources\org\quartz\impl\jdbcjobstore</code> 中找到表创建 SQL 脚本。</li> <li>有关属性的详细信息，可参考 <code>docs/config</code> 文件夹中的示例配置文件。</li></ul> <p>要使用 JDBCJobStore（并假定您使用的是 StdSchedulerFactory），首先需要将 Quartz 配置的 JobStore 类属性设置为<code>org.quartz.impl.jdbcjobstore.JobStoreTX</code>或 <code>org.quartz.impl.jdbcjobstore.JobStoreCMT</code>。</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 配置Quartz以使用JobStoreTx</span>
<span class="token key attr-name">org.quartz.jobStore.class</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.quartz.impl.jdbcjobstore.JobStoreTX</span>
<span class="token comment"># 配置JDBCJobStore以使用DriverDelegate</span>
<span class="token key attr-name">org.quartz.jobStore.driverDelegateClass</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span>
<span class="token comment"># 使用表前缀配置JDBCJobStore</span>
<span class="token key attr-name">org.quartz.jobStore.tablePrefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">QRTZ_</span>
<span class="token comment"># 使用要使用的DataSource的名称配置JDBCJobStore</span>
<span class="token key attr-name">org.quartz.jobStore.dataSource</span> <span class="token punctuation">=</span> <span class="token value attr-value">myDS</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>具体介绍见：<a href="https://www.w3cschool.cn/quartz_doc/quartz_doc-ib1j2d6x.html" target="_blank" rel="noopener noreferrer">Job Stores<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="terracottajobstore"><a href="#terracottajobstore" class="header-anchor">#</a> TerracottaJobStore</h4> <ul><li>TerracottaJobStore 提供了一种缩放和鲁棒性的手段，而不使用数据库。这意味着您的数据库可以免受 Quartz 的负载，可以将其所有资源保存为应用程序的其余部分。</li> <li>TerracottaJobStore 可以运行群集或非群集，并且在任一情况下，为应用程序重新启动之间持续的作业数据提供存储介质，因为数据存储在 Terracotta 服务器中。它的性能比通过 JDBCJobStore 使用数据库要好得多（约一个数量级更好），但比 RAMJobStore 要慢。</li></ul> <p>要使用 TerracottaJobStore（并且假设您使用的是 StdSchedulerFactory），只需将类名称 <code>org.quartz.jobStore.class = org.terracotta.quartz.TerracottaJobStore</code> 指定为用于配置石英的 JobStore 类属性，并添加一个额外的行配置来指定 Terracotta 服务器的位置</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">org.quartz.jobStore.class</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.terracotta.quartz.TerracottaJobStore</span>
<span class="token key attr-name">org.quartz.jobStore.tcConfigUrl</span> <span class="token punctuation">=</span> <span class="token value attr-value">localhost:951</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="springboot-整合-quartz"><a href="#springboot-整合-quartz" class="header-anchor">#</a> SpringBoot 整合 Quartz</h2> <h3 id="简单案例"><a href="#简单案例" class="header-anchor">#</a> 简单案例</h3> <h4 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h4> <p><code>spring-boot-starter-quartz</code></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.bombax.springboot.quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springboot-quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>springboot-quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>springboot-quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-boot.version</span><span class="token punctuation">&gt;</span></span>2.3.12.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-boot.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-boot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="创建-job"><a href="#创建-job" class="header-anchor">#</a> 创建 Job</h4> <ul><li>自定义任务实现类</li> <li><code>@PersistJobDataAfterExecution</code> ，有状态的 job</li> <li><code>@DisallowConcurrentExecution</code>，禁止并发访问同一个 job 定义</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bombax<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>job</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@PersistJobDataAfterExecution</span>   <span class="token comment">// 有状态的job</span>
<span class="token annotation punctuation">@DisallowConcurrentExecution</span>    <span class="token comment">// 禁止并发访问同一个 job 定义</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token comment">// context-定时任务执行的环境（上下文）</span>
        <span class="token comment">// 获取 JobDetail 对象</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;System.identityHashCode(jobDetail) = &quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">identityHashCode</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出详情</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务名字：&quot;</span> <span class="token operator">+</span> jobDetail<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务分组名字：&quot;</span> <span class="token operator">+</span> jobDetail<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务类名字：&quot;</span> <span class="token operator">+</span> jobDetail<span class="token punctuation">.</span><span class="token function">getJobClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;本次执行时间：&quot;</span> <span class="token operator">+</span> context<span class="token punctuation">.</span><span class="token function">getFireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;下次执行时间：&quot;</span> <span class="token operator">+</span> context<span class="token punctuation">.</span><span class="token function">getNextFireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 记录任务执行次数</span>
        <span class="token class-name">JobDataMap</span> jobDataMap <span class="token operator">=</span> jobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> count <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> jobDataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第&quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot;次执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobDataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 更新共享数据</span>

        <span class="token comment">// 休眠3秒</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="创建-jobdetail-和-trigger"><a href="#创建-jobdetail-和-trigger" class="header-anchor">#</a> 创建 JobDetail 和 Trigger</h4> <ul><li>配置类 QuartzConfig</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bombax<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JobDetail</span> <span class="token function">jobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">MyJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">storeDurably</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 持久化</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 唯一标识</span>
                <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment">// （共享）数据初始化</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Trigger</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// cron 表达式</span>
        <span class="token class-name">String</span> cronExpression <span class="token operator">=</span> <span class="token string">&quot;0/2 * * * * ? *&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 每隔2秒执行一次</span>
        <span class="token keyword">return</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;trigger1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span><span class="token function">jobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 时间规则（cron 表达式</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="主启动类"><a href="#主启动类" class="header-anchor">#</a> 主启动类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bombax<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>quartz</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootQuartzApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootQuartzApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h4> <ol><li><p><code>@PersistJobDataAfterExecution</code>  注解：有状态的 job</p> <ul><li><p>不使用 <code>@PersistJobDataAfterExecution</code>  注解</p> <p><img src="/assets/img/image-20240607181500661.a119c83f.webp" alt="image-20240607181500661"></p></li> <li><p>使用 <code>@PersistJobDataAfterExecution</code>  注解</p> <p><img src="/assets/img/image-20240607181727420.a8ebd821.webp" alt="image-20240607181727420"></p></li></ul></li> <li><p><code>@DisallowConcurrentExecution</code> ：当任务处理时间超过了定时的时间，禁止并发访问同一个 job 定义。</p> <ul><li><p>不使用<code>@DisallowConcurrentExecution</code></p> <p><img src="/assets/img/image-20240607182216331.cd5ab838.webp" alt="image-20240607182216331"></p></li> <li><p>使用<code>@DisallowConcurrentExecution</code></p> <p><img src="/assets/img/image-20240607182322001.a29d51f2.webp" alt="image-20240607182322001"></p></li></ul></li></ol> <h3 id="quartz-实现定时任务的动态调度"><a href="#quartz-实现定时任务的动态调度" class="header-anchor">#</a> Quartz 实现定时任务的动态调度</h3> <h4 id="什么是动态定时任务"><a href="#什么是动态定时任务" class="header-anchor">#</a> 什么是动态定时任务</h4> <ol><li>动态定时任务，即定时任务的动态调度，可根据需求自动的进行任务的生成、暂停、恢复、删除和更新操作。</li> <li>Quartz 本身没有提供动态调度的功能，需要自己根据相关的 API 开发。</li></ol> <h4 id="动态定时任务的使用场景"><a href="#动态定时任务的使用场景" class="header-anchor">#</a> 动态定时任务的使用场景</h4> <ol><li>订单成功后自动发短信通知</li> <li>每日推送的功能引发用户不满，不再定时推送</li> <li>每日下班前 30 分钟发送工作报表，遇节假日暂停发送</li> <li>......</li></ol> <h4 id="scheduler-调度器常用-api"><a href="#scheduler-调度器常用-api" class="header-anchor">#</a> Scheduler 调度器常用 API</h4> <ol><li><code>schedule.scheduleJob(JobDetail jobDetail, Trigger trigger)</code>：生成一个新的定时任务</li> <li><code>schedule.pauseJob(JobKey jobKey)</code>：暂停一个定时任务，参数  jobKey 代表该任务的唯一标识</li> <li><code>schedule.resumeJob(JobKey jobKey)</code>：恢复一个定时任务</li> <li><code>schedule.deleteJob(JobKey jobKey)</code>：删除一个定时任务</li> <li><code>schedule.rescheduleJob(TriggerKey triggerKey, Trigger newTrigger)</code>：修改一个定时任务</li> <li><code>schedule.triggerJob(JobKey jobKey)</code>：执行一次定时任务</li></ol> <h4 id="实现动态调度的定时任务"><a href="#实现动态调度的定时任务" class="header-anchor">#</a> 实现动态调度的定时任务</h4> <h5 id="自定义任务类"><a href="#自定义任务类" class="header-anchor">#</a> 自定义任务类</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bombax<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>job</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@PersistJobDataAfterExecution</span>   <span class="token comment">// 有状态的job</span>
<span class="token annotation punctuation">@DisallowConcurrentExecution</span>    <span class="token comment">// 禁止并发访问同一个 job 定义</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JobDataMap</span> jobDataMap <span class="token operator">=</span> jobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> count <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> jobDataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第&quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot;次执行，本次执行时间：&quot;</span> <span class="token operator">+</span> context<span class="token punctuation">.</span><span class="token function">getFireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobDataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="任务-bean"><a href="#任务-bean" class="header-anchor">#</a> 任务 Bean</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bombax<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobBean</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 任务名字
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> jobName<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 任务类
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> jobClass<span class="token punctuation">;</span>

    <span class="token comment">/**
     * cron 表达式
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cronExpression<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="操作任务的工具类"><a href="#操作任务的工具类" class="header-anchor">#</a> 操作任务的工具类</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bombax<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 生成一个定时任务
     * @param scheduler 调度器
     * @param jobBean 任务 Bean
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createJob</span><span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">JobBean</span> jobBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token punctuation">&gt;</span></span> jobClass <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> cronExpression <span class="token operator">=</span> jobBean<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            jobClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getJobClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span>jobClass<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">storeDurably</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 任务持久化</span>
                    <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 设置任务详细信息的唯一标识</span>
                    <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment">// （共享）数据初始化</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;_trigger&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 时间规则（cron 表达式</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 暂停定时任务
     * @param scheduler 调度器
     * @param jobName 任务名字
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">pauseJob</span><span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">String</span> jobName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobKey</span> jobKey <span class="token operator">=</span> <span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            scheduler<span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 恢复定时任务
     * @param scheduler 调度器
     * @param jobName 任务名字
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">resumeJob</span><span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">String</span> jobName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobKey</span> jobKey <span class="token operator">=</span> <span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            scheduler<span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除定时任务
     * @param scheduler 调度器
     * @param jobName 任务名字
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deleteJob</span><span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">String</span> jobName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobKey</span> jobKey <span class="token operator">=</span> <span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            scheduler<span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 执行一次定时任务
     * @param scheduler 调度器
     * @param jobName 任务名字
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">runJobOnce</span><span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">String</span> jobName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobKey</span> jobKey <span class="token operator">=</span> <span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            scheduler<span class="token punctuation">.</span><span class="token function">triggerJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 修改定时任务
     * @param scheduler 调度器
     * @param jobBean 任务 Bean
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">modifyJob</span><span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">JobBean</span> jobBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取任务触发器的唯一标识</span>
        <span class="token class-name">TriggerKey</span> triggerKey <span class="token operator">=</span> <span class="token class-name">TriggerKey</span><span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;_trigger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 通过唯一标识获取旧的触发器对象</span>
            <span class="token class-name">CronTrigger</span> oldTrigger <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CronTrigger</span><span class="token punctuation">)</span> scheduler<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 使用新 cron 表达式构建新的触发器</span>
            <span class="token class-name">String</span> newCron <span class="token operator">=</span> jobBean<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CronTrigger</span> newTrigger <span class="token operator">=</span> oldTrigger<span class="token punctuation">.</span><span class="token function">getTriggerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>newCron<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMisfireHandlingInstructionDoNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 调度器更新任务的触发器</span>
            scheduler<span class="token punctuation">.</span><span class="token function">rescheduleJob</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">,</span> newTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div><h5 id="编写控制器操作任务"><a href="#编写控制器操作任务" class="header-anchor">#</a> 编写控制器操作任务</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bombax<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/quartz&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> jobName <span class="token operator">=</span> <span class="token string">&quot;myjob&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/create&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">createJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobBean</span> jobBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JobBean</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> <span class="token class-name">MyJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;0/2 * * * * ? *&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JobUtils</span><span class="token punctuation">.</span><span class="token function">createJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> jobBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;任务创建成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pause&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pauseJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobUtils</span><span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;任务暂停成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;resume&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">resumeJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobUtils</span><span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;任务恢复成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/delete&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deleteJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobUtils</span><span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;任务删除成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/once&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">runOnceJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobUtils</span><span class="token punctuation">.</span><span class="token function">runJobOnce</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;任务执行一次成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/modify&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">modifyJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JobBean</span> jobBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JobBean</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> <span class="token class-name">MyJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;0/5 * * * * ? *&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JobUtils</span><span class="token punctuation">.</span><span class="token function">modifyJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> jobBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;任务修改成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h5 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试</h5> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">### 生成一个定时任务</span>
GET http://localhost:8080/quartz/create

<span class="token comment">### 暂停定时任务</span>
GET http://localhost:8080/quartz/pause

<span class="token comment">### 恢复定时任务</span>
GET http://localhost:8080/quartz/resume

<span class="token comment">### 删除定时任务</span>
GET http://localhost:8080/quartz/delete

<span class="token comment">### 执行一次定时任务</span>
GET http://localhost:8080/quartz/once

<span class="token comment">### 修改定时任务</span>
GET http://localhost:8080/quartz/modify
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="关于修改定时任务的问题"><a href="#关于修改定时任务的问题" class="header-anchor">#</a> 关于修改定时任务的问题</h4> <p><strong>问题描述：</strong></p> <ul><li>当调度器执行 <code>schedule.rescheduleJob(TriggerKey triggerKey, Trigger newTrigger)</code> 去更新某个 triggerKey 对应的新 trigger 时，会导致新 trigger 相关联的定时任务立即执行一次（暂停任务亦如此）。</li></ul> <p><strong>解决方法：</strong></p> <ul><li>为 CronScheduleBuilder 设置 <code>withMisfireHandlingInstructionDoNothing()</code>，忽略所有错误的任务，按正常调度继续执行。</li></ul> <h3 id="quartz-的持久化"><a href="#quartz-的持久化" class="header-anchor">#</a> Quartz 的持久化</h3> <h4 id="为什么需要-quartz-持久化"><a href="#为什么需要-quartz-持久化" class="header-anchor">#</a> 为什么需要 Quartz 持久化</h4> <ul><li>Quartz 持久化即将定时任务保存在介质中，持久化目的是保证任务在发生异常后也不会丢失。</li> <li>Quartz 默认将定时任务存在内存(RAMJobSrote)，优点是数据读取速度快，缺点是一旦异常发生，任务数据就没有了。</li> <li>Quartz 还提供另外一种存储在数据库的方案(JDBCJobStore)解决上面的问题。</li></ul> <h4 id="如何实现-jdbcjobstore"><a href="#如何实现-jdbcjobstore" class="header-anchor">#</a> 如何实现 JDBCJobStore</h4> <ol><li><p>创建持久化相关表：可以在 Quartz 发行版的 <code>docs/dbTables</code> 目录或 <code>quartz-core\src\main\resources\org\quartz\impl\jdbcjobstore</code> 中找到表创建 SQL 脚本。</p></li> <li><p>引入相关依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- quartz --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- lombok --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- druid 数据库连接池 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 驱动程序 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- ORM 框架：mybatis-plus --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li> <li><p>相关配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 数据源配置</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/quartz<span class="token punctuation">-</span>db<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
  <span class="token comment"># quartz 存储设置</span>
  <span class="token key atrule">quartz</span><span class="token punctuation">:</span>
    <span class="token comment"># 默认存储到 memory</span>
    <span class="token key atrule">job-store-type</span><span class="token punctuation">:</span> jdbc
    <span class="token key atrule">jdbc</span><span class="token punctuation">:</span>
      <span class="token comment"># always-每次先清空数据库进行初始化</span>
      <span class="token comment"># embedded-只初始化内存数据库，默认值</span>
      <span class="token comment"># never-不进行初始化</span>
      <span class="token key atrule">initialize-schema</span><span class="token punctuation">:</span> always <span class="token comment"># 首次运行请使用 always</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>任务详细消息的持久化设置</p> <ul><li><p><code>storeDurably()</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">JobDetail</span> <span class="token function">jobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">MyJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">storeDurably</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 持久化</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 唯一标识</span>
        <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment">// （共享）数据初始化</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li> <li><p>项目中配置的是 Cron 触发器，涉及到记录 <code>qrtz_cron_triggers</code>、<code>qrtz_job_details</code>、<code>qrtz_triggers</code>三表。</p></li></ol> <h3 id="quartz-的集群操作"><a href="#quartz-的集群操作" class="header-anchor">#</a> Quartz 的集群操作</h3> <h4 id="为什么需要-quartz-集群"><a href="#为什么需要-quartz-集群" class="header-anchor">#</a> 为什么需要 Quartz 集群</h4> <ol><li>防止单点故障，减少对业务的影响。
<ul><li>例如：一个任务在一台机器上跑，如果这台机器下线，可以将任务分配到第二台机器执行。</li></ul></li> <li>通过负载均衡，减少节点的压力。
<ul><li>例如：在 10 点要触发 1000 个任务，如果有 10 个节点，则每个节点只需要执行 100 个任务。</li></ul></li> <li>注意事项
<ul><li>Quartz 集群不能选择存储内存类型（必须持久化到数据库），因集群的多个节点要进行数据共享和通信。</li> <li>Quartz 使用的是随机的负载均衡算法，不能执行节点执行。</li> <li>注意 Quartz 服务器时间的同步。</li></ul></li></ol> <h4 id="quartz-集群的实现"><a href="#quartz-集群的实现" class="header-anchor">#</a> Quartz 集群的实现</h4> <h5 id="集群-properties-常用配置"><a href="#集群-properties-常用配置" class="header-anchor">#</a> 集群 properties 常用配置</h5> <ul><li>集群开关：<code>org.quartz.jobStore.isClustered</code>: <code>true | false(默认)</code> <ul><li>注意该属性与 <code>job-store-type</code> 的值关联，只有 <code>job-store-type: jdbc</code> 时可设置为 <code>true</code></li></ul></li> <li>线程池大小：<code>org.quartz.threadPool.threadCount</code>，默认 10 个</li> <li>集群实例名：<code>org.quartz.scheduler.instanceName</code>，同一个集群内多个节点上的该名称必须一致。默认值 <code>quartzScheduler</code></li> <li>实例 id：<code>org.quartz.scheduler.instanceId</code>，同一个集群内多个节点上的实例 id 必须不同。
<ul><li>设置为 <code>AUTO</code> 表示让 Quartz 自动生成一个唯一的实例 ID（计算机名+时间戳）。</li> <li>如果不指定，所有实例 id 的值均为 <code>NON_CLUSTERED</code></li></ul></li> <li>持久化类（含事务管理）：<code>org.quartz.jobStore.class</code>，其值可选用 <code>RAMJobStore</code>、<code>JobStoreTX</code>、<code>JobStoreCMT</code>等。
<ul><li>当 <code>job-store-type: memory</code> 时，默认值 <code>org.quartz.simpl.RAMJobStore</code></li> <li>当 <code>job-store-type: jdbc</code> 时，默认值 <code>JobStoreCMT</code> 的子类 <code>LocalDataSourceJobStore</code></li></ul></li> <li>数据库驱动代理类：<code>org.quartz.jobStore.driverDelegateClass</code>，用来匹配不投数据库的实现类。
<ul><li>默认值为标准 JDBC 驱动代理：<code>org.quartz.impl.jdbcjobstore.StdJDBCDelegate</code>，Quartz 将会根据所使用的数据库驱动自动选择合适的代理类。</li></ul></li> <li>misfire 阈值：<code>org.quartz.jobStore.misfireThreshold</code>，单位：毫秒，默认 60000ms</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 数据源配置</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/quartz<span class="token punctuation">-</span>db<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
  <span class="token comment"># quartz 存储设置</span>
  <span class="token key atrule">quartz</span><span class="token punctuation">:</span>
    <span class="token comment"># 默认存储到 memory</span>
    <span class="token key atrule">job-store-type</span><span class="token punctuation">:</span> jdbc
    <span class="token key atrule">jdbc</span><span class="token punctuation">:</span>
      <span class="token comment"># always-每次先清空数据库进行初始化</span>
      <span class="token comment"># embedded-只初始化内存数据库，默认值</span>
      <span class="token comment"># never-不进行初始化</span>
      <span class="token key atrule">initialize-schema</span><span class="token punctuation">:</span> always <span class="token comment"># 首次运行请使用 always</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">org</span><span class="token punctuation">:</span>
        <span class="token key atrule">quartz</span><span class="token punctuation">:</span>
          <span class="token key atrule">jobStore</span><span class="token punctuation">:</span>
            <span class="token key atrule">isClustered</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">class</span><span class="token punctuation">:</span> org.springframework.scheduling.quartz.LocalDataSourceJobStore
            <span class="token key atrule">driverDelegateClass</span><span class="token punctuation">:</span> org.quartz.impl.jdbcjobstore.StdJDBCDelegate
            <span class="token key atrule">misfireThreshold</span><span class="token punctuation">:</span> <span class="token number">120000</span>
          <span class="token key atrule">threadPool</span><span class="token punctuation">:</span>
            <span class="token key atrule">threadCount</span><span class="token punctuation">:</span> <span class="token number">20</span>
          <span class="token key atrule">scheduler</span><span class="token punctuation">:</span>
            <span class="token key atrule">instanceName</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>cluster
            <span class="token key atrule">instanceId</span><span class="token punctuation">:</span> AUTO
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h5 id="节点的重复执行问题"><a href="#节点的重复执行问题" class="header-anchor">#</a> 节点的重复执行问题</h5> <ul><li><p>防止集群的节点重复执行任务，其原理就是使用锁。</p></li> <li><p>Quartz 默认使用基于数据库的锁定机制来确保同一时刻只有一个节点在运行作业</p> <ul><li>如果一个节点无法获得锁，则它将等待直到能够获得锁（相关表 <code>qrtz_locks</code>）。</li> <li>如果一个节点获得了锁，任务将在该节点上执行，完成任务时，节点会将作业状态更新到数据库通知其他节点。</li></ul></li> <li><p>出现问题的原因是两个节点 <code>initialize-schema</code> 设置的都是 <code>true</code>，导致<strong>第二个节点启动时再次清空数据库进行初始化</strong>。</p></li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/06/12, 00:25:27</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/micro-service-ecology/Shiro/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">安全框架之 Shiro</div></a> <a href="/micro-service-ecology/XXL-JOB/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">定时任务框架之 XXL-JOB</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/micro-service-ecology/Shiro/" class="prev">安全框架之 Shiro</a></span> <span class="next"><a href="/micro-service-ecology/XXL-JOB/">定时任务框架之 XXL-JOB</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-basic/jdbc-core/"><div>
            JDBC 核心技术(JDK21版)
            <!----></div></a> <span class="date">09-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-0/"><div>
            第00章_写在前面
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-basic/mysql-from-beginners-to-advanced/advanced/chapter-1/"><div>
            第01章_Linux 下 MySQL 的安装与使用
            <!----></div></a> <span class="date">05-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1214025526@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coderofmutou" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/ismutou" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>bombax | <a href="https://github.com/coderofmutou/coderofmutou.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca5c989c.js" defer></script><script src="/assets/js/3.f2884e99.js" defer></script><script src="/assets/js/2.81e8b964.js" defer></script><script src="/assets/js/51.6728bddb.js" defer></script>
  </body>
</html>
